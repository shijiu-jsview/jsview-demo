!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).jsviewreact={})}(this,function(t){"use strict";function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(r){return function(){var t,e,i,n=o(r);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()){var s=o(this).constructor;t=Reflect.construct(n,arguments,s)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!=typeof i&&"function"!=typeof i?l(e):i}}function u(t,e,i){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(i):s.value}})(t,e,i||t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function p(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s,r=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){a=!0,s=t},f:function(){try{r||null==n.return||n.return()}finally{if(a)throw s}}}}void 0===window.Forge&&(window.Forge={});var d=window.Forge,f=function(){function c(t,e){if(v(this,c),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",t){if(!0===t.startsWith("url")){var i=t.indexOf("(")+1,n=t.lastIndexOf(")");t=t.substring(i,n).trim()}if(!0!==t.startsWith("data:")){if(!0===t.startsWith("/")&&(t=document.location.origin+t),!0===t.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var s=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,s)}t=window.JsView.React.__MainPath+t.substring(1)}if(this.href=t,e){var r=this.href,a=r.indexOf("#");0<a&&(this.hash=r.substring(a),r=r.substring(0,a));var o=r.indexOf("?");1<o&&(this.search=r.substring(o),r=r.substring(0,o));var l=r,h=l.indexOf("://");this.protocol=0<h?l.substring(0,h+1):"";var u=1<h?l.substring(h+3):"";h=u.indexOf("/"),this.host=0<h?u.substring(0,h):"",this.pathname=1<h?u.substring(h):"",this.origin=0<h?this.protocol+"//"+this.host:"",h=this.host.indexOf(":"),this.hostname=0<h?this.host.substring(0,h):"",this.port=1<h?this.host.substring(h+1):""}}else this.href=t}}return r(c,[{key:"replace",value:function(t){this.href=t}}]),c}(),y=function(){function h(){v(this,h)}return r(h,null,[{key:"SetBackgroundColor",value:function(t,e,i){var n,s=h.TextureManager.GetColorTexture(e);i&&(n=new d.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var r=new d.TextureSetting(s,n);t.ResetTexture(r)}},{key:"SetBackgroundImage",value:function(t,e,i,n,s,r){if("string"==typeof e&&(e=new f(e)),e instanceof f==!1)throw Error("Bad Argument.",e);var a,o;a=e.href.endsWith("gif")||e.href.endsWith("webp")?h.TextureManager.GetGifImage(e.href):h.TextureManager.GetImage2(e.href,!1,s,r||d.ColorSpace.RGBA_8888),i&&(o=new d.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var l=new d.ExternalTextureSetting(a,o);t.ResetTexture(l),n&&a.RegisterLoadImageCallback(null,function(){n({width:a.Width,height:a.Height})})}},{key:"SetVideoTexture",value:function(t,e,i){var n,s=h.TextureManager.GetColorTexture(e);i&&(n=new d.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var r=new d.TextureSetting(s,n);t.ResetTexture(r)}},{key:"GetTextWidth",value:function(t){return t.str||(t.str=""),t.font||(t.font=d.TextUtils._sDefaultFont),t.size||(t.size=d.TextUtils._sDefaultFontSize),"italic"!==t.italic&&(t.italic=""),"bold"!==t.bold&&(t.bold=""),window.PlatformUtils.GetTextWidth(t)}},{key:"RequestSwap",value:function(){d.sRenderBridge.RequestSwap()}},{key:"SetImgTexSize",value:function(t,e){var i={size:e,refNum:0};h.TextureInfo.Cache[t.Source]=i}},{key:"RefImgTexSize",value:function(n,s){var t=h.TextureInfo.Cache[n.Source];t?(0<t.refNum?t.refNum++:t.refNum=1,s(t.size)):n.RegisterLoadImageCallback(null,function(){var t={width:n.Width,height:n.Height};s(t);var e=h.TextureInfo.Cache[n.Source];if(e)0<e.refNum?e.refNum++:e.refNum=1;else{var i={size:t,refNum:1};h.TextureInfo.Cache[n.Source]=i}})}},{key:"UnrefImgTexSize",value:function(t){if(t){var e=h.TextureInfo.Cache[t.Source];e&&(e.refNum--,e.refNum<=0&&h.TextureInfo.Unused.add(t.Source))}}},{key:"ClearUnusedTexSize",value:function(){var t,e=p(h.TextureInfo.Unused);try{for(e.s();!(t=e.n()).done;){var i=t.value,n=h.TextureInfo.Cache[i];n.refNum<-2?(delete h.TextureInfo.Cache[i],h.TextureInfo.Unused.delete(i)):n.refNum<=0?n.refNum--:h.TextureInfo.Unused.delete(i)}}catch(t){e.e(t)}finally{e.f()}}}]),h}();y.TextureInfo={Cache:{},Unused:new Set},y.TextureManager=null,y.RootView=null,y.RootActivity=null,y.HaltKeyEvent=!1;var s=function(){function e(t){v(this,e),this.target=null,this.timeStamp=Date.now(),this.type=t}return r(e,[{key:"initEvent",value:function(t){this.type=t}}]),e}(),w=function(){a(n,s);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this,t)).keyCode=-1,e.key=-1,e.repeat=0,e}return r(n,null,[{key:"JsvGetKeyFromCode",value:function(t){return new Map([[n.KeyCode.Enter,n.Key.Enter],[n.KeyCode.ArrowUp,n.Key.ArrowUp],[n.KeyCode.ArrowDown,n.Key.ArrowDown],[n.KeyCode.ArrowLeft,n.Key.ArrowLeft],[n.KeyCode.ArrowRight,n.Key.ArrowRight]])[t]}}]),n}();w.Type={KEYDOWN:"keydown",KEYUP:"keyup"},w.Key={Enter:"Enter",ArrowUp:"ArrowUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight"},w.KeyCode={Enter:13,ArrowUp:38,ArrowDown:40,ArrowLeft:37,ArrowRight:39};var g={cnt:0},j=function(){function i(t){v(this,i),this.type=t,this.cachedValues=null,this.onSyncCallback=null}return r(i,[{key:"setOnSyncCallback",value:function(t){this.onSyncCallback=t,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(t,e){this.cachedValues||(this.cachedValues={}),this.cachedValues[t]=e,this.syncLastCaches(!1),y.RequestSwap()}},{key:"syncLastCaches",value:function(t){var e=i.LastModified[this.type];!t&&e===this||(i.LastModified[this.type]=this,e&&e.cachedValues&&"function"==typeof e.onSyncCallback&&(e.onSyncCallback(e.cachedValues),e.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){for(var t=0,e=Object.values(i.LastModified);t<e.length;t++){e[t].syncLastCaches(!0)}g.cnt=(g.cnt+1)%65535}}]),i}();j.LastModified={};var m=function(){function e(t){v(this,e),this.activity=new d.ReactActivity("ForgeReactActivity",t,this.OnKeyDown.bind(this),this.OnKeyUp.bind(this)),this._Init()}return r(e,[{key:"_Init",value:function(){console.log("ForgeReactActivity.OnCreate()."),y.TextureManager=this.activity.GetTextureManager(),y.RootView=new d.LayoutView,y.RootActivity=this.activity,document.jsvUpdateRootElement(y.RootView);var t=null;d.DesignMap&&(t=d.DesignMap());var e=t?t.width:1280,i=Math.floor(9*e/16);this.activity.SetContentView(y.RootView,{x:0,y:0,width:e,height:i}),d.sRenderBridge.AddWillSwapListener("forgeSwap",function(){j.SyncAllCachedProperty(),y.ClearUnusedTexSize()}),window.JsView.React.Render()}},{key:"OnKeyDown",value:function(t){if(y.HaltKeyEvent){var e=new w(w.Type.KEYDOWN);return e.keyCode=t.keyCode,e.repeat=t.repeat,document.dispatchEvent(e),!0}return!1}},{key:"OnKeyUp",value:function(t){if(y.HaltKeyEvent){var e=new w(w.Type.KEYUP);return e.keyCode=t.keyCode,e.key=w.JsvGetKeyFromCode(e.keyCode),e.repeat=t.repeat,document.dispatchEvent(e),!0}return!1}}]),e}();window.JsView&&(window.JsView.React={DesignMap:null,Render:null,Extension:y,UrlRef:f},window.JsView.Vue=window.JsView.React);var E=function(){function e(t){v(this,e),this.ownerDocument=window.document,this.nodeType=t,this.parentNode=null,this.jsvEventListener=null}return r(e,[{key:"appendChild",value:function(t){t.parentNode=this}},{key:"removeChild",value:function(t){t.parentNode=null}},{key:"insertBefore",value:function(t){t.parentNode=this}},{key:"addEventListener",value:function(t,e){this.jsvEventListener||(this.jsvEventListener={});var i=this.jsvEventListener[t];i||(i=new Set,this.jsvEventListener[t]=i),i.add(e)}},{key:"removeEventListener",value:function(t,e){if(this.jsvEventListener){var i=this.jsvEventListener[t];i&&(i.delete(e),i.size<=0&&this.jsvEventListener.hasOwnProperty(t)&&delete this.jsvEventListener[t],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(t){if(this.jsvEventListener){var e=this.jsvEventListener[t.type];if(e){t.target||(t.target=document.activeElement);var i,n=p(e);try{for(n.s();!(i=n.n()).done;){(0,i.value)(t)}}catch(t){n.e(t)}finally{n.f()}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No event added.")}}]),e}();E.ELEMENT_NODE=1,E.TEXT_NODE=3,E.DOCUMENT_NODE=9;var O=function(){a(e,s);var t=h(e);function e(){return v(this,e),t.apply(this,arguments)}return e}();O.Type={FOCUS:"focus",BLUR:"blur"};function S(t){if(v(this,S),this.top=null,this.right=null,this.bottom=null,this.left=null,t&&!1!==t.startsWith("inset")){var e=t.indexOf("(")+1,i=t.substring(e),n=C.ConvertRect(i);this.top=n.top,this.right=n.right,this.bottom=n.bottom,this.left=n.left}else console.error("Inset.Parse() InvalidArgs: value=",t)}function T(t){if(v(this,T),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,t){var e=t.indexOf(")")+1,i=t.substring(0,e),n=t.substring(e);this.source=new f(i),this.slice=C.ConvertRect(n)}else console.error("BorderImage.constructor() InvalidArgs: value=",t)}var R=function(){a(e,s);var t=h(e);function e(){return v(this,e),t.apply(this,arguments)}return e}(),C=function(){function w(){v(this,w)}return r(w,null,[{key:"ConvertFloat",value:function(t){return!t||"string"!=typeof t?t:parseFloat(t)}},{key:"ConvertPx",value:function(t){return!t||"string"!=typeof t?t:"0"===t?0:t.endsWith("px")?parseInt(t):t}},{key:"ConvertRect",value:function(t){var e=w.SplitString(t," "),i={top:0<e.length?parseInt(e[0]):0,right:1<e.length?parseInt(e[1]):null,bottom:2<e.length?parseInt(e[2]):null,left:3<e.length?parseInt(e[3]):null};return i.right=i.right||0===i.right?i.right:i.top,i.bottom=i.bottom||0===i.bottom?i.bottom:i.top,i.left=i.left||0===i.left?i.left:i.right,i}},{key:"ConvertCorner",value:function(t){var e=w.SplitString(t," "),i={topLeft:0<e.length?parseInt(e[0]):0,topRight:1<e.length?parseInt(e[1]):null,bottomRight:2<e.length?parseInt(e[2]):null,bottomLeft:3<e.length?parseInt(e[3]):null};return i.topRight=i.topRight||0===i.topRight?i.topRight:i.topLeft,i.bottomRight=i.bottomRight||0===i.bottomRight?i.bottomRight:i.topLeft,i.bottomLeft=i.bottomLeft||0===i.bottomLeft?i.bottomLeft:i.bottomRight,i}},{key:"ConvertSize",value:function(t){var e=w.SplitString(t," "),i={width:0<e.length?parseInt(e[0]):0,height:1<e.length?parseInt(e[1]):null};return i.height=i.height||0===i.height?i.height:i.width,i}},{key:"ConvertAnimation",value:function(t){if(null===t||0===t.length)return null;var e=t.indexOf("cubic-bezier"),i=[];if(0<=e){var n,s=t.indexOf(")"),r=t.substring(e,s+1),a=p(w.SplitString(t,r));try{for(a.s();!(n=a.n()).done;){var o=n.value,l=w.SplitString(o," ");i=i.concat(l)}}catch(t){a.e(t)}finally{a.f()}i.push(r)}else i=w.SplitString(t," ");for(var h=null,u=0,c=1,v=t.includes("alternate"),d=2;d<i.length;d++)if("infinite"!==i[d]){var f=w.ConvertTimeMs(i[d]);!1===isNaN(f)?u=f:(f=parseFloat(i[d]),!1===isNaN(f)?c=f:h=i[d])}else c=-1;var y=1<i.length?w.ConvertTimeMs(i[1]):0;return{name:0<i.length?i[0]:"",duration:y,timingFunction:w.ConvertEasing(h,y),delay:u,iterationCount:c,direction:v}}},{key:"ConvertTransition",value:function(t){if(null==t||0==t.length)return null;for(var e={},i=new Array,n=t.split(","),s=0;s<n.length;s++)if(0<=n[s].indexOf("(")){for(var r=s;r<n.length&&n[r].indexOf(")")<0;)r++;for(var a="",o=s;o<=r;o++)o!=s&&(a+=","),a+=n[o];s=r,i=i.concat(a)}else i=i.concat(n[s]);var l,h=p(i);try{for(h.s();!(l=h.n()).done;){var u=l.value,c=w.ConvertAnimation(u);if("all"==(e[c.name]=c).name)for(var v=new Array("opacity","left","top","width","height","transform"),d=0,f=v;d<f.length;d++){e[f[d]]=c}}}catch(t){h.e(t)}finally{h.f()}return e}},{key:"ConvertTimeMs",value:function(t){var e=NaN;return(t=(t=t||"").trim()).endsWith("ms")?e=1:t.endsWith("s")&&(e=1e3),e*=parseFloat(t)}},{key:"ConvertEasing",value:function(t,e){var i=d.Easing.Circular.InOut;if(!t)return i;if(t.includes("ease"))i=t.includes("-in-out")?d.Easing.Circular.InOut:t.includes("-out")?d.Easing.Circular.Out:t.includes("-in")?d.Easing.Circular.In:d.Easing.Circular.InOut;else if(t.includes("linear"))i=null;else if(t.includes("cubic-bezier")){var n=w.ConvertBezier(t);i=new d.BezierEasing(n.x1,n.y1,n.x2,n.y2,e)}else if(t.includes("steps")){var s=w.ConvertSteps(t);i=new d.StepsEasing(s.steps,s.type)}return i}},{key:"ConvertBezier",value:function(t){var e=t.indexOf("(");0<=e&&(t=t.substring(e+1));var i=w.SplitString(t,",");return{x1:0<i.length?parseFloat(i[0]):0,y1:1<i.length?parseFloat(i[1]):0,x2:2<i.length?parseFloat(i[2]):0,y2:3<i.length?parseFloat(i[3]):0}}},{key:"ConvertSteps",value:function(t){var e=t.indexOf("(");0<=e&&(t=t.substring(e+1));var i=w.SplitString(t,",");return{steps:0<i.length?parseInt(i[0]):1,type:!(1<i.length)||i[1].includes("start")?0:1}}},{key:"ConvertOverflow",value:function(t,e){return t&&!t.includes("visible")?e.HIDDEN:e.VISIBLE}},{key:"ConvertObjectFit",value:function(t,e){return(t=t||"").includes("fill")?e.FILL:t.includes("contain")?e.CONTAIN:t.includes("cover")?e.COVER:t.includes("none")?e.NONE:t.includes("scale-down")?e.SCALEDOWN:e.CONTAIN}},{key:"SplitString",value:function(t,e){var i=(t=t||"").trim().split(e);if(" "!==e)return i;var n,s=[],r=p(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;a&&s.push(a)}}catch(t){r.e(t)}finally{r.f()}return s}}]),w}(),I=new Set(["textOverflow","wordWrap","textShadow","fontSize","lineHeight","color","fontFamily","fontStyle","fontWeight","textAlign"]),A=function(){function n(){v(this,n),this.jsvStore={},this.jsvLazySyncCache=new j("style"),this.jsvLockedProps={},this.jsvTextClassRef=null}return r(n,[{key:"setProperty",value:function(t,e){"function"==typeof document.jsvCheckStyleFormat&&document.jsvCheckStyleFormat(t,e),this.jsvLockedProps[t]=!0,e=this.jsvConvertPropValue(t,e),this._JsvUpdateProperty(t,e)}},{key:"_JsvUpdateProperty",value:function(t,e){if(this.jsvStore[t]!==e){this.jsvStore[t]=e;var i=n.JsvGetStyleType(t);this.jsvLazySyncCache.setCacheProperty(i,void 0)}}},{key:"getPropertyValue",value:function(t){return this.jsvStore[t]}},{key:"setDefaultValueBeforeForgeViewLoad",value:function(t,e){this.jsvStore[t]=e}},{key:"jsvApplyClasses",value:function(t){if(t){var e,i={},n=p(t.split(" "));try{for(n.s();!(e=n.n()).done;){var s=e.value;if(d.ReactUtils.StyleClassMap.hasOwnProperty(s)){var r=d.ReactUtils.StyleClassMap[s],a=r.getAttach();if(null==a){var o=r.getStyles();for(var l in a={altStyles:{}},o)a.altStyles[l]=this.jsvConvertPropValue(l,o[l]);r.updateAttach(a)}Object.assign(i,a.altStyles),"text"===r.classType()&&(this.jsvTextClassRef=r)}}}catch(t){n.e(t)}finally{n.f()}for(var h in i)this.jsvLockedProps[h]||this._JsvUpdateProperty(h,i[h])}}},{key:"jsvSaveTextCachedSet",value:function(t){var e=this.jsvTextClassRef.getAttach();e.cachedSet=t;var i,n={},s=p(I);try{for(s.s();!(i=s.n()).done;){var r=i.value;this.jsvStore.hasOwnProperty(r)?n[r]=this.jsvStore[r]:n[r]=void 0}}catch(t){s.e(t)}finally{s.f()}e.majorStyles=n}},{key:"jsvCheckTextStyleChange",value:function(){var t=this.jsvTextClassRef.getAttach();if(!t.hasOwnProperty("cachedSet"))return!1;for(var e in t.majorStyles)if(t.majorStyles[e]!==this.jsvStore[e])return this.jsvTextClassRef.fallbackMode(e),!1;return!0}},{key:"jsvSetChangedListener",value:function(s){this.jsvLazySyncCache.setOnSyncCallback(function(t){for(var e={},i=0,n=Object.keys(t);i<n.length;i++){e[n[i]]=!0}s(e)})}},{key:"jsvConvertPropValue",value:function(t,e){switch(t){case n.PROP.VISIBILITY:case n.PROP.DISPLAY:return e.toUpperCase();case n.PROP.OVERFLOW:return C.ConvertOverflow(e,n.Overflow);case n.PROP.OBJECTFIT:return C.ConvertObjectFit(e,n.ObjectFit);case n.PROP.TRANSFORM:case n.PROP.TRANSFORMORIGIN:return e;case n.PROP.CLIPPATH:return new S(e);case n.PROP.BORDERIMAGE:return new T(e);case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return C.ConvertRect(e);case n.PROP.BORDERRADIUS:return C.ConvertCorner(e);case n.PROP.ANIMATION:return C.ConvertAnimation(e);case n.PROP.TRANSITION:return C.ConvertTransition(e);case n.PROP.OPACITY:return C.ConvertFloat(e);default:return C.ConvertPx(e)}}}],[{key:"JsvGetStyleType",value:function(t){switch(t){case n.PROP.LEFT:case n.PROP.RIGHT:case n.PROP.TOP:case n.PROP.BOTTOM:case n.PROP.ZINDEX:return n.TYPE.LAYOUT_POS;case n.PROP.WIDTH:case n.PROP.HEIGHT:case n.PROP.VISIBILITY:case n.PROP.DISPLAY:case n.PROP.CLIPPATH:case n.PROP.OVERFLOW:case n.PROP.OBJECTFIT:case n.PROP.TRANSFORM:case n.PROP.TRANSFORMORIGIN:case n.PROP.PERSPECTIVE:case n.PROP.PERSPECTIVEORIGIN:case n.PROP.BACKFACEVISIBILITY:case n.PROP.TRANSFORMSTYLE:return n.TYPE.LAYOUT_SIZE;case n.PROP.BACKGROUNDCOLOR:case n.PROP.BACKGROUNDIMAGE:case n.PROP.BORDERRADIUS:return n.TYPE.BACKGROUND;case n.PROP.COLOR:case n.PROP.LINEHEIGHT:case n.PROP.WHITESPACE:case n.PROP.FONTFAMILY:case n.PROP.FONTSIZE:case n.PROP.FONTSTYLE:case n.PROP.FONTWEIGHT:case n.PROP.TEXTALIGN:case n.PROP.TEXTSHADOW:case n.PROP.TEXTOVERFLOW:return n.TYPE.FOREGROUND;case n.PROP.BORDERIMAGE:case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return n.TYPE.BORDER;case n.PROP.ANIMATION:return n.TYPE.ANIMATION;case n.PROP.TRANSITION:return n.TYPE.TRANSITION;case n.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+t),null}}}]),n}();A.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation",TRANSITION:"transition"},A.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},A.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},A.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",DISPLAY:"display",BACKFACEVISIBILITY:"backfaceVisibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",TRANSFORMORIGIN:"transformOrigin",PERSPECTIVE:"perspective",PERSPECTIVEORIGIN:"perspectiveOrigin",ZINDEX:"zIndex",TRANSFORMSTYLE:"transformStyle",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function e(t){var e=A.PROP[t];Object.defineProperty(A.prototype,e,{set:function(t){this.setProperty(e,t)},get:function(){return this.getPropertyValue(e)}})}for(var V in A.PROP)e(V);var P=null,b=function(){function t(){v(this,t)}return r(t,null,[{key:"reactEventHandlers",value:function(t){return null==P&&this._getReactToken(t),t["__reactEventHandlers$"+P]}},{key:"reactInternalInstance",value:function(t){return null==P&&this._getReactToken(t),t["__reactInternalInstance$"+P]}},{key:"_getReactToken",value:function(t){for(var e in t)if(0<=e.indexOf("__reactEventHandlers")||0<=e.indexOf("__reactInternalInstance")){var i=e.indexOf("$");P=e.substring(i+1);break}}}]),t}(),k=0,x=function(){a(n,E);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this,E.ELEMENT_NODE)).parentElement=null,e.tagName=e.constructor.name.replace("Element","").toUpperCase(),e._Count=k++,e.childElementCount=0,e.childNodes=new Set,e.firstElementChild=null,e.lastElementChild=null,e.tagName===n.TAG.STYLE?(e.style=null,e.jsvMainView=null):(e.style=new A,e.jsvMainView=new d.LayoutView),e.jsvMaskView=null,e.jsvAnimation=null,e.jsvStore={transition:null,transitionTmp:null,textContent:null,clientWidth:NaN,clientHeight:NaN,textureWidth:NaN,textureHeight:NaN},e.jsvLazySyncCache=new j("element"),e.instantSwapCallback=null,e.reactEventHandlers=null,e.reactInternalInstance=null,e}return r(n,[{key:"appendChild",value:function(t){if(u(o(n.prototype),"appendChild",this).call(this,t),(t.parentElement=this).firstElementChild||(this.firstElementChild=t),this.lastElementChild=t,this.childNodes.add(t),this.childElementCount++,t.nodeType===E.ELEMENT_NODE&&t.tagName!==n.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);t.jsvOnLoadForgeView(),t.style.jsvSetChangedListener(t.jsvOnStyleChanged.bind(t));var e=t.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(t.jsvMaskView,e)}}},{key:"removeChild",value:function(t){u(o(n.prototype),"removeChild",this).call(this,t),t.parentElement=null,this.childNodes.delete(t),this.childElementCount--,0==this.childElementCount&&(this.firstElementChild=null,this.lastElementChild=null),t instanceof n&&(t.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(t.jsvMaskView))}},{key:"insertBefore",value:function(t,e){u(o(n.prototype),"appendChild",this).call(this,t,e),(t.parentElement=this).appendChild(t)}},{key:"setAttribute",value:function(t,e){this[t];this[t]=e,"class"===t?this.style.jsvApplyClasses(e):t.startsWith(n.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,e)}},{key:"removeAttribute",value:function(t){this[t]=void 0,t.startsWith(n.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,void 0)}},{key:"getAttribute",value:function(t){return this[t]}},{key:"hasAttribute",value:function(t){return console.log("Element.hasAttribute() name="+t),!!this[t]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var t=document.activeElement;if(document.activeElement=this,t){var e=new O(O.Type.BLUR);e.target=t,document.dispatchEvent(e)}var i=new O(O.Type.FOCUS);document.dispatchEvent(i)}},{key:"jsvOnLoadForgeView",value:function(){var e=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new d.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(t){e.jsvSetElementProp(t)})}},{key:"jsvSetElementProp",value:function(t){this.jsvMainView&&this.jsvMainView.SetElementProp(t,y.RootActivity)}},{key:"jsvOnUnloadForgeView",value:function(){this.jsvMainView&&this.jsvMainView.ClearViews()}},{key:"jsvOnStyleChanged",value:function(t){var e=!!t[A.TYPE.LAYOUT_SIZE],i=!1;t[A.TYPE.LAYOUT_POS]&&(e||(this.jsvFlushViewLayout(),i=!0)),t[A.TYPE.LAYOUT_SIZE]&&(this.jsvFlushViewLayout(),i=!0),t[A.TYPE.BACKGROUND]&&this.jsvFlushViewBackground(),t[A.TYPE.ANIMATION]&&this.jsvFlushViewAnimation(),t[A.TYPE.TRANSITION]&&!i&&this.jsvFlushViewTransition(),this.jsvFlushEventHandlers()}},{key:"jsvFlushEventHandlers",value:function(){null===this.reactEventHandlers&&(this.reactEventHandlers=b.reactEventHandlers(this),this.reactEventHandlers&&this.reactEventHandlers.onClick&&this.jsvMainView&&this.jsvMainView.EnableDivTouch(this,null))}},{key:"jsvApplyObjectFit",value:function(){return null}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var t={x:isNaN(this.style.left)?0:this.style.left,y:isNaN(this.style.top)?0:this.style.top,width:isNaN(this.style.width)?0:this.style.width,height:isNaN(this.style.height)?0:this.style.height},e=null;if(this.style.objectFit&&(e=this.jsvApplyObjectFit(t),this.style.objectFit===A.ObjectFit.FILL&&(e=null)),this.jsvMaskView.ResetCssTransform(this.style.transform,this.style.transformOrigin),this.style.perspective&&0<this.style.perspective){var i=this.style.perspectiveOrigin?this.style.perspectiveOrigin:null;this.jsvMainView.SetPerspective(this.style.perspective,i)}if(this.style.backfaceVisibility&&this.jsvMainView.SetBackfaceVisibility("visible"==this.style.backfaceVisibility),this.style.transformStyle&&this.jsvMainView.SetTransformStyle(this.style.transformStyle),this.jsvMaskView.ResetLayoutParams({x:t.x,y:t.y,width:this.clientWidth,height:this.clientHeight}),this.jsvMaskView!==this.jsvMainView){var n={x:0,y:0,width:this.jsvMaskView.LayoutParams.Width,height:this.jsvMaskView.LayoutParams.Height};this.jsvMainView.ResetLayoutParams(n)}this.jsvMaskView.SetVisibility(this.style.visibility);var s=null;null!==e&&window.JsView&&(s={x:e.x,y:e.y,width:e.width,height:e.height}),this.style.clipPath?s={x:this.style.clipPath.left,y:this.style.clipPath.top,width:this.jsvMaskView.LayoutParams.Width-this.style.clipPath.left-this.style.clipPath.right,height:this.jsvMaskView.LayoutParams.Height-this.style.clipPath.top-this.style.clipPath.bottom}:this.style.overflow===A.Overflow.HIDDEN&&null===this.jsvStore.textContent&&(s={x:0,y:0,width:this.style.width,height:this.style.height}),s?this.jsvMaskView.SetClipRect(s.x,s.y,s.width,s.height,!0):this.jsvMaskView instanceof d.ClipView&&this.jsvMaskView.SetClipRect(0,0,0,0,!1),void 0!==this.style.zIndex&&null!==this.style.zIndex&&this.jsvMaskView.SetZIndex(this.style.zIndex),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&(this.jsvStore.textureWidth=NaN,this.jsvStore.textureHeight=NaN,y.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius)),this.style.backgroundImage&&(this.jsvStore.textureWidth=NaN,this.jsvStore.textureHeight=NaN,y.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius))}},{key:"jsvFlushViewAnimation",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.animation){var t=document.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation=new d.CssKeyframeAnimation(t,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var i=this,e=new d.AnimationListener;e.OnEnd(function(t){var e;i.jsvAnimation=null,t&&((e=new R("animationend")).target=i,document.dispatchEvent(e),null==i.instantSwapCallback&&(i.instantSwapCallback=d.sRenderBridge.InstantPerformSwap.bind(d.sRenderBridge)),Promise.resolve().then(i.instantSwapCallback))}),this.jsvAnimation.Enable(d.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(e),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(null!=this.jsvStore.transitionTmp&&this.jsvStore.transitionTmp.syncTimes!=g.cnt&&-1!=this.jsvStore.transitionTmp.syncTimes){var t=this.jsvStore.transition;this.jsvStore.transition=this.jsvStore.transitionTmp,this.jsvStore.transitionTmp=t,null!=this.jsvStore.transitionTmp&&(this.jsvStore.transitionTmp.syncTimes=-1)}if(this.style.transition){if(this.jsvStore.transition&&!this._JsvBuildTransition())return}else this.jsvAnimation&&(this.jsvAnimation.Cancel(),this.jsvAnimation=null);var e=this.jsvStore.transitionTmp;(e=e||{left:0,top:0,width:0,height:0,opacity:1,transform:null,syncTimes:-1}).left=this.style.left,e.top=this.style.top,e.width=this.style.width,e.height=this.style.height,e.opacity=this.style.opacity,e.transform=this.style.transform,e.syncTimes=g.cnt,this.jsvStore.transitionTmp=e}},{key:"_JsvBuildTransition",value:function(){var t=[];for(var e in this.style.transition){var i=this.jsvStore.transition[e],n=this.style[e];if(i!==n){var s=this.style.transition[e],r={name:e,dur:s.duration,tf:null,dly:s.delay,from:i,to:n};"transform"===e&&(r.origin=this.style.transformOrigin?this.style.transformOrigin:"center center"),s.timingFunction&&(r.tf=s.timingFunction.Package()),t.push(r)}}if(t.length<=0)return!1;var a=this,o=new d.AnimationListener;return o.OnEnd(function(t){if(a.jsvAnimation=null,t){var e=new R("transitionend");e.target=a,document.dispatchEvent(e),null==a.instantSwapCallback&&(a.instantSwapCallback=d.sRenderBridge.InstantPerformSwap.bind(d.sRenderBridge)),Promise.resolve().then(a.instantSwapCallback)}}),this.jsvAnimation=new d.CssTransitionAnimation(t),this.jsvAnimation.SetAnimationListener(o),this.jsvMaskView.StartAnimation(this.jsvAnimation),!0}},{key:"clientWidth",get:function(){return isNaN(this.jsvStore.clientWidth)?this.style.width:this.jsvStore.clientWidth}},{key:"clientHeight",get:function(){return isNaN(this.jsvStore.clientHeight)?this.style.height:this.jsvStore.clientHeight}}],[{key:"applyObjectFitCommon",value:function(t,e,i){if(!i||isNaN(t.jsvStore.textureWidth)||isNaN(t.jsvStore.textureHeight))return null;var n=t.style.objectFit,s=i.ApplyObjectFit(e.width,e.height,t.jsvStore.textureWidth,t.jsvStore.textureHeight,n,A.ObjectFit);return 0!==e.width&&0!==e.height||0===e.width&&0===e.height||(t.jsvStore.clientWidth=Math.max(e.width,s.width),t.jsvStore.clientHeight=Math.max(e.height,s.height)),s}}]),n}();x.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},x.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};function M(t){v(this,M);var e=t.indexOf(M.KeyFramesFlag)+M.KeyFramesFlag.length,i=t.indexOf("{"),n=t.substring(e,i);this.name=n.trim(),this.cssText=t}var L=function(){a(s,x);var e=h(s);function s(){var t;return v(this,s),(t=e.call(this)).jsvContentView=null,t.jsvRefedImgTex=null,t.jsvVerticalAlign=null,t.jsvTextClassSynced=null,t}return r(s,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new d.NinePatchView),u(o(s.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){u(o(s.prototype),"jsvOnUnloadForgeView",this).call(this),y.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(t){u(o(s.prototype),"jsvOnStyleChanged",this).call(this,t);var e=!!t[A.TYPE.FOREGROUND];t[A.TYPE.LAYOUT_SIZE]&&(e||this.jsvFlushViewForeground()),t[A.TYPE.FOREGROUND]&&this.jsvFlushViewForeground(),t[A.TYPE.BORDER]&&this.jsvFlushViewBorder()}},{key:"jsvFlushViewForeground",value:function(){var i=this;if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var t=void 0===this.style.height||0==this.style.height,e=t?function(t,e){i.jsvStore.clientHeight=t.height}:null,n=this.jsvBuildTextView(e);t&&n.EnableAutoHeight();var s=n.GetLayoutView();this.jsvContentView.AddView(s)}}},{key:"jsvBuildTextView",value:function(t){var e=null,i=null!=this.style.jsvTextClassRef;if(i&&this.jsvCanUseTextViewCache()){var n=this.style.width,s=this.style.height;void 0===n&&(n=this.clientWidth),void 0===s&&(s=0),e=new d.CopiedTextViewEx(y.TextureManager,this.jsvStore.textContent,{width:n,height:s},this.style.jsvTextClassRef.getAttach().cachedSet,t)}else{var r=this.jsvGetTextParams();i&&!this.style.jsvTextClassRef.getAttach().hasOwnProperty("cachedSet")?(r.EnableDuplicateBuilder(),e=new d.TextViewEx(y.TextureManager,r,this.jsvStore.textContent,!0,t),this.style.jsvSaveTextCachedSet(e.GetDuplicateBuilder()),this.style.jsvTextClassRef.getAttach().jsvAttr={jsvVerticalAlign:this.jsvVerticalAlign}):e=new d.TextViewEx(y.TextureManager,r,this.jsvStore.textContent,!0,t)}return e}},{key:"jsvCanUseTextViewCache",value:function(){var t=this.style.jsvTextClassRef.getAttach();return!!t.hasOwnProperty("cachedSet")&&(t.jsvAttr.jsvVerticalAlign!==this.jsvVerticalAlign?(this.style.jsvTextClassRef.fallbackMode("jsv_text_vertical_align"),!1):this.style.jsvCheckTextStyleChange())}},{key:"jsvFlushViewBorder",value:function(){if(this.jsvMaskView)if(this.style.clipPath)console.error("BorderImage is conflicting with ClipPath.");else if(this.style.borderImage){var t=C.ConvertPx(this.getAttribute("jsv-borderimage-width")),e=C.ConvertPx(this.getAttribute("jsv-borderimage-height"));if(y.UnrefImgTexSize(this.jsvRefedImgTex),!this.jsvRefedImgTex||this.jsvRefedImgTex.Source!==this.style.borderImage.source.href){var i=t&&e?{width:t,height:e}:null;this.jsvRefedImgTex=y.TextureManager.GetImage2(this.style.borderImage.source.href,!1,i,d.ColorSpace.RGBA_8888)}t&&e&&(console.log("Custom cache image size with: "+t+"/"+e),y.SetImgTexSize(this.jsvRefedImgTex,{width:t,height:e})),y.RefImgTexSize(this.jsvRefedImgTex,function(t){var e=this.style.borderImageOutset?this.style.borderImageOutset:C.ConvertRect();this.jsvMaskView.SetPadding({start:e.left,width:t.width-e.left-e.right},{start:e.top,width:t.height-e.top-e.bottom});var i=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:i.left,width:t.width-i.left-i.right}],[{start:i.top,width:t.height-i.top-i.bottom}]);var n=new d.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(n)}.bind(this))}}},{key:"setAttribute",value:function(t,e){if(!this.jsvTakeTextAttribute(t,e)&&(u(o(s.prototype),"setAttribute",this).call(this,t,e),"class"===t&&null!=this.style.jsvTextClassRef&&this.style.jsvTextClassRef.getName()!==this.jsvTextClassSynced)){var i=this.style.jsvTextClassRef.getTextJsvAttributes();for(var n in i)n.startsWith("jsv_text_")&&this.jsvTakeTextAttribute(n,i[n]);this.jsvTextClassSynced=this.style.jsvTextClassRef.getName()}}},{key:"jsvTakeTextAttribute",value:function(t,e){return"jsv_text_vertical_align"===t&&(this.jsvVerticalAlign=e,!0)}},{key:"jsvGetTextParams",value:function(){var t={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"break-word"===this.style.wordWrap?"break_word":"normal"};"nowrap"===this.style.whiteSpace&&(t.wordWrap="none");var e={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top",vAreaAlign:this.jsvVerticalAlign?this.jsvVerticalAlign:"top"},i=this.style.textShadow?this.style.textShadow.split(" "):void 0;i&&(e.shadow={shadowOffsetX:parseInt(i[0]),shadowOffsetY:parseInt(i[1]),shadowBlur:parseInt(i[2]),shadowColor:i[3]});var n=this.style.fontSize?1.3*this.style.fontSize:14;this.style.lineHeight&&(n=this.style.lineHeight);var s=new d.TextViewParams;s.SetTextAttr(t),s.SetFontStyle(e),s.SetLineHeight(n);var r=this.style.width;return void 0===r&&(r=this.clientWidth),s.SetViewSize(new d.RectArea(0,0,r,this.style.height)),s}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(t){this.jsvStore.textContent=t,this.jsvStore.clientWidth=NaN,this.jsvContentView||(this.jsvContentView=new d.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var t=this.style.width;if(t||0===t)return t;if(this.jsvStore.textContent){if(!isNaN(this.jsvStore.clientWidth))return this.jsvStore.clientWidth;var e={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=y.GetTextWidth(e),this.jsvStore.clientWidth}return u(o(s.prototype),"clientWidth",this)}}]),s}(),N=function(){a(i,s);var e=h(i);function i(t){return v(this,i),e.call(this,"load")}return i}(),F=function(){a(n,x);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this,t)).jsvImageView=new d.LayoutView(null,"img"),e.jsvMainView.AddView(e.jsvImageView),e._ImageInLoading=!1,e.jsvColorSpace=d.ColorSpace.RGBA_8888,e.jsvScaleDownTex=null,e}return r(n,[{key:"setAttribute",value:function(t,e){if(this.jsvTakeTextureAttribute(t,e))console.assert(!this._ImageInLoading,"set ".concat(t," after src"));else if(u(o(n.prototype),"setAttribute",this).call(this,t,e),t===x.ATTRIBUTE.SRC){this._ImageInLoading=!0,this.jsvStore.textureWidth=NaN,this.jsvStore.textureHeight=NaN;var i=null;"true"===this.jsvScaleDownTex&&(this.style&&this.style.width?i={width:this.style.width,height:0}:console.error("set jsvScaleDownTex while style.width is not set")),y.SetBackgroundImage(this.jsvImageView,e,this.style.borderRadius,this.jsvOnLoaded.bind(this),i,this.jsvColorSpace)}}},{key:"jsvSetElementProp",value:function(t){this.jsvImageView.SetElementProp(t,y.RootActivity)}},{key:"jsvTakeTextureAttribute",value:function(t,e){return"jsv_img_color_space"==t?(this.jsvColorSpace=e,!0):"jsv_img_scaledown_tex"==t&&(this.jsvScaleDownTex=e,!0)}},{key:"jsvFlushViewLayout",value:function(){this._ImageInLoading?this.jsvImageView.WaitTextureToResize(!0):this.jsvImageView.WaitTextureToResize(!1),u(o(n.prototype),"jsvFlushViewLayout",this).call(this)}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(x.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(t){this._ImageInLoading=!1,this.jsvStore.textureWidth=t.width,this.jsvStore.textureHeight=t.height,this.style.jsvLazySyncCache.setCacheProperty(A.TYPE.LAYOUT_SIZE,void 0);var e=new N;e.target=this,document.dispatchEvent(e)}},{key:"jsvOnLoadForgeView",value:function(){this.style.objectFit||this.style.setDefaultValueBeforeForgeViewLoad("objectFit",A.ObjectFit.FILL),u(o(n.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvApplyObjectFit",value:function(t){return x.applyObjectFitCommon(this,t,this.jsvImageView)}}]),n}();M.KeyFramesFlag="@keyframes";var D=function(){function e(t){v(this,e),this.jsvCssRules=null,this.jsvTextContent=t}return r(e,[{key:"insertRule",value:function(t,e){if(void 0===e&&(e=this.jsvCssRules.length),t.indexOf(M.KeyFramesFlag)<0)throw Error("StyleSheet.insertRule() Rule is not supported except keyframes.");var i=new M(t);this.jsvCssRules.splice(e,0,i)}},{key:"deleteRule",value:function(t){this.jsvCssRules.splice(t,1)}},{key:"cssRules",get:function(){if(this.jsvCssRules)return this.jsvCssRules;if(this.jsvCssRules=new Array,this.jsvTextContent.indexOf(M.KeyFramesFlag)<0)return this.jsvCssRules;var t=this.jsvTextContent.split(M.KeyFramesFlag);for(var e in t)0!=e&&this.insertRule(M.KeyFramesFlag+t[e]);return this.jsvCssRules}}]),e}(),_=function(){a(n,x);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this,t)).textContent=null,e}return r(n,[{key:"appendChild",value:function(t){u(o(n.prototype),"appendChild",this).call(this,t);var e=new D(t.textContent);document.jsvAppendStyleSheet(e)}},{key:"removeChild",value:function(t){throw u(o(n.prototype),"removeChild",this).call(this,t),Error("Failed to removeChild, unimplement!.")}}]),n}(),U=function(){a(n,x);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this)).jsvMediaView=null,e.jsvMedia=null,t&&(e.src=t),e}return r(n,[{key:"addEventListener",value:function(t,e,i){u(o(n.prototype),"addEventListener",this).call(this,t,e,i),this.jsvAddMediaListener(t)}},{key:"jsvOnLoaded",value:function(){this.jsvMediaView=new d.LayoutView,this.jsvMediaView.RegisterDetachCallback(this.jsvOnUnloadForgeView.bind(this)),this.jsvMainView.AddView(this.jsvMediaView)}},{key:"jsvOnLoadForgeView",value:function(){console.log("MediaElement jsvOnLoadForgeView"),u(o(n.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){console.log("MediaElement jsvOnUnloadForgeView"),this.jsvMediaView&&(this.jsvMediaView.UnregisterDetachCallback(),this.jsvMediaView=null),u(o(n.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){var t=this.jsvEventListener;if(t)for(var e in t.keys)this.jsvAddMediaListener(e)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.pause(),this.jsvMedia.unload&&this.jsvMedia.unload(),this.jsvMedia.releaseResource&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy())),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(e){var i=this;this.jsvMedia&&this.jsvMedia.addEventListener(e,function(){var t=new s(e);t.target=i,u(o(n.prototype),"dispatchEvent",i).call(i,t)})}},{key:"src",set:function(t){t=t&&new f(t).href;this.jsvMedia||this.jsvInit(),t!==this.jsvMedia.src&&(this.jsvMedia.src=t)}}]),n}();for(var B in U.HOOKS={Audio:Audio,Video:Video,OffscreenVideo:OffscreenVideoPlayer},U.PROP={SetOnly:["autoplay","loop","timeupdateless"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},U.PROP){var G,W=p(U.PROP[B]);try{var H=function(){var e=G.value,t={};"SetOnly"!==B&&"SetAndGet"!==B||(t.set=function(t){this.jsvMedia||this.jsvInit(),this.jsvMedia[e]=t}),"GetOnly"!==B&&"SetAndGet"!==B||(t.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[e]}),"Function"===B&&(t=function(){var t;return this.jsvMedia||this.jsvInit(),this.jsvMedia[e]?(t=this.jsvMedia)[e].apply(t,arguments):null}),t instanceof Function?U.prototype[e]=t:Object.defineProperty(U.prototype,e,t)};for(W.s();!(G=W.n()).done;)H()}catch(t){W.e(t)}finally{W.f()}}var Y=function(){a(n,U);var i=h(n);function n(t){var e;return v(this,n),e=i.call(this,t),console.log("AudioElement.constructor()",l(e)),e}return r(n,[{key:"jsvInit",value:function(){this.jsvMedia=new U.HOOKS.Audio,u(o(n.prototype),"jsvInit",this).call(this),this.jsvOnLoaded()}},{key:"jsvRelease",value:function(){u(o(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),n}(),J=function(){a(n,U);var i=h(n);function n(t){var e;return v(this,n),e=i.call(this,t),console.log("VideoElement.constructor()",l(e)),e._EventCache=[],e._UseTexture=!1,e}return r(n,[{key:"jsvOnStyleChanged",value:function(t){u(o(n.prototype),"jsvOnStyleChanged",this).call(this,t),t[A.TYPE.LAYOUT_SIZE]&&this.jsvFlushVideoView()}},{key:"setAttribute",value:function(t,e){"jsvusetexture"!==t||"true"!==e?u(o(n.prototype),"setAttribute",this).call(this,t,e):this._UseTexture=!0}},{key:"jsvAddMediaListener",value:function(t){this.jsvMedia?u(o(n.prototype),"jsvAddMediaListener",this).call(this,t):this._EventCache.push(t)}},{key:"jsvFlushVideoView",value:function(){this.jsvMediaView&&(this.jsvStore.textureWidth=this.jsvMedia.videoWidth,this.jsvStore.textureHeight=this.jsvMedia.videoHeight,this.style.jsvLazySyncCache.setCacheProperty(A.TYPE.LAYOUT_SIZE,void 0))}},{key:"jsvApplyObjectFit",value:function(t){return x.applyObjectFitCommon(this,t,this.jsvMediaView)}},{key:"jsvInit",value:function(){var e=this;console.log("VideoElement jsvInit"),this._UseTexture?this.jsvMedia=new U.HOOKS.OffscreenVideo:this.jsvMedia=new U.HOOKS.Video,0<this._EventCache.length&&(this._EventCache.map(function(t){e.jsvAddMediaListener(t)}),this._EventCache=[]),this.addEventListener("load",this.jsvOnLoaded.bind(this)),u(o(n.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){u(o(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(!this.jsvMediaView){var t;if(this._UseTexture){this.jsvMediaView=new d.LayoutView;var e,i=y.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),n=this.style.borderRadius;n&&(e=new d.ViewRoundCornerMask(n.topLeft,n.topRight,n.bottomLeft,n.bottomRight)),t=new d.TextureSetting(i,e)}else{this.jsvMediaView=new d.VideoView(this.jsvMedia);var s=y.TextureManager.GetColorTexture("rgba(0,0,0,0)");t=new d.TextureSetting(s,null,null,!1)}this.jsvMediaView.RegisterDetachCallback(this.jsvOnUnloadForgeView.bind(this)),this.jsvMainView.AddView(this.jsvMediaView),this.jsvMediaView.ResetTexture(t)}this.jsvFlushVideoView()}},{key:"jsvOnLoadForgeView",value:function(){this.style.objectFit&&this.style.setDefaultValueBeforeForgeViewLoad("objectFit",A.ObjectFit.CONTAIN),u(o(n.prototype),"jsvOnLoadForgeView",this).call(this)}}]),n}();for(var z in J.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},J.PROP){var K,X=p(J.PROP[z]);try{var Z=function(){var e=K.value,t={};"SetOnly"!==z&&"SetAndGet"!==z||(t.set=function(t){this.media[e]=t}),"GetOnly"!==z&&"SetAndGet"!==z||(t.get=function(){return this.media[e]}),J.prototype[e]=t};for(X.s();!(K=X.n()).done;)Z()}catch(t){X.e(t)}finally{X.f()}}var q=function(){function t(){v(this,t),this.src=null,this.onerror=null,this.onload=null,this.charset=null,this.timeout=120}return r(t,[{key:"setAttribute",value:function(t,e){console.log("ScriptElement.setAttribute() name="+t+", value=",e),this[t]=e}},{key:"jsvActiveScript",value:function(){if(null!=this.src){var t=new f(this.src);console.log("load script with url="+t.href);var i=this;window.JsView.runJsWithUrl(t.href,!1,function(t,e){i.onLoadResult(t,e)})}}},{key:"onLoadResult",value:function(t,e){console.log("onLoadResult "+t+" "+e),t?this.onload&&this.onload():this.onerror&&this.onerror({type:"jsvErr_"+e,target:this})}}]),t}(),$=function(){a(i,x);var e=h(i);function i(){var t;return v(this,i),t=e.call(this),console.warn("Warnig: <a> is fake in JsView system"),t.href="",t.protocol="",t.host="",t.search="",t.hash="",t.hostname="",t.port="",t.pathname="",t}return i}(),Q=function(){a(e,x);var t=h(e);function e(){return v(this,e),t.apply(this,arguments)}return e}(),tt=function(){a(n,x);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this)).jsvMainView=new d.JsvElementView(t),e}return r(n,[{key:"setAttribute",value:function(t,e){u(o(n.prototype),"setAttribute",this).call(this,t,e),this.jsvMainView.setAttribute(t,e)}},{key:"removeAttribute",value:function(t){u(o(n.prototype),"removeAttribute",this).call(this,t),this.jsvMainView.removeAttribute(t)}},{key:"getAttribute",value:function(t){return this.jsvMainView.getAttribute(t)}},{key:"hasAttribute",value:function(t){return this.jsvMainView.hasAttribute(t)}},{key:"jsvOnStyleChanged",value:function(t){u(o(n.prototype),"jsvOnStyleChanged",this).call(this,t)}},{key:"textContent",get:function(){return this.jsvMainView.textContent},set:function(t){this.jsvMainView.textContent=t}}]),n}(),et=function(){a(n,E);var i=h(n);function n(t){var e;return v(this,n),(e=i.call(this,E.TEXT_NODE)).textContent=t,e}return n}(),it=function(){function t(){v(this,t),console.log("Document header construct")}return r(t,[{key:"appendChild",value:function(t){t instanceof q&&(console.log("Found append script in head."),t.jsvActiveScript())}},{key:"removeChild",value:function(){console.warn("Failed to header.removeChild, unimplemented!.")}}]),t}(),nt=function(){a(i,E);var e=h(i);function i(){var t;return v(this,i),(t=e.call(this,E.DOCUMENT_NODE)).location=window.location,t.rootElement=new L,t.rootElement.ownerDocument=l(t),t.rootElement.id="root",t.activeElement=t.rootElement,t.cookie="",t.styleSheets=new Array,t.jsvIsReady=!1,t.head=new it,t}return r(i,[{key:"createElement",value:function(t){switch(t){case i.DIV_ELEMENT:case i.FDIV_ELEMENT:return new L;case i.IMG_ELEMENT:case i.FIMG_ELEMENT:return new F;case i.STYLE_ELEMENT:return new _;case i.AUDIO_ELEMENT:return new Y;case i.VIDEO_ELEMENT:return new J;case i.SCRIPT_ELEMENT:return console.log("Document.createElement() create script"),window.JsView?new q:window.originDocument.createElement("script");case i.ANCHOR_ELEMENT:return new $;default:return 0!==t.indexOf("jsv")||window.JsView?(console.warn("Document.createElement() unknown name="+t),new Q(t)):new tt(t)}}},{key:"createTextNode",value:function(t){return new et(t)}},{key:"createEvent",value:function(t){return new s(t)}},{key:"getElementById",value:function(t){if("root"===t||"app"===t)return this.rootElement;throw Error("Document.getElementById() id="+t+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(t){if("head"===t||"#app"===t)return this.rootElement;throw Error("Document.querySelector() selectors="+t+" is UNIMPLEMENTED.")}},{key:"jsvAppendStyleSheet",value:function(t){document.styleSheets.push(t)}},{key:"jsvGetKeyFrames",value:function(t){var e,i=p(this.styleSheets);try{for(i.s();!(e=i.n()).done;){var n,s=p(e.value.cssRules);try{for(s.s();!(n=s.n()).done;){var r=n.value;if(r.name==t)return r.cssText}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}var a,o="@keyframes ",l=o+t,h=p(this.styleSheets);try{for(h.s();!(a=h.n()).done;){var u=a.value,c=u.jsvTextContent,v=c.indexOf(l);if(!(v<0)){var d=c.indexOf("-keyframes",v+1),f=c.indexOf(o,v+1);f<0&&(f=c.length),0<d&&d<f&&(f=d);var y=c.substring(v,f);return u.insertRule(y,0),y}}}catch(t){h.e(t)}finally{h.f()}return null}},{key:"jsvUpdateRootElement",value:function(t){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=t,this.jsvIsReady=!0}}]),i}();if(nt.DIV_ELEMENT="div",nt.IMG_ELEMENT="img",nt.STYLE_ELEMENT="style",nt.VIDEO_ELEMENT="video",nt.AUDIO_ELEMENT="audio",nt.SCRIPT_ELEMENT="script",nt.ANCHOR_ELEMENT="a",nt.FIMG_ELEMENT="fimg",nt.FDIV_ELEMENT="fdiv",window.JsView){console.log("Declare React Proxy.");var st=new f(window.JsView.getAppUrl(),!0);window.location.applyUrlInfo?window.location.applyUrlInfo(st):window.location=st,window.addEventListener=function(t,e){},window.document=new nt,window.navigator={userAgent:"ForgeReact"},window.HTMLIFrameElement=function(){}}window.Audio=Y,window.Video=J,console.log("Using JsView React"),t.Document=nt,t.ForgeExtension=y,t.ForgeReactApp=function t(e){v(this,t),this._ActivityManager=e;var i=new m(e);e.RegisterActivity(i.activity),e.StartActivity(new d.Intent("ForgeReactActivity"))},t.JsvLazySyncCache=j,Object.defineProperty(t,"__esModule",{value:!0})});
