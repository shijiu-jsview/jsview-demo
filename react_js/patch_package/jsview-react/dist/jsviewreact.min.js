!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t=t||self).jsviewreact={},t.React)}(this,function(t,r){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){if(null==t)return{};var i,n,s=function(t,e){if(null==t)return{};var i,n,s={},o=Object.keys(t);for(n=0;n<o.length;n++)i=o[n],0<=e.indexOf(i)||(s[i]=t[i]);return s}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)i=o[n],0<=e.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(s[i]=t[i])}return s}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(o){return function(){var t,e,i,n=c(o);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()){var s=c(this).constructor;t=Reflect.construct(n,arguments,s)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!=typeof i&&"function"!=typeof i?l(e):i}}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(i):s.value}})(t,e,i||t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function x(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(t,e):void 0}}(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,s,o=!0,r=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){r=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(r)throw s}}}}r=r&&r.hasOwnProperty("default")?r.default:r,void 0===window.Forge&&(window.Forge={});var y=window.Forge,g=function(){function l(t,e){if(f(this,l),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",t){if(!0===t.startsWith("url")){var i=t.indexOf("(")+1,n=t.lastIndexOf(")");t=t.substring(i,n).trim()}if(!0!==t.startsWith("data:")){if(!0===t.startsWith("/")&&(t=document.location.origin+t),!0===t.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var s=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,s)}t=window.JsView.React.__MainPath+t.substring(1)}if(this.href=t,e){var o=this.href.indexOf("?"),r=0<o?this.href.substring(0,o):this.href;this.search=1<o?this.href.substring(o):"",o=r.indexOf("://"),this.protocol=0<o?r.substring(0,o+1):"";var a=1<o?r.substring(o+3):"";o=a.indexOf("/"),this.host=0<o?a.substring(0,o):"",this.pathname=1<o?a.substring(o):"",this.origin=0<o?this.protocol+"//"+this.host:"",o=this.host.indexOf(":"),this.hostname=0<o?this.host.substring(0,o):"",this.port=1<o?this.host.substring(o+1):"",console.log("create total parse URL, this=",this)}}else this.href=t}}return h(l,[{key:"replace",value:function(t){this.href=t}}]),l}(),m=function(){function a(){f(this,a)}return h(a,null,[{key:"SetBackgroundColor",value:function(t,e,i){var n,s=a.TextureManager.GetColorTexture(e);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var o=new y.TextureSetting(s,n);t.ResetTexture(o)}},{key:"SetBackgroundImage",value:function(t,e,i,n){if("string"==typeof e&&(e=new g(e)),e instanceof g==!1)throw Error("Bad Argument.",e);var s,o=a.TextureManager.GetImage(e.href);i&&(s=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var r=new y.ExternalTextureSetting(o,s);t.ResetTexture(r),n&&o.RegisterLoadImageCallback(null,function(){n({width:o.Width,height:o.Height})})}},{key:"SetVideoTexture",value:function(t,e,i){var n,s=a.TextureManager.GetColorTexture(e);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var o=new y.TextureSetting(s,n);t.ResetTexture(o)}},{key:"GetTextWidth",value:function(t){return t.str||(t.str=""),t.font||(t.font=y.TextUtils._sDefaultFont),t.size||(t.size=y.TextUtils._sDefaultFontSize),"italic"!==t.italic&&(t.italic=""),"bold"!==t.bold&&(t.bold=""),window.PlatformUtils.GetTextWidth(t)}},{key:"RequestSwap",value:function(){y.sRenderBridge.RequestSwap()}},{key:"SetImgTexSize",value:function(t,e){var i={size:e,refNum:0};a.TextureInfo.Cache[t.Source]=i}},{key:"RefImgTexSize",value:function(n,s){var t=a.TextureInfo.Cache[n.Source];t?(0<t.refNum?t.refNum++:t.refNum=1,s(t.size)):n.RegisterLoadImageCallback(null,function(){var t={width:n.Width,height:n.Height};s(t);var e=a.TextureInfo.Cache[n.Source];if(e)0<e.refNum?e.refNum++:e.refNum=1;else{var i={size:t,refNum:1};a.TextureInfo.Cache[n.Source]=i}})}},{key:"UnrefImgTexSize",value:function(t){if(t){var e=a.TextureInfo.Cache[t.Source];e&&(e.refNum--,e.refNum<=0&&a.TextureInfo.Unused.add(t.Source))}}},{key:"ClearUnusedTexSize",value:function(){var t,e=x(a.TextureInfo.Unused);try{for(e.s();!(t=e.n()).done;){var i=t.value,n=a.TextureInfo.Cache[i];n.refNum<-2?(delete a.TextureInfo.Cache[i],a.TextureInfo.Unused.delete(i)):n.refNum<=0?n.refNum--:a.TextureInfo.Unused.delete(i)}}catch(t){e.e(t)}finally{e.f()}}}]),a}();m.TextureInfo={Cache:{},Unused:new Set},m.TextureManager=null,m.RootView=null,m.RootActivity=null,m.HaltKeyEvent=!1;var b=function(){function e(t){f(this,e),this.target=null,this.timeStamp=Date.now(),this.type=t}return h(e,[{key:"initEvent",value:function(t){this.type=t}}]),e}(),_=function(){u(n,b);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t)).keyCode=-1,e.key=-1,e.repeat=0,e}return h(n,null,[{key:"JsvGetKeyFromCode",value:function(t){return new Map([[n.KeyCode.Enter,n.Key.Enter],[n.KeyCode.ArrowUp,n.Key.ArrowUp],[n.KeyCode.ArrowDown,n.Key.ArrowDown],[n.KeyCode.ArrowLeft,n.Key.ArrowLeft],[n.KeyCode.ArrowRight,n.Key.ArrowRight]])[t]}}]),n}();_.Type={KEYDOWN:"keydown",KEYUP:"keyup"},_.Key={Enter:"Enter",ArrowUp:"ArrowUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight"},_.KeyCode={Enter:13,ArrowUp:38,ArrowDown:40,ArrowLeft:37,ArrowRight:39};var w=function(){function i(t){f(this,i),this.type=t,this.cachedValues=null,this.onSyncCallback=null}return h(i,[{key:"setOnSyncCallback",value:function(t){this.onSyncCallback=t,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(t,e){this.cachedValues||(this.cachedValues={}),this.cachedValues[t]=e,this.syncLastCaches(!1),m.RequestSwap()}},{key:"syncLastCaches",value:function(t){var e=i.LastModified[this.type];!t&&e===this||(i.LastModified[this.type]=this,e&&e.cachedValues&&"function"==typeof e.onSyncCallback&&(e.onSyncCallback(e.cachedValues),e.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){console.log("JsvLazySyncCache.SyncAllCachedProperty()");for(var t=0,e=Object.values(i.LastModified);t<e.length;t++){e[t].syncLastCaches(!0)}}}]),i}();w.LastModified={};function I(t){f(this,I),this._ActivityManager=t;var e=new S(t);t.RegisterActivity(e.activity),t.StartActivity(new y.Intent("ForgeReactActivity"))}var S=function(){function e(t){f(this,e),this.activity=new y.ReactActivity("ForgeReactActivity",t,this.OnKeyDown.bind(this),this.OnKeyUp.bind(this)),this._Init()}return h(e,[{key:"_Init",value:function(){console.log("ForgeReactActivity.OnCreate()."),m.TextureManager=this.activity.GetTextureManager(),m.RootView=new y.LayoutView,m.RootActivity=this.activity,document.jsvUpdateRootElement(m.RootView);var t="object"===i(window.JsView.React.DesignMap)?window.JsView.React.DesignMap.width:1280,e=Math.floor(9*t/16);this.activity.SetContentView(m.RootView,{x:0,y:0,width:t,height:e}),y.sRenderBridge.AddWillSwapListener("forgeSwap",function(){w.SyncAllCachedProperty(),m.ClearUnusedTexSize()}),window.JsView.React.Render()}},{key:"OnKeyDown",value:function(t){if(m.HaltKeyEvent){var e=new _(_.Type.KEYDOWN);return e.keyCode=t.keyCode,e.repeat=t.repeat,document.dispatchEvent(e),!0}return!1}},{key:"OnKeyUp",value:function(t){if(m.HaltKeyEvent){var e=new _(_.Type.KEYUP);return e.keyCode=t.keyCode,e.key=_.JsvGetKeyFromCode(e.keyCode),e.repeat=t.repeat,document.dispatchEvent(e),!0}return!1}}]),e}();window.JsView&&(window.JsView.React={DesignMap:null,Render:null,Extension:m},window.JsView.Vue=window.JsView.React),y.DesignMap=function(){var t={width:1280,displayScale:1};return"object"===i(t)&&(t=window.JsView.React.DesignMap),Media.setDesignMapWidth(t.width),t},y.RunApp=function(t){console.log("Forge.RunApp()."),new I(t)};var e={};window.JsView&&(window.JsView.React&&window.JsView.React.Extension||(window.JsView.React.Extension=e),e=window.JsView.React.Extension);var E=e,k=function(){function e(t){f(this,e),this.ownerDocument=window.document,this.nodeType=t,this.parentNode=null,this.jsvEventListener=null}return h(e,[{key:"appendChild",value:function(t){t.parentNode=this}},{key:"removeChild",value:function(t){t.parentNode=null}},{key:"insertBefore",value:function(t){t.parentNode=this}},{key:"addEventListener",value:function(t,e){this.jsvEventListener||(this.jsvEventListener={});var i=this.jsvEventListener[t];i||(i=new Set,this.jsvEventListener[t]=i),i.add(e)}},{key:"removeEventListener",value:function(t,e){if(this.jsvEventListener){var i=this.jsvEventListener[t];i&&(i.delete(e),i.size<=0&&this.jsvEventListener.hasOwnProperty(t)&&delete this.jsvEventListener[t],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(t){if(this.jsvEventListener){var e=this.jsvEventListener[t.type];if(e){t.target||(t.target=document.activeElement);var i,n=x(e);try{for(n.s();!(i=n.n()).done;){(0,i.value)(t)}}catch(t){n.e(t)}finally{n.f()}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No event added.")}}]),e}();k.ELEMENT_NODE=1,k.TEXT_NODE=3,k.DOCUMENT_NODE=9;var O=function(){u(e,b);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return e}();O.Type={FOCUS:"focus",BLUR:"blur"};function P(t){if(f(this,P),this.top=null,this.right=null,this.bottom=null,this.left=null,t&&!1!==t.startsWith("inset")){var e=t.indexOf("(")+1,i=t.substring(e),n=R.ConvertRect(i);this.top=n.top,this.right=n.right,this.bottom=n.bottom,this.left=n.left}else console.error("Inset.Parse() InvalidArgs: value=",t)}function L(t){if(f(this,L),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,t){var e=t.indexOf(")")+1,i=t.substring(0,e),n=t.substring(e);this.source=new g(i),this.slice=R.ConvertRect(n)}else console.error("BorderImage.constructor() InvalidArgs: value=",t)}var F=function(){u(e,b);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return e}(),R=function(){function g(){f(this,g)}return h(g,null,[{key:"ConvertFloat",value:function(t){return!t||"string"!=typeof t?t:parseFloat(t)}},{key:"ConvertPx",value:function(t){return!t||"string"!=typeof t?t:"0"===t?0:t.endsWith("px")?parseInt(t):t}},{key:"ConvertRect",value:function(t){var e=g.SplitString(t," "),i={top:0<e.length?parseInt(e[0]):0,right:1<e.length?parseInt(e[1]):null,bottom:2<e.length?parseInt(e[2]):null,left:3<e.length?parseInt(e[3]):null};return i.right=i.right||0===i.right?i.right:i.top,i.bottom=i.bottom||0===i.bottom?i.bottom:i.top,i.left=i.left||0===i.left?i.left:i.right,i}},{key:"ConvertCorner",value:function(t){var e=g.SplitString(t," "),i={topLeft:0<e.length?parseInt(e[0]):0,topRight:1<e.length?parseInt(e[1]):null,bottomRight:2<e.length?parseInt(e[2]):null,bottomLeft:3<e.length?parseInt(e[3]):null};return i.topRight=i.topRight||0===i.topRight?i.topRight:i.topLeft,i.bottomRight=i.bottomRight||0===i.bottomRight?i.bottomRight:i.topLeft,i.bottomLeft=i.bottomLeft||0===i.bottomLeft?i.bottomLeft:i.bottomRight,i}},{key:"ConvertSize",value:function(t){var e=g.SplitString(t," "),i={width:0<e.length?parseInt(e[0]):0,height:1<e.length?parseInt(e[1]):null};return i.height=i.height||0===i.height?i.height:i.width,i}},{key:"ConvertAnimation",value:function(t){if(null===t||0===t.length)return null;var e=t.indexOf("cubic-bezier"),i=[];if(0<=e){var n,s=t.indexOf(")"),o=t.substring(e,s+1),r=x(g.SplitString(t,o));try{for(r.s();!(n=r.n()).done;){var a=n.value,l=g.SplitString(a," ");i=i.concat(l)}}catch(t){r.e(t)}finally{r.f()}i.push(o)}else i=g.SplitString(t," ");for(var h=null,u=0,c=1,d=t.includes("alternate"),p=2;p<i.length;p++)if("infinite"!==i[p]){var f=g.ConvertTimeMs(i[p]);!1===isNaN(f)?u=f:(f=parseFloat(i[p]),!1===isNaN(f)?c=f:h=i[p])}else c=-1;var v=1<i.length?g.ConvertTimeMs(i[1]):0;return{name:0<i.length?i[0]:"",duration:v,timingFunction:g.ConvertEasing(h,v),delay:u,iterationCount:c,direction:d}}},{key:"ConvertTransition",value:function(t){if(null==t||0==t.length)return null;for(var e={},i=new Array,n=t.split(","),s=0;s<n.length;s++)if(0<=n[s].indexOf("(")){for(var o=s;o<n.length&&n[o].indexOf(")")<0;)o++;for(var r="",a=s;a<=o;a++)a!=s&&(r+=","),r+=n[a];s=o,i=i.concat(r)}else i=i.concat(n[s]);var l,h=x(i);try{for(h.s();!(l=h.n()).done;){var u=l.value,c=g.ConvertAnimation(u);if("all"==(e[c.name]=c).name)for(var d=new Array("opacity","left","top","width","height"),p=0,f=d;p<f.length;p++){e[f[p]]=c}}}catch(t){h.e(t)}finally{h.f()}return e}},{key:"ConvertTimeMs",value:function(t){var e=NaN;return(t=(t=t||"").trim()).endsWith("ms")?e=1:t.endsWith("s")&&(e=1e3),e*=parseFloat(t)}},{key:"ConvertEasing",value:function(t,e){var i=y.Easing.Circular.InOut;if(!t)return i;if(t.includes("ease"))i=t.includes("-in-out")?y.Easing.Circular.InOut:t.includes("-out")?y.Easing.Circular.Out:t.includes("-in")?y.Easing.Circular.In:y.Easing.Circular.InOut;else if(t.includes("linear"))i=null;else if(t.includes("cubic-bezier")){var n=g.ConvertBezier(t);i=new y.BezierEasing(n.x1,n.y1,n.x2,n.y2,e)}return i}},{key:"ConvertBezier",value:function(t){var e=t.indexOf("(");0<=e&&(t=t.substring(e+1));var i=g.SplitString(t,",");return{x1:0<i.length?parseFloat(i[0]):0,y1:1<i.length?parseFloat(i[1]):0,x2:2<i.length?parseFloat(i[2]):0,y2:3<i.length?parseFloat(i[3]):0}}},{key:"ConvertOverflow",value:function(t){return(t=t||"").includes("hidden")?A.Overflow.HIDDEN:A.Overflow.VISIBLE}},{key:"ConvertObjectFit",value:function(t){return(t=t||"").includes("fill")?A.ObjectFit.FILL:t.includes("contain")?A.ObjectFit.CONTAIN:t.includes("cover")?A.ObjectFit.COVER:t.includes("none")?A.ObjectFit.NONE:t.includes("scale-down")?A.ObjectFit.SCALEDOWN:A.ObjectFit.CONTAIN}},{key:"SplitString",value:function(t,e){var i=(t=t||"").trim().split(e);if(" "!==e)return i;var n,s=[],o=x(i);try{for(o.s();!(n=o.n()).done;){var r=n.value;r&&s.push(r)}}catch(t){o.e(t)}finally{o.f()}return s}}]),g}(),A=function(){function n(){f(this,n),this.jsvStore={},this.jsvLazySyncCache=new w("style")}return h(n,[{key:"setProperty",value:function(t,e){if("function"==typeof document.jsvCheckStyleFormat&&document.jsvCheckStyleFormat(t,e),e=this.jsvConvertPropValue(t,e),this.jsvStore[t]!==e){this.jsvStore[t]=e;var i=n.JsvGetStyleType(t);this.jsvLazySyncCache.setCacheProperty(i,void 0)}}},{key:"getPropertyValue",value:function(t){return this.jsvStore[t]}},{key:"jsvSetChangedListener",value:function(e){this.jsvLazySyncCache.setOnSyncCallback(function(t){e(Object.keys(t))})}},{key:"jsvConvertPropValue",value:function(t,e){switch(t){case n.PROP.VISIBILITY:return e.toUpperCase();case n.PROP.OVERFLOW:return R.ConvertOverflow(e);case n.PROP.OBJECTFIT:return R.ConvertObjectFit(e);case n.PROP.TRANSFORM:return e;case n.PROP.CLIPPATH:return new P(e);case n.PROP.BORDERIMAGE:return new L(e);case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return R.ConvertRect(e);case n.PROP.BORDERRADIUS:return R.ConvertCorner(e);case n.PROP.ANIMATION:return R.ConvertAnimation(e);case n.PROP.TRANSITION:return R.ConvertTransition(e);case n.PROP.OPACITY:return R.ConvertFloat(e);default:return R.ConvertPx(e)}}}],[{key:"JsvGetStyleType",value:function(t){switch(t){case n.PROP.LEFT:case n.PROP.RIGHT:case n.PROP.TOP:case n.PROP.BOTTOM:return n.TYPE.LAYOUT_POS;case n.PROP.WIDTH:case n.PROP.HEIGHT:case n.PROP.VISIBILITY:case n.PROP.CLIPPATH:case n.PROP.OVERFLOW:case n.PROP.OBJECTFIT:case n.PROP.TRANSFORM:return n.TYPE.LAYOUT_SIZE;case n.PROP.BACKGROUNDCOLOR:case n.PROP.BACKGROUNDIMAGE:case n.PROP.BORDERRADIUS:return n.TYPE.BACKGROUND;case n.PROP.COLOR:case n.PROP.LINEHEIGHT:case n.PROP.WHITESPACE:case n.PROP.FONTFAMILY:case n.PROP.FONTSIZE:case n.PROP.FONTSTYLE:case n.PROP.FONTWEIGHT:case n.PROP.TEXTALIGN:case n.PROP.TEXTSHADOW:case n.PROP.TEXTOVERFLOW:return n.TYPE.FOREGROUND;case n.PROP.BORDERIMAGE:case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return n.TYPE.BORDER;case n.PROP.ANIMATION:return n.TYPE.ANIMATION;case n.PROP.TRANSITION:return n.TYPE.TRANSITION;case n.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+t),null}}}]),n}();A.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation",TRANSITION:"transition"},A.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},A.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},A.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function T(t){var e=A.PROP[t];Object.defineProperty(A.prototype,e,{set:function(t){this.setProperty(e,t)},get:function(){return this.getPropertyValue(e)}})}for(var C in A.PROP)T(C);var V=function(){u(l,k);var i=v(l);function l(t){var e;return f(this,l),(e=i.call(this,k.ELEMENT_NODE)).parentElement=null,e.tagName=e.constructor.name.replace("Element","").toUpperCase(),e.childElementCount=0,e.childNodes=[],e.firstElementChild=null,e.lastElementChild=null,e.tagName===l.TAG.STYLE?(e.style=null,e.jsvMainView=null):(e.style=new A,e.jsvMainView=new y.LayoutView),e.jsvMaskView=null,e.jsvAnimation=null,e.jsvStore={transition:null,textContent:null,clientWidth:null},e.jsvLazySyncCache=new w("element"),e.instantSwapCallback=null,e}return h(l,[{key:"appendChild",value:function(t){if(d(c(l.prototype),"appendChild",this).call(this,t),(t.parentElement=this).firstElementChild||(this.firstElementChild=t),this.lastElementChild=t,this.childNodes.push(t),this.childElementCount++,t.nodeType===k.ELEMENT_NODE&&t.tagName!==l.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);t.jsvOnLoadForgeView(),t.style.jsvSetChangedListener(t.jsvOnStyleChanged.bind(t));var e=t.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(t.jsvMaskView,e)}}},{key:"removeChild",value:function(t){d(c(l.prototype),"removeChild",this).call(this,t),t.parentElement=null,t instanceof l&&(t.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(t.jsvMaskView))}},{key:"insertBefore",value:function(t,e){d(c(l.prototype),"appendChild",this).call(this,t,e),(t.parentElement=this).appendChild(t)}},{key:"setAttribute",value:function(t,e){console.log("Element.setAttribute() name="+t+", value=",e),this[t]=e,t.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,e)}},{key:"removeAttribute",value:function(t){this[t]=void 0,t.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,void 0)}},{key:"getAttribute",value:function(t){return this[t]}},{key:"hasAttribute",value:function(t){return console.log("Element.hasAttribute() name="+t),!!this[t]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var t=document.activeElement;if(document.activeElement=this,t){var e=new O(O.Type.BLUR);e.target=t,document.dispatchEvent(e)}var i=new O(O.Type.FOCUS);document.dispatchEvent(i)}},{key:"jsvOnLoadForgeView",value:function(){var e=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new y.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(t){e.jsvMainView.SetElementProp(t)})}},{key:"jsvOnUnloadForgeView",value:function(){}},{key:"jsvOnStyleChanged",value:function(t){var e,i=t.includes(A.TYPE.LAYOUT_SIZE),n=x(t);try{for(n.s();!(e=n.n()).done;){switch(e.value){case A.TYPE.LAYOUT_POS:if(i)break;this.jsvFlushViewLayout();break;case A.TYPE.LAYOUT_SIZE:this.jsvFlushViewLayout();break;case A.TYPE.BACKGROUND:this.jsvFlushViewBackground();break;case A.TYPE.ANIMATION:this.jsvFlushViewAnimation();break;case A.TYPE.TRANSITION:this.jsvStore.transition=null,this.jsvFlushViewTransition()}}}catch(t){n.e(t)}finally{n.f()}}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var t={x:this.style.left,y:this.style.top,width:this.style.width,height:this.style.height};if(this.jsvMaskView.ResetLayoutParams(t),this.jsvMaskView.ResetCssTransform(this.style.transform),this.jsvMaskView!==this.jsvMainView){var e={x:0,y:0,width:t.width,height:t.height};this.jsvMainView.ResetLayoutParams(e)}this.jsvMaskView.SetVisibility(this.style.visibility);var i=null;this.style.clipPath?i={x:this.style.clipPath.left,y:this.style.clipPath.top,width:t.width-this.style.clipPath.left-this.style.clipPath.right,height:t.height-this.style.clipPath.top-this.style.clipPath.bottom}:!this.style.objectFit&&this.style.overflow!==A.Overflow.HIDDEN||(i={x:0,y:0,width:this.style.width,height:this.style.height}),i&&this.jsvMaskView.SetClipRect(i.x,i.y,i.width,i.height,!0),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&m.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius),this.style.backgroundImage&&m.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius)}},{key:"jsvFlushViewAnimation",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.animation){var t=document.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation=new y.CssKeyframeAnimation(t,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var i=this,e=new y.AnimationListener(null,function(t){if(t){var e=new F("animationend");e.target=i,document.dispatchEvent(e),null==i.instantSwapCallback&&(i.instantSwapCallback=y.sRenderBridge.InstantPerformSwap.bind(y.sRenderBridge)),Promise.resolve().then(i.instantSwapCallback)}},null);this.jsvAnimation.Enable(y.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(e),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.transition){this.jsvStore.transition||(this.jsvStore.transition={});var t=[];for(var e in this.style.transition){var i=this.jsvStore.transition[e],n=this.style[e];if(this.jsvStore.transition[e]=n,void 0!==i&&i!==n){var s=this.style.transition[e],o={name:e,dur:s.duration,tf:null,dly:s.delay,from:i,to:n};s.timingFunction&&(o.tf=s.timingFunction.Pacakge()),t.push(o)}}t.length<=0||(this.jsvAnimation=new y.CssTransitionAnimation(t),this.jsvMaskView.StartAnimation(this.jsvAnimation))}}},{key:"clientWidth",get:function(){return this.style.width}}],[{key:"JsvFitViewLayout",value:function(t,e,i){var n={x:0,y:0,width:t.width,height:t.height},s={width:0,height:0},o=t.width/t.height,r=e.width/e.height;if(!r)return n;if(!o){if(0===t.width||0===t.height)return n;0===o?t.width=t.height*r:isNaN(o)&&(t.height=t.width/r),o=t.width/t.height}if(!o)return n.width=e.width,n.height=e.height,n;switch(i=i||A.ObjectFit.CONTAIN){case A.ObjectFit.FILL:s.width=t.width,s.height=t.height;break;case A.ObjectFit.NONE:s.width=e.width,s.height=e.height;break;case A.ObjectFit.COVER:s=l.JsvStretchSize(t,r,r<o);break;case A.ObjectFit.SCALEDOWN:var a=o<r;t.width>e.width&&t.height>e.height&&(a=r<o),s=l.JsvStretchSize(t,r,a);break;case A.ObjectFit.CONTAIN:s=l.JsvStretchSize(t,r,o<r);break;default:throw Error("Unexpected object-fit.")}return n.x=(t.width-s.width)/2,n.y=(t.height-s.height)/2,n.width=s.width,n.height=s.height,n}},{key:"JsvStretchSize",value:function(t,e,i){var n={width:0,height:0};return i?(n.width=t.width,n.height=t.width/e):(n.height=t.height,n.width=t.height*e),n}}]),l}();V.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},V.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};var j=function(){u(n,V);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this)).jsvMedia=null,t&&(e.src=t),e}return h(n,[{key:"addEventListener",value:function(t,e,i){d(c(n.prototype),"addEventListener",this).call(this,t,e,i),this.jsvAddMediaListener(t)}},{key:"jsvOnLoadForgeView",value:function(){d(c(n.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){d(c(n.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){var t=this.jsvEventListener;if(t)for(var e in t.keys)this.jsvAddMediaListener(e)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy()),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(e){var i=this;this.jsvMedia||this.jsvInit(),this.jsvMedia.addEventListener(e,function(){var t=new b(e);t.target=i,d(c(n.prototype),"dispatchEvent",i).call(i,t)})}},{key:"src",set:function(t){t=t&&new g(t).href;this.jsvMedia||this.jsvInit(),this.jsvMedia.src=t}}]),n}();for(var N in j.HOOKS={Audio:Audio,Video:window.OffscreenVideoPlayer},j.PROP={SetOnly:["autoplay","loop"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},j.PROP){var M,D=x(j.PROP[N]);try{var U=function(){var e=M.value,t={};"SetOnly"!==N&&"SetAndGet"!==N||(t.set=function(t){this.jsvMedia||this.jsvInit(),this.jsvMedia[e]=t}),"GetOnly"!==N&&"SetAndGet"!==N||(t.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[e]}),"Function"===N&&(t=function(){var t;return this.jsvMedia||this.jsvInit(),(t=this.jsvMedia)[e].apply(t,arguments)}),t instanceof Function?j.prototype[e]=t:Object.defineProperty(j.prototype,e,t)};for(D.s();!(M=D.n()).done;)U()}catch(t){D.e(t)}finally{D.f()}}var G=function(){u(n,j);var i=v(n);function n(t){var e;return f(this,n),e=i.call(this,t),console.log("AudioElement.constructor()",l(e)),e}return h(n,[{key:"jsvInit",value:function(){this.jsvMedia=new j.HOOKS.Audio,d(c(n.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){d(c(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),n}(),B=function(){u(n,j);var i=v(n);function n(t){var e;return f(this,n),e=i.call(this,t),console.log("VideoElement.constructor()",l(e)),e}return h(n,[{key:"jsvOnStyleChanged",value:function(t){d(c(n.prototype),"jsvOnStyleChanged",this).call(this,t);var e,i=x(t);try{for(i.s();!(e=i.n()).done;){switch(e.value){case A.TYPE.LAYOUT_SIZE:this.jsvFlushVideoView()}}}catch(t){i.e(t)}finally{i.f()}}},{key:"jsvFlushVideoView",value:function(){if(this.jsvVideoView){var t={width:this.style.width,height:this.style.height},e={width:this.jsvMedia.videoWidth,height:this.jsvMedia.videoHeight},i=V.JsvFitViewLayout(t,e,this.style.objectFit);this.jsvVideoView.ResetLayoutParams(i)}}},{key:"jsvInit",value:function(){this.jsvMedia=new j.HOOKS.Video,this.addEventListener("load",this.jsvOnLoaded.bind(this)),d(c(n.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){d(c(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(!this.jsvVideoView){var t=m.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),e=new y.TextureSetting(t);this.jsvVideoView=new y.LayoutView,this.jsvVideoView.ResetTexture(e),this.jsvMainView.AddView(this.jsvVideoView)}this.jsvFlushVideoView()}}]),n}();for(var K in B.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},B.PROP){var H,W=x(B.PROP[K]);try{var Y=function(){var e=H.value,t={};"SetOnly"!==K&&"SetAndGet"!==K||(t.set=function(t){this.media[e]=t}),"GetOnly"!==K&&"SetAndGet"!==K||(t.get=function(){return this.media[e]}),B.prototype[e]=t};for(W.s();!(H=W.n()).done;)Y()}catch(t){W.e(t)}finally{W.f()}}function J(t){f(this,J);var e=t.indexOf(J.KeyFramesFlag)+J.KeyFramesFlag.length,i=t.indexOf("{"),n=t.substring(e,i);this.name=n.trim(),this.cssText=t}var z=function(){u(s,V);var e=v(s);function s(){var t;return f(this,s),(t=e.call(this)).jsvContentView=null,t.jsvRefedImgTex=null,t}return h(s,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new y.NinePatchView),d(c(s.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){d(c(s.prototype),"jsvOnUnloadForgeView",this).call(this),m.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(t){d(c(s.prototype),"jsvOnStyleChanged",this).call(this,t);var e,i=t.includes(A.TYPE.FOREGROUND),n=x(t);try{for(n.s();!(e=n.n()).done;){switch(e.value){case A.TYPE.LAYOUT_SIZE:if(i)break;this.jsvFlushViewForeground();break;case A.TYPE.FOREGROUND:this.jsvFlushViewForeground();break;case A.TYPE.BORDER:this.jsvFlushViewBorder()}}}catch(t){n.e(t)}finally{n.f()}}},{key:"jsvFlushViewForeground",value:function(){if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var t=this.jsvGetTextParams(),e=new y.TextViewEx(m.TextureManager,t,this.jsvStore.textContent,!0).GetLayoutView();this.jsvContentView.AddView(e)}}},{key:"jsvFlushViewBorder",value:function(){if(this.jsvMaskView)if(this.style.clipPath)console.error("BorderImage is conflicting with ClipPath.");else if(this.style.borderImage){m.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex&&this.jsvRefedImgTex.Source===this.style.borderImage.source.href||(this.jsvRefedImgTex=m.TextureManager.GetImage(this.style.borderImage.source.href));var t=R.ConvertPx(this.getAttribute("jsv-borderimage-width")),e=R.ConvertPx(this.getAttribute("jsv-borderimage-height"));t&&e&&(console.log("Custom cache image size with: "+t+"/"+e),m.SetImgTexSize(this.jsvRefedImgTex,{width:t,height:e})),m.RefImgTexSize(this.jsvRefedImgTex,function(t){var e=this.style.borderImageOutset?this.style.borderImageOutset:R.ConvertRect();this.jsvMaskView.SetPadding({start:e.left,width:t.width-e.left-e.right},{start:e.top,width:t.height-e.top-e.bottom});var i=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:i.left,width:t.width-i.left-i.right}],[{start:i.top,width:t.height-i.top-i.bottom}]);var n=new y.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(n)}.bind(this))}}},{key:"jsvGetTextParams",value:function(){var t={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"nowrap"===this.style.whiteSpace?"none":"normal"},e={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top"},i=this.style.textShadow?this.style.textShadow.split(" "):void 0;i&&(e.shadow={shadowOffsetX:parseInt(i[0]),shadowOffsetY:parseInt(i[1]),shadowBlur:parseInt(i[2]),shadowColor:i[3]});var n=this.style.fontSize?this.style.fontSize+4:14;this.style.lineHeight&&(n=this.style.lineHeight);var s=new y.TextViewParams;s.SetTextAttr(t),s.SetFontStyle(e),s.SetLineHeight(n);var o=this.style.width;return void 0===o&&(o=this.clientWidth),s.SetViewSize(new y.RectArea(0,0,o,this.style.height)),s}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(t){this.jsvStore.textContent=t,this.jsvStore.clientWidth=null,this.jsvContentView||(this.jsvContentView=new y.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var t=this.style.width;if(t||0===t)return t;if(this.jsvStore.textContent){if(this.jsvStore.clientWidth||0===this.jsvStore.clientWidth)return this.jsvStore.clientWidth;var e={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=m.GetTextWidth(e),this.jsvStore.clientWidth}return d(c(s.prototype),"clientWidth",this)}}]),s}(),X=function(){u(i,V);var t=v(i);function i(){return f(this,i),t.apply(this,arguments)}return h(i,[{key:"setAttribute",value:function(t,e){d(c(i.prototype),"setAttribute",this).call(this,t,e),t===V.ATTRIBUTE.SRC&&m.SetBackgroundImage(this.jsvMainView,e,this.style.borderRadius,this.jsvOnLoaded.bind(this))}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(V.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(t){var e={width:this.style.width,height:this.style.height},i=V.JsvFitViewLayout(e,t,this.style.objectFit);this.style.left&&(i.x+=this.style.left),this.style.top&&(i.y+=this.style.top),this.jsvMainView.ResetLayoutParams(i)}}]),i}();J.KeyFramesFlag="@keyframes";var q,Q=function(){function e(t){f(this,e),this.jsvCssRules=null,this.jsvTextContent=t}return h(e,[{key:"insertRule",value:function(t,e){if(console.log("StyleSheet.insertRule() rule="+t),void 0===e&&(e=this.jsvCssRules.length),t.indexOf(J.KeyFramesFlag)<0)throw Error("StyleSheet.insertRule() Rule is not supported except keyframes.");var i=new J(t);this.jsvCssRules.splice(e,0,i)}},{key:"deleteRule",value:function(t){console.log("StyleSheet.deleteRule() index="+t),this.jsvCssRules.splice(t,1)}},{key:"cssRules",get:function(){if(this.jsvCssRules)return this.jsvCssRules;if(this.jsvCssRules=new Array,this.jsvTextContent.indexOf(J.KeyFramesFlag)<0)return this.jsvCssRules;var t=this.jsvTextContent.split(J.KeyFramesFlag);for(var e in t)0!=e&&this.insertRule(J.KeyFramesFlag+t[e]);return this.jsvCssRules}}]),e}(),Z=function(){u(n,V);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t)).textContent=null,e}return h(n,[{key:"appendChild",value:function(t){d(c(n.prototype),"appendChild",this).call(this,t);var e=new Q(t.textContent);document.jsvAppendStyleSheet(e)}},{key:"removeChild",value:function(t){throw d(c(n.prototype),"removeChild",this).call(this,t),Error("Failed to removeChild, unimplement!.")}}]),n}(),$=function(){u(e,V);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return e}(),tt=function(){u(n,V);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this)).jsvMainView=new y.JsvElementView(t),e}return h(n,[{key:"setAttribute",value:function(t,e){d(c(n.prototype),"setAttribute",this).call(this,t,e),this.jsvMainView.setAttribute(t,e)}},{key:"removeAttribute",value:function(t){d(c(n.prototype),"removeAttribute",this).call(this,t),this.jsvMainView.removeAttribute(t)}},{key:"getAttribute",value:function(t){return this.jsvMainView.getAttribute(t)}},{key:"hasAttribute",value:function(t){return this.jsvMainView.hasAttribute(t)}},{key:"jsvOnStyleChanged",value:function(t){d(c(n.prototype),"jsvOnStyleChanged",this).call(this,t)}},{key:"textContent",get:function(){return this.jsvMainView.textContent},set:function(t){this.jsvMainView.textContent=t}}]),n}(),et=function(){u(n,k);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,k.TEXT_NODE)).textContent=t,e}return n}(),it=function(){u(i,k);var e=v(i);function i(){var t;return f(this,i),(t=e.call(this,k.DOCUMENT_NODE)).location=window.location,t.rootElement=new z,t.rootElement.ownerDocument=l(t),t.rootElement.id="root",t.activeElement=t.rootElement,t.cookie="",t.styleSheets=new Array,t.jsvIsReady=!1,t}return h(i,[{key:"createElement",value:function(t){switch(t){case i.DIV_ELEMENT:case i.FDIV_ELEMENT:return new z;case i.IMG_ELEMENT:case i.FIMG_ELEMENT:return new X;case i.STYLE_ELEMENT:return new Z;case i.AUDIO_ELEMENT:return new G;case i.VIDEO_ELEMENT:return new B;default:return 0===t.indexOf("jsv")?new tt(t):(console.warn("Document.createElement() unknown name="+t),new $(t))}}},{key:"createTextNode",value:function(t){return console.log("Document.createTextNode() text="+t),new et(t)}},{key:"createEvent",value:function(t){return new b(t)}},{key:"getElementById",value:function(t){if("root"===t||"app"===t)return this.rootElement;throw Error("Document.getElementById() id="+t+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(t){if("head"===t||"#app"===t)return this.rootElement;throw Error("Document.querySelector() selectors="+t+" is UNIMPLEMENTED.")}},{key:"jsvAppendStyleSheet",value:function(t){document.styleSheets.push(t)}},{key:"jsvGetKeyFrames",value:function(t){var e,i=x(this.styleSheets);try{for(i.s();!(e=i.n()).done;){var n,s=x(e.value.cssRules);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(o.name==t)return o.cssText}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}var r,a="@keyframes ",l=a+t,h=x(this.styleSheets);try{for(h.s();!(r=h.n()).done;){var u=r.value,c=u.jsvTextContent,d=c.indexOf(l);if(!(d<0)){var p=c.indexOf("-keyframes",d+1),f=c.indexOf(a,d+1);f<0&&(f=c.length),0<p&&p<f&&(f=p);var v=c.substring(d,f);return u.insertRule(v,0),v}}}catch(t){h.e(t)}finally{h.f()}return null}},{key:"jsvUpdateRootElement",value:function(t){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=t,this.jsvIsReady=!0}}]),i}();it.DIV_ELEMENT="div",it.IMG_ELEMENT="img",it.STYLE_ELEMENT="style",it.VIDEO_ELEMENT="video",it.AUDIO_ELEMENT="audio",it.FIMG_ELEMENT="fimg",it.FDIV_ELEMENT="fdiv",console.log("Declare React Proxy."),window.location=new g(window.JsView.getAppUrl(),!0),window.addEventListener=function(t,e){},window.document=new it,window.navigator={userAgent:"ForgeReact"},window.HTMLIFrameElement=function(){},window.Audio=G,window.Video=B,q="undefined"!=typeof ForgeExtension?y:{LogM:console.log.bind(console),LogF:console.error.bind(console),LogE:console.error.bind(console),LogW:console.warn.bind(console),LogI:console.log.bind(console),LogD:console.debug.bind(console),ThrowError:function(t){throw new Error(t)},Assert:function(t){if(!t)throw new Error("ASSERT!!!!!")},BaseActivity:function t(){f(this,t)}};var nt=function(){function n(t,e,i){f(this,n),this.PageName=t,this._FocusChild=null,this._LatestFocusChild=null,this.SubPages=[],this._ParentPage=null,this._ConsumeKeycodeUntilUp=-1,this.TouchDispatcher=null,this._Acc=.001,this._KeyLock=!1,this._CVSet=null,this._AutoShow=!1,this._IsShowing=!1,this._HostActivity=i,e&&this.SetContentView(e)}return h(n,[{key:"OnRenderFrame",value:function(){q.LogE("OnRenderFrame() MUST override")}},{key:"OnKeyDown",value:function(){return!1}},{key:"OnKeyUp",value:function(){return!1}},{key:"DispatchKeyDown",value:function(t){if(this._KeyLock)return!0;var e=!1;return(n.LastFocusPage=this)._FocusChild&&(e=this._FocusChild.DispatchKeyDown(t)),e=e||this.OnKeyDown(t)}},{key:"DispatchKeyUp",value:function(t){if(this._KeyLock)return!0;var e=!1;return this._FocusChild&&(e=this._FocusChild.DispatchKeyUp(t)),e=e||this.OnKeyUp(t)}},{key:"PrintLastFocusPage",value:function(){var t="------"+this.PageName+"\n",e=this._ParentPage;return e&&(t+=e.PrintLastFocusPage()),t}},{key:"OnMouseDown",value:function(){return!1}},{key:"EnableTouchDispatcher",value:function(){this.TouchDispatcher=new y.TouchDispatcher(this)}},{key:"DisableTouchDispatcher",value:function(){this.TouchDispatcher=null}},{key:"GetTouchView",value:function(){return null}},{key:"GetSwipeParams",value:function(t,e,i){var n=void 0===i||0===i?this._Acc:i,s=t*t/2/n;t<0&&(s=-s);var o=e*e/2/n;return e<0&&(o=-o),{durationX:Math.floor(Math.abs(t/n)),durationY:Math.floor(Math.abs(e/n)),distanceX:s,distanceY:o}}},{key:"OnTouch",value:function(){return!1}},{key:"DispatchTouch",value:function(t){var e=!1;return this.TouchDispatcher&&(e=this.TouchDispatcher.OnTouch(t)),e}},{key:"LostTouchFocus",value:function(){}},{key:"OnJavaKey",value:function(){return!0}},{key:"OnPlatformKey",value:function(){return!0}},{key:"PassPlatformKey",value:function(t,e){if(this._KeyLock)return!1;var i=this.OnPlatformKey(t,e);return i=i&&this.OnJavaKey(t,e)}},{key:"DispatchJavaKey",value:function(t,e){if(t===this._ConsumeKeycodeUntilUp)return 1===e&&(this._ConsumeKeycodeUntilUp=-1),y.LogM("Consume Javakey until up keycode="+t+" keyaction="+e),!1;if(this._KeyLock)return!1;-1!==this._ConsumeKeycodeUntilUp&&(y.LogE("ERROR: Other key pressed before locked key release"),this._ConsumeKeycodeUntilUp=-1);var i=this._FocusChild,n=!0;return i&&(n=i.DispatchJavaKey(t,e)),n=n&&this.PassPlatformKey(t,e),i!==this._FocusChild&&0===e&&this.CosumeAllKeyUnitlUpForFocusChange(t),n}},{key:"CosumeAllKeyUnitlUpForFocusChange",value:function(t){this._ParentPage?this._ParentPage.CosumeAllKeyUnitlUpForFocusChange(t):this._ConsumeKeycodeUntilUp=t}},{key:"OnHostActivityGetFocus",value:function(){this._ConsumeKeycodeUntilUp=-1}},{key:"IsFocus",value:function(){return!this._ParentPage||this._ParentPage._FocusChild===this}},{key:"_IsLeafInChain",value:function(){return this.IsFocus()&&!this._FocusChild}},{key:"SetParent",value:function(t,e){null!==t?(null!==e&&this.SetContentView(e),t instanceof q.BaseActivity&&(t=t.GetRootPageBase()),(this._ParentPage=t).SubPages.push(this),this._HostActivity=t._HostActivity,t._IsShowing&&this._AutoShow&&this._OnShowInternal()):q.ThrowError("ERROR: parent is null")}},{key:"SetParentPage",value:function(t){this.SetParent(t)}},{key:"RemoveSubPage",value:function(t){t===this._FocusChild&&(this._FocusChild=null),t===this._LatestFocusChild&&(this._LatestFocusChild=null);for(var e=0;e<this.SubPages.length;e++)if(t===this.SubPages[e]){t._OnHideInternal(),this.SubPages.splice(e,1);break}}},{key:"ClearSubPages",value:function(){this.SubPages=[],this._FocusChild=null,this._LatestFocusChild=null}},{key:"GetParentPage",value:function(){return this._ParentPage}},{key:"Focus",value:function(t){if(this.IsFocus()){if(!t)return void q.LogI("Already focused page_name="+this.PageName);if(this._IsLeafInChain())return void q.LogI("Already focused page_name="+this.PageName)}if(this._ParentPage){for(var e,i=[],n=this;n._ParentPage&&!n.IsFocus();)i.push(n),n=n._ParentPage;e=t&&0===i.length?this._FocusChild:i[i.length-1]._ParentPage._FocusChild;for(var s=[];e;)s.push(e),e=e._FocusChild;for(var o=s.length-1;0<=o;o--)s[o]._BlurInternal();for(var r=i.length-1;0<=r;r--)i[r]._FocusInternal();if(!t)for(var a=i[0];a._LatestFocusChild&&null===a._FocusChild;)a._LatestFocusChild.Focus(),(a=a._FocusChild)||q.ThrowError("ERROR: focus chain is broken")}}},{key:"_FocusInternal",value:function(){this._ParentPage?((this._ParentPage._FocusChild=this)._ParentPage._LatestFocusChild=this).OnFocus():y.LogE("No dispatcher")}},{key:"_BlurInternal",value:function(){this._ParentPage||y.LogE("No dispacher"),this._ParentPage._FocusChild===this?(this._ParentPage._FocusChild=null,this.OnBlur()):q.LogW("Not focus yet, page name="+this.PageName)}},{key:"GetFocusChild",value:function(){return this._FocusChild}},{key:"Hide",value:function(){this._AutoShow=!1,this._OnHideInternal()}},{key:"Show",value:function(t){this._OnShowInternal(),t&&this.Focus()}},{key:"OnFocus",value:function(){q.LogW("No overrided Page OnFocus event, page name="+this.PageName)}},{key:"OnBlur",value:function(){q.LogW("No overrided Page OnBlur event, page name="+this.PageName)}},{key:"OnShow",value:function(){q.LogW("No overrided Page OnShow event, page name="+this.PageName)}},{key:"OnHide",value:function(){q.LogW("No overrided Page OnHide event, page name="+this.PageName)}},{key:"_OnShowInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._AutoShow&&t._OnShowInternal();this._IsShowing||(this._IsShowing=!0,this.OnShow())}},{key:"_OnHideInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._IsShowing&&t._OnHideInternal();this._IsShowing&&(this._IsShowing=!1,this.OnHide())}},{key:"GetMainView",value:function(){return null===this._CVSet&&(this._CVSet=new y.MainViewSetting(null,null)),this._CVSet}},{key:"GetContentView",value:function(){return null===this._CVSet?null:this._CVSet.View}},{key:"SetContentView",value:function(t){null!==t&&(null!==this._CVSet&&this._CVSet.View.BindedPageBase(null),this._CVSet=new y.MainViewSetting(t,null),t.BindedPageBase(this))}},{key:"OnContentViewLostInternal",value:function(){this.OnContentViewLost()}},{key:"OnContentViewLost",value:function(){}},{key:"GetHostActivity",value:function(){return this._HostActivity}},{key:"SetHostActivity",value:function(t){this._HostActivity=t}},{key:"GetTextureManager",value:function(){return null!==this._HostActivity?this._HostActivity.GetTextureManager():null}},{key:"SetAutoShow",value:function(t){this._AutoShow=t}},{key:"KeyLock",value:function(){this._KeyLock=!0}},{key:"UnKeyLock",value:function(){this._KeyLock=!1}}]),n}();nt.LastFocusPage=null;var st,ot,rt,at,lt,ht=(st=Object,ot=st.getPrototypeOf||function(t){return t.__proto__},rt=st.setPrototypeOf||function(t,e){return t.__proto__=e,t},at="object"===("undefined"==typeof Reflect?"undefined":i(Reflect))?Reflect.construct:function(t,e,i){var n,s=[null];return s.push.apply(s,e),n=t.bind.apply(t,s),rt(new n,i.prototype)},function(t){var e=ot(t);return rt(t,rt(function(){return at(e,arguments,ot(this).constructor)},e))}),ut=function(){function t(){f(this,t),this._ChildMap={},this._FocusNodeName=null}return h(t,[{key:"add",value:function(t,e){this._ChildMap[t]=e,this._FocusNodeName==t&&e.Focus()}},{key:"focus",value:function(t){var e=this._ChildMap[t];return this._FocusNodeName=t,!!e&&(e.Focus(),!0)}},{key:"forEach",value:function(t){for(var e in this._ChildMap)t(this._ChildMap[e],e,this._ChildMap)}}]),t}();lt=window.JsView?y.PageBase:nt;var ct=ht(function(){u(n,lt);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._OnKeyDown=null,e._OnKeyUp=null,e._OnFocus=null,e._OnBlur=null,e._DispatchKeyDown=null,e._DispatchKeyUp=null,e._Mounted=!1,e.BranchName=null,e.Router=null,e._TmpRouter=null,e._SubNodes=e.SubPages,e._AutoShow=!1,e}return h(n,[{key:"UpdateMountState",value:function(){for(var t in this._Mounted=!0,this._SubNodes)this._SubNodes[t].UpdateMountState()}},{key:"SetRouter",value:function(t){this.Router=t}},{key:"RouterAdd",value:function(t,e){this.Router?this.Router.add(t,e):this._ParentPage?this._ParentPage.RouterAdd(t,e):(this._TmpRouter||(this._TmpRouter=new ut),this._TmpRouter.add(t,e))}},{key:"SetBranchName",value:function(t){this.BranchName=t}},{key:"SetOnKeyDown",value:function(t){this._OnKeyDown=t}},{key:"SetOnKeyUp",value:function(t){this._OnKeyUp=t}},{key:"SetOnFocus",value:function(t){this._OnFocus=t}},{key:"SetOnBlur",value:function(t){this._OnBlur=t}},{key:"SetDispatchKeyUp",value:function(t){this._DispatchKeyUp=t}},{key:"SetDispatchKeyDown",value:function(t){this._DispatchKeyDown=t}},{key:"OnKeyDown",value:function(t){return!!this._OnKeyDown&&this._OnKeyDown(t)}},{key:"OnKeyUp",value:function(t){return!!this._OnKeyUp&&this._OnKeyUp(t)}},{key:"DispatchKeyDown",value:function(t){var e=!1;return this._DispatchKeyDown&&(e=this._DispatchKeyDown(t)),!!e||d(c(n.prototype),"DispatchKeyDown",this).call(this,t)}},{key:"DispatchKeyUp",value:function(t){var e=!1;return this._DispatchKeyUp&&(e=this._DispatchKeyUp(t)),!!e||d(c(n.prototype),"DispatchKeyUp",this).call(this,t)}},{key:"AttachToActivity",value:function(t,e){d(c(n.prototype),"SetParent",this).call(this,t,e)}},{key:"SetParent",value:function(t){var i=this;null!=t&&(d(c(n.prototype),"SetParent",this).call(this,t,null),this._ParentPage._Mounted&&(this.UpdateMountState(),n.CurFocus&&n.CurFocus.Focus()),this._TmpRouter&&(this._TmpRouter.forEach(function(t,e){i._ParentPage.RouterAdd(e,t)}),this._TmpRouter=null),this.BranchName&&this._ParentPage.RouterAdd(this.BranchName,this))}},{key:"Focus",value:function(t){if(!this._Mounted)return n.CurFocus=this,void console.log("page base tree not build, cache focus");d(c(n.prototype),"Focus",this).call(this,t)}},{key:"OnFocus",value:function(){this._OnFocus&&this._OnFocus()}},{key:"OnBlur",value:function(){this._OnBlur&&this._OnBlur()}}]),n}());ct.CurFocus=null,ct.LastFocusNode=null,ct.RootPageNode=null;function dt(t){var e=""+vt++;return gt[e]=t,e}function pt(t){delete gt[t]}function ft(t){return gt[t]}var vt=0,gt={};ct.pbMap=gt;var yt=function(){u(d,r.Component);var c=v(d);function d(t){var e;f(this,d);var i=(e=c.call(this,t)).props.onKeyUp,n=e.props.onKeyDown,s=e.props.onFocus,o=e.props.onBlur,r=e.props.dispathchKeyDown,a=e.props.dispathcKeyUp,l=e.props.branchName,h=e.props.router,u=new ct(e.props.id);return l&&u.SetBranchName(l),n&&u.SetOnKeyDown(n),i&&u.SetOnKeyUp(i),s&&u.SetOnFocus(s),o&&u.SetOnBlur(o),r&&u.SetDispatchKeyDown(r),a&&u.SetDispatchKeyUp(a),h&&u.SetRouter(h),e._FocusNodeId=dt(u),e}return h(d,[{key:"render",value:function(){var e=this,t=this.props,i=(t.onKeyDown,t.onKeyUp,t.onFocus,t.onBlur,t.dispathchKeyDown,t.dispathcKeyUp,t.focus,t.branchName,t.router,o(t,["onKeyDown","onKeyUp","onFocus","onBlur","dispathchKeyDown","dispathcKeyUp","focus","branchName","router"]));return r.createElement("div",a({ref:function(t){e._Element=t}},i,{__pbid:this._FocusNodeId}))}},{key:"componentDidMount",value:function(){for(var t=ft(this._FocusNodeId),e=this._Element;e.parentElement;){var i=(e=e.parentElement).getAttribute("__pbid");if(i){var n=ft(i);t.SetParent(n);break}}}},{key:"componentWillUnmount",value:function(){console.log(this.props.id+"unmount"),this._Element.setAttribute("__pbid",""),this._Element=null,ft(this._FocusNodeId).ClearSubPages(),pt(this._FocusNodeId)}}]),d}(),mt=function(){u(o,r.Component);var s=v(o);function o(t){var e;f(this,o),e=s.call(this,t);var i,n=new ct("root");return e._FocusNodeId=dt(n),i=n,ct.RootPageBase=i,window.JsView?n.AttachToActivity(m.RootActivity,m.RootView):(window.addEventListener("keydown",function(t){ft(e._FocusNodeId).DispatchKeyDown(t),t.preventDefault&&t.preventDefault()}),window.addEventListener("keyup",function(t){ft(e._FocusNodeId).DispatchKeyUp(t),t.preventDefault&&t.preventDefault()})),e}return h(o,[{key:"render",value:function(){return r.createElement("div",a({__pbid:this._FocusNodeId},this.props))}},{key:"componentDidMount",value:function(){console.log("Root didmount"),ft(this._FocusNodeId).UpdateMountState(),ct.CurFocus&&ct.CurFocus.Focus()}},{key:"componentWillUnmount",value:function(){console.log("Root unmount"),ft(this._FocusNodeId).ClearSubPages(),pt(this._FocusNodeId)}}]),o}(),bt=function(){function i(t,e){f(this,i),this.Ranges=[],void 0!==t&&void 0!==e&&this.Ranges.push(new _t(t,e))}return h(i,[{key:"Merge",value:function(t){for(var e=!1,i=this.Ranges.length,n=0;n<this.Ranges.length;n++){if(t.End+1<this.Ranges[n].Start){i=n;break}if(this.Ranges[n].Merge(t)){for(e=!0;n+1<this.Ranges.length&&this.Ranges[n].Merge(this.Ranges[n+1]);)this.Ranges.splice(n+1,1);break}}e||this.Ranges.splice(i,0,t)}},{key:"Exclude",value:function(t){for(var e=0;e<this.Ranges.length&&!(t.End<this.Ranges[e].Start);e++){var i=this.Ranges[e].Exclude(t);if(this.Ranges[e].IsEmpty()&&(this.Ranges.splice(e,1),e--),null!==i.newSplitedRange){this.Ranges.splice(e+1,0,i.newSplitedRange);break}}}},{key:"ForEach",value:function(t,e){if(t)if(e)for(var i=this.Ranges.length-1;0<=i;i--)for(var n=this.Ranges[i].End;n>=this.Ranges[i].Start;n--)t(n);else for(var s=0;s<this.Ranges.length;s++)for(var o=this.Ranges[s].Start;o<=this.Ranges[s].End;o++)t(o);else console.log("Callback function is invalid")}}]),i}(),_t=function(){function i(t,e){f(this,i),this.Start=t,this.End=e}return h(i,[{key:"Merge",value:function(t){return this.IsInterAct(t)?(this.Start>t.Start&&(this.Start=t.Start),this.End<t.End&&(this.End=t.End),!0):this.End+1===t.Start?(this.End=t.End,!0):this.Start===t.End+1&&(this.Start=t.Start,!0)}},{key:"IsInterAct",value:function(t){return t.Start<this.Start?!(t.End<this.Start):t.Start<=this.End}},{key:"Exclude",value:function(t){var e={success:!1,newSplitedRange:null};return this.IsInterAct(t)&&(t.Start<=this.Start?t.End<this.End?this.Start=t.End+1:this.Clear():(t.End<this.End&&(e.newSplitedRange=new i(t.End+1,this.End)),this.End=t.Start-1),e.success=!0),e}},{key:"IsEmpty",value:function(){return this.Start>this.End}},{key:"Clear",value:function(){this.End=this.Start-1}},{key:"Clone",value:function(){return new i(this.Start,this.End)}}]),i}(),wt=function(){function s(t,e,i,n){f(this,s),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return h(s,[{key:"Equals",value:function(t){return null!==t&&(t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height)}}]),s}(),It=(new(function(){function t(){f(this,t)}return h(t,[{key:"FormatRectArea",value:function(t){var e=null;if(t instanceof wt)e=t;else if("object"===i(t)&&null!==t){if(isNaN(t.width)||isNaN(t.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");e=new wt(0,0,t.width,t.height)}return e}}]),t}()),function(){function n(t,e,i){f(this,n),this.IdsMap=[],this._IdsTotal=-1,this.List=[],this.Orient={type:t,widthMax:e},this.Layout={type:i||"relative"}}return h(n,[{key:"SetIdsMap",value:function(t,e){this.IdsMap[t]=e,this._IdsTotal=-1,this.List[e].id=t}},{key:"AddItem",value:function(t){this.List.push(t)}},{key:"GetIdsTotal",value:function(){if(this._IdsTotal<0){for(var t=0,e=0;e<this.List.length;e++)0<=this.List[e].id&&t++;this._IdsTotal=t}return this._IdsTotal}}]),n}());It.getTemplateItem=function(t,e){return{id:-1,hasSub:!!t.hasSub,xPos:t.blocks.x?t.blocks.x:0,yPos:t.blocks.y?t.blocks.y:0,centerXPos:0,centerYPos:0,width:t.blocks.w,height:t.blocks.h,focusAble:void 0===t.focusable||t.focusable,needRedraw:void 0===t.needRedraw||t.needRedraw,onBottomLine:!1,view:null,data:e}};function St(){}function Et(){return null}var kt=function(){function s(t,e,i,n){f(this,s),this._Gaps=[{GapStart:0,GapEnd:i-1}],this._FenceTotalWidth=i,this.AheadOffset=n,0<e&&this._SplitGap(0,t,e)}return h(s,[{key:"HasGapFor",value:function(t){for(var e=0;e<this._Gaps.length;e++)if(this._Gaps[e].GapEnd-this._Gaps[e].GapStart+1>=t)return{startPos:this._Gaps[e].GapStart};return null}},{key:"MarkGapUsed",value:function(t,e){if(e<=0)return this._Gaps.length;for(var i=t+e-1,n=-1,s=0;s<this._Gaps.length;s++)if(this._Gaps[s].GapStart<=t&&this._Gaps[s].GapEnd>=i){n=s;break}return-1===n&&console.log("Error in mark gap used, not found suitable gap of offset="+this.AheadOffset),this._SplitGap(n,t,e),this._Gaps.length}},{key:"_SplitGap",value:function(t,e,i){var n=this._Gaps.splice(t,1)[0],s=e+i-1;(e<n.GapStart||s>n.GapEnd)&&console.log("ERROR in split Fence Gap, range overflow"),s!==n.GapEnd&&this._Gaps.splice(t,0,{GapStart:1+s,GapEnd:n.GapEnd}),e!==n.GapStart&&this._Gaps.splice(t,0,{GapStart:n.GapStart,GapEnd:e-1})}},{key:"Fork",value:function(t){var e=new s(0,0,0,0);return e._Gaps=JSON.parse(JSON.stringify(this._Gaps)),e._FenceTotalWidth=this._FenceTotalWidth,e.AheadOffset=t,e}}]),s}(),Ot=function(){function o(t,e,i,n,s){f(this,o),this._Template=new It(t,e,i),this._FenceStack=[new kt(0,0,this._Template.Orient.widthMax,0)],this._Identity=0,this._MoveLimitArea=new wt(0,0,n,s),this._FenceEdge={StartX:0,StartY:0},this._NotOccupiedEdgeList=[],this._SupportHistoryPath=!1,this._VisibleRangeSearchBaseItem=null}return h(o,[{key:"_CheckNeighborItemMatching",value:function(t,e,i){var n=!1,s=e.edgeObj,o=i.edgeObj,r="rightEdge",a="leftEdge";switch(t){case"left":r="rightEdge",a="leftEdge";break;case"right":r="leftEdge",a="rightEdge";break;case"top":r="bottomEdge",a="topEdge";break;case"bottom":a="bottomEdge",r="topEdge";break;default:console.log("_CheckNeighborItemMatching unknown direction:"+t)}var l=o[r].range.Start,h=o[r].range.Clone();o[r].range.Exclude(s[a].range),s[a].range.Exclude(h);var u=o[r].range.Start;return o[r].range.IsEmpty()&&(n=!(o[r]=null)),s[a].range.IsEmpty()&&(n=!(s[a]=null)),l!==u&&(n=!0),n}},{key:"_FindNearestNeighbor",value:function(t){for(var e=t.edgeObj,i=-1,n=-1,s=-1,o=-1,r=-1,a=-1,l=-1,h=-1,u=0;u<this._NotOccupiedEdgeList.length;u++){var c=this._NotOccupiedEdgeList[u],d=c.edgeObj;if(t!==c){if(null!==e.leftEdge&&null!==d.rightEdge&&e.leftEdge.x>=d.rightEdge.x&&e.leftEdge.range.IsInterAct(d.rightEdge.range)){if(-1===r){r=e.leftEdge.x-d.rightEdge.x,i=u;continue}if(r>e.leftEdge.x-d.rightEdge.x){r=e.leftEdge.x-d.rightEdge.x,i=u;continue}}if(null!==e.rightEdge&&null!==d.leftEdge&&e.rightEdge.x<=d.leftEdge.x&&e.rightEdge.range.IsInterAct(d.leftEdge.range)){if(-1===a){a=d.leftEdge.x-e.rightEdge.x,n=u;continue}if(a>d.leftEdge.x-e.rightEdge.x){a=d.leftEdge.x-e.rightEdge.x,n=u;continue}}if(null!==e.topEdge&&null!==d.bottomEdge&&e.topEdge.y>=d.bottomEdge.y&&e.topEdge.range.IsInterAct(d.bottomEdge.range)){if(-1===l){l=e.topEdge.y-d.bottomEdge.y,s=u;continue}if(l>e.topEdge.y-d.bottomEdge.y){l=e.topEdge.y-d.bottomEdge.y,s=u;continue}}if(null!==e.bottomEdge&&null!==d.topEdge&&e.bottomEdge.y<=d.topEdge.y&&e.bottomEdge.range.IsInterAct(d.topEdge.range)){if(-1===h){h=d.topEdge.y-e.bottomEdge.y,o=u;continue}if(h>d.topEdge.y-e.bottomEdge.y){h=d.topEdge.y-e.bottomEdge.y,o=u;continue}}}}return{left:i,right:n,top:s,bottom:o}}},{key:"_CalculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],s=n.edgeObj,o=n.index;if(this._Template.Orient.type===Pt){if(null===s.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&s.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===s.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&s.rightEdge.x>this._FenceEdge.StartX)continue}var r=this._FindNearestNeighbor(n);if(-1!==r.left){var a=this._NotOccupiedEdgeList[r.left],l=a.index;if(t)e[l].tmpNeighborIndexList.right.push(o),e[o].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,a)&&(e[l].neighborIndexList.right.push(o),e[o].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[o].tmpNeighborIndexList.left=[])}if(-1!==r.right){var h=this._NotOccupiedEdgeList[r.right],u=h.index;if(t)e[u].tmpNeighborIndexList.left.push(o),e[o].tmpNeighborIndexList.right.push(u);else this._CheckNeighborItemMatching("right",n,h)&&(e[u].neighborIndexList.left.push(o),e[o].neighborIndexList.right.push(u),e[u].tmpNeighborIndexList.left=[],e[o].tmpNeighborIndexList.right=[])}if(-1!==r.top){var c=this._NotOccupiedEdgeList[r.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(o),e[o].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(o),e[o].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[o].tmpNeighborIndexList.top=[])}if(-1!==r.bottom){var p=this._NotOccupiedEdgeList[r.bottom],f=p.index;if(t)e[f].tmpNeighborIndexList.top.push(o),e[o].tmpNeighborIndexList.bottom.push(f);else this._CheckNeighborItemMatching("bottom",n,p)&&(e[f].neighborIndexList.top.push(o),e[o].neighborIndexList.bottom.push(f),e[f].tmpNeighborIndexList.top=[],e[o].tmpNeighborIndexList.bottom=[])}}}},{key:"_TryCalculateNeighborItem",value:function(t,e,i,n,s){var o={index:t,edgeObj:{leftEdge:{x:e,range:new _t(i,i+s-1)},rightEdge:{x:e+n,range:new _t(i,i+s-1)},topEdge:{y:i,range:new _t(e,e+n-1)},bottomEdge:{y:i+s,range:new _t(e,e+n-1)}}};0===e&&(o.edgeObj.leftEdge=null),0===i&&(o.edgeObj.topEdge=null);var r=!1,a=this._Template.Orient.widthMax,l=this._FenceEdge.StartX,h=this._FenceEdge.StartY;this._Template.Orient.type===Pt?(e+n===a&&(o.edgeObj.rightEdge=null),i>this._FenceEdge.StartY&&(r=!0,h=i)):(i+s===a&&(o.edgeObj.bottomEdge=null),e>this._FenceEdge.StartX&&(r=!0,l=e)),this._FenceEdge.StartX=l,this._FenceEdge.StartY=h,this._NotOccupiedEdgeList.push(o),r&&this._CalculateNeighborItem()}},{key:"_UpdateLastFenceEdge",value:function(){for(var t=this._FenceEdge,e={StartX:-1,StartY:-1},i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i].edgeObj;this._Template.Orient.type===Pt?null!==n.bottomEdge&&n.bottomEdge.y>t.StartY&&(-1===e.StartY||n.bottomEdge.y<e.StartY)&&(e.StartY=n.bottomEdge.y):null!==n.rightEdge&&n.rightEdge.x>t.StartX&&(-1===e.StartX||n.rightEdge.y<e.StartX)&&(e.StartX=n.rightEdge.x)}this._FenceEdge=e}},{key:"ParseTemplateItem",value:function(t,e){var i,n,s,o,r=It.getTemplateItem(t,e),a=this._FenceStack,l=-1,h=1,u=r.id,c=r.width,d=r.height,p=0,f=0,v=0,g=0,y=0;if("relative"===this._Template.Layout.type){g=this._Template.Orient.type===Pt?c:d,y=this._Template.Orient.type===Pt?d:c;for(var m=null,b=null;0<a.length;){var _=a[a.length-1];if(null!==(b=_.HasGapFor(g))){m=_;break}a.pop()}null!==b?(p=b.startPos,f=m.AheadOffset):console.log("ERROR: coding error, header full gap fence lost"),v=this._Template.Orient.type===Pt?(i=p,s=g,((n=f)+(o=y))/this._MoveLimitArea.height):(n=p,o=g,((i=f)+(s=y))/this._MoveLimitArea.width)}else i=r.xPos,n=r.yPos,s=c,o=d,v=this._Template.Orient.type===Pt?(n+o)/this._MoveLimitArea.height:(i+s)/this._MoveLimitArea.width;-1===l&&(l=u);var w=Math.ceil(v);0<=v&&w!==h&&(h=w,l=u),r.curPageHeadId=l,r.neighborIndexList={left:[],top:[],right:[],bottom:[]},r.tmpNeighborIndexList={left:[],top:[],right:[],bottom:[]},r.pathHistory={left:null,top:null,right:null,bottom:null},r.xPos=i,r.yPos=n,r.centerXPos=Math.floor(i+s/2)-1,r.centerYPos=Math.floor(n+o/2)-1,this._Template.Orient.type!==Pt&&n+o===this._Template.Orient.widthMax&&(r.onBottomLine=!0),this._Template.AddItem(r),r.focusAble&&this._Template.SetIdsMap(this._Identity++,this._Template.List.length-1),this._TryCalculateNeighborItem(this._Template.List.length-1,r.xPos,r.yPos,r.width,r.height);var I=f+y-1;a[0].AheadOffset<=I&&a.splice(0,0,new kt(0,0,this._Template.Orient.widthMax,1+I));for(var S=!1,E=!1,k=-1,O=a.length-1;0<=O;O--){if(!(a[O].AheadOffset<=I)){a[O].AheadOffset===1+I&&(E=!0),k=O;break}a[O].AheadOffset===I&&(S=!0),0===a[O].MarkGapUsed(p,g)&&a.splice(O,1)}var P=I;if(!S&&k+1<=a.length-1){var L=a[k+1].Fork(P);a.splice(k+1,0,L)}if(!E&&0<k){var x=a[k].Fork(1+P);a.splice(k+1,0,x)}}},{key:"GetItem",value:function(t){return this._Template.List[this._Template.IdsMap[t]]}},{key:"_CheckIdsHasFocusable",value:function(t){for(var e=this._Template.List,i=!1,n=0;n<t.length;n++){if(e[t[n]].focusAble){i=!0;break}}return i}},{key:"_IsInNeighborList",value:function(t,e){for(var i=!1,n=t.length-1;0<=n;n--)if(t[n]===e){i=!0;break}return i}},{key:"_GetValidNeighborIndex",value:function(t,e,i){var n=this._Template.List,s=-1,o=n[e],r=n[t],a=null,l=null;if(0<(a="top"===i?(l=o.neighborIndexList.left,o.neighborIndexList.right):(l=o.neighborIndexList.right,o.neighborIndexList.left)).length)for(var h=0;h<a.length;h++){var u=a[h],c=n[u];if(c.focusAble&&("top"===i&&c.yPos+c.height<=r.yPos||"bottom"===i&&c.yPos>=r.yPos+r.height)){s=u;break}}if(-1===s&&0<l.length)for(var d=0;d<l.length;d++){var p=l[d],f=n[p];if(f.focusAble&&("top"===i&&f.yPos+f.height<=r.yPos||"bottom"===i&&f.yPos>=r.yPos+r.height)){s=p;break}}return s}},{key:"_CaculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],s=n.edgeObj,o=n.index;if(this._Template.Orient.type===Pt){if(null===s.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&s.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===s.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&s.rightEdge.x>this._FenceEdge.StartX)continue}var r=this._FindNearestNeighbor(n);if(-1!==r.left){var a=this._NotOccupiedEdgeList[r.left],l=a.index;if(t)e[l].tmpNeighborIndexList.right.push(o),e[o].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,a)&&(e[l].neighborIndexList.right.push(o),e[o].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[o].tmpNeighborIndexList.left=[])}if(-1!==r.right){var h=this._NotOccupiedEdgeList[r.right],u=h.index;if(t)e[u].tmpNeighborIndexList.left.push(o),e[o].tmpNeighborIndexList.right.push(u);else this._CheckNeighborItemMatching("right",n,h)&&(e[u].neighborIndexList.left.push(o),e[o].neighborIndexList.right.push(u),e[u].tmpNeighborIndexList.left=[],e[o].tmpNeighborIndexList.right=[])}if(-1!==r.top){var c=this._NotOccupiedEdgeList[r.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(o),e[o].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(o),e[o].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[o].tmpNeighborIndexList.top=[])}if(-1!==r.bottom){var p=this._NotOccupiedEdgeList[r.bottom],f=p.index;if(t)e[f].tmpNeighborIndexList.top.push(o),e[o].tmpNeighborIndexList.bottom.push(f);else this._CheckNeighborItemMatching("bottom",n,p)&&(e[f].neighborIndexList.top.push(o),e[o].neighborIndexList.bottom.push(f),e[f].tmpNeighborIndexList.top=[],e[o].tmpNeighborIndexList.bottom=[])}}}},{key:"CalculateNeighborWhenAddStop",value:function(){this._UpdateLastFenceEdge(),this._CaculateNeighborItem();this._CaculateNeighborItem(!0);for(var t=this._Template.List,e=t.length-1,i=t[e],n=t.length-1;0<=n;n--)if((i=t[n]).focusAble){e=n;break}for(var s=t.length-1;0<=s;s--){var o=t[s];if(o.focusAble){if(0<o.neighborIndexList.bottom.length&&!this._CheckIdsHasFocusable(o.neighborIndexList.bottom)){var r=o.neighborIndexList.bottom[o.neighborIndexList.bottom.length-1],a=this._GetValidNeighborIndex(s,r,"bottom");-1!==a&&(o.neighborIndexList.bottom=[],o.neighborIndexList.bottom.push(a))}if(0<o.neighborIndexList.top.length&&!this._CheckIdsHasFocusable(o.neighborIndexList.top)){var l=this._GetValidNeighborIndex(s,o.neighborIndexList.top[o.neighborIndexList.top.length-1],"top");-1!==l&&(o.neighborIndexList.top=[],o.neighborIndexList.top.push(l))}}}if(this._Template.Orient.type!==Pt){for(var h=null,u=-1,c=0,d=e-1;0<=d;d--){var p=t[d];p.focusAble&&p.yPos>=i.yPos+i.height&&(0!==p.neighborIndexList.right.length&&this._CheckIdsHasFocusable(p.neighborIndexList.right)&&!this._IsInNeighborList(p.neighborIndexList.right,e)||(c=Math.pow(i.xPos-p.xPos,2)+Math.pow(i.yPos-p.yPos,2),(-1===u||c<u)&&(u=c,h=d)))}h&&(i.neighborIndexList.bottom=[],i.neighborIndexList.bottom.push(h))}else for(var f=e-1;0<=f;f--){var v=t[f];v.focusAble&&v.yPos+v.height<i.yPos+i.height&&0===v.neighborIndexList.bottom.length&&v.neighborIndexList.bottom.push(e)}}},{key:"GetNextItem",value:function(t,e,i,n){0===e&&0===i&&console.log("GetNextItem(): offset is 0"),0!==e&&0!==i&&console.log("GetNextItem(): not support change vertical and horizontal and the same time");var s,o=this._Template.IdsMap[t];return s=0!==e?this._GetNextItemVertical(o,e):this._GetNextItemHorizontal(o,i),n&&null===s&&(s=0!==e?this._GetNextLoopItemVertical(o,e):this._GetNextLoopItemHorizontal(o,i)),null===s?-1:s.id}},{key:"_GetNextItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,s="top",o="bottom";0<e&&(o="top",s="bottom");for(var r=i.length-1,a=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){r=l;break}}var h=!1,u=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[s]),null===c){var d=i[t].neighborIndexList[s];if(0<i[t].tmpNeighborIndexList[s].length&&(d=d.concat(i[t].tmpNeighborIndexList[s])),1===d.length)u=d[0],r===t&&"bottom"===s&&a===Lt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),h=!0;else{for(var p=0;p<d.length;p++){var f=i[u=d[p]];if(n<=f.xPos+f.width-1&&n>=f.xPos){r===t&&"bottom"===s&&a===Lt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),h=!0;break}}if(!h||!i[u].focusAble)for(var v=0;v<d.length;v++){var g=d[v];if(i[g].focusAble){r===t&&"bottom"===s&&a===Lt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),u=g,h=!0;break}}}}else u=c,r===t&&"bottom"===s&&a===Lt||(i[u].pathHistory[o]=t),h=!0;return h?i[u].focusAble?i[u]:this._GetNextItemVertical(u,e):null}},{key:"_GetNextItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,s="left",o="right";0<e&&(o="left",s="right");for(var r=i.length-1,a=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){r=l;break}}var h=!1,u=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[s]),null===c){var d=i[t].neighborIndexList[s];if(0<i[t].tmpNeighborIndexList[s].length&&(d=d.concat(i[t].tmpNeighborIndexList[s])),1===d.length)u=d[0],r===t&&"right"===s&&a===Pt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),h=!0;else{for(var p=0;p<d.length;p++){var f=i[u=d[p]];if(n<=f.yPos+f.height-1&&n>=f.yPos){r===t&&"right"===s&&a===Pt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),h=!0;break}}if(!h||!i[u].focusAble)for(var v=0;v<d.length;v++){var g=d[v];if(i[g].focusAble){r===t&&"right"===s&&a===Pt||(i[t].pathHistory[s]=u,i[u].pathHistory[o]=t),u=g,h=!0;break}}}}else u=c,r===t&&"right"===s&&a===Pt||(i[u].pathHistory[o]=t),h=!0;return h?i[u].focusAble?i[u]:this._GetNextItemHorizontal(u,e):null}},{key:"_GetNextLoopItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,s="bottom";0<e&&(s="top");var o=!1,r=-1,a=i[t].neighborIndexList[s];for(0<i[t].tmpNeighborIndexList[s].length&&(a=a.concat(i[t].tmpNeighborIndexList[s]));1<=a.length;)for(var l=0;l<a.length;l++){var h=i[r=a[l]];if(n<=h.xPos+h.width-1&&n>=h.xPos){a=i[r].neighborIndexList[s],o=!0;break}}return o?i[r].focusAble?i[r]:this._GetNextLoopItemVertical(r,e):null}},{key:"_GetNextLoopItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,s="right";0<e&&(s="left");var o=!1,r=-1,a=i[t].neighborIndexList[s];for(0<i[t].tmpNeighborIndexList[s].length&&(a=a.concat(i[t].tmpNeighborIndexList[s]));1<=a.length;)for(var l=0;l<a.length;l++){var h=i[r=a[l]];if(n<=h.yPos+h.height-1&&n>=h.yPos){a=i[r].neighborIndexList[s],o=!0;break}}return o?i[r].focusAble?i[r]:this._GetNextLoopItemHorizontal(r,e):null}},{key:"GetTemplate",value:function(){return this._Template}},{key:"GetVisibleItemList",value:function(t,e,i){if(e<t)return null;for(var n=this._Template.IdsMap[i],s={resultStartIdx:-1,resultEndIdx:-1,enableBackwardSearching:!0,enableForwardSearching:!0,checkingStartLinePos:t,checkingEndLinePos:e},o={searchDirect:-1,baseIdx:n,checkingStartLineRanges:new bt,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new bt,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:0,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:s},r={searchDirect:1,baseIdx:n,checkingStartLineRanges:new bt,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new bt,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:this._Template.List.length-1,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:s},a=this._Template.Orient.type===Pt,l=0;s.enableBackwardSearching||s.enableForwardSearching;)s.enableBackwardSearching&&this._DoSearching(o,-l,a),s.enableForwardSearching&&this._DoSearching(r,l,a),l++;if(s.resultStartIdx<0&&(0<=o.latestOverStartLineIdx&&0<=o.firstStartLineBlockIdx?s.resultStartIdx=o.latestOverStartLineIdx:0<=r.firstStartLineBlockIdx&&(s.resultStartIdx=r.firstStartLineBlockIdx)),s.resultEndIdx<0&&(0<=r.latestOverEndLineIdx&&0<=r.firstEndLineBlockIdx?s.resultEndIdx=r.latestOverEndLineIdx:0<=o.firstEndLineBlockIdx&&(s.resultEndIdx=o.firstEndLineBlockIdx)),s.resultStartIdx<0&&s.resultEndIdx<0){var h=this._Template.List[0],u=a?h.yPos:h.xPos,c=this._Template.List[this._Template.List.length-1],d=a?c.yPos:c.xPos,p=a?c.height:c.width;t<u&&d+p<e&&(s.resultStartIdx=0,s.resultEndIdx=this._Template.List.length-1)}var f=null;s.resultStartIdx<0&&s.resultEndIdx<0||(f={visibleStart:0<=s.resultStartIdx?s.resultStartIdx:0,visibleEnd:0<=s.resultEndIdx?s.resultEndIdx:this._Template.List.length-1});return f}},{key:"_DoSearching",value:function(t,e,i){var n=this._Template.List[t.baseIdx+e],s=i?n.xPos:n.yPos,o=i?n.width:n.height,r=i?n.yPos:n.xPos,a=i?n.height:n.width;if(t.common.resultStartIdx<0&&!t.startLineRangesFulled){var l=!1;if(r<=t.common.checkingStartLinePos&&r+a-1>=t.common.checkingStartLinePos?(t.latestOverStartLineIdx=t.baseIdx+e,t.firstStartLineBlockIdx<0&&(t.firstStartLineBlockIdx=t.baseIdx+e),t.checkingStartLineRanges.Merge(new _t(s,s+o-1)),l=!0):t.searchDirect<0&&r+a-1<=t.common.checkingStartLinePos&&(t.checkingStartLineRanges.Merge(new _t(s,s+o-1)),l=!0),l){var h=t.checkingStartLineRanges.Ranges[0];h&&this.DebugPrint&&h.Start<=0&&h.End>=this._Template.Orient.widthMax-1&&((h.End>this._Template.Orient.widthMax-1||h.Start<0)&&(t.startLineRangesFulled=!0),0<t.searchDirect?t.common.resultStartIdx=t.firstStartLineBlockIdx:t.common.resultStartIdx=t.latestOverStartLineIdx,0<=t.common.resultStartIdx&&(t.common.enableBackwardSearching=!1))}}if(t.common.resultEndIdx<0&&!t.endLineRangesFulled){var u=!1;if(r<=t.common.checkingEndLinePos&&r+a-1>=t.common.checkingEndLinePos?(t.latestOverEndLineIdx=t.baseIdx+e,t.firstEndLineBlockIdx<0&&(t.firstEndLineBlockIdx=t.baseIdx+e),t.checkingEndLineRanges.Merge(new _t(s,s+o-1)),u=!0):0<t.searchDirect&&r>=t.common.checkingEndLinePos&&(t.checkingEndLineRanges.Merge(new _t(s,s+o-1)),u=!0),u){var c=t.checkingEndLineRanges.Ranges[0];c&&this.DebugPrint&&c.Start<=0&&c.End>=this._Template.Orient.widthMax-1&&((c.End>this._Template.Orient.widthMax-1||c.Start<0)&&(t.endLineRangesFulled=!0),t.searchDirect<0?t.common.resultEndIdx=t.firstEndLineBlockIdx:t.common.resultEndIdx=t.latestOverEndLineIdx,0<=t.common.resultEndIdx&&(t.common.enableForwardSearching=!1))}}t.baseIdx+e===t.endSearchingIndex&&(0<t.searchDirect?t.common.enableForwardSearching=!1:t.common.enableBackwardSearching=!1,t.searchToBorder=!0)}}]),o}(),Pt=Symbol("vertical"),Lt=Symbol("horizontal"),xt={seamLess:Symbol("seamless"),wholePage:Symbol("wholePage"),seamlessFixedId:Symbol("seamlessFixedId")},Ft={left:Symbol("left"),right:Symbol("right"),top:Symbol("top"),bottom:Symbol("bottom")},Rt=function(){u(n,r.Component);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._setVisibility=e._setVisibility.bind(l(e)),e._updateView=e._updateView.bind(l(e)),e._Visibility=!0,e.props.setVisibleFunc&&(e.props.setVisibleFunc(e._setVisibility),e._Visibility=!1),e.props.registerUpdateFunc&&e.props.registerUpdateFunc(e._updateView),e.state={visible:e._Visibility},e}return h(n,[{key:"_updateView",value:function(){this.setState({visible:this._Visibility})}},{key:"_setVisibility",value:function(t){this._Visibility=t,this.setState({visible:this._Visibility})}},{key:"render",value:function(){var t=this.state.visible?"inherit":"hidden";return r.createElement("div",{style:{left:this.props.x,top:this.props.y,visibility:t}},this.props.renderFunc())}}]),n}(),At=function(){u(n,r.Component);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(l(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:Et,onRenderDone:St},e}return h(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||St})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),Tt=function(){u(n,r.Component);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(l(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:St},e}return h(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||St})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),Ct=function(){u(n,r.Component);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(l(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:St},e}return h(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||St})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),Vt=function(){u(e,r.Component);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return h(e,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return r.createElement("div",null,r.createElement(At,{registerUpdateFunc:this.props.registerUpdateContentFunc}),r.createElement(Ct,{registerUpdateFunc:this.props.registerUpdateBlurFunc}),r.createElement(Tt,{registerUpdateFunc:this.props.registerUpdateFocusFunc}))}}]),e}(),jt=function(){u(n,r.Component);var i=v(n);function n(t){var e;return f(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(l(e)),e.props.registerUpdateFunc(e._updateView),e.state={x:0,y:0,transitionCallback:St},e}return h(n,[{key:"_updateView",value:function(t,e,i){this.setState({x:t,y:e,transitionCallback:i})}},{key:"render",value:function(){return r.createElement("div",{style:{left:this.props.x,top:this.props.y}},r.createElement("div",{style:{transition:this.props.transition,top:this.state.y,left:this.state.x},onTransitionEnd:this.state.transitionCallback},r.createElement(Vt,{registerUpdateContentFunc:this.props.registerUpdateContentFunc,registerUpdateFocusFunc:this.props.registerUpdateFocusFunc,registerUpdateBlurFunc:this.props.registerUpdateBlurFunc})))}}]),n}(),Nt=function(){function t(){f(this,t),this._Component=null,this.registerComponent=this.registerComponent.bind(this),this.unregisterComponent=this.unregisterComponent.bind(this),this.dispatch=this.dispatch.bind(this)}return h(t,[{key:"registerComponent",value:function(t){this._Component=t}},{key:"unregisterComponent",value:function(){this._Component=null}},{key:"dispatch",value:function(t){t&&this._Component&&this._Component._dispathcEvent(t)}}]),t}(),Mt=function(){u(e,Nt);var t=v(e);function e(){return f(this,e),t.apply(this,arguments)}return e}();Mt.Type={setFocusId:Symbol("setFocusId"),setFocusRect:Symbol("setFocusRect"),updateItem:Symbol("updateItem"),slideToItem:Symbol("slideTo")};var Dt=function(){u(p,r.Component);var a=v(p);function p(t){var i;f(this,p),(i=a.call(this,t))._OnKeyDown=i._OnKeyDown.bind(l(i)),i._onFocusInner=i._onFocusInner.bind(l(i)),i._onBlurInner=i._onBlurInner.bind(l(i)),i._OnFocusableItemEdge=i._OnFocusableItemEdge.bind(l(i)),i._updateItemVisibility=i._updateItemVisibility.bind(l(i)),i._onTransitionEnd=i._onTransitionEnd.bind(l(i)),i._getContentView=i._getContentView.bind(l(i)),i._getFocusView=i._getFocusView.bind(l(i)),i._getBlurView=i._getBlurView.bind(l(i)),i._onContentUpdate=i._onContentUpdate.bind(l(i)),i._drawItem=i._drawItem.bind(l(i)),i._getSlideAnim=i._getSlideAnim.bind(l(i)),i._setItmeVisible=i._setItmeVisible.bind(l(i)),i._updateFocusItem=i._updateFocusItem.bind(l(i)),i._dispathcEvent=i._dispathcEvent.bind(l(i)),i._getQueryObj=i._getQueryObj.bind(l(i)),i.props.dispatcher&&i.props.dispatcher.registerComponent(l(i)),i._AllState={},i._AllState.isFocus=!1;var e=p._getTemplateParser(i.props);p._AddTemplateItem(i.props,e,0),i._AllState.templateParser=e,i._VisibleItemList=[],i._NeedHideItemList=[],i._ItemVisibleFuncMap=[],i._registerItemVisibleFunc=function(e){return function(t){i._ItemVisibleFuncMap[e]={visible:!1,func:t}}},i._itemUpdateFuncMap={},i._registerItemUpdateFunc=function(e){return function(t){i._itemUpdateFuncMap[e]=t}},i._updateRootFunc=St,i._registerUpdateRootFunc=function(t){i._updateRootFunc=t},i._updateContentFunc=St,i._registerUpdateContentFunc=function(t){i._updateContentFunc=t},i._updateFocusFunc=St,i._registerUpdateFocusFunc=function(t){i._updateFocusFunc=t},i._updateBlurFunc=St,i._registerUpdateBlurFunc=function(t){i._updateBlurFunc=t},i.queryPosition=function(t){return{xPos:i._AllState.templateParser.GetItem(t).xPos,yPos:i._AllState.templateParser.GetItem(t).yPos}};var n=0,s=0,o=i.props.direction===Pt?i.props.height:i.props.width;if(i._VisibleItemList=i._getVisibleItemList(n,s,s+o-1),void 0!==i.props.baseAnchor){var r=i._BaseAnchorInfo2Pos(i.props.baseAnchor,0,o);s=i.props.direction===Pt?r.yPos:r.xPos,i._VisibleItemList=i._getVisibleItemList(i.props.baseAnchor.id,s,s+o-1)}return i.props.initFocusId&&(n=i.props.initFocusId,void 0===i.props.baseAnchor&&(s=i._CalculateSlide(i._AllState.templateParser.GetItem(n),1,0),i._VisibleItemList=i._getVisibleItemList(n,s,s+o-1))),i._AllState.enterFocusId=-1,i._AllState.enterFocusRect=null,i._AllState.focusId=n,i._AllState.preFocusId=-1,i._AllState.preEdgeRect=null,i._AllState.visibleStart=s,i._AllState.visibleRange=o,i._AllState.baseAnchor=i.props.baseAnchor,i}return h(p,[{key:"_getQueryObj",value:function(t){return{id:t,queryPosition:this.queryPosition}}},{key:"_getSlideAnim",value:function(){return"left "+this.props.slideTime+"s, top "+this.props.slideTime+"s "+this.props.slideEasing}},{key:"_dispathcEvent",value:function(t){switch(t.type){case Mt.Type.setFocusId:this._AllState.enterFocusId=t.data;break;case Mt.Type.setFocusRect:this._AllState.enterFocusRect=t.data;break;case Mt.Type.updateItem:var e=t.data;if(e){var i,n=this._AllState.templateParser.GetTemplate(),s=x(e);try{for(s.s();!(i=s.n()).done;){var o=i.value,r=n.IdsMap[o];this._itemUpdateFuncMap[r]&&this._itemUpdateFuncMap[r]()}}catch(t){s.e(t)}finally{s.f()}}break;case Mt.Type.slideToItem:t.data&&this._slideViewToAnchor(t.data)}}},{key:"_getVisibleItemList",value:function(t,e,i){var n=this._AllState.templateParser.GetVisibleItemList(e,i,t);return this._AllState.templateParser.GetTemplate().List.slice(n.visibleStart,n.visibleEnd+1)}},{key:"_calculateNearestItemByRect",value:function(t,e){var i=e.direction,n=e.rect,s="",o={x:0,y:0};switch(i){case Ft.left:s="left",o.x=n.x,o.y=n.y+n.height/4;break;case Ft.right:s="right",o.x=n.x+n.width,o.y=n.y+n.height/4;break;case Ft.top:s="up",o.x=n.x+n.width/4,o.y=n.y;break;case Ft.bottom:s="down",o.x=n.x+n.width/4,o.y=n.y+n.height}var r,a=new _t(o.x,o.x),l=new _t(o.y,o.y),h=null,u=-1,c=0,d=0,p=0,f=this.props.direction===Pt?"yPos":"xPos",v=this.props.direction===Pt?"height":"width",g=x(t);try{for(g.s();!(r=g.n()).done;){var y=r.value;if(y[f]>=this._AllState.visibleStart&&y[f]+y[v]-1<=this._AllState.visibleStart+this._AllState.visibleRange-1){var m=this.props.direction===Pt?y.xPos:y.xPos-this._AllState.visibleStart,b=this.props.direction===Pt?y.yPos-this._AllState.visibleStart:y.yPos,_=new _t(m,m+y.width-1),w=new _t(b,b+y.height-1);switch(s){case"left":if(o.x<m+y.width-1)continue;o.y<b?d=Math.pow(o.x-(m+y.width-1),2)+Math.pow(b-o.y,2):l.IsInterAct(w)?d=Math.pow(o.x-(m+y.width-1),2):o.y>b+y.height-1&&(d=Math.pow(o.x-(m+y.width-1),2)+Math.pow(o.y-(b+y.height-1),2)),p=Math.abs(o.x-(m+y.width-1));break;case"right":if(o.x>m)continue;o.y<b?d=Math.pow(m-o.x,2)+Math.pow(b-o.y,2):l.IsInterAct(w)?d=Math.pow(m-o.x,2):o.y>b+y.height-1&&(d=Math.pow(m-o.x,2)+Math.pow(o.y-(b+y.height-1),2)),p=Math.abs(o.x-m);break;case"up":if(o.y<b+y.height-1)continue;o.x<m?d=Math.pow(o.x-m,2)+Math.pow(o.y-(b+y.height-1),2):a.IsInterAct(_)?d=Math.pow(o.y-(b+y.height-1),2):o.x>m+y.width-1&&(d=Math.pow(o.x-(m+y.width-1),2)+Math.pow(o.y-(b+y.height-1),2)),p=Math.abs(o.y-(b+y.height-1));break;case"down":if(o.y>b)continue;o.x<m?d=Math.pow(o.x-m,2)+Math.pow(b-o.y,2):a.IsInterAct(_)?d=Math.pow(b-o.y,2):o.x>m+y.width-1&&(d=Math.pow(o.x-(m+y.width-1),2)+Math.pow(b-o.y,2)),p=Math.abs(o.y-b);break;default:console.log("direction is error:"+s)}(u<0||p<c||c===p&&d<u)&&(u=d,c=p,h=y)}}}catch(t){g.e(t)}finally{g.f()}return h?h.id:0}},{key:"_updateItemVisibility",value:function(t,e){for(var i=this._AllState.templateParser.GetTemplate(),n=0;n<t.length;++n){var s=this._ItemVisibleFuncMap[i.IdsMap[t[n].id]];s&&s.visible!==e&&(s.visible=e,s.func&&s.func(e))}}},{key:"_OnKeyDown",value:function(t){var e=0,i=0;switch(t.keyCode){case 37:e=-1,this._moveToNext(e,i);break;case 38:i=-1,this._moveToNext(e,i);break;case 39:e=1,this._moveToNext(e,i);break;case 40:i=1,this._moveToNext(e,i);break;case 13:var n=this._AllState.templateParser.GetItem(this._AllState.focusId);!n.hasSub&&this.props.onClick&&this.props.onClick(n.data);break;default:return!1}return!0}},{key:"_moveToNext",value:function(t,e,i){var n=this._AllState.templateParser.GetTemplate(),s=this._AllState.preFocusId,o=n.IdsMap[this._AllState.focusId],r=this._AllState.templateParser.GetNextItem(this._AllState.focusId,e,t,this.props.loopFocus);if(0<=r){this._AllState.preFocusId=this._AllState.focusId;var a=this._AllState.templateParser.GetItem(r);this._AllState.focusId=a.id;var l=this.props.direction===Pt?e:t,h=this._AllState.visibleStart,u=this._CalculateSlide(a,l,this._AllState.visibleStart);if(h!==u){var c=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(r,u,u+this._AllState.visibleRange-1);var d,p=x(c);try{for(p.s();!(d=p.n()).done;){var f=d.value;this._VisibleItemList.indexOf(f)<0&&this._NeedHideItemList.indexOf(f)<0&&this._NeedHideItemList.push(f)}}catch(t){p.e(t)}finally{p.f()}var v,g=x(this._VisibleItemList);try{for(g.s();!(v=g.n()).done;){var y=v.value,m=this._NeedHideItemList.indexOf(y);0<=m&&this._NeedHideItemList.splice(m,1)}}catch(t){g.e(t)}finally{g.f()}this._AllState.visibleStart=u,this._updateItemVisibility(this._VisibleItemList,!0);var b=this.props.direction===Pt?0:-this._AllState.visibleStart,_=this.props.direction===Pt?-this._AllState.visibleStart:0;this._updateRootFunc(b,_,this._onTransitionEnd)}if(a.hasSub){var w,I=n.List[o].xPos-n.List[r].xPos,S=n.List[o].yPos-n.List[r].yPos;w=i?(i.rect.x+=I,i.rect.y+=S,i):{direction:null,rect:{x:I,y:S,width:n.List[o].width,height:n.List[o].height}},this._AllState.preEdgeRect=w,this._itemUpdateFuncMap[r]&&this._itemUpdateFuncMap[r]()}else s!==this._AllState.preFocusId&&this._setItmeVisible(n.IdsMap[s],!0),this._updateFocusItem(),this._updateBlurItem();if(0<=this._AllState.preFocusId&&this.props.onItemBlur){var E=this._AllState.templateParser.GetItem(this._AllState.preFocusId).data;this.props.onItemBlur(E,this._getQueryObj(this._AllState.preFocusId))}this._AllState.isFocus&&this.props.onItemFocus&&this.props.onItemFocus(a.data,this._AllState.preEdgeRect,this._getQueryObj(a.id))}else if(this.props.onEdge){var k,O=this.props.direction===Pt?0:this._AllState.visibleStart,P=this.props.direction===Pt?this._AllState.visibleStart:0;1===t&&(k=Ft.right),-1===t&&(k=Ft.left),1===e&&(k=Ft.bottom),-1===e&&(k=Ft.top);var L={x:n.List[o].xPos-O,y:n.List[o].yPos-P,width:n.List[o].width,height:n.List[o].height};this.props.onEdge({direction:k,rect:L})}}},{key:"_CalculateSlide",value:function(t,e,i){var n=i,s=n,o=this._AllState.templateParser.GetTemplate().List,r=o[o.length-1],a=this.props.direction===Pt?"yPos":"xPos",l=this.props.direction===Pt?"height":"width",h=this.props.direction===Pt?"bottom":"right",u=this.props.direction===Pt?this.props.height:this.props.width;switch(this.props.slideStyle){case xt.seamLess:var c=r[a]+r[l]-u+p._getPadding(this.props)[h];0<e?t[a]+t[l]>n+4*u/5&&(s=t[a]+t[l]-4*u/5):e<0&&t[a]<n+u/5&&(s=t[a]-u/5),s=(s=c<s?c:s)<0?0:s;break;case xt.wholePage:0<e?t[a]+t[l]>n+u+1&&(s=t[a]):e<0&&t[a]<n&&(s=(s=t[a]+t[l]-u)<0?0:s)}return s}},{key:"_OnFocusableItemEdge",value:function(t){var e=0,i=0;switch(t.direction){case Ft.left:e=-1;break;case Ft.right:e=1;break;case Ft.top:i=-1;break;case Ft.bottom:i=1}this._moveToNext(e,i,t)}},{key:"_ifValidEnterRect",value:function(t){return t&&t.direction&&t.rect}},{key:"_setItmeVisible",value:function(t,e){var i=this._ItemVisibleFuncMap[t];i&&i.visible!==e&&(i.visible=e,i.func&&i.func(e))}},{key:"_onFocusInner",value:function(){var t=void 0!==this._AllState.enterFocusId&&0<=this._AllState.enterFocusId?this._AllState.enterFocusId:this._AllState.focusId;if(t=this._ifValidEnterRect(this._AllState.enterFocusRect)?this._calculateNearestItemByRect(this._VisibleItemList,this._AllState.enterFocusRect):t,this._AllState.isFocus=!0,this._AllState.focusId=t,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=-1,this._updateFocusItem(),this._updateBlurFunc(this._getBlurView),this.props.onItemFocus){var e=this._AllState.templateParser.GetItem(t);this.props.onItemFocus(e.data,null,this._getQueryObj(e.id))}this.props.onFocus&&this.props.onFocus()}},{key:"_onBlurInner",value:function(){this._AllState.isFocus=!1,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=this._AllState.focusId,this._updateFocusFunc(this._getFocusView),this._updateBlurItem(),this.props.onBlur&&this.props.onBlur()}},{key:"_onTransitionEnd",value:function(t){t.stopPropagation(),this._updateItemVisibility(this._NeedHideItemList,!1),this._NeedHideItemList=[]}},{key:"_drawItem",value:function(t){var e=this;return function(){return e.props.renderItem(t.data,e._OnFocusableItemEdge,e._getQueryObj(t.id))}}},{key:"_getContentView",value:function(){var i=this,t=this._AllState.templateParser.GetTemplate().List;return r.createElement("div",{id:"container"},t.map(function(t,e){return r.createElement(Rt,{key:t.id,x:t.xPos,y:t.yPos,setVisibleFunc:i._registerItemVisibleFunc(e),registerUpdateFunc:i._registerItemUpdateFunc(e),renderFunc:i._drawItem(t)})}))}},{key:"_onContentUpdate",value:function(){this._updateItemVisibility(this._VisibleItemList,!0),this._updateFocusItem()}},{key:"_drawFocusItem",value:function(t){var e=this;return function(){return e.props.renderFocus(t.data,e._getQueryObj(t.id))}}},{key:"_getFocusView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.focusId);return t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus?r.createElement(Rt,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawFocusItem(t)}):null}},{key:"_updateFocusItem",value:function(){this._updateFocusFunc(this._getFocusView);var t=this._AllState.templateParser.GetItem(this._AllState.focusId);t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.focusId],!1)}},{key:"_drawBlurItem",value:function(t){var e=this;return function(){return e.props.renderBlur(t.data,e._renderBlurEndCallback(t.id),e._getQueryObj(t.id))}}},{key:"_getBlurView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);return t&&!t.hasSub&&this.props.renderBlur?r.createElement(Rt,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawBlurItem(t)}):null}},{key:"_updateBlurItem",value:function(){this._updateBlurFunc(this._getBlurView);var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);t&&!t.hasSub&&this.props.renderBlur||this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0)}},{key:"_onFocusUpdate",value:function(){}},{key:"_BaseAnchorInfo2Pos",value:function(t,e,i){var n=t.id,s={xPos:this.props.direction===Pt?0:e,yPos:this.props.direction===Pt?e:0};if(null!=n){var o=this._AllState.templateParser.GetTemplate().List,r=o[n],a=o[o.length-1];if(r){var l=void 0!==t.type?t.type:"start",h=this.props.direction===Pt?"yPos":"xPos",u=this.props.direction===Pt?"height":"width",c=this.props.direction===Pt?"bottom":"right";switch(l){case"start":s[h]=r[h];break;case"center":s[h]=r[h]-i/2+r[u]/2;break;case"end":s[h]=r[h]+r[u]-1-i}var d=a[h]+a[u]-i+p._getPadding(this.props)[c];s[h]=s[h]>d?d:s[h],s[h]=s[h]<0?0:s[h]}}return s}},{key:"_slideViewToAnchor",value:function(t){var e=this._BaseAnchorInfo2Pos(t,this._AllState.visibleStart,this._AllState.visibleRange);this._AllState.visibleStart=this.props.direction===Pt?e.yPos:e.xPos;var i=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(t.id,this._AllState.visibleStart,this._AllState.visibleStart+this._AllState.visibleRange-1);var n,s=x(i);try{for(s.s();!(n=s.n()).done;){var o=n.value;this._VisibleItemList.indexOf(o)<0&&this._NeedHideItemList.indexOf(o)<0&&this._NeedHideItemList.push(o)}}catch(t){s.e(t)}finally{s.f()}this._updateItemVisibility(this._VisibleItemList,!0),this._updateRootFunc(-e.xPos,-e.yPos,this._onTransitionEnd)}},{key:"_onBlurUpdate",value:function(){}},{key:"_renderBlurEndCallback",value:function(t){var e=this;return function(){t===e._AllState.preFocusId&&e._updateBlurFunc(Et),e._setItmeVisible(e._AllState.templateParser.GetTemplate().IdsMap[t],!0)}}},{key:"render",value:function(){return r.createElement(yt,{onKeyDown:this._OnKeyDown,branchName:this.props.branchName,onFocus:this._onFocusInner,onBlur:this._onBlurInner,style:{left:this.props.left,top:this.props.top,width:this.props.width,height:this.props.height,clipPath:"inset(0px 0px 0px 0px)"}},r.createElement(jt,{x:this.props.padding&&void 0!==this.props.padding.left?this.props.padding.left:0,y:this.props.padding&&void 0!==this.props.padding.top?this.props.padding.top:0,transition:this._getSlideAnim(),registerUpdateFunc:this._registerUpdateRootFunc,registerUpdateContentFunc:this._registerUpdateContentFunc,registerUpdateFocusFunc:this._registerUpdateFocusFunc,registerUpdateBlurFunc:this._registerUpdateBlurFunc}))}},{key:"componentDidUpdate",value:function(){var t=this,e=this._AllState.templateParser.GetTemplate().List,i=this.props.data,n=0;for(n=0;n<i.length;++n){for(var s=!1,o=0;o<e.length;++o)if(i[n]===e[o].data){s=!0;break}if(!s)break}var r=!1;if(n===e.length)n!==i.length?(r=!0,p._AddTemplateItem(this.props,this._AllState.templateParser,n)):!this.props.baseAnchor||this.props.baseAnchor.id===this._AllState.baseAnchor.id&&this.props.baseAnchor.type===this._AllState.baseAnchor.type||(this._AllState.baseAnchor=this.props.baseAnchor,this._slideViewToAnchor(this._AllState.baseAnchor));else{r=!0;var a=p._getTemplateParser(this.props);p._AddTemplateItem(this.props,a,0),this._AllState.templateParser=a}r&&this._updateContentFunc(this._getContentView,null),this._AllState.focusId>=this.props.data.length&&(this._AllState.focusId=0,this._AllState.preFocusId=-1,0!==this._AllState.visibleStart&&(this._AllState.visibleStart=0,this._updateRootFunc(0,0,null))),this._updateFocusItem(),this.props.onWidgetUpdate&&Promise.resolve().then(function(){t.props.onWidgetUpdate()})}},{key:"componentDidMount",value:function(){var t=this;if(this._updateContentFunc(this._getContentView,this._onContentUpdate),0!==this._AllState.visibleStart){var e=this.props.direction===Pt?0:-this._AllState.visibleStart,i=this.props.direction===Pt?-this._AllState.visibleStart:0;this._updateRootFunc(e,i,null)}this.props.onWidgetMount&&Promise.resolve().then(function(){t.props.onWidgetMount()})}}],[{key:"_getPadding",value:function(t){var e={left:0,right:0,top:0,bottom:0};return void 0!==t.padding&&null!==t.padding&&(e={left:void 0===t.padding.left?0:t.padding.left,right:void 0===t.padding.right?0:t.padding.right,top:void 0===t.padding.top?0:t.padding.top,bottom:void 0===t.padding.bottom?0:t.padding.bottom}),e}},{key:"_getTemplateParser",value:function(t){var e=p._getPadding(t),i=t.direction===Pt?t.width-e.left-e.right:t.height-e.top-e.bottom,n=t.layoutType?t.layoutType:"relative";return new Ot(t.direction,i,n,t.width,t.height)}},{key:"_AddTemplateItem",value:function(t,e,i){for(var n=i;n<t.data.length;n++){var s=t.measures(t.data[n]);e.ParseTemplateItem(s,t.data[n])}e.CalculateNeighborWhenAddStop()}}]),p}();Dt.defaultProps={left:0,top:0,slideEasing:"cubic-bezier(0.14,0.68,0.19,0.87)",slideTime:.2,loopFocus:!1,slideStyle:xt.seamLess},Dt.getMeasureObj=function(t,e,i,n){return{blocks:{w:t,h:e},focusable:i,hasSub:n}},t.BaseDispatcher=Nt,t.EdgeDirection=Ft,t.Fdiv=yt,t.FdivRoot=mt,t.Forge=y,t.ForgeExtension=E,t.HORIZONTAL=Lt,t.Router=ut,t.SWidgetDispatcher=Mt,t.SimpleWidget=Dt,t.SlideStyle=xt,t.VERTICAL=Pt,Object.defineProperty(t,"__esModule",{value:!0})});
