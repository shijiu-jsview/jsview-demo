!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";void 0===window.Forge&&(window.Forge={});var m=window.Forge;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function g(e,t,i){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}console.log("Define Forge ..."),window.originDocument={},window.originDocument.createElement=window.document.createElement.bind(window.document),window.originDocument.createTextNode=window.document.createTextNode.bind(window.document),window.originDocument.getElementById=window.document.getElementById.bind(window.document),window.originDocument.querySelector=window.document.querySelector.bind(window.document),window.originDocument.createEvent=window.document.createEvent.bind(window.document),window.originDocument.dispatchEvent=window.document.dispatchEvent.bind(window.document);var e=function(){function r(){v(this,r)}return h(r,null,[{key:"getTextPixelWith",value:function(e,t){null===r.sCanvas&&(r.sCanvas=window.originDocument.createElement("canvas"));var i=r.sCanvas.getContext("2d");i.font=t;var n=i.measureText(e);return Math.ceil(n.width)}},{key:"GetTextWidth",value:function(e){return this.getTextPixelWith(e.str,e.size+"px "+e.font)}},{key:"GetTextRect",value:function(e,t,i,n,r){var a=Math.ceil(i.size*e.length/t.width)*r;return a>t.height&&(a=t.height),{width:t.width,height:a}}}]),r}();e.sCanvas=null,window.PlatformUtils=e;var r=function(){function t(){v(this,t),this.state={}}return h(t,[{key:"buildPlatformInstance",value:function(){var e=this;this.VideoEle=window.originDocument.createElement("VIDEO"),this.VideoEle.addEventListener("loadedmetadata",function(){e.hasOwnProperty("onload")&&e.onload(),e.hasOwnProperty("onloadedmetadata")&&e.onloadedmetadata()})}},{key:"addEventListener",value:function(t,e){var i=this;this["on"+t]=e,this.VideoEle.addEventListener(t,function(e){i["on"+t](e)})}},{key:"load",value:function(){this.VideoEle.load()}},{key:"pause",value:function(){this.VideoEle.pause(),this.setState("paused",!0,"boolean"),this.hasOwnProperty("onpause")&&this.onpause()}},{key:"play",value:function(){this.setState("paused",!1,"boolean"),this.VideoEle.play(),this.hasOwnProperty("onplay")&&this.onplay()}},{key:"unload",value:function(){this.setState("paused",!0,"boolean"),this.VideoEle.isRenderable=!1,this.VideoEle.pause(),this.VideoEle.removeAttribute("src"),this.VideoEle.load()}},{key:"setState",value:function(e,t,i){u(t)===i?(this.VideoEle.setAttribute(e,t),this.state[e]=t,console.log("set "+e+" = "+t)):console.warn("invalid paramter type to set "+e+". value is not "+i)}},{key:"getState",value:function(e){var t=this.state[e];return console.log("get "+e+" = "+t),void 0===t&&(t=this.VideoEle.getAttribute(e),this.state[e]=t),t}},{key:"onError",value:function(e){this.VideoEle.isRenderable=!1,this.hasOwnProperty("onerror")&&this.onerror(e.currentTarget.error.code)}},{key:"mediaHandler",value:function(){return this.VideoEle}},{key:"autoplay",set:function(e){e&&this.play()}},{key:"currentTime",get:function(){return this.VideoEle.currentTime},set:function(e){this.VideoEle.isRenderable=!1,this.VideoEle.currentTime=e,this.setState("seek",e,"number")}},{key:"duration",get:function(){return this.VideoEle.duration}},{key:"loop",set:function(e){this.VideoEle.loop="boolean"!=typeof e||e}},{key:"muted",get:function(){return this.getState("muted")},set:function(e){this.setState("muted",e,"boolean")}},{key:"paused",get:function(){return this.VideoEle.paused}},{key:"playbackRate",get:function(){return this.getState("rate")},set:function(e){this.setState("rate",e,"number")}},{key:"src",set:function(e){this.setState("src",e,"string")}},{key:"style",get:function(){var t=this;return{set bottom(e){t.setState("style",'{"bottom":"'+e+'"}',"string")},set left(e){t.setState("style",'{"left":"'+e+'"}',"string")},set right(e){t.setState("style",'{"right":"'+e+'"}',"string")},set top(e){t.setState("style",'{"top":"'+e+'"}',"string")},set height(e){t.setState("style",'{"height":"'+e+'"}',"string")},set width(e){t.setState("style",'{"width":"'+e+'"}',"string")}}}},{key:"volume",get:function(){return this.getState("volume")},set:function(e){this.setState("volume",e,"number")}},{key:"playableDuration",get:function(){return this.VideoEle.playableDuration}}],[{key:"setDesignMapWidth",value:function(e){"number"==typeof e?t.prototype.designMapWidth=e:console.warn("Invalid paramter type to set "+e+". It is not number.")}}]),t}();r.prototype.designMapWidth=0;var t=function(){function t(){var e;return v(this,t),(e=y(this,f(t).call(this)))._ReleaseCallbacks=[],e._ResourceTerminater=null,g(f(t.prototype),"buildPlatformInstance",d(e)).call(d(e)),e}return c(t,r),h(t,[{key:"setResourceTerminator",value:function(e){this._ResourceTerminater=e}},{key:"hasTerminator",value:function(){return null!=this._ResourceTerminater}},{key:"listenToRelease",value:function(e){this._ReleaseCallbacks.push(e)}},{key:"unload",value:function(){g(f(t.prototype),"unload",this).call(this),null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"releaseResource",value:function(){for(var e=0;e<this._ReleaseCallbacks.length;e++)this._ReleaseCallbacks[e]();null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"onPlatformDestroy",value:function(){}}]),t}();window.OffscreenVideoPlayer=t,m.LogF=function(e){},m.LogE=function(e){},m.LogW=function(e){},m.LogI=function(e){},m.LogD=function(e){},m.LogM=function(e){},m.ThrowError=function(e){throw new Error(e)},m.Assert=function(e){if(!e)throw new Error("ASSERT!!!!!")},m.EnableLog=function(e){m.LogM=console.log.bind(console),0<e&&(m.LogF=console.error.bind(console)),1<e&&(m.LogE=console.error.bind(console)),2<e&&(m.LogW=console.warn.bind(console)),3<e&&(m.LogI=console.log.bind(console)),4<e&&(m.LogD=console.debug.bind(console))};var a=function(){function r(e,t,i,n){v(this,r),this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return h(r,[{key:"Equals",value:function(e){return null!==e&&(e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height)}}]),r}();m.RectArea=a;m.Coordinate=function e(t,i){v(this,e),this.x=t,this.y=i};m.Size=function e(t,i){v(this,e),this.width=t,this.height=i};var s=function(){function e(){v(this,e)}return h(e,[{key:"FormatRectArea",value:function(e){var t=null;if(e instanceof m.RectArea)t=e;else if("object"===u(e)&&null!==e){if(isNaN(e.width)||isNaN(e.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");t=new m.RectArea(0,0,e.width,e.height)}return t}}]),e}();m.RectUtils=s,m.sRectUitls=new m.RectUtils;var o=function(){function d(){v(this,d)}return h(d,[{key:"StringWithFont",value:function(e,t,i,n,r,a,s,o,l,u){var h="";!0===s&&(h="italic");var c="";return!0===o&&(c="bold"),{str:""+e,font:i=i||d._sDefaultFont,size:t=t||d._sDefaultFontSize,italic:h,bold:c,stroke_width:u=u||-1,alignment:n=n||"left",vertical_align:r=r||"middle",textColour:a=a||d._sDefaultFontColor,backgroundColour:d._sDefaultBackgroundColor,enableBlend:!0,shadow:l=l||null}}},{key:"TextAttr",value:function(e,t){return{text_overflow:e=e||"none",word_wrap:t=t||"none"}}},{key:"GetTextWidth",value:function(e){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextWidth(e):e.str.length*e.size+1}},{key:"GetTextRect",value:function(e,t,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextRect(e,t,i,n,r):{width:t.width,height:t.height}}},{key:"GetTextInfo",value:function(e,t,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextInfo(e,t,i,n,r):{start:0,end:e.length,width:t.width,height:t.height}}},{key:"GetCursorOffset",value:function(e,t,i,n,r,a,s){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorOffset(e,t,i,n,r,a,s):0}},{key:"GetCursorPosition",value:function(e,t,i,n,r,a){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorPosition(e,t,i,n,r,a):{x:0,y:0}}}]),d}();o._sDefaultFont="黑体",o._sDefaultFontSize=30,o._sDefaultFontColor="#FFFFFF",o._sDefaultBackgroundColor="rgba(0, 0, 0, 0)",m.TextUtils=o,m.sTextUtils=new m.TextUtils,m.TextShaderType={LinearGradient:0,Image:1};m.TextShader=function e(t,i){v(this,e),this.Type=t,this.Params=i};var l=function(){function t(){v(this,t);var e=(new m.LayoutView).GetRenderer();this._Renderer=e,this.StringWithFont=m.sTextUtils.StringWithFont("",0,void 0,"center","middle",void 0,!1,!1,void 0),this.RectArea=new m.RectArea(0,0,0,0),this.TextAttr=m.sTextUtils.TextAttr("ellipsis","none"),this.Marquee=null,this.Shader=null,this.IsInstantLoad=!0,this.LineHeight=0}return h(t,[{key:"SetInstantLoad",value:function(e){return this.IsInstantLoad=e,this}},{key:"SetStringWithFont",value:function(e){return this.StringWithFont=e,this}},{key:"SetFontStyle",value:function(e,t,i,n,r,a,s,o,l){return"object"===u(e)?this.StringWithFont=m.sTextUtils.StringWithFont("",void 0!==e.size?e.size:10,void 0!==e.font?e.font:"宋体",void 0!==e.hAlign?e.hAlign:"center",void 0!==e.vAlign?e.vAlign:"middle",void 0!==e.textColor?e.textColor:"#000000",void 0!==e.italic&&e.italic,void 0!==e.bold&&e.bold,void 0!==e.shadow?e.shadow:null):this.StringWithFont=m.sTextUtils.StringWithFont("",e,t,i,n,r,a,s,o,l),this}},{key:"SetRectArea",value:function(e){return e instanceof m.RectArea?this.RectArea=e:this.RectArea=new m.RectArea(e.x,e.y,e.width,e.height),this}},{key:"SetViewSize",value:function(e){return e instanceof m.RectArea||(e=new m.RectArea(e.x,e.y,e.width,e.height)),this.SetRectArea(e),0===this.LineHeight&&0!==e.height&&(this.LineHeight=e.height),this}},{key:"SetTextAttr",value:function(e){var t,i;return t=e.hasOwnProperty("textOverflow")?e.textOverflow:e.hasOwnProperty("text_overflow")?e.text_overflow:"clip",i=e.hasOwnProperty("wordWrap")?e.wordWrap:e.hasOwnProperty("word_wrap")?e.word_wrap:"none",this.TextAttr={word_wrap:i,text_overflow:t},this}},{key:"SetMarquee",value:function(e){return e&&(this.Marquee={repetition:"infinite",direction:"left",speed:"normal"},e.repetition&&(this.Marquee.repetition=e.repetition),e.direction&&(this.Marquee.direction=e.direction),e.speed&&(this.Marquee.speed=e.speed)),this}},{key:"SetShader",value:function(e){return this.Shader=e,this}},{key:"SetLineHeight",value:function(e){return this.LineHeight=e,this}},{key:"Clone",value:function(){var e=new t(null);return e.StringWithFont=this.StringWithFont,e.RectArea=this.RectArea,e.TextAttr=this.TextAttr,e.LineHeight=this.LineHeight,e}}]),t}();m.TextViewParams=l,window.TextViewParams=m.TextViewParams;var w=function(){function f(e,t,i,n){v(this,f),this._layoutView=null,this._textWidth=0,this._textViewReahHeight=0,this._marqueeRunning=!0,this._marqueeCurrentNum=2,this._textView=null,this._TextViewParams=t,this._NeedQuick=void 0!==n&&n,this._marquee=t.Marquee,this._rectArea=t.RectArea,this._DrawCount=0,this._ShowInterval=0,this._AutoHeight=!1,this._TextureManager=e,this._Shader=t.Shader,this._IsInstantLoad=t.IsInstantLoad?1:0;var r,a,s=this,o=t.RectArea.width,l=t.RectArea.height,u=null;null!==this._marquee?((u=new m.ClipView).Init(),u.SetClipRect(0,0,o,l,!0),u.SetId("matrixClipLayoutview"),u.OnDettachFromSystem=function(){s._marqueeRunning=!1,m.ClipView.prototype.OnDettachFromSystem.call(this)}):u=new m.LayoutView,r=u.GetRenderer(),this._Renderer=r;var h=i;h=h||t.StringWithFont.str,h=this._ConvertEscToString(h);var c=!1;0<t.StringWithFont.italic.length&&(c=!0);var d=!1;0<t.StringWithFont.bold.length&&(d=!0),a=m.sTextUtils.StringWithFont(h,t.StringWithFont.size,t.StringWithFont.font,t.StringWithFont.alignment,t.StringWithFont.vertical_align,t.StringWithFont.textColour,c,d,t.StringWithFont.shadow,t.StringWithFont.stroke_width),void 0!==t.Marquee&&null!==t.Marquee?this._textWidth=m.sTextUtils.GetTextWidth(a):this._NeedQuick?this._textWidth=t.RectArea.width-2*t.RectArea.x:this._textWidth=m.sTextUtils.GetTextWidth(a),this.addTextView(u,a,t.TextAttr,t.RectArea,t.Marquee,t.LineHeight),this._layoutView=u,this._TextTexture=null}return h(f,[{key:"_ConvertEscToString",value:function(e){var t=""+e;return-1!==t.indexOf("&quot;")&&(t=t.replace(/&quot;/gi,'"')),-1!==t.indexOf("&amp;")&&(t=t.replace(/&amp;/gi,"&")),-1!==t.indexOf("&lt;")&&(t=t.replace(/&lt;/gi,">")),-1!==t.indexOf("&gt;")&&(t=t.replace(/&gt;/gi,"<")),-1!==t.indexOf("&nbsp;")&&(t=t.replace(/&nbsp;/gi," ")),t}},{key:"EnableAutoHeight",value:function(){this._AutoHeight=!0}},{key:"addTextView",value:function(e,t,i,n,r,a){var s,o=n.height,l=m.Clone(n),u=null;0!==t.str.length?(s=this._TextureManager.GetTextTextureByMultiRows(t,i,l,a,this._NeedQuick,this._Shader,this._IsInstantLoad),this._TextTexture=s.texture,this._textViewReahHeight=s.real_height,(u=new m.LayoutView).Init(new m.TextureSetting(s.texture,null,null,!0)),u.SetId("Text-"+t.str),e.AddView(u,new m.LayoutParams({x:0,y:0,width:l.width,height:o})),this._textView=u):(this._textViewReahHeight=0,m.LogI("t_StringWithFont.str.length is 0"))}},{key:"GetLayoutView",value:function(){return this._layoutView}},{key:"GetTextWidth",value:function(){return this._textView?this._textView.Div.clientWidth:Math.floor(this._textWidth+.5)}},{key:"StartAnimation",value:function(e){e&&null!==this._textView&&this._textView.StartAnimation(e)}}]),f}();m.TextViewEx=w,m.TextViewControl=w,m.Clone=function(e){var t=JSON.stringify(e);return JSON.parse(t)},window.Clone=m.Clone;var p=function(){function e(){v(this,e),this._AlreadyExited=!1,window.PersistTimer&&(this._AlreadyExited=!0)}return h(e,[{key:"setTimeout",value:function(e,t){return this._AlreadyExited&&window.PersistTimer.setTimeout?window.PersistTimer.setTimeout(e,t):window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){this._AlreadyExited&&window.PersistTimer.clearTimeout?window.PersistTimer.clearTimeout(e):window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){if(!this._AlreadyExited||!window.PersistTimer.setInterval)return window.setInterval(e,t);window.PersistTimer.setInterval(e,t)}},{key:"clearInterval",value:function(e){this._AlreadyExited&&window.PersistTimer.clearInterval?window.PersistTimer.clearInterval(e):window.clearInterval(e)}}]),e}();m.PersistTimer=new p;var T=function(){function e(){v(this,e)}return h(e,[{key:"setTimeout",value:function(e,t){return window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){return window.setInterval(e,t)}},{key:"clearInterval",value:function(e){window.clearInterval(e)}}]),e}();m.ForegroundTimer=new T,m.EasingTypeIn=0,m.EasingTypeOut=1,m.EasingTypeInOut=2,m.EasingTypeBezier=3,m.EasingTypeBlink=4,m.EasingTypeDeceleration=5,m.EasingTypeSteps=6;var k=function(){function e(){v(this,e)}return h(e,[{key:"Package",value:function(){}},{key:"_GetBasePackage",value:function(e){return{T:e,St:null}}}]),e}();m.EasingBase=k;var S=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,m.EasingBase),h(e,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeIn)}}]),e}();m.EasingIn=S;var x=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,m.EasingBase),h(e,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeOut)}}]),e}();m.EasingOut=x;var _=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,m.EasingBase),h(e,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeInOut)}}]),e}();m.EasingInOut=_;var R=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,m.EasingBase),h(e,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeDeceleration)}}]),e}();m.EasingDeceleration=R;var E=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,m.EasingBase),h(e,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeBlink)}}]),e}();m.EasingBlink=E;var b=function(){function s(e,t,i,n,r){var a;return v(this,s),(a=y(this,f(s).call(this)))._Inited=!1,a._X1=e,a._X2=i,a._Y1=t,a._Y2=n,a._Duration=r,a}return c(s,m.EasingBase),h(s,[{key:"Pacakge",value:function(){var e=this._GetBasePackage(m.EasingTypeBezier);return e.St={X1:this._X1,X2:this._X2,Y1:this._Y1,Y2:this._Y2,Dur:this._Duration},e}}]),s}();m.BezierEasing=b;var C=function(){function n(e,t){var i;return v(this,n),(i=y(this,f(n).call(this)))._Steps=e,i._Type=t,i}return c(n,m.EasingBase),h(n,[{key:"Pacakge",value:function(){var e=this._GetBasePackage(m.EasingTypeSteps);return e.St={S:this._Steps,T:this._Type},e}}]),n}();m.StepsEasing=C,m.Easing={Circular:{In:new m.EasingIn,Out:new m.EasingOut,InOut:new m.EasingInOut,Deceleration:new m.EasingDeceleration}},window.Easing=m.Easing,m.ColorSpace={RGBA_8888:"RGBA_8888",RGBA_4444:"RGBA_4444",RGBA_5551:"RGBA_5551",RGB_565:"RGB_565",RGB_ETC1:"RGB_ETC1",RGBA_ETC1:"RGBA_ETC1"},m.QRCodeLevel={L:1,M:0,Q:3,H:2};var I=function(){function n(e,t,i){v(this,n),this._Manager=e,i&&m.sRenderTextureDelegateManager.CreateTextureStatus().SetResourceInfo(i);this.RenderTexture=m.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(t),this._CallbackIdToken=0,this._OnLoadCallback=[],m.ForgeDebug.EnableTextureTracer&&(e._ImageTextureTracer.push(this),this._TracerDescript="")}return h(n,[{key:"UnloadTex",value:function(){this._OnLoadCallback=[],null!==this.RenderTexture&&(0<this._CallbackIdToken&&(this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken),this._CallbackIdToken=0),this.RenderTexture.UndoRef(),this.RenderTexture=null),this._TracerDescript=""}},{key:"RegisterLoadImageCallback",value:function(e,t,i){this.IsLoaded()&&null!==t?t(i):null!==t&&(this._OnLoadCallback.push({callback:t,params:i}),0===this._CallbackIdToken&&(m.Assert(null!==this.RenderTexture),this._CallbackIdToken=this.RenderTexture.RegisterOnloadCallback(n.prototype._InvokeOnLoadCallbacks.bind(this))))}},{key:"_InvokeOnLoadCallbacks",value:function(){var e=this._OnLoadCallback;this._OnLoadCallback=[];for(var t=0;t<e.length;t++){var i=e[t];i.callback(i.params)}this.RenderTexture&&this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken)}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}},{key:"SetTextureTracerDescript",value:function(e){this._TracerDescript=e}},{key:"ReallocRenderTexture",value:function(){}},{key:"Unloaded",get:function(){return null===this.RenderTexture||this.RenderTexture.Unloaded},set:function(){}},{key:"LoadTime",get:function(){return null!==this.RenderTexture?this.RenderTexture.LoadTime:0},set:function(){}},{key:"Width",get:function(){return null!==this.RenderTexture?this.RenderTexture.Width:0},set:function(){}},{key:"Height",get:function(){return null!==this.RenderTexture?this.RenderTexture.Height:0},set:function(){}}]),n}();m.ImageTexture=I;var O=function(){function l(e,t,i,n,r,a){var s;v(this,l);var o=m.sRenderTextureDelegateManager.CreateResourceInfo(e.GetId(),"IMG");return o.Set={URL:t,Siz:n,Clr:r||"",IsF:i?1:0,NtS:a,ILd:0},(s=y(this,f(l).call(this,e,o))).Name="IMG",s.Source=t,s.IsForever=i?1:0,s.TargetSize=n,s.ColorSpace=r||"",s.NetSetting=a||null,s._InstantLoad=0,s._ImageElement=new Image,s._ImageElement.onload=function(){this._Loaded()}.bind(d(s)),s._ImageElement.onerror=function(){this._Loaded()}.bind(d(s)),s._ImageElement.src=t,s.RenderTexture.NeedCheckExpired=!0,s}return c(l,m.ImageTexture),h(l,[{key:"_Loaded",value:function(){this.RenderTexture.Unloaded=!1,this.RenderTexture.LoadTime=Date.now(),this.RenderTexture.Width=this._ImageElement.width,this.RenderTexture.Height=this._ImageElement.height,this.RenderTexture.InvokeOnloadCallbacks()}},{key:"InstantLoad",value:function(e){if(this._InstantLoad=e?1:0,this.RenderTexture){var t=this.RenderTexture.GetResourceInfo();null!==t&&(t.Set.ILd=this._InstantLoad,this.RenderTexture.SetResourceInfo(t))}return this}},{key:"ReallocRenderTexture",value:function(){if(this.IsForever)m.LogE("ReallocRenderTexture(): NOT need for forever texture");else{var e=this.Source,t=this.TargetSize,i=this.ColorSpace,n=this.IsForever,r=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Manager.GetId(),this.Name);r.Set={URL:e,Siz:t,Clr:i,IsF:n,ILd:this._InstantLoad},this.RenderTexture=m.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(r),this._Manager.CachedTextureManager.CacheTheTexture(this)}}}]),l}();m.UrlImageTexture=O;var A=function(){function t(e){v(this,t),this._TextureManager=e,this._Renderer=e.GetRenderer(),this._CachedTextureStack=[],this._LockedTextureStack=[],this._MemoryLimited=10485760,this._VisibleMark=1}return h(t,[{key:"SetMemoryLimited",value:function(e){this._MemoryLimited=1024*e*1024}},{key:"_FindTexture",value:function(e,t,i){for(var n=this._CachedTextureStack.length-1;0<=n;n--){var r=this._CachedTextureStack[n];if(r.Source===e&&(t===r.TargetSize||null!==t&&t.Equals(r.TargetSize))&&i===r.ColorSpace){if(null===r.RenderTexture)continue;return r}}return null}},{key:"CacheTheTexture",value:function(e){for(var t=this._CachedTextureStack.length-1;0<=t;t--)if(e===this._CachedTextureStack[t])return;this._CachedTextureStack.push(e)}},{key:"_MarkVisibleViewTextures",value:function(e,t){e.TextureSetting&&e.TextureSetting.Texture&&(e.TextureSetting.Texture.VisibleMark=t);for(var i=e.ChildViews.length,n=0;n<i;n++){var r=e.ChildViews[n];r&&"VISIBLE"!==r.Visibility||this._MarkVisibleViewTextures(r,t)}}},{key:"ReduceInvisibleTexture",value:function(e){this._MarkVisibleViewTextures(e,++this._VisibleMark);for(var t=0;t<this._CachedTextureStack.length;t++){var i=this._CachedTextureStack[t];i.VisibleMark!==this._VisibleMark&&(i.UnloadTex(),this._CachedTextureStack.splice(t,1),t--)}}},{key:"GetCacheSize",value:function(){return this._CachedTextureStack.length}}]),t}();m.CachedTextureManager=A;var L=new Map,M=0,V=new Map,P=0,j=function(){function e(){v(this,e),this.CachedTextureManager=new m.CachedTextureManager(this),this._ForeverCachedTextureManager=new m.CachedTextureManager(this),this._AtlasDataInfo={atlas_data:[],buffer_data_offset:0,textures:[]},this._ClearTimer=-1,this._ImageTextureTracer=[],this._Id=e.sTextureManagerToken++,this._CacheMaxSize=100,this.StartScavengerCachedTimer()}return h(e,[{key:"StartScavengerCachedTimer",value:function(){-1===this._ClearTimer&&(this._ClearTimer=m.ForegroundTimer.setInterval(this.ScavengerCached.bind(this),3e4))}},{key:"GetId",value:function(){return this._Id}},{key:"GetRenderer",value:function(){return m.sDeprecatedRenderer}},{key:"GetImage",value:function(e,t,i){return e?this._GetImageInternal(e,null,m.ColorSpace.RGBA_8888,t,!1,i):(m.LogI("GetImage, url is null!"),null)}},{key:"GetImage2",value:function(e,t,i,n,r){if(!e)return m.LogI("GetImage2, url is null!"),null;var a=m.sRectUitls.FormatRectArea(i);return"string"!=typeof n&&(n=0<=e.indexOf(".pkm")?0<=e.indexOf(".pkma")?m.ColorSpace.RGBA_ETC1:m.ColorSpace.RGB_ETC1:m.ColorSpace.RGB_565),this._GetImageInternal(e,a,n,t,!1,r)}},{key:"_GetImageInternal",value:function(e,t,i,n,r,a){if(n){var s=this._ForeverCachedTextureManager._FindTexture(e,t,i);if(s)return s}else{var o=this.CachedTextureManager._FindTexture(e,t,i);if(o)return o}var l=new m.UrlImageTexture(this,e,n,t,i,a);return l.IsForever?this._ForeverCachedTextureManager.CacheTheTexture(l):this.CachedTextureManager.CacheTheTexture(l),l}},{key:"GetRoundCornerMask",value:function(e,t){return this.GetCustomCornerMask(e,t,t,t,t)}},{key:"GetCustomCornerMask",value:function(e,t,i,n,r){var a=m.sRectUitls.FormatRectArea(e),s=Math.max(t,i,n,r);if(s>a.width/2||s>a.height/2)return m.LogE("TextureManager.GetRoundCornerMask(): radius is too large, radius="+s+" w="+a.width+" h="+a.height),null;var o=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CCM");o.Set={W:a.width,H:a.height,LT:t,RT:i,LB:n,RB:r};var l=new m.ImageTexture(this,o);return m.ForgeDebug.EnableTextureTracer&&l.SetTextureTracerDescript("CornerMask"),l}},{key:"GetOneCornerMask",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"OCM");t.Set={Rad:e};var i=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("OneCornerMask"),i}},{key:"_getParamsId",value:function(e,t){var i=e.font,n=e.size,r=e.italic,a=e.bold,s=e.alignment,o=e.vertical_align,l=e.textColour,u=e.backgroundColour,h=e.shadow,c="";e.stroke_width&&(c=e.stroke_width);var d=t.text_overflow,f=t.word_wrap,v=[i,r,a,h,c].join(":"),y=[n,s,o,d,f].join(":"),g="",m="";return L.has(v)?g=L.get(v):(g="TS"+M,L.set(v,g),M++),V.has(y)?m=V.get(y):(m="DS"+P,V.set(y,m),P++),[g,m,l,u]}},{key:"GetTextTextureByMultiRows",value:function(e,t,i,n,r,a,s){var o=e.str;if(null===o||0===o.length)return null;var l=m.sRenderBridge.GetScreenInfo().scaleRatio,u=m.Clone(i);u.x*=l,u.y*=l,u.width*=l,u.height*=l;var h=m.Clone(e);h.size=Math.ceil(h.size*l),n*=l;var c=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"T");if(c.Set={ST:e.str,AT:JSON.stringify({TO:t.text_overflow,WW:t.word_wrap}),RA:JSON.stringify({X:parseInt(u.x+.5),Y:parseInt(u.y+.5),W:parseInt(u.width+.5),H:parseInt(u.height+.5)}),LH:parseInt(n+.5),ILD:void 0!==s?s:1},a&&(c.Set.SH=JSON.stringify({T:a.Type,P:a.Params})),void 0!==window.JsView&&void 0!==window.JsView.ForgeNativeRevision&&0<window.JsView.ForgeNativeRevision){var d=this._getParamsId(h,t,a);c.Set.PI={FS:d[0],DS:d[1],TC:d[2],BC:d[3]}}m.sRenderTextureDelegateManager.AppendFontStatusIfNeed(c.Set,h);var f=null;c.Set.FO&&(f={STA:{Nam:"T",Sta:c.Set.FO}});var v=new m.ImageTexture(this,c,f),y=u.height;void 0!==window.PlatformUtils&&!1===r&&(y=window.PlatformUtils.GetTextRect(o,u,h,t,n).height);if(y=Math.floor(y/l+.5),m.ForgeDebug.EnableTextureTracer){var g=e.str;8<g.length&&(g=e.str.substr(0,8)+"..."),v.SetTextureTracerDescript("["+g+"]")}return{texture:v,real_height:y}}},{key:"GetColorTexture",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CT");t.Set={Clr:e};var i=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Color["+e+"]"),i}},{key:"ScavengerCached",value:function(){this.CachedTextureManager.GetCacheSize()>=this._CacheMaxSize&&this.CachedTextureManager.ReduceInvisibleTexture(m.sRootView)}},{key:"GetOffScreenMediaTexture",value:function(e){if(void 0===window.OffscreenVideoPlayer||!(e instanceof window.OffscreenVideoPlayer))return null;if(!e.hasTerminator()){var t=this._BuildVideoTexture(e);e.setResourceTerminator(function(){t.UnloadTex()})}return this._BuildVideoTexture(e)}},{key:"_BuildVideoTexture",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"VPLY");t.Set={Hdl:e.mediaHandler()};var i=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Video["+e.mediaHandler()+"]"),i}}]),e}();j.sTextureManagerToken=100,m.TextureManager=j,window.TextureManager=m.TextureManager;var F=function(){function e(){v(this,e)}return h(e,[{key:"SetTextureTracer",value:function(){}},{key:"GetTextureTracer",value:function(){return null}}]),e}();m.LayoutViewDebugClass=F,window.ForgeDebug=m.ForgeDebug=new m.LayoutViewDebugClass;var N=function(){function t(){v(this,t),this.Width=0,this.Height=0,this.MarginTop=0,this.MarginLeft=0,this.MarginRight=0,this.MarginBottom=0,this.Z=0,this.SizeAdjust=!1}return h(t,[{key:"SetPosition",value:function(e,t,i){this.MarginTop=t,this.MarginLeft=e,i&&(this.Z=i)}},{key:"SetSize",value:function(e,t){this.Width=e,this.Height=t}},{key:"Clone",value:function(){var e=new t(null);return e.Width=this.Width,e.Height=this.Height,e.MarginTop=this.MarginTop,e.MarginLeft=this.MarginLeft,e.MarginRight=this.MarginRight,e.MarginBottom=this.MarginBottom,e.Z=this.Z,e.SizeAdjust=this.SizeAdjust,e}},{key:"Equals",value:function(e){return e.Width===this.Width&&e.Height===this.Height&&e.MarginTop===this.MarginTop&&e.MarginLeft===this.MarginLeft&&e.MarginRight===this.MarginRight&&e.MarginBottom===this.MarginBottom&&e.Z===this.Z}}]),t}();m.LayoutParamsBase=N;var D=function(){function i(e){var t;return v(this,i),t=y(this,f(i).call(this)),e instanceof m.RectArea&&(e={x:e.x,y:e.y,width:e.width,height:e.height}),e&&(e.x?t.MarginLeft=e.x:e.marginLeft&&(t.MarginLeft=e.marginLeft),e.y?t.MarginTop=e.y:e.marginTop&&(t.MarginTop=e.marginTop),e.z&&(t.Z=e.z),e.width&&(t.Width=e.width),e.height&&(t.Height=e.height),isNaN(t.MarginTop)&&(m.LogE("isNaN(this.MarginTop)!"),t.MarginTop=0),isNaN(t.MarginLeft)&&(m.LogE("isNaN(this.MarginLeft)!"),t.MarginLeft=0),"MatchParent"!==t.Width?isNaN(t.Width)&&m.LogE("isNaN(this.Width)!"):t.SizeAdjust=!0,"MatchParent"!==t.Height?isNaN(t.Height)&&m.LogE("isNaN(this.Height)!"):t.SizeAdjust=!0),t}return c(i,m.LayoutParamsBase),i}();m.LayoutParams=D,window.LayoutParams=m.LayoutParams;var B=function(){function e(){v(this,e),this._IdTokenGenerator=66,(m.sRenderTextureDelegateManager=this)._CheckExpiredTime=0}return h(e,[{key:"CreateTextureStatus",value:function(){var e=new m.RenderTextureDelegate(this,0);return e.DoRef(),e}},{key:"CreateTexture",value:function(){var e=new m.RenderTextureDelegate(this,this._IdTokenGenerator++);return e.DoRef(),e}},{key:"RecycleTexture",value:function(){}},{key:"CreateResourceInfo",value:function(e,t){return{Id:0,Nam:t,Set:null,TmId:e,NdLd:0}}},{key:"AppendFontStatusIfNeed",value:function(e,t){var i={};i.Fo=t.font,i.Si=t.size,i.It=t.italic,i.Bo=t.bold,i.Al=t.alignment,i.Ve=t.vertical_align,i.Tx=t.textColour,i.Ba=t.backgroundColour,i.En=t.enableBlend,i.Sh=t.shadow,t.stroke_width?i.Stk=t.stroke_width:i.Stk=-1,e.FO=JSON.stringify(i)}}]),e}();m.RenderTextureDelegateManager=B,m.sRenderTextureDelegateManager=new m.RenderTextureDelegateManager;var G=function(){function n(e,t){if(v(this,n),this.IdToken=t,this._Manager=e,this._Reference=0,this._SyncingResourceInfo=null,this._OnloadCallbacks={},this._OnloadCallbacksSize=0,this._OnloadCallbackIdGenerator=1,this.Unloaded=!0,this.LoadTime=0,this.RequireTime=0,this.ForceExpire=!1,this.NeedCheckExpired=!1,m.ForgeDebug.GetTextureTracer()){var i=new Error;this.Stack=i.stack}}return h(n,[{key:"DoRef",value:function(){this._Reference++}},{key:"UndoRef",value:function(){this._Reference--,0===this._Reference&&(0<this._OnloadCallbacksSize&&(this._OnloadCallbacks={}),this._Manager.RecycleTexture(this))}},{key:"SetResourceInfo",value:function(e){e.Id=this.IdToken,this._SyncingResourceInfo=e}},{key:"GetResourceInfo",value:function(){return this._SyncingResourceInfo}},{key:"ReadSyncInfo",value:function(){var e=this._SyncingResourceInfo;return this._SyncingResourceInfo=null,e}},{key:"RegisterOnloadCallback",value:function(e){var t=this._OnloadCallbackIdGenerator++;return this._OnloadCallbacks[""+t]=e,this._OnloadCallbacksSize++,null!==this._SyncingResourceInfo&&(this._SyncingResourceInfo.NdLd=1),t}},{key:"UnregisterOnloadCallback",value:function(e){delete this._OnloadCallbacks[""+e],this._OnloadCallbacksSize--}},{key:"InvokeOnloadCallbacks",value:function(){if(0<this._OnloadCallbacksSize)for(var e in this._OnloadCallbacks)this._OnloadCallbacks[e]()}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}}]),n}();m.RenderTextureDelegate=G;var U=function(){function e(){v(this,e),(m.sDeprecatedRenderer=this)._SharedTextureManager=this.CreateTextureManager()}return h(e,[{key:"SetUserId",value:function(e){m.sRenderBridge.UpdateUserId(e)}},{key:"GetScreenInfo",value:function(){return m.sRenderBridge.GetScreenInfo()}},{key:"StringWithFont",value:function(){return m.sTextUtils.StringWithFont.apply(this,arguments)}},{key:"GetTextWidth",value:function(){return m.sTextUtils.GetTextWidth.apply(this,arguments)}},{key:"GetTextUtils",value:function(){return m.sTextUtils}},{key:"RectArea",value:function(e,t,i,n){return new m.RectArea(e,t,i,n)}},{key:"TextAttr",value:function(){return m.sTextUtils.TextAttr.apply(this,arguments)}},{key:"GarbageCollect",value:function(){m.LogM("GarbageCollect called")}},{key:"TriggerFrameDraw",value:function(){m.sRenderBridge.RequestSwap()}},{key:"GetSharedTextureManager",value:function(){return this._SharedTextureManager}},{key:"CreateTextureManager",value:function(){return new m.TextureManager}}]),e}();m.DeprecatedRenderer=U,m.sDeprecatedRenderer=null,window.gRootView=null,m.sRootView=null;var W=function(){function r(e,t,i,n){v(this,r),this.Texture=e,this._IsTextureExternal=!1,t instanceof m.ImageTexture?(t&&t.RenderTexture&&t.RenderTexture.NeedCheckExpired&&(t.RenderTexture.RequireTime=0),this.MaskSetting=new m.ViewTextureMask(t)):this.MaskSetting=t,e&&e.RenderTexture&&e.RenderTexture.NeedCheckExpired&&(e.RenderTexture.RequireTime=0),this._IsMaskTextureExternal=!1,this.TextureBeforeImageLoad=i,this._IsPreloadImageTextureExternal=!1,void 0===n&&(n=!0),this.HasAlpha=n}return h(r,[{key:"SetExternal",value:function(e,t,i){this._IsTextureExternal=e,this._IsMaskTextureExternal=t,this._IsPreloadImageTextureExternal=i}},{key:"ReleaseInternalTexture",value:function(){!this._IsTextureExternal&&this.Texture&&(this.Texture.UnloadTex(),this.Texture=null),!this._IsMaskTextureExternal&&this.MaskSetting&&(this.MaskSetting.UnLoad(),this.MaskSetting=null),!this._IsPreloadImageTextureExternal&&this.TextureBeforeImageLoad&&(this.TextureBeforeImageLoad.UnloadTex(),this.TextureBeforeImageLoad=null)}},{key:"DebugPrint",value:function(){return" _IsTextureExternal="+this._IsTextureExternal}}]),r}();m.TextureSetting=W,window.TextureSetting=m.TextureSetting;var H=function(){function a(e,t,i,n){var r;return v(this,a),(r=y(this,f(a).call(this,e,t,i,n))).SetExternal(!0,!0,!0),r}return c(a,m.TextureSetting),a}();m.ExternalTextureSetting=H,window.ExternalTextureSetting=m.ExternalTextureSetting;var z=function(){function i(e){v(this,i);var t=e.RectInfo;this.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},this.LayoutParams=JSON.parse(JSON.stringify(e.LayoutParams))}return h(i,[{key:"ApplyToView",value:function(e){var t=this.RectInfo;e.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},e.LayoutParams=JSON.parse(JSON.stringify(this.LayoutParams))}}]),i}();m.PackedLayout=z;var Y=function(){function e(){v(this,e),this._MaskType="COMMON"}return h(e,[{key:"Type",value:function(){return this._MaskType}},{key:"UnLoad",value:function(){}}]),e}();m.ViewMask=Y;var J=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this)))._MaskType="TEXTURE",t.ImageTexture=e,t}return c(i,m.ViewMask),h(i,[{key:"UnLoad",value:function(){this.ImageTexture.UnloadTex()}}]),i}();m.ViewTextureMask=J;var q=function(){function a(e,t,i,n){var r;return v(this,a),(r=y(this,f(a).call(this)))._MaskType="CORNER",r._TopLeft=e,r._TopRight=isNaN(t)?e:t,r._BottomLeft=isNaN(i)?e:i,r._BottomRight=isNaN(n)?e:n,r._CornersWidth=[0,0,0,0],r._CornersDisable=[0===r._TopLeft?1:0,0===r._TopRight?1:0,0===r._BottomLeft?1:0,0===r._BottomRight?1:0],r}return c(a,m.ViewMask),h(a,[{key:"UnLoad",value:function(){}}]),a}();m.ViewRoundCornerMask=q;var X=function(){function i(e,t){v(this,i),(this.TextureSetting=e)&&console.error("LayoutViewBase constructor texture_setting not undefined!"),this.Visibility="VISIBLE",this.LayoutParams=null,this.ParentView=null,this.ChildViews=[],this.zIndex=0,this.childZIndexCount=0,this._IsChildOfRootView=!1,"root"===t?this.Element=window.originDocument.getElementById(t):"svg"===t||"path"===t?this.Element=document.createElementNS("http://www.w3.org/2000/svg",t):(this.Element=window.originDocument.createElement(t),this.Element.style.position="absolute"),this._TransitionStore={},this.TransformAnimationObj=null,this._TextureAnimationObj=null}return h(i,[{key:"Init",value:function(e){this.ResetTexture(e)}},{key:"AddView",value:function(e,t){null!==t?t instanceof m.LayoutParamsBase?e.LayoutParams=t.Clone():e.LayoutParams=new m.LayoutParams(t):null===e.LayoutParams&&(e.LayoutParams=new m.LayoutParams({x:0,y:0})),null!==e.LayoutParams&&(e.LayoutParams.MarginLeft&&(e.Element.style.left=e.LayoutParams.MarginLeft+"px"),e.LayoutParams.MarginTop&&(e.Element.style.top=e.LayoutParams.MarginTop+"px"),e.LayoutParams.Width&&(e.Element.style.width=e.LayoutParams.Width+"px"),e.LayoutParams.Height&&(e.Element.style.height=e.LayoutParams.Height+"px")),(e.ParentView=this).ChildViews.push(e),this._IsChildOfRootView&&e._OnAttachToSystem()}},{key:"RemoveView",value:function(e){for(var t=0;t<this.ChildViews.length;t++)if(this.ChildViews[t]===e){e.IsChildOfRootView()&&e._OnDetachFromSystem(),this.ChildViews.splice(t,1),e.ParentView=null;break}}},{key:"_OnDetachFromSystem",value:function(){this._IsChildOfRootView=!1;for(var e=0;e<this.ChildViews.length;e++){this.ChildViews[e]._OnDetachFromSystem()}this.ParentView.Element.removeChild(this.Element)}},{key:"ClearViews",value:function(){var e=this.ChildViews.length;if(0!==e){for(var t=0;t<e;t++){var i=this.ChildViews[t];i&&i.IsChildOfRootView()&&i._OnDetachFromSystem()}this.ChildViews=[]}}},{key:"_ResetTextStyle",value:function(e){if(this.Element.textContent=e.Set.ST,this.Element.style.overflow="hidden",e.Set.AT){var t=JSON.parse(e.Set.AT);this.Element.style.textOverflow=t.TO,"none"==t.WW&&(this.Element.style.whiteSpace="nowrap")}if(e.Set.RA){var i=JSON.parse(e.Set.RA);this.Element.style.width=i.W+"px",this.Element.style.height=i.H+"px"}if(e.Set.LH&&(this.Element.style.lineHeight=e.Set.LH+"px"),e.Set.FO){var n=JSON.parse(e.Set.FO);n.Tx&&(this.Element.style.color=n.Tx),n.Fo&&(this.Element.style.fontFamily=n.Fo),n.Si&&(this.Element.style.fontSize=n.Si+"px"),n.Ba&&(this.Element.style.backgroundColor=n.Ba),n.It&&(this.Element.style.italic="italic"),n.Bo?this.Element.style.fontWeight="bold":this.Element.style.fontWeight="normal",n.Al&&(this.Element.style.textAlign=n.Al),n.Ve&&(this.Element.style.verticalAlign=n.Ve)}}},{key:"_SetBorderRadius",value:function(e){this.Element.style.borderRadius=e._TopLeft+"px "+e._TopRight+"px "+e._BottomLeft+"px "+e._BottomRight+"px"}},{key:"ResetTexture",value:function(e){if(this.TextureSetting=e)if(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)this.Element.style.backgroundImage="url("+e.Texture.Source+")",this.Element.style.backgroundSize="100% 100%";else if(e.Texture.RenderTexture&&e.Texture.RenderTexture._SyncingResourceInfo){var t=e.Texture.RenderTexture._SyncingResourceInfo;if("T"===t.Nam)this._ResetTextStyle(t);else if("CT"===t.Nam)this.Element.style.backgroundColor=t.Set.Clr;else if("VPLY"===t.Nam){var i=t.Set.Hdl;this.LayoutParams&&(i.style.width=this.LayoutParams.Width+"px",i.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(i)}}}},{key:"SetVisibility",value:function(e){this.Element.style.visibility="string"==typeof e?e.toLocaleLowerCase():"inherit"}},{key:"_OnAttachToSystem",value:function(){"svg"!==this.Element.id&&"path"!==this.Element.id||console.log("_OnAttachToSystem appendChild"),this.ParentView.Element.appendChild(this.Element),this._IsChildOfRootView=!0;for(var e=this.ChildViews,t=0;t<e.length;t++)e[t]._OnAttachToSystem()}},{key:"IsChildOfRootView",value:function(){return this._IsChildOfRootView}},{key:"_ConvertTimingFunc",value:function(e){var t="linear";if(e.T)switch(e.T){case m.EasingTypeIn:t="ease-in";break;case m.EasingTypeOut:t="ease-out";break;case m.EasingTypeInOut:t="ease-in-out";break;case m.EasingTypeBezier:t="cubic-bezier("+e.St.X1+","+e.St.Y1+","+e.St.X2+","+e.St.Y2+")";break;case m.EasingTypeSteps:t="steps("+e.St.S+","+(0==e.St.T?"start":"end")+")";break;case m.EasingTypeBlink:case m.EasingTypeDeceleration:}return t}},{key:"ClearAnimation",value:function(){-1!=this._AnimationOpacity&&(this._AnimationOpacity=-1)}},{key:"StartAnimation",value:function(e,t,i){if(void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(e),this.TransformAnimationObj=null),this.TransformAnimationObj=e,!isNaN(i)&&0<i&&e.EnableDelay(i),e.Start(this),e&&e._SettingInfo&&e._SettingInfo.Set){var n=e._SettingInfo.Set.Kf,r=e._SettingInfo.Set.Ts;if(n&&(0<=n.indexOf("@keyframes")||0<=n.indexOf("@-webkit-keyframes"))){var a=n.split(" ")[1];0<=a.indexOf("{")&&(a=a.substr(0,a.indexOf("{")));var s=e._SettingInfo.Rpt,o="linear";e._SettingInfo.E&&(o=this._ConvertTimingFunc(e._SettingInfo.E));var l=a+" "+e._SettingInfo.Dur/1e3+"s "+o+" "+e._SettingInfo.Dly/1e3+"s "+(-1===s?"infinite":s);console.log("StartAnimation style_anim:",l),this.Element.style.animation=l,this.Element.addEventListener("animationend",function(){e.OnEnd()}),this.Element.style.webkitAnimation=l,this.Element.addEventListener("webkitAnimationEnd",function(){e.OnEnd()})}else if(r&&0<=r.length){for(var u="",h=0;h<r.length;h++){var c="linear",d=r[h];d.tf&&(c=this._ConvertTimingFunc(d.tf)),u=d.name+" "+d.dur/1e3+"s "+c+" "+d.dly/1e3+"s",this._TransitionStore[d.name]=u}if(u){var f="";for(var v in this._TransitionStore)f&&(f+=","),f+=this._TransitionStore[v];this.Element.style.transition=f,this.Element.addEventListener("transitionend",function(){e.OnEnd()}),this.Element.style.webkitTransition=f,this.Element.addEventListener("webkitTransitionEnd",function(){e.OnEnd()})}}}}},{key:"StopAnimation",value:function(){void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(),this.TransformAnimationObj=null)}},{key:"StartTextureAnimation",value:function(e){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(e),this._TextureAnimationObj=null),(this._TextureAnimationObj=e).AsTextureAnimation(),e.Start(this),this._RequestLayout()}},{key:"StopTextureAnimation",value:function(){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(),this._TextureAnimationObj=null)}},{key:"StopAllAnimations",value:function(){this.StopAnimation(),this.StopTextureAnimation();for(var e=0;e<this.ChildViews.length;e++)this.ChildViews[e].StopAllAnimations()}},{key:"GetAnimation",value:function(){return this.TransformAnimationObj}},{key:"DetachAnimation",value:function(e){this.TransformAnimationObj==e&&(this.TransformAnimationObj=null,this.Element.style.animation=null,this.Element.style.webkitAnimation=null)}},{key:"ResetCssTransform",value:function(e){e!==this._CssTransform&&(console.log("ResetCssTransform transform_string:",e),this.Element.style.transform=e,this._CssTransform=e)}},{key:"SetId",value:function(e){this.Id=e}},{key:"ResetLayoutParams",value:function(e){if(null!==e){e instanceof m.LayoutParamsBase?this.LayoutParams=e.Clone():this.LayoutParams=new m.LayoutParams(e),this.Element.style.left=this.LayoutParams.MarginLeft+"px",this.Element.style.top=this.LayoutParams.MarginTop+"px",this.LayoutParams.Width&&(this.Element.style.width=this.LayoutParams.Width+"px"),this.LayoutParams.Height&&(this.Element.style.height=this.LayoutParams.Height+"px");var t=this.TextureSetting;if(t&&t.Texture.RenderTexture&&t.Texture.RenderTexture._SyncingResourceInfo){var i=t.Texture.RenderTexture._SyncingResourceInfo;if("VPLY"===i.Nam){var n=i.Set.Hdl;this.LayoutParams&&(n.style.width=this.LayoutParams.Width+"px",n.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(n)}}}else m.ThrowError("ResetLayoutParams(): new params is null")}},{key:"GetRenderer",value:function(){return m.LayoutViewBase.sRenderer}},{key:"GetLayoutParams",value:function(){return this.LayoutParams?this.LayoutParams.Clone():new m.LayoutParams}}]),i}();X.DivId=0,m.LayoutViewBase=X;var K=function(){function i(e,t){return v(this,i),!e||e instanceof m.TextureSetting||m.ThrowError("ERROR:LayoutView need TextureSetting as parameter"),t=t||"div",y(this,f(i).call(this,e,t))}return c(i,m.LayoutViewBase),i}();m.LayoutView=K,window.LayoutView=m.LayoutView;var Z=function(){function t(){var e;return v(this,t),(e=y(this,f(t).call(this,void 0,"root")))._ViewType=1,e._IsChildOfRootView=!0,window.gRootView=d(e),m.sRootView=d(e),e}return c(t,m.LayoutView),h(t,[{key:"Init",value:function(e){this.InitLayoutViewStaticValues(e),this.ResetLayoutParams({x:0,y:0,width:1280,height:720})}},{key:"InitLayoutViewStaticValues",value:function(e){m.LayoutViewBase.sRenderer=e,m.LayoutViewBase.sInternalTextureManager=e.GetSharedTextureManager(),m.LayoutViewBase.sIdentityMat4=new m.Mat4,m.LayoutViewBase.sNullDirectParentMat4=new m.Mat4,m.LayoutViewBase.sBakeFlipYMat4=(new m.Mat4).rotatex(180)}}]),t}();m.RootView=Z,window.RootView=m.RootView;var Q=function(){function a(e,t,i,n,r){v(this,a),this.coordX=e,this.coordY=t,this.width=i,this.height=n,this.useScissors=r,this.maskStencil=null}return h(a,[{key:"updateInfo",value:function(e,t,i,n,r){this.coordX=e,this.coordY=t,this.width=i,this.height=n,this.useScissors=r}},{key:"setMaskStencil",value:function(e){this.maskStencil=e}}]),a}(),$=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this,e,"div")))._ClipRectInfo=null,t.Id="ClipView",t.TextureSetting=null,t}return c(i,m.LayoutView),h(i,[{key:"SetId",value:function(e){this.Id=e+"_ClipView"}},{key:"SetClipRect",value:function(e,t,i,n,r){null===this._ClipRectInfo?this._ClipRectInfo=new Q(e,t,i,n,r):this._ClipRectInfo.updateInfo(e,t,i,n,r),this.Element.style.left=this.LayoutParams.MarginLeft+e+"px",this.Element.style.top=this.LayoutParams.MarginTop+t+"px",this.Element.style.overflow="hidden",this.Element.style.width=i+"px",this.Element.style.height=n+"px"}}]),i}();m.ClipView=$,window.ClipView=m.ClipView;var ee=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this,e,"div")))._HorizontalRepeats=[0,0,0,0],t._VerticalRepeats=[0,0,0,0],t._HorizontalPadding=[0,0],t._VerticalPadding=[0,0],t}return c(i,m.LayoutView),h(i,[{key:"ResetTexture",value:function(e){if((this.TextureSetting=e)&&(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)){var t=e.Texture.RenderTexture.Width,i=e.Texture.RenderTexture.Width,n=this._HorizontalRepeats[0],r=t-this._HorizontalRepeats[1]-n,a=this._VerticalRepeats[0],s=i-this._VerticalRepeats[1]-a,o=a+" "+r+" "+s+" "+n;this.Element.style.borderImage="url("+e.Texture.Source+") "+o+" fill";var l=this._HorizontalPadding[0],u=t-this._HorizontalPadding[1]-l,h=this._VerticalPadding[0],c=i-this._VerticalPadding[1]-h;this.Element.style.borderImageWidth=a+"px "+r+"px "+s+"px "+n+"px",this.Element.style.borderImageOutset=h+"px "+u+"px "+c+"px "+l+"px"}}},{key:"SetRepeat",value:function(e,t){m.Assert(e.length<=2),m.Assert(t.length<=2);for(var i=0;i<2;i++)i<e.length?(this._HorizontalRepeats[2*i]=e[i].start,this._HorizontalRepeats[2*i+1]=e[i].width):(this._HorizontalRepeats[2*i]=0,this._HorizontalRepeats[2*i+1]=0),i<t.length?(this._VerticalRepeats[2*i]=t[i].start,this._VerticalRepeats[2*i+1]=t[i].width):(this._VerticalRepeats[2*i]=0,this._VerticalRepeats[2*i+1]=0);return this}},{key:"SetPadding",value:function(e,t){return m.Assert(null!==e),m.Assert(null!==t),this._VerticalPadding[0]=t.start,this._VerticalPadding[1]=t.width,this._HorizontalPadding[0]=e.start,this._HorizontalPadding[1]=e.width,this}}]),i}();m.NinePatchView=ee;var te=function(){function i(e){v(this,i);var t=e.substr(3);return y(this,f(i).call(this,void 0,t))}return c(i,m.LayoutView),h(i,[{key:"setAttribute",value:function(e,t){this.Element.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){this.Element.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.Element.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.Element.hasAttribute(e)}},{key:"textContent",get:function(){return this.Element.textContent},set:function(e){this.Element.textContent=e}}]),i}();m.JsvElementView=te,m.AnimationEnable={ReleaseAfterEndCallback:0};var ie=function(){function e(){v(this,e),this.IdToken=0,this._AttachedGroup=null,this.AnimationListenerObj=null,this._AnimationClose=!1,this._LayoutViewRef=null,this._IsTextureAnim=!1}return h(e,[{key:"SetAnimationListener",value:function(e){this.AnimationListenerObj=e}},{key:"AddAnimationListener",value:function(e){this.AnimationListenerObj&&e.AddInherit(this.AnimationListenerObj),this.SetAnimationListener(e)}},{key:"GetAnimationListener",value:function(){return this.AnimationListenerObj}},{key:"Cancel",value:function(e){this._LayoutViewRef&&this._LayoutViewRef.DetachAnimation(this);var t=this.AnimationListenerObj;if(t&&t.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,t.OnAnimationEnd(!1)),this._AttachedGroup){var i=!0;e&&(i=e._AttachedGroup!==this._AttachedGroup),i&&(this._AttachedGroup.CancelFromInternalAnimation(this),this._AttachedGroup=null)}}},{key:"RemoveFromGroup",value:function(){this._AttachedGroup=null}},{key:"AsTextureAnimation",value:function(){this._IsTextureAnim=!0}},{key:"Start",value:function(e){(this._LayoutViewRef=e)&&!this._IsTextureAnim&&e.ClearAnimation()}},{key:"SetCannotDisable",value:function(){}},{key:"OnStart",value:function(){var e=this.AnimationListenerObj;e&&e.OnAnimationStart&&e.OnAnimationStart()}},{key:"OnEnd",value:function(){this._LayoutViewRef&&(this._LayoutViewRef.DetachAnimation(this),this._LayoutViewRef=null);var e=this.AnimationListenerObj;e&&e.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,e.OnAnimationEnd(!0))}},{key:"OnViewHide",value:function(){var e=this.AnimationListenerObj;e&&e.OnViewNoVisible&&e.OnViewNoVisible()}}]),e}();m.AnimationBase=ie;var ne=function(){function n(e,t,i){v(this,n),this.OnAnimationStart=e,this._OnAnimationStart=e,this.OnAnimationEnd=t,this._OnAnimationEnd=t,this.OnViewNoVisible=i,this._OnViewNoVisible=i,this._AttachedGroup=null,this._InheritListener=[]}return h(n,[{key:"AddInherit",value:function(e){if(e){if(0===this._InheritListener.length){var i=this;this.OnAnimationStart=function(){i._OnAnimationStart&&i._OnAnimationStart();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnAnimationStart&&this._InheritListener[e].OnAnimationStart()},this.OnAnimationEnd=function(e){i._OnAnimationEnd&&i._OnAnimationEnd(e);for(var t=0;t<this._InheritListener.length;t++)this._InheritListener[t].OnAnimationEnd&&this._InheritListener[t].OnAnimationEnd(e)},this.OnViewNoVisible=function(){i._OnViewNoVisible&&i._OnViewNoVisible();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnViewNoVisible&&this._InheritListener[e].OnViewNoVisible()}}this._InheritListener.push(e)}}}]),n}();m.AnimationListener=ne,m.AnimationManager=function(){function e(){v(this,e),this._EndAckAnimationList=[],this._StartingAnimationList=[],this._CancelingAnimationIdList=[],this._SyncInfo={EndAck:null,Start:null,Cancel:null},this._ActiveAnimationList={},this._IdTokenGenerator=1}return h(e,[{key:"GenerateIdToken",value:function(){return this._IdTokenGenerator++}},{key:"CreateBaseSetting",value:function(e,t,i,n){var r=null;return n&&(r=n.Pacakge()),{ID:e,Nam:t,V_C:0,Dur:Math.floor(i),E:r,En:-1,Set:null,Dly:0}}},{key:"UpdateIdToken",value:function(e,t){e.ID=t}},{key:"ScheduleSyncEndAckAnimation",value:function(e){this._EndAckAnimationList.push(e.IdToken),m.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncStartingAnimation",value:function(e){this._StartingAnimationList.push(e),m.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncCancelAnimation",value:function(e){if(this._ActiveAnimationList[""+e.IdToken])this._CancelingAnimationIdList.push(e.IdToken),delete this._ActiveAnimationList[""+e.IdToken],m.sRenderBridge.RequestSwap();else for(var t=this._StartingAnimationList.length-1;0<=t;t--)this._StartingAnimationList[t].IdToken===e.IdToken&&this._StartingAnimationList.splice(t,1)}},{key:"ProcessViewHideEvents",value:function(e){for(var t=e.length,i=0;i<t;i++){var n=this._ActiveAnimationList[""+e[i]];n&&n.OnViewHide()}}},{key:"ProcessEndEvents",value:function(e){for(var t=e.length,i=0;i<t;i++){var n=this._ActiveAnimationList[""+e[i]];n&&(n.OnEnd(),delete this._ActiveAnimationList[""+e[i]])}}}]),e}(),m.sAnimationManager=null,m.AnimationDelegate=function(){function r(e,t,i){var n;return v(this,r),(n=y(this,f(r).call(this))).IdToken=m.sAnimationManager.GenerateIdToken(),n._SettingInfo=m.sAnimationManager.CreateBaseSetting(n.IdToken,e,t,i),n._Enable=-1,n._AnimationUsed=!1,n}return c(r,m.AnimationBase),h(r,[{key:"SetAnimationListener",value:function(e){g(f(r.prototype),"SetAnimationListener",this).call(this,e),this.AnimationListenerObj&&this.AnimationListenerObj.OnViewNoVisible?this._SettingInfo.V_C=1:this._SettingInfo.V_C=0}},{key:"EnableDelay",value:function(e){return this._SettingInfo.Dly=e,this}},{key:"EnableInfinite",value:function(){return this._SettingInfo.Rpt=-1,this}},{key:"SetRepeat",value:function(e){return this._SettingInfo.Rpt=e,this}},{key:"SetForceSmooth",value:function(e,t){isNaN(t)&&(t=50),(t<10||60<t)&&m.LogE("Fps rate should be 10 ~ 60"),e?this._SettingInfo.Mfr=t:delete this._SettingInfo.Mfr}},{key:"Start",value:function(e){this._AnimationUsed&&(m.sAnimationManager.ScheduleSyncCancelAnimation(this),this.IdToken=m.sAnimationManager.GenerateIdToken(),m.sAnimationManager.UpdateIdToken(this._SettingInfo,this.IdToken)),m.sAnimationManager.ScheduleSyncStartingAnimation(this),g(f(r.prototype),"Start",this).call(this,e),this._AnimationUsed=!0}},{key:"Cancel",value:function(e){m.sAnimationManager.ScheduleSyncCancelAnimation(this),g(f(r.prototype),"Cancel",this).call(this,e)}},{key:"OnEnd",value:function(){this._Enable===m.AnimationEnable.ReleaseAfterEndCallback&&m.sAnimationManager.ScheduleSyncEndAckAnimation(this),g(f(r.prototype),"OnEnd",this).call(this)}},{key:"GetSetting",value:function(){return this._SettingInfo}},{key:"Clone",value:function(){var e=JSON.parse(JSON.stringify()),t=new m.AnimationDelegate("CLONE",0,null);return e.ID=t._SettingInfo.ID,e.V_C=0,t._SettingInfo=e,t}},{key:"Enable",value:function(e){this._SettingInfo.En=e,this._Enable=e}}]),r}(),m.TranslateAnimation=function(){function l(e,t,i,n,r,a){var s;v(this,l);var o={X0:e,X1:t,Y0:i,Y1:n};return(s=y(this,f(l).call(this,"TL",r,a)))._SettingInfo.Set=o,s}return c(l,m.AnimationDelegate),l}(),m.FuncAnimation=function(){function a(e,t,i){var n;if(v(this,a),void 0!==window.JsView&&67<=window.JsView.ForgeNativeRevision){var r={F:e};(n=y(this,f(a).call(this,"FC2",t,i)))._SettingInfo.Set=r}else(n=y(this,f(a).call(this,"FC",t,i)))._SettingInfo.Set={X:"0",Y:"0",Z:"0"};return y(n)}return c(a,m.AnimationDelegate),a}(),m.MultiFactorAnimation=function(){function s(e,t,i,n){var r;v(this,s);var a={FSA:t,PP:e};return(r=y(this,f(s).call(this,"MF",i,n)))._SettingInfo.Set=a,r}return c(s,m.AnimationDelegate),s}(),m.RotateAnimation=function(){function l(e,t,i,n,r,a){var s;v(this,l),s=y(this,f(l).call(this,"RO",r,a)),i instanceof m.Vec3||(i=new m.Vec3(i)),n instanceof m.Vec3||(n=new m.Vec3(n));var o={SA:e,OA:t,AN:i.data,AX:n.data};return s._SettingInfo.Set=o,s}return c(l,m.AnimationDelegate),l}(),m.BasicScaleAnimation=function(){function d(e,t,i,n,r,a,s,o,l,u){var h;v(this,d),h=y(this,f(d).call(this,"SC",s,o));var c={SW:e=Math.round(e),SH:t=Math.round(t),EW:i=Math.round(i),EH:n=Math.round(n),AX:r,AY:a,BW:l=l?Math.round(l):i,BH:u=u?Math.round(u):n};return h._SettingInfo.Set=c,h}return c(d,m.AnimationDelegate),d}(),m.ScaleAnimation=function(){function h(e,t,i,n,r,a){v(this,h);var s=200*e,o=200*e,l=200*t,u=200*t;return y(this,f(h).call(this,s,o,l,u,i,n,r,a,200,200))}return c(h,m.BasicScaleAnimation),h}(),m.OpacityAnimation=function(){function s(e,t,i,n){var r;v(this,s),(r=y(this,f(s).call(this,"OP",i,n)))._StartOpacity=e,r._EndOpacity=t,r._OffsetOpacity=t-e;var a={SO:e,EO:t};return r._SettingInfo.Set=a,r}return c(s,m.AnimationDelegate),s}(),m.CssKeyframeAnimation=function(){function s(e,t,i,n,r){var a;return v(this,s),(a=y(this,f(s).call(this,"CK",t,i)))._SettingInfo.Set={Kf:e,VL:{vw:n||0,vh:r||0}},a}return c(s,m.AnimationDelegate),s}(),m.CssTransitionAnimation=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this,"CT",null,null)))._SettingInfo.Set={Ts:e},t}return c(i,m.AnimationDelegate),i}(),m.AnimationEnable={ReleaseAfterEndCallback:0},window.TranslateAnimation=m.TranslateAnimation;var re=function(){function r(e,t){v(this,r),this.set(e,t)}return h(r,[{key:"add",value:function(e,t){return e instanceof r?(this.x+=e.x,this.y+=e.y):(this.x+=e||0,this.y+=t||0),this}},{key:"angle",value:function(e){if(void 0!==e)return this.set(this.length(),0).rotate(e);var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"angleDeg",value:function(e){return void 0!==e?this.angle(e/180*Math.PI):180*this.angle()/Math.PI}},{key:"clone",value:function(){return new r(this.x,this.y)}},{key:"cross",value:function(e,t){return e instanceof r?this.x*e.y-this.y*e.x:this.x*t-this.y*e}},{key:"distance",value:function(e,t){var i=this.distanceSq(e,t);if(void 0!==i)return Math.sqrt(i)}},{key:"distanceSq",value:function(e,t){var i,n;if(e instanceof r)i=e.x-this.x,n=e.y-this.y;else{if(void 0===t)return;i=e-this.x,n=t-this.y}return i*i+n*n}},{key:"dot",value:function(e,t){return e instanceof r?this.x*e.x+this.y*e.y:this.x*e+this.y*t}},{key:"equals",value:function(e,t,i){return e instanceof r?(t=t||0,Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t):void 0!==t&&(i=i||0,Math.abs(this.x-e)<=i&&Math.abs(this.y-t)<=i)}},{key:"length",value:function(){return Math.sqrt(this.lengthSq())}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"negate",value:function(){return this.scale(-1)}},{key:"normalize",value:function(){return this.scale(1/this.length())}},{key:"rotate",value:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(this.x*t-this.y*i,this.x*i+this.y*t)}},{key:"rotateDeg",value:function(e){return this.rotate(e/180*Math.PI)}},{key:"scale",value:function(e,t){return this.x*=e,this.y*=t||e,this}},{key:"set",value:function(e,t){return e instanceof r?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this}},{key:"setPolar",value:function(e,t){return this.set(t,0).rotate(e)}},{key:"setPolarDeg",value:function(e,t){return this.setPolar(e/180*Math.PI,t)}},{key:"sub",value:function(e,t){return void 0!==t?(this.x-=e,this.y-=t):(this.x-=e.x,this.y-=e.y),this}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}}]),r}();function ae(e,t,i){return i=i||0,Math.abs(e-t)<Math.abs(i)}var se=function(e,t){return ae(e,0,t)},oe=function(e,t,i){return t<e?e<i?e:i:t},le=1/3,ue=new re(0,0),he=1e-4;function ce(e){return"[object Array]"===Object.prototype.toString.call(e)}function de(e){if(!ce(e))throw"Polygon must be an array of points";switch(u(e[0])){case"number":if(e.length%2!=0)throw"Polygon that contains array of numbers must has even length ([x0, y0, x1, y1, ...., xn, yn])";for(var t=[],i=0;i<e.length;i+=2)t.push(new re(e[i],e[i+1]));return t;case"object":return e.map(ce(e[0])?function(e){return new re(e[0],e[1])}:function(e){return new re(e.x,e.y)});default:throw"Passed polygon is not an array of 2D coordinates"}}function fe(a){if(1===a.length)return new re(a[0]);var s=new re(0,0);a.forEach(function(e){return s.add(e)}),s.scale(1/a.length);var o=new re,l=0;return a.forEach(function(e,t){var i=new re(e),n=new re(t+1===a.length?a[0]:a[t+1]);i.add(-s.x,-s.y),n.add(-s.x,-s.y);var r=.5*i.cross(n);l+=r,o.add(i.add(n).scale(le).scale(r))}),se(l,he)?o.set(a[0]):o.scale(1/l).add(s)}function ve(e,t){for(var i=e[0],n=t.dot(e[0]),r=0,a=1;a<e.length;a++)n<(r=t.dot(e[a]))&&(n=r,i=e[a]);return new re(i)}function ye(e,t,i){var n=ve(e,i),r=ve(t,i.negate());return new re(n.sub(r))}function ge(e,t){var i=new re(0,0),n=new re(e).negate(),r=new re(t).sub(e),a=r.dot(r);if(se(a,he))return i.set(e);var s=n.dot(r)/a;return s=oe(s,0,1),i.set(r.scale(s).add(e))}function me(e,t){e=de(e),t=de(t);var i,n,r,a=fe(e),s=fe(t).add(a.negate());i=ye(e,t,s),n=ye(e,t,s.negate());for(var o=0;o<30;o++){var l=ge(i,n);if(se(l.length(),he))return 0;s.set(l.negate().normalize());var u=(r=ye(e,t,s)).dot(s),h=i.dot(s);if(se(u-h,he))return u;i.distanceSq(ue)<n.distanceSq(ue)?n=r:i=r}return 0}function we(e){return 48<=e&&e<=57}function pe(e,t){switch(e){case"translate3d":return Se.translate(t[0],t[1],t[2]);case"scale3d":return Se.scale(t[0],t[1],t[2]);case"rotate3d":return Se.rotate(t[0],t[1],t[2],t[3]);case"skew":return Se.skew(t[0],t[1]);case"matrix":return Se.transform2d(t[0],t[1],t[2],t[3],t[4],t[5]);case"matrix3d":return new Se(4,4,t);default:throw"no support type "+e}}function Te(e){var t=e.jsvMainView,i=getComputedStyle(t.Element),n=i.transform?i.transform:i.webkitTransform,r=function(e){var t=[];if(!e)return t;for(var i="",n=0;n<e.length;n++){var r=e.charCodeAt(n);!we(r)&&46!=r&&45!=r||(i+=e[n]),32!=r&&n!=e.length-1||(t.push(parseFloat(i)),i="")}return t}(i.transformOrigin?i.transformOrigin:i.webkitTransformOrigin),a=function(e){var t=Se.identity();if(!e)return t;for(var i,n="",r="",a=[],s=0,o=0;o<e.length;o++){var l=e.charCodeAt(o);0==s?(65<=(i=l)&&i<=90||97<=i&&i<=122||we(l))&&(n+=e[o]):!we(l)&&46!=l&&45!=l&&101!=l||(r+=e[o]),40==l?(s=1,r="",a=[]):41==l?(a.push(parseFloat(r)),t=Se.multiply(t,pe(n,a)),n="",s=0):44==l&&(a.push(parseFloat(r)),r="")}return t}(n),s=parseFloat(i.left.substr(0,i.left.length-2)),o=parseFloat(i.top.substr(0,i.top.length-2)),l=parseFloat(i.width.substr(0,i.width.length-2)),u=parseFloat(i.height.substr(0,i.height.length-2)),h=[s,o,0,1,s+l,o,0,1,s,o+u,0,1,s+l,o+u,0,1],c=Se.translate(-s-r[0],-o-r[1],0),d=Se.translate(s+r[0],o+r[1],0),f=Se.multiply(d,Se.multiply(a,c)),v=Se.multiply(f,new Se(4,4,h));return[v.element[0],v.element[1],v.element[4],v.element[5],v.element[8],v.element[9],v.element[12],v.element[13]]}var ke=function(e,t){return se(me(e,t),he)},Se=function(){function g(e,t,i){v(this,g),this.element=i,this.row=e,this.column=t}return h(g,null,[{key:"multiply",value:function(e,t){if(e.column!==t.row)throw"matrix multiply error";for(var i=[],n=0;n<e.row;n++)for(var r=0;r<t.column;r++)for(var a=i[n+r*t.column]=0;a<e.column;a++)i[n+r*t.column]+=e.element[n+a*e.column]*t.element[a+r*t.column];return new g(e.row,t.column,i)}},{key:"identity",value:function(){return new g(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"translate",value:function(e,t,i){return new g(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1])}},{key:"scale",value:function(e,t,i){return new g(4,4,[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1])}},{key:"rotate",value:function(e,t,i,n){var r=Math.cos(n/180*Math.PI),a=Math.sin(n/180*Math.PI),s=Math.sqrt(e*e+t*t+i*i);if(1!=s){var o=1/s;e*=o,t*=o,i*=o}var l=1-r,u=e*t,h=t*i,c=i*e,d=e*a,f=t*a,v=i*a,y=[];return y[0]=e*e*l+r,y[1]=u*l+v,y[2]=c*l-f,y[3]=0,y[4]=u*l-v,y[5]=t*t*l+r,y[6]=h*l+d,y[7]=0,y[8]=c*l+f,y[9]=h*l-d,y[10]=i*i*l+r,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,new g(4,4,y)}},{key:"skew",value:function(e,t){var i=new Array(16).fill(0),n=2*Math.PI*(t/360),r=-2*Math.PI*(e/360);return i[0]=1-r*n,i[1]=-Math.tan(n),i[4]=Math.tan(r),i[5]=1,i[10]=1,i[15]=1,new g(4,4,i)}},{key:"transform2d",value:function(e,t,i,n,r,a){return new g(4,4,[e,t,0,0,i,n,0,0,0,0,1,0,r,a,0,1])}}]),g}(),xe=function(){function r(e,t,i,n){v(this,r),this._Id=e,this._Element1=t,this._Element2=i,this._Callback=n,this._Contacted=!1,this._Recycled=!1,this.recycle=this.recycle.bind(this),this.testCollision=this.testCollision.bind(this)}return h(r,[{key:"recycle",value:function(){this._Recycled=!0,this._Callback=null,this._Element1=null,this._Element2=null}},{key:"testCollision",value:function(){this._Recycled||(ke(Te(this._Element1),Te(this._Element2))?this._Contacted||(this._Contacted=!0,this._Callback&&this._Callback.OnBeginContact()):this._Contacted&&(this._Callback&&this._Callback.OnEndContact(),this._Contacted=!1))}}]),r}(),_e=0,Re=function(){function e(){v(this,e),this._SensorMap={},this._DeleteList=[],this.testCollision=this.testCollision.bind(this),this.startTrace=this.startTrace.bind(this)}return h(e,[{key:"testCollision",value:function(){for(var e in this._SensorMap)this._SensorMap[e]._Recycled?delete this._SensorMap[e]:this._SensorMap[e].testCollision()}},{key:"startTrace",value:function(e,t,i){var n=new xe(_e++,e,t,i);return this._SensorMap[_e]=n}}]),e}();m.CollisionManager=new Re,m.CollisionManager.Callback=function(){return function e(t,i){v(this,e),this.OnBeginContact=t,this.OnEndContact=i}}();var Ee=function(){function l(e,t){if(v(this,l),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",e){if(!0===e.startsWith("url")){var i=e.indexOf("(")+1,n=e.lastIndexOf(")");e=e.substring(i,n).trim()}if(!0!==e.startsWith("data:")){if(!0===e.startsWith("/")&&(e=document.location.origin+e),!0===e.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var r=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,r)}e=window.JsView.React.__MainPath+e.substring(1)}if(this.href=e,t){var a=this.href.indexOf("?"),s=0<a?this.href.substring(0,a):this.href;this.search=1<a?this.href.substring(a):"",a=s.indexOf("://"),this.protocol=0<a?s.substring(0,a+1):"";var o=1<a?s.substring(a+3):"";a=o.indexOf("/"),this.host=0<a?o.substring(0,a):"",this.pathname=1<a?o.substring(a):"",this.origin=0<a?this.protocol+"//"+this.host:"",a=this.host.indexOf(":"),this.hostname=0<a?this.host.substring(0,a):"",this.port=1<a?this.host.substring(a+1):"",console.log("create total parse URL, this=",this)}}else this.href=e}}return h(l,[{key:"replace",value:function(e){this.href=e}}]),l}(),be=function(){function o(){v(this,o)}return h(o,null,[{key:"SetBackgroundColor",value:function(e,t,i){var n,r=o.TextureManager.GetColorTexture(t);i&&(n=new m.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var a=new m.TextureSetting(r,n);e.ResetTexture(a)}},{key:"SetBackgroundImage",value:function(e,t,i,n){if("string"==typeof t&&(t=new Ee(t)),t instanceof Ee==!1)throw Error("Bad Argument.",t);var r,a=o.TextureManager.GetImage(t.href);i&&(r=new m.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var s=new m.ExternalTextureSetting(a,r);e.ResetTexture(s),n&&a.RegisterLoadImageCallback(null,function(){n({width:a.Width,height:a.Height})})}},{key:"SetVideoTexture",value:function(e,t,i){var n,r=o.TextureManager.GetColorTexture(t);i&&(n=new m.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var a=new m.TextureSetting(r,n);e.ResetTexture(a)}},{key:"GetTextWidth",value:function(e){return e.str||(e.str=""),e.font||(e.font=m.TextUtils._sDefaultFont),e.size||(e.size=m.TextUtils._sDefaultFontSize),"italic"!==e.italic&&(e.italic=""),"bold"!==e.bold&&(e.bold=""),window.PlatformUtils.GetTextWidth(e)}},{key:"RequestSwap",value:function(){m.sRenderBridge.RequestSwap()}},{key:"SetImgTexSize",value:function(e,t){var i={size:t,refNum:0};o.TextureInfo.Cache[e.Source]=i}},{key:"RefImgTexSize",value:function(n,r){var e=o.TextureInfo.Cache[n.Source];e?(0<e.refNum?e.refNum++:e.refNum=1,r(e.size)):n.RegisterLoadImageCallback(null,function(){var e={width:n.Width,height:n.Height};r(e);var t=o.TextureInfo.Cache[n.Source];if(t)0<t.refNum?t.refNum++:t.refNum=1;else{var i={size:e,refNum:1};o.TextureInfo.Cache[n.Source]=i}})}},{key:"UnrefImgTexSize",value:function(e){if(e){var t=o.TextureInfo.Cache[e.Source];t&&(t.refNum--,t.refNum<=0&&o.TextureInfo.Unused.add(e.Source))}}},{key:"ClearUnusedTexSize",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=o.TextureInfo.Unused[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var a=n.value,s=o.TextureInfo.Cache[a];s.refNum<-2?(delete o.TextureInfo.Cache[a],o.TextureInfo.Unused.delete(a)):s.refNum<=0?s.refNum--:o.TextureInfo.Unused.delete(a)}}catch(e){t=!0,i=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw i}}}}]),o}();be.TextureInfo={Cache:{},Unused:new Set},be.TextureManager=null,be.RootView=null,be.RootActivity=null,be.HaltKeyEvent=!1;var Ce=function(){function i(e){v(this,i),this.type=e,this.cachedValues=null,this.onSyncCallback=null}return h(i,[{key:"setOnSyncCallback",value:function(e){this.onSyncCallback=e,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(e,t){this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t,this.syncLastCaches(!1),be.RequestSwap()}},{key:"syncLastCaches",value:function(e){var t=i.LastModified[this.type];!e&&t===this||(i.LastModified[this.type]=this,t&&t.cachedValues&&"function"==typeof t.onSyncCallback&&(t.onSyncCallback(t.cachedValues),t.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){console.log("JsvLazySyncCache.SyncAllCachedProperty()");for(var e=0,t=Object.values(i.LastModified);e<t.length;e++){t[e].syncLastCaches(!0)}}}]),i}();Ce.LastModified={};var Ie=function(){function e(){v(this,e),this._ScreenInfo={width:160,height:90,x:.0125,y:2/90,perspective:.0125,scaleRatio:1,designedWidth:1280},this._OnAnimation=this._OnAnimation.bind(this),window.requestAnimationFrame&&window.requestAnimationFrame(this._OnAnimation)}return h(e,[{key:"_OnAnimation",value:function(){m.CollisionManager.testCollision(),window.requestAnimationFrame(this._OnAnimation)}},{key:"GetScreenInfo",value:function(){return this._ScreenInfo}},{key:"InitScreenBuffer",value:function(e,t){isNaN(e)&&(e=1),isNaN(t)&&(t=1280);var i=t*e,n=i/16*9;this._ScreenInfo.width=Math.floor(i),this._ScreenInfo.height=Math.floor(n),this._ScreenInfo.x=2/this._ScreenInfo.width,this._ScreenInfo.y=2/this._ScreenInfo.height,this._ScreenInfo.perspective=this._ScreenInfo.x,this._ScreenInfo.scaleRatio=e,this._ScreenInfo.designedWidth=t}},{key:"RequestSwap",value:function(){this._OnRequesting||(this._OnRequesting=!0,this._SwapTimer=m.PersistTimer.setTimeout(this._DoRequestSwap.bind(this),0))}},{key:"_DoRequestSwap",value:function(){Ce.SyncAllCachedProperty(),be.ClearUnusedTexSize(),this._OnRequesting=!1}},{key:"InstantPerformSwap",value:function(){this._OnRequesting&&(this._OnRequesting=!1,0<this._SwapTimer&&(m.PersistTimer.clearTimeout(this._SwapTimer),this._SwapTimer=-1),this._DoRequestSwap(!1))}}]),e}();m.RenderBridge=Ie,m.sRenderBridge=new m.RenderBridge,m.sAnimationManager=new m.AnimationManager;var Oe=function(){function t(e){v(this,t),this.ownerDocument=window.document,this.nodeType=e,this.parentNode=null,this.jsvEventListener=null}return h(t,[{key:"appendChild",value:function(e){e.parentNode=this}},{key:"removeChild",value:function(e){e.parentNode=null}},{key:"insertBefore",value:function(e){e.parentNode=this}},{key:"addEventListener",value:function(e,t){this.jsvEventListener||(this.jsvEventListener={});var i=this.jsvEventListener[e];i||(i=new Set,this.jsvEventListener[e]=i),i.add(t)}},{key:"removeEventListener",value:function(e,t){if(this.jsvEventListener){var i=this.jsvEventListener[e];i&&(i.delete(t),i.size<=0&&this.jsvEventListener.hasOwnProperty(e)&&delete this.jsvEventListener[e],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(e){if(this.jsvEventListener){var t=this.jsvEventListener[e.type];if(t){e.target||(e.target=document.activeElement);var i=!0,n=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){(0,a.value)(e)}}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No event added.")}}]),t}();Oe.ELEMENT_NODE=1,Oe.TEXT_NODE=3,Oe.DOCUMENT_NODE=9;var Ae=function(){function t(e){v(this,t),this.target=null,this.timeStamp=Date.now(),this.type=e}return h(t,[{key:"initEvent",value:function(e){this.type=e}}]),t}(),Le=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,Ae),e}();Le.Type={FOCUS:"focus",BLUR:"blur"};function Me(e){if(v(this,Me),this.top=null,this.right=null,this.bottom=null,this.left=null,e&&!1!==e.startsWith("inset")){var t=e.indexOf("(")+1,i=e.substring(t),n=je.ConvertRect(i);this.top=n.top,this.right=n.right,this.bottom=n.bottom,this.left=n.left}else console.error("Inset.Parse() InvalidArgs: value=",e)}function Ve(e){if(v(this,Ve),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,e){var t=e.indexOf(")")+1,i=e.substring(0,t),n=e.substring(t);this.source=new Ee(i),this.slice=je.ConvertRect(n)}else console.error("BorderImage.constructor() InvalidArgs: value=",e)}var Pe=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,Ae),e}(),je=function(){function T(){v(this,T)}return h(T,null,[{key:"ConvertFloat",value:function(e){return e?"string"!=typeof e?e:parseFloat(e):e}},{key:"ConvertPx",value:function(e){return e?"string"!=typeof e?e:"0"===e?0:e.endsWith("px")?parseInt(e):e:e}},{key:"ConvertRect",value:function(e){var t=T.SplitString(e," "),i={top:0<t.length?parseInt(t[0]):0,right:1<t.length?parseInt(t[1]):null,bottom:2<t.length?parseInt(t[2]):null,left:3<t.length?parseInt(t[3]):null};return i.right=i.right||0===i.right?i.right:i.top,i.bottom=i.bottom||0===i.bottom?i.bottom:i.top,i.left=i.left||0===i.left?i.left:i.right,i}},{key:"ConvertCorner",value:function(e){var t=T.SplitString(e," "),i={topLeft:0<t.length?parseInt(t[0]):0,topRight:1<t.length?parseInt(t[1]):null,bottomRight:2<t.length?parseInt(t[2]):null,bottomLeft:3<t.length?parseInt(t[3]):null};return i.topRight=i.topRight||0===i.topRight?i.topRight:i.topLeft,i.bottomRight=i.bottomRight||0===i.bottomRight?i.bottomRight:i.topLeft,i.bottomLeft=i.bottomLeft||0===i.bottomLeft?i.bottomLeft:i.bottomRight,i}},{key:"ConvertSize",value:function(e){var t=T.SplitString(e," "),i={width:0<t.length?parseInt(t[0]):0,height:1<t.length?parseInt(t[1]):null};return i.height=i.height||0===i.height?i.height:i.width,i}},{key:"ConvertAnimation",value:function(e){if(null===e||0===e.length)return null;var t=e.indexOf("cubic-bezier"),i=[];if(0<=t){var n=e.indexOf(")"),r=e.substring(t,n+1),a=T.SplitString(e,r),s=!0,o=!1,l=void 0;try{for(var u,h=a[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var c=u.value,d=T.SplitString(c," ");i=i.concat(d)}}catch(e){o=!0,l=e}finally{try{s||null==h.return||h.return()}finally{if(o)throw l}}i.push(r)}else i=T.SplitString(e," ");for(var f=null,v=0,y=1,g=e.includes("alternate"),m=2;m<i.length;m++)if("infinite"!==i[m]){var w=T.ConvertTimeMs(i[m]);!1===isNaN(w)?v=w:(w=parseFloat(i[m]),!1===isNaN(w)?y=w:f=i[m])}else y=-1;var p=1<i.length?T.ConvertTimeMs(i[1]):0;return{name:0<i.length?i[0]:"",duration:p,timingFunction:T.ConvertEasing(f,p),delay:v,iterationCount:y,direction:g}}},{key:"ConvertTransition",value:function(e){if(null==e||0==e.length)return null;for(var t={},i=new Array,n=e.split(","),r=0;r<n.length;r++)if(0<=n[r].indexOf("(")){for(var a=r;a<n.length&&n[a].indexOf(")")<0;)a++;for(var s="",o=r;o<=a;o++)o!=r&&(s+=","),s+=n[o];r=a,i=i.concat(s)}else i=i.concat(n[r]);var l=!0,u=!1,h=void 0;try{for(var c,d=i[Symbol.iterator]();!(l=(c=d.next()).done);l=!0){var f=c.value,v=T.ConvertAnimation(f);if("all"==(t[v.name]=v).name)for(var y=new Array("opacity","left","top","width","height"),g=0,m=y;g<m.length;g++){t[m[g]]=v}}}catch(e){u=!0,h=e}finally{try{l||null==d.return||d.return()}finally{if(u)throw h}}return t}},{key:"ConvertTimeMs",value:function(e){var t=NaN;return(e=(e=e||"").trim()).endsWith("ms")?t=1:e.endsWith("s")&&(t=1e3),t*=parseFloat(e)}},{key:"ConvertEasing",value:function(e,t){var i=m.Easing.Circular.InOut;if(!e)return i;if(e.includes("ease"))i=e.includes("-in-out")?m.Easing.Circular.InOut:e.includes("-out")?m.Easing.Circular.Out:e.includes("-in")?m.Easing.Circular.In:m.Easing.Circular.InOut;else if(e.includes("linear"))i=null;else if(e.includes("cubic-bezier")){var n=T.ConvertBezier(e);i=new m.BezierEasing(n.x1,n.y1,n.x2,n.y2,t)}else if(e.includes("steps")){var r=T.ConvertSteps(e);i=new m.StepsEasing(r.steps,r.type)}return i}},{key:"ConvertBezier",value:function(e){var t=e.indexOf("(");0<=t&&(e=e.substring(t+1));var i=T.SplitString(e,",");return{x1:0<i.length?parseFloat(i[0]):0,y1:1<i.length?parseFloat(i[1]):0,x2:2<i.length?parseFloat(i[2]):0,y2:3<i.length?parseFloat(i[3]):0}}},{key:"ConvertSteps",value:function(e){var t=e.indexOf("(");0<=t&&(e=e.substring(t+1));var i=T.SplitString(e,",");return{steps:0<i.length?parseInt(i[0]):1,type:1<i.length?i[1].includes("start")?0:1:0}}},{key:"ConvertOverflow",value:function(e){return(e=e||"").includes("hidden")?Fe.Overflow.HIDDEN:Fe.Overflow.VISIBLE}},{key:"ConvertObjectFit",value:function(e){return(e=e||"").includes("fill")?Fe.ObjectFit.FILL:e.includes("contain")?Fe.ObjectFit.CONTAIN:e.includes("cover")?Fe.ObjectFit.COVER:e.includes("none")?Fe.ObjectFit.NONE:e.includes("scale-down")?Fe.ObjectFit.SCALEDOWN:Fe.ObjectFit.CONTAIN}},{key:"SplitString",value:function(e,t){var i=(e=e||"").trim().split(t);if(" "!==t)return i;var n=[],r=!0,a=!1,s=void 0;try{for(var o,l=i[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value;u&&n.push(u)}}catch(e){a=!0,s=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw s}}return n}}]),T}(),Fe=function(){function n(){v(this,n),this.jsvStore={},this.jsvLazySyncCache=new Ce("style")}return h(n,[{key:"setProperty",value:function(e,t){if("function"==typeof document.jsvCheckStyleFormat&&document.jsvCheckStyleFormat(e,t),t=this.jsvConvertPropValue(e,t),this.jsvStore[e]!==t){this.jsvStore[e]=t;var i=n.JsvGetStyleType(e);this.jsvLazySyncCache.setCacheProperty(i,void 0)}}},{key:"getPropertyValue",value:function(e){return this.jsvStore[e]}},{key:"jsvSetChangedListener",value:function(t){this.jsvLazySyncCache.setOnSyncCallback(function(e){t(Object.keys(e))})}},{key:"jsvConvertPropValue",value:function(e,t){switch(e){case n.PROP.VISIBILITY:return t.toUpperCase();case n.PROP.OVERFLOW:return je.ConvertOverflow(t);case n.PROP.OBJECTFIT:return je.ConvertObjectFit(t);case n.PROP.TRANSFORM:return t;case n.PROP.CLIPPATH:return new Me(t);case n.PROP.BORDERIMAGE:return new Ve(t);case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return je.ConvertRect(t);case n.PROP.BORDERRADIUS:return je.ConvertCorner(t);case n.PROP.ANIMATION:return je.ConvertAnimation(t);case n.PROP.TRANSITION:return je.ConvertTransition(t);case n.PROP.OPACITY:return je.ConvertFloat(t);default:return je.ConvertPx(t)}}}],[{key:"JsvGetStyleType",value:function(e){switch(e){case n.PROP.LEFT:case n.PROP.RIGHT:case n.PROP.TOP:case n.PROP.BOTTOM:return n.TYPE.LAYOUT_POS;case n.PROP.WIDTH:case n.PROP.HEIGHT:case n.PROP.VISIBILITY:case n.PROP.CLIPPATH:case n.PROP.OVERFLOW:case n.PROP.OBJECTFIT:case n.PROP.TRANSFORM:return n.TYPE.LAYOUT_SIZE;case n.PROP.BACKGROUNDCOLOR:case n.PROP.BACKGROUNDIMAGE:case n.PROP.BORDERRADIUS:return n.TYPE.BACKGROUND;case n.PROP.COLOR:case n.PROP.LINEHEIGHT:case n.PROP.WHITESPACE:case n.PROP.FONTFAMILY:case n.PROP.FONTSIZE:case n.PROP.FONTSTYLE:case n.PROP.FONTWEIGHT:case n.PROP.TEXTALIGN:case n.PROP.TEXTSHADOW:case n.PROP.TEXTOVERFLOW:return n.TYPE.FOREGROUND;case n.PROP.BORDERIMAGE:case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return n.TYPE.BORDER;case n.PROP.ANIMATION:return n.TYPE.ANIMATION;case n.PROP.TRANSITION:return n.TYPE.TRANSITION;case n.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+e),null}}}]),n}();Fe.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation",TRANSITION:"transition"},Fe.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},Fe.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},Fe.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function Ne(e){var t=Fe.PROP[e];Object.defineProperty(Fe.prototype,t,{set:function(e){this.setProperty(t,e)},get:function(){return this.getPropertyValue(t)}})}for(var De in Fe.PROP)Ne(De);var Be=function(){function l(e){var t;return v(this,l),(t=y(this,f(l).call(this,Oe.ELEMENT_NODE))).parentElement=null,t.tagName=t.constructor.name.replace("Element","").toUpperCase(),t.childElementCount=0,t.childNodes=[],t.firstElementChild=null,t.lastElementChild=null,t.tagName===l.TAG.STYLE?(t.style=null,t.jsvMainView=null):(t.style=new Fe,t.jsvMainView=new m.LayoutView),t.jsvMaskView=null,t.jsvAnimation=null,t.jsvStore={transition:null,textContent:null,clientWidth:null},t.jsvLazySyncCache=new Ce("element"),t.instantSwapCallback=null,t}return c(l,Oe),h(l,[{key:"appendChild",value:function(e){if(g(f(l.prototype),"appendChild",this).call(this,e),(e.parentElement=this).firstElementChild||(this.firstElementChild=e),this.lastElementChild=e,this.childNodes.push(e),this.childElementCount++,e.nodeType===Oe.ELEMENT_NODE&&e.tagName!==l.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);e.jsvOnLoadForgeView(),e.style.jsvSetChangedListener(e.jsvOnStyleChanged.bind(e));var t=e.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(e.jsvMaskView,t)}}},{key:"removeChild",value:function(e){g(f(l.prototype),"removeChild",this).call(this,e),e.parentElement=null,e instanceof l&&(e.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(e.jsvMaskView))}},{key:"insertBefore",value:function(e,t){g(f(l.prototype),"appendChild",this).call(this,e,t),(e.parentElement=this).appendChild(e)}},{key:"setAttribute",value:function(e,t){console.log("Element.setAttribute() name="+e+", value=",t),this[e]=t,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,t)}},{key:"removeAttribute",value:function(e){this[e]=void 0,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,void 0)}},{key:"getAttribute",value:function(e){return this[e]}},{key:"hasAttribute",value:function(e){return console.log("Element.hasAttribute() name="+e),!!this[e]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var e=document.activeElement;if(document.activeElement=this,e){var t=new Le(Le.Type.BLUR);t.target=e,document.dispatchEvent(t)}var i=new Le(Le.Type.FOCUS);document.dispatchEvent(i)}},{key:"jsvOnLoadForgeView",value:function(){var t=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new m.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(e){t.jsvMainView.SetElementProp(e)})}},{key:"jsvOnUnloadForgeView",value:function(){this.jsvMainView&&this.jsvMainView.ClearViews()}},{key:"jsvOnStyleChanged",value:function(e){var t=e.includes(Fe.TYPE.LAYOUT_SIZE),i=!0,n=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){switch(a.value){case Fe.TYPE.LAYOUT_POS:if(t)break;this.jsvFlushViewLayout();break;case Fe.TYPE.LAYOUT_SIZE:this.jsvFlushViewLayout();break;case Fe.TYPE.BACKGROUND:this.jsvFlushViewBackground();break;case Fe.TYPE.ANIMATION:this.jsvFlushViewAnimation();break;case Fe.TYPE.TRANSITION:this.jsvStore.transition=null,this.jsvFlushViewTransition()}}}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var e={x:this.style.left,y:this.style.top,width:this.style.width,height:this.style.height};if(this.jsvMaskView.ResetLayoutParams(e),this.jsvMaskView.ResetCssTransform(this.style.transform),this.jsvMaskView!==this.jsvMainView){var t={x:0,y:0,width:e.width,height:e.height};this.jsvMainView.ResetLayoutParams(t)}this.jsvMaskView.SetVisibility(this.style.visibility);var i=null;this.style.clipPath?i={x:this.style.clipPath.left,y:this.style.clipPath.top,width:e.width-this.style.clipPath.left-this.style.clipPath.right,height:e.height-this.style.clipPath.top-this.style.clipPath.bottom}:this.style.objectFit?i={x:0,y:0,width:this.style.width,height:this.style.height}:this.style.overflow===Fe.Overflow.HIDDEN&&(i={x:0,y:0,width:this.style.width,height:this.style.height}),i&&this.jsvMaskView.SetClipRect(i.x,i.y,i.width,i.height,!0),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&be.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius),this.style.backgroundImage&&be.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius)}},{key:"jsvFlushViewAnimation",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.animation){var e=document.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation=new m.CssKeyframeAnimation(e,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var i=this,t=new m.AnimationListener(null,function(e){if(e){var t=new Pe("animationend");t.target=i,document.dispatchEvent(t),null==i.instantSwapCallback&&(i.instantSwapCallback=m.sRenderBridge.InstantPerformSwap.bind(m.sRenderBridge)),Promise.resolve().then(i.instantSwapCallback)}},null);this.jsvAnimation.Enable(m.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(t),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.transition){this.jsvStore.transition||(this.jsvStore.transition={});var e=[];for(var t in this.style.transition){var i=this.jsvStore.transition[t],n=this.style[t];if(this.jsvStore.transition[t]=n,void 0!==i&&i!==n){var r=this.style.transition[t],a={name:t,dur:r.duration,tf:null,dly:r.delay,from:i,to:n};r.timingFunction&&(a.tf=r.timingFunction.Pacakge()),e.push(a)}}e.length<=0||(this.jsvAnimation=new m.CssTransitionAnimation(e),this.jsvMaskView.StartAnimation(this.jsvAnimation))}}},{key:"clientWidth",get:function(){return this.style.width}}],[{key:"JsvFitViewLayout",value:function(e,t,i){var n={x:0,y:0,width:e.width,height:e.height},r={width:0,height:0},a=e.width/e.height,s=t.width/t.height;if(!s)return n;if(!a){if(0===e.width||0===e.height)return n;0===a?e.width=e.height*s:isNaN(a)&&(e.height=e.width/s),a=e.width/e.height}if(!a)return n.width=t.width,n.height=t.height,n;switch(i=i||Fe.ObjectFit.CONTAIN){case Fe.ObjectFit.FILL:r.width=e.width,r.height=e.height;break;case Fe.ObjectFit.NONE:r.width=t.width,r.height=t.height;break;case Fe.ObjectFit.COVER:r=l.JsvStretchSize(e,s,s<a);break;case Fe.ObjectFit.SCALEDOWN:var o=a<s;e.width>t.width&&e.height>t.height&&(o=s<a),r=l.JsvStretchSize(e,s,o);break;case Fe.ObjectFit.CONTAIN:r=l.JsvStretchSize(e,s,a<s);break;default:throw Error("Unexpected object-fit.")}return n.x=(e.width-r.width)/2,n.y=(e.height-r.height)/2,n.width=r.width,n.height=r.height,n}},{key:"JsvStretchSize",value:function(e,t,i){var n={width:0,height:0};return i?(n.width=e.width,n.height=e.width/t):(n.height=e.height,n.width=e.height*t),n}}]),l}();Be.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},Be.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};function Ge(e){v(this,Ge);var t=e.indexOf(Ge.KeyFramesFlag)+Ge.KeyFramesFlag.length,i=e.indexOf("{"),n=e.substring(t,i);this.name=n.trim(),this.cssText=e}var Ue=function(){function o(){var e;return v(this,o),(e=y(this,f(o).call(this))).jsvContentView=null,e.jsvRefedImgTex=null,e}return c(o,Be),h(o,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new m.NinePatchView),g(f(o.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){g(f(o.prototype),"jsvOnUnloadForgeView",this).call(this),be.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(e){g(f(o.prototype),"jsvOnStyleChanged",this).call(this,e);var t=e.includes(Fe.TYPE.FOREGROUND),i=!0,n=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){switch(a.value){case Fe.TYPE.LAYOUT_SIZE:if(t)break;this.jsvFlushViewForeground();break;case Fe.TYPE.FOREGROUND:this.jsvFlushViewForeground();break;case Fe.TYPE.BORDER:this.jsvFlushViewBorder()}}}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"jsvFlushViewForeground",value:function(){var i=this;if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var e=this.jsvGetTextParams(),t=void 0===this.style.height||0==this.style.height,n=t?function(e,t){i.clientHeight=e.height}:null,r=new m.TextViewEx(be.TextureManager,e,this.jsvStore.textContent,!0,n);t&&r.EnableAutoHeight();var a=r.GetLayoutView();this.jsvContentView.AddView(a)}}},{key:"jsvFlushViewBorder",value:function(){if(this.jsvMaskView)if(this.style.clipPath)console.error("BorderImage is conflicting with ClipPath.");else if(this.style.borderImage){be.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex&&this.jsvRefedImgTex.Source===this.style.borderImage.source.href||(this.jsvRefedImgTex=be.TextureManager.GetImage(this.style.borderImage.source.href));var e=je.ConvertPx(this.getAttribute("jsv-borderimage-width")),t=je.ConvertPx(this.getAttribute("jsv-borderimage-height"));e&&t&&(console.log("Custom cache image size with: "+e+"/"+t),be.SetImgTexSize(this.jsvRefedImgTex,{width:e,height:t})),be.RefImgTexSize(this.jsvRefedImgTex,function(e){var t=this.style.borderImageOutset?this.style.borderImageOutset:je.ConvertRect();this.jsvMaskView.SetPadding({start:t.left,width:e.width-t.left-t.right},{start:t.top,width:e.height-t.top-t.bottom});var i=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:i.left,width:e.width-i.left-i.right}],[{start:i.top,width:e.height-i.top-i.bottom}]);var n=new m.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(n)}.bind(this))}}},{key:"jsvGetTextParams",value:function(){var e={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"nowrap"===this.style.whiteSpace?"none":"normal"},t={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top"},i=this.style.textShadow?this.style.textShadow.split(" "):void 0;i&&(t.shadow={shadowOffsetX:parseInt(i[0]),shadowOffsetY:parseInt(i[1]),shadowBlur:parseInt(i[2]),shadowColor:i[3]});var n=this.style.fontSize?this.style.fontSize+4:14;this.style.lineHeight&&(n=this.style.lineHeight);var r=new m.TextViewParams;r.SetTextAttr(e),r.SetFontStyle(t),r.SetLineHeight(n);var a=this.style.width;return void 0===a&&(a=this.clientWidth),r.SetViewSize(new m.RectArea(0,0,a,this.style.height)),r}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(e){this.jsvStore.textContent=e,this.jsvStore.clientWidth=null,this.jsvContentView||(this.jsvContentView=new m.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var e=this.style.width;if(e||0===e)return e;if(this.jsvStore.textContent){if(this.jsvStore.clientWidth||0===this.jsvStore.clientWidth)return this.jsvStore.clientWidth;var t={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=be.GetTextWidth(t),this.jsvStore.clientWidth}return g(f(o.prototype),"clientWidth",this)}}]),o}(),We=function(){function i(){return v(this,i),y(this,f(i).apply(this,arguments))}return c(i,Be),h(i,[{key:"setAttribute",value:function(e,t){g(f(i.prototype),"setAttribute",this).call(this,e,t),e===Be.ATTRIBUTE.SRC&&be.SetBackgroundImage(this.jsvMainView,t,this.style.borderRadius,this.jsvOnLoaded.bind(this))}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(Be.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(e){var t={width:this.style.width,height:this.style.height},i=Be.JsvFitViewLayout(t,e,this.style.objectFit);this.style.left&&(i.x+=this.style.left),this.style.top&&(i.y+=this.style.top),this.jsvMainView.ResetLayoutParams(i)}}]),i}();Ge.KeyFramesFlag="@keyframes";var He=function(){function t(e){v(this,t),this.jsvCssRules=null,this.jsvTextContent=e}return h(t,[{key:"insertRule",value:function(e,t){if(console.log("StyleSheet.insertRule() rule="+e),void 0===t&&(t=this.jsvCssRules.length),e.indexOf(Ge.KeyFramesFlag)<0)throw Error("StyleSheet.insertRule() Rule is not supported except keyframes.");var i=new Ge(e);this.jsvCssRules.splice(t,0,i)}},{key:"deleteRule",value:function(e){console.log("StyleSheet.deleteRule() index="+e),this.jsvCssRules.splice(e,1)}},{key:"cssRules",get:function(){if(this.jsvCssRules)return this.jsvCssRules;if(this.jsvCssRules=new Array,this.jsvTextContent.indexOf(Ge.KeyFramesFlag)<0)return this.jsvCssRules;var e=this.jsvTextContent.split(Ge.KeyFramesFlag);for(var t in e)0!=t&&this.insertRule(Ge.KeyFramesFlag+e[t]);return this.jsvCssRules}}]),t}(),ze=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this,e))).textContent=null,t}return c(i,Be),h(i,[{key:"appendChild",value:function(e){g(f(i.prototype),"appendChild",this).call(this,e);var t=new He(e.textContent);document.jsvAppendStyleSheet(t)}},{key:"removeChild",value:function(e){throw g(f(i.prototype),"removeChild",this).call(this,e),Error("Failed to removeChild, unimplement!.")}}]),i}(),Ye=function(){function n(e,t){var i;return v(this,n),(i=y(this,f(n).call(this,e,t)))._DetachListener=null,i}return c(n,m.LayoutView),h(n,[{key:"registerDetachListener",value:function(e){this._DetachListener=e}},{key:"unRegisterDetachListener",value:function(){this._DetachListener=null}},{key:"_OnDetachFromSystem",value:function(){console.log("JsvMediaView _OnDetachFromSystem"),this._DetachListener&&this._DetachListener()}}]),n}(),Je=function(){function n(e){var t;return v(this,n),(t=y(this,f(n).call(this))).jsvMediaView=null,t.jsvMedia=null,e&&(t.src=e),t}return c(n,Be),h(n,[{key:"addEventListener",value:function(e,t,i){g(f(n.prototype),"addEventListener",this).call(this,e,t,i),this.jsvAddMediaListener(e)}},{key:"jsvOnLoaded",value:function(){this.jsvMediaView=new Ye,this.jsvMediaView.registerDetachListener(this.jsvOnUnloadForgeView.bind(this)),this.jsvMainView.AddView(this.jsvMediaView)}},{key:"jsvOnLoadForgeView",value:function(){console.log("MediaElement jsvOnLoadForgeView"),g(f(n.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){console.log("MediaElement jsvOnUnloadForgeView"),this.jsvMediaView&&(this.jsvMediaView.unRegisterDetachListener(),this.jsvMediaView=null),g(f(n.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){var e=this.jsvEventListener;if(e)for(var t in e.keys)this.jsvAddMediaListener(t)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.pause(),this.jsvMedia.unload&&this.jsvMedia.unload(),this.jsvMedia.releaseResource&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy())),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(t){var i=this;this.jsvMedia||this.jsvInit(),this.jsvMedia.addEventListener(t,function(){var e=new Ae(t);e.target=i,g(f(n.prototype),"dispatchEvent",i).call(i,e)})}},{key:"src",set:function(e){e=e&&new Ee(e).href;this.jsvMedia||this.jsvInit(),e!==this.jsvMedia.src&&(this.jsvMedia.src=e)}}]),n}();for(var qe in Je.HOOKS={Audio:Audio,Video:OffscreenVideoPlayer},Je.PROP={SetOnly:["autoplay","loop"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},Je.PROP){var Xe=Je.PROP[qe],Ke=!0,Ze=!1,Qe=void 0;try{for(var $e,et=function(){var t=$e.value,e={};"SetOnly"!==qe&&"SetAndGet"!==qe||(e.set=function(e){this.jsvMedia||this.jsvInit(),this.jsvMedia[t]=e}),"GetOnly"!==qe&&"SetAndGet"!==qe||(e.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[t]}),"Function"===qe&&(e=function(){var e;return this.jsvMedia||this.jsvInit(),this.jsvMedia[t]?(e=this.jsvMedia)[t].apply(e,arguments):null}),e instanceof Function?Je.prototype[t]=e:Object.defineProperty(Je.prototype,t,e)},tt=Xe[Symbol.iterator]();!(Ke=($e=tt.next()).done);Ke=!0)et()}catch(e){Ze=!0,Qe=e}finally{try{Ke||null==tt.return||tt.return()}finally{if(Ze)throw Qe}}}var it=function(){function i(e){var t;return v(this,i),t=y(this,f(i).call(this,e)),console.log("AudioElement.constructor()",d(t)),t}return c(i,Je),h(i,[{key:"jsvInit",value:function(){this.jsvMedia=new Je.HOOKS.Audio,g(f(i.prototype),"jsvInit",this).call(this),this.jsvOnLoaded()}},{key:"jsvRelease",value:function(){g(f(i.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),i}(),nt=function(){function s(e){var t;return v(this,s),t=y(this,f(s).call(this,e)),console.log("VideoElement.constructor()",d(t)),t}return c(s,Je),h(s,[{key:"jsvOnStyleChanged",value:function(e){g(f(s.prototype),"jsvOnStyleChanged",this).call(this,e);var t=!0,i=!1,n=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){switch(r.value){case Fe.TYPE.LAYOUT_SIZE:this.jsvFlushVideoView()}}}catch(e){i=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(i)throw n}}}},{key:"jsvFlushVideoView",value:function(){if(this.jsvMediaView){var e={width:this.style.width,height:this.style.height},t={width:this.jsvMedia.videoWidth,height:this.jsvMedia.videoHeight},i=Be.JsvFitViewLayout(e,t,this.style.objectFit);this.jsvMediaView.ResetLayoutParams(i)}}},{key:"jsvInit",value:function(){this.jsvMedia=new Je.HOOKS.Video,this.addEventListener("load",this.jsvOnLoaded.bind(this)),g(f(s.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){g(f(s.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(g(f(s.prototype),"jsvOnLoaded",this).call(this),this.jsvMediaView){var e=be.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),t=new m.TextureSetting(e);this.jsvMediaView.ResetTexture(t)}this.jsvFlushVideoView()}}]),s}();for(var rt in nt.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},nt.PROP){var at=nt.PROP[rt],st=!0,ot=!1,lt=void 0;try{for(var ut,ht=function(){var t=ut.value,e={};"SetOnly"!==rt&&"SetAndGet"!==rt||(e.set=function(e){this.media[t]=e}),"GetOnly"!==rt&&"SetAndGet"!==rt||(e.get=function(){return this.media[t]}),nt.prototype[t]=e},ct=at[Symbol.iterator]();!(st=(ut=ct.next()).done);st=!0)ht()}catch(e){ot=!0,lt=e}finally{try{st||null==ct.return||ct.return()}finally{if(ot)throw lt}}}var dt=function(){function e(){v(this,e),this.src=null,this.onerror=null,this.onload=null,this.charset=null,this.timeout=120}return h(e,[{key:"setAttribute",value:function(e,t){console.log("ScriptElement.setAttribute() name="+e+", value=",t),this[e]=t}},{key:"jsvActiveScript",value:function(){if(null!=this.src){var e=new Ee(this.src);console.log("load script with url="+e.href);var i=this;window.JsView.runJsWithUrl(e.href,!1,function(e,t){i.onLoadResult(e,t)})}}},{key:"onLoadResult",value:function(e,t){console.log("onLoadResult "+e+" "+t),e?this.onload&&this.onload():this.onerror&&this.onerror({type:"jsvErr_"+t,target:this})}}]),e}(),ft=function(){function e(){return v(this,e),y(this,f(e).apply(this,arguments))}return c(e,Be),e}(),vt=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this))).jsvMainView=new m.JsvElementView(e),t}return c(i,Be),h(i,[{key:"setAttribute",value:function(e,t){g(f(i.prototype),"setAttribute",this).call(this,e,t),this.jsvMainView.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){g(f(i.prototype),"removeAttribute",this).call(this,e),this.jsvMainView.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.jsvMainView.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.jsvMainView.hasAttribute(e)}},{key:"jsvOnStyleChanged",value:function(e){g(f(i.prototype),"jsvOnStyleChanged",this).call(this,e)}},{key:"textContent",get:function(){return this.jsvMainView.textContent},set:function(e){this.jsvMainView.textContent=e}}]),i}(),yt=function(){function i(e){var t;return v(this,i),(t=y(this,f(i).call(this,Oe.TEXT_NODE))).textContent=e,t}return c(i,Oe),i}(),gt=function(){function e(){v(this,e),console.log("Document header construct")}return h(e,[{key:"appendChild",value:function(e){e instanceof dt&&(console.log("Found append script in head."),e.jsvActiveScript())}},{key:"removeChild",value:function(){console.warn("Failed to header.removeChild, unimplemented!.")}}]),e}(),mt=function(){function t(){var e;return v(this,t),(e=y(this,f(t).call(this,Oe.DOCUMENT_NODE))).location=window.location,e.rootElement=new Ue,e.rootElement.ownerDocument=d(e),e.rootElement.id="root",e.activeElement=e.rootElement,e.cookie="",e.styleSheets=new Array,e.jsvIsReady=!1,e.head=new gt,e}return c(t,Oe),h(t,[{key:"createElement",value:function(e){switch(e){case t.DIV_ELEMENT:case t.FDIV_ELEMENT:return new Ue;case t.IMG_ELEMENT:case t.FIMG_ELEMENT:return new We;case t.STYLE_ELEMENT:return new ze;case t.AUDIO_ELEMENT:return new it;case t.VIDEO_ELEMENT:return new nt;case t.SCRIPT_ELEMENT:return console.log("Document.createElement() create script"),window.JsView?new dt:window.originDocument.createElement("script");default:return 0===e.indexOf("jsv")?new vt(e):(console.warn("Document.createElement() unknown name="+e),new ft(e))}}},{key:"createTextNode",value:function(e){return console.log("Document.createTextNode() text="+e),new yt(e)}},{key:"createEvent",value:function(e){return new Ae(e)}},{key:"getElementById",value:function(e){if("root"===e||"app"===e)return this.rootElement;throw Error("Document.getElementById() id="+e+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(e){if("head"===e||"#app"===e)return this.rootElement;throw Error("Document.querySelector() selectors="+e+" is UNIMPLEMENTED.")}},{key:"jsvAppendStyleSheet",value:function(e){document.styleSheets.push(e)}},{key:"jsvGetKeyFrames",value:function(e){var t=!0,i=!1,n=void 0;try{for(var r,a=this.styleSheets[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value,o=!0,l=!1,u=void 0;try{for(var h,c=s.cssRules[Symbol.iterator]();!(o=(h=c.next()).done);o=!0){var d=h.value;if(d.name==e)return d.cssText}}catch(e){l=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(i)throw n}}var f="@keyframes ",v=f+e,y=!0,g=!1,m=void 0;try{for(var w,p=this.styleSheets[Symbol.iterator]();!(y=(w=p.next()).done);y=!0){var T=w.value,k=T.jsvTextContent,S=k.indexOf(v);if(!(S<0)){var x=k.indexOf("-keyframes",S+1),_=k.indexOf(f,S+1);_<0&&(_=k.length),0<x&&x<_&&(_=x);var R=k.substring(S,_);return T.insertRule(R,0),R}}}catch(e){g=!0,m=e}finally{try{y||null==p.return||p.return()}finally{if(g)throw m}}return null}},{key:"jsvUpdateRootElement",value:function(e){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=e,this.jsvIsReady=!0}}]),t}();mt.DIV_ELEMENT="div",mt.IMG_ELEMENT="img",mt.STYLE_ELEMENT="style",mt.VIDEO_ELEMENT="video",mt.AUDIO_ELEMENT="audio",mt.SCRIPT_ELEMENT="script",mt.FIMG_ELEMENT="fimg",mt.FDIV_ELEMENT="fdiv";var wt=function(){function i(){v(this,i)}return h(i,null,[{key:"_isUndefined",value:function(e,t){var i=void 0===t;return i&&console.error(e+" property is undefined!"),i}},{key:"_keyframesCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("transform")<0&&t.indexOf("opacity")<0&&console.error("keyframes property is only support transform and opacity, value:",t)}},{key:"_clipPathCheck",value:function(e,t){i._isUndefined(e,t)||t.startsWith("inset")||console.error("clipPath property is support inset only.")}},{key:"_transitionOtherCheck",value:function(e,t){i._isUndefined(e,t)||console.error(e+" property is not support, you can use transition property, e.g. transition='width 2s'")}},{key:"_transitionCheck",value:function(e,t){i._isUndefined(e,t)}},{key:"_transformCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("translate3d")<0&&t.indexOf("scale3d")<0&&t.indexOf("rotate3d")<0&&t.indexOf("skew")<0&&console.error("transform property's value only support translate3d、scale3d、rotate3d、skew, value:",t)}},{key:"_textOverflowCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"clip":case"ellipsis":break;default:console.error("textOverflow property's value is not support, value:",t)}}},{key:"_whiteSpaceCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"normal":case"nowrap":break;default:console.error("whiteSpace property's value is not support, value:",t)}}},{key:"_textAlignCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"left":case"right":case"center":break;default:console.error("textAlign property's value is not support, value:",t)}}},{key:"_lineHeightCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"normal":case"inherit":console.error("lineHeight property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("lineHeight property's value is support number only, value:",t)}}},{key:"_colorCheck",value:function(e,t){i._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("color property value is not valid, need startwith rgba or #, value:",t))}},{key:"_visibilityCheck",value:function(e,t){i._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&"inherit"!==t&&console.error("visibility property's value is not support, value:",t)}},{key:"_overflowCheck",value:function(e,t){i._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&console.error("overflow property's value is support visible or hidden only, value:",t)}},{key:"_topCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("top property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("top property's value is support number only, value:",t)}}},{key:"_leftCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("left property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("left property's value is support number only, value:",t)}}},{key:"_heightCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("height property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("height property's value is support number only, value:",t)}}},{key:"_widthCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("width property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("width property's value is support number only, value:",t)}}},{key:"_fontSizeCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"smaller":case"larger":case"inherit":case"x-small":case"xx-small":case"small":case"large":case"medium":case"x-large":case"xx-large":console.error("fontSize property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("fontSize property's value is support number only, value:",t)}}},{key:"_fontWeightCheck",value:function(e,t){i._isUndefined(e,t)||"bold"!==t&&console.error("fontWeight property's value is support bold only, value:",t)}},{key:"_fontStyleCheck",value:function(e,t){i._isUndefined(e,t)||"italic"!==t&&console.error("fontWeight property's value is support italic only, value:",t)}},{key:"_borderRadiusCheck",value:function(e,t){i._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderRadius property's value is not support, value:",t)}},{key:"_borderImageWidthCheck",value:function(e,t){i._isUndefined(e,t)}},{key:"_borderImageOutsetCheck",value:function(e,t){i._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderImageOutsetCheck property's value is not support, value:",t)}},{key:"_borderImageCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("fill")<0&&console.error("borderImage property's value is not contain fill, e.g. source slice, but value:",t)}},{key:"_backgroundOtherCheck",value:function(e){console.error(e+" property not support, you can use backgroundImage property, e.g. backgroundImage=`url(${iconImgPath})`")}},{key:"_backgroundImageCheck",value:function(e,t){i._isUndefined(e,t)||"inherit"==t&&console.error("backgroundImage property's value is not support, value:",t)}},{key:"_backgroundColorCheck",value:function(e,t){i._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("backgroundColor property value is not valid, need startwith rgba or #, value:",t))}},{key:"_animationCheck",value:function(){}},{key:"_animationOtherNotSupport",value:function(e){console.error(e+" property is not support, you can use animation property, e.g. animation='mymove 5s infinite'")}},{key:"get",value:function(e){return i.ValidStyleMap[e]}}]),i}();wt.ValidStyleMap={animation:{check:wt._animationCheck.bind(wt)},animationName:{check:wt._animationOtherNotSupport.bind(wt)},animationDuration:{check:wt._animationOtherNotSupport.bind(wt)},animationTimingFunction:{check:wt._animationOtherNotSupport.bind(wt)},animationDelay:{check:wt._animationOtherNotSupport.bind(wt)},animationIterationCount:{check:wt._animationOtherNotSupport.bind(wt)},animationDirection:{check:wt._animationOtherNotSupport.bind(wt)},animationPlayState:{check:wt._animationOtherNotSupport.bind(wt)},animationFillMode:{check:wt._animationOtherNotSupport.bind(wt)},background:{check:wt._backgroundOtherCheck.bind(wt)},backgroundColor:{check:wt._backgroundColorCheck.bind(wt)},backgroundImage:{check:wt._backgroundImageCheck.bind(wt)},borderImage:{check:wt._borderImageCheck.bind(wt)},borderImageOutset:{check:wt._borderImageOutsetCheck.bind(wt)},borderImageWidth:{check:wt._borderImageWidthCheck.bind(wt)},borderRadius:{check:wt._borderRadiusCheck.bind(wt)},height:{check:wt._heightCheck.bind(wt)},width:{check:wt._widthCheck.bind(wt)},fontFamily:{check:null},fontSize:{check:wt._fontSizeCheck.bind(wt)},fontStyle:{check:wt._fontStyleCheck.bind(wt)},fontWeight:{check:wt._fontWeightCheck.bind(wt)},left:{check:wt._leftCheck.bind(wt)},overflow:{check:wt._overflowCheck.bind(wt)},top:{check:wt._topCheck.bind(wt)},visibility:{check:wt._visibilityCheck.bind(wt)},color:{check:wt._colorCheck.bind(wt)},lineHeight:{check:wt._lineHeightCheck.bind(wt)},textAlign:{check:wt._textAlignCheck.bind(wt)},whiteSpace:{check:wt._whiteSpaceCheck.bind(wt)},textOverflow:{check:wt._textOverflowCheck.bind(wt)},transform:{check:wt._transformCheck.bind(wt)},transition:{check:wt._transitionCheck.bind(wt)},transitionProperty:{check:wt._transitionOtherCheck.bind(wt)},transitionDuration:{check:wt._transitionOtherCheck.bind(wt)},transitionTimingFunction:{check:wt._transitionOtherCheck.bind(wt)},transitionDelay:{check:wt._transitionOtherCheck.bind(wt)},clipPath:{check:wt._clipPathCheck.bind(wt)},keyframes:{check:wt._keyframesCheck.bind(wt)}};var pt=new mt;window.document.createElement=pt.createElement.bind(pt),window.document.createTextNode=pt.createTextNode.bind(pt),window.document.getElementById=pt.getElementById.bind(pt),window.document.querySelector=pt.querySelector.bind(pt),window.document.createEvent=pt.createEvent.bind(pt),console.log("Hook Document ..."),window.document.dispatchEvent=pt.dispatchEvent.bind(pt),window.document.jsvAppendStyleSheet=function(e){var t=window.originDocument.createElement("style");t.type="text/css",t.innerHTML=e.jsvTextContent,this.getElementsByTagName("Head")[0].appendChild(t)},window.document.jsvGetKeyFrames=function(e){for(var t="",i=document.styleSheets,n=0;n<i.length;++n){var r=i[n];if(r.cssRules)for(var a=0;a<r.cssRules.length;++a){var s=r.cssRules[a];if(s&&s.name===e){t=s.cssText;break}}}return t&&document.jsvCheckStyleFormat("keyframes",t),t},window.document.jsvCheckStyleFormat=function(e,t){var i=wt.get(e);i?i.check&&i.check(e,t):console.error(e+" property is not support.")},be.TextureManager=new m.TextureManager,be.RootView=new m.RootView,pt.jsvUpdateRootElement(be.RootView),console.log("Using JsView HTML")});
