!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";void 0===window.Forge&&(window.Forge={});var m=window.Forge;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?c(e):t}function y(i){return function(){var e,t=s(i);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(e){return}}}()){var n=s(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return o(this,e)}}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function p(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,a=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw r}}}}console.log("Define Forge ..."),window.originDocument={},window.originDocument.createElement=window.document.createElement.bind(window.document),window.originDocument.createTextNode=window.document.createTextNode.bind(window.document),window.originDocument.getElementById=window.document.getElementById.bind(window.document),window.originDocument.querySelector=window.document.querySelector.bind(window.document),window.originDocument.createEvent=window.document.createEvent.bind(window.document),window.originDocument.dispatchEvent=window.document.dispatchEvent.bind(window.document);var e=function(){function r(){w(this,r)}return h(r,null,[{key:"getTextPixelWith",value:function(e,t){null===r.sCanvas&&(r.sCanvas=window.originDocument.createElement("canvas"));var n=r.sCanvas.getContext("2d");n.font=t;var i=n.measureText(e);return Math.ceil(i.width)}},{key:"GetTextWidth",value:function(e){return this.getTextPixelWith(e.str,e.size+"px "+e.font)}},{key:"GetTextRect",value:function(e,t,n,i,r){var a=Math.ceil(n.size*e.length/t.width)*r;return a>t.height&&(a=t.height),{width:t.width,height:a}}}]),r}();e.sCanvas=null,window.PlatformUtils=e;var r=function(){function t(){w(this,t),this.state={}}return h(t,[{key:"buildPlatformInstance",value:function(){var e=this;this.VideoEle=window.originDocument.createElement("VIDEO"),this.VideoEle.addEventListener("loadedmetadata",function(){e.hasOwnProperty("onload")&&e.onload(),e.hasOwnProperty("onloadedmetadata")&&e.onloadedmetadata()})}},{key:"addEventListener",value:function(t,e){var n=this;this["on"+t]=e,this.VideoEle.addEventListener(t,function(e){n["on"+t](e)})}},{key:"load",value:function(){this.VideoEle.load()}},{key:"pause",value:function(){this.VideoEle.pause(),this.setState("paused",!0,"boolean"),this.hasOwnProperty("onpause")&&this.onpause()}},{key:"play",value:function(){this.setState("paused",!1,"boolean"),this.VideoEle.play(),this.hasOwnProperty("onplay")&&this.onplay()}},{key:"unload",value:function(){this.setState("paused",!0,"boolean"),this.VideoEle.isRenderable=!1,this.VideoEle.pause(),this.VideoEle.removeAttribute("src"),this.VideoEle.load()}},{key:"setState",value:function(e,t,n){u(t)===n?(this.VideoEle.setAttribute(e,t),this.state[e]=t,console.log("set "+e+" = "+t)):console.warn("invalid paramter type to set "+e+". value is not "+n)}},{key:"getState",value:function(e){var t=this.state[e];return console.log("get "+e+" = "+t),void 0===t&&(t=this.VideoEle.getAttribute(e),this.state[e]=t),t}},{key:"onError",value:function(e){this.VideoEle.isRenderable=!1,this.hasOwnProperty("onerror")&&this.onerror(e.currentTarget.error.code)}},{key:"mediaHandler",value:function(){return this.VideoEle}},{key:"autoplay",set:function(e){e&&this.play()}},{key:"currentTime",get:function(){return this.VideoEle.currentTime},set:function(e){this.VideoEle.isRenderable=!1,this.VideoEle.currentTime=e,this.setState("seek",e,"number")}},{key:"duration",get:function(){return this.VideoEle.duration}},{key:"loop",set:function(e){this.VideoEle.loop="boolean"!=typeof e||e}},{key:"muted",get:function(){return this.getState("muted")},set:function(e){this.setState("muted",e,"boolean")}},{key:"paused",get:function(){return this.VideoEle.paused}},{key:"playbackRate",get:function(){return this.getState("rate")},set:function(e){this.setState("rate",e,"number")}},{key:"src",set:function(e){this.setState("src",e,"string")}},{key:"style",get:function(){var t=this;return{set bottom(e){t.setState("style",'{"bottom":"'+e+'"}',"string")},set left(e){t.setState("style",'{"left":"'+e+'"}',"string")},set right(e){t.setState("style",'{"right":"'+e+'"}',"string")},set top(e){t.setState("style",'{"top":"'+e+'"}',"string")},set height(e){t.setState("style",'{"height":"'+e+'"}',"string")},set width(e){t.setState("style",'{"width":"'+e+'"}',"string")}}}},{key:"volume",get:function(){return this.getState("volume")},set:function(e){this.setState("volume",e,"number")}},{key:"playableDuration",get:function(){return this.VideoEle.playableDuration}}],[{key:"setDesignMapWidth",value:function(e){"number"==typeof e?t.prototype.designMapWidth=e:console.warn("Invalid paramter type to set "+e+". It is not number.")}}]),t}();r.prototype.designMapWidth=0;var t=function(){v(n,r);var t=y(n);function n(){var e;return w(this,n),(e=t.call(this))._ReleaseCallbacks=[],e._ResourceTerminater=null,d(s(n.prototype),"buildPlatformInstance",c(e)).call(c(e)),e}return h(n,[{key:"setResourceTerminator",value:function(e){this._ResourceTerminater=e}},{key:"hasTerminator",value:function(){return null!=this._ResourceTerminater}},{key:"listenToRelease",value:function(e){this._ReleaseCallbacks.push(e)}},{key:"unload",value:function(){d(s(n.prototype),"unload",this).call(this),null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"releaseResource",value:function(){for(var e=0;e<this._ReleaseCallbacks.length;e++)this._ReleaseCallbacks[e]();null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"onPlatformDestroy",value:function(){}}]),n}();window.OffscreenVideoPlayer=t,m.LogF=function(e){},m.LogE=function(e){},m.LogW=function(e){},m.LogI=function(e){},m.LogD=function(e){},m.LogM=function(e){},m.ThrowError=function(e){throw new Error(e)},m.Assert=function(e){if(!e)throw new Error("ASSERT!!!!!")},m.EnableLog=function(e){m.LogM=console.log.bind(console),0<e&&(m.LogF=console.error.bind(console)),1<e&&(m.LogE=console.error.bind(console)),2<e&&(m.LogW=console.warn.bind(console)),3<e&&(m.LogI=console.log.bind(console)),4<e&&(m.LogD=console.debug.bind(console))};var a=function(){function r(e,t,n,i){w(this,r),this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,("number"!=typeof n||n<0)&&(n=0),this.width=n,("number"!=typeof i||i<0)&&(i=0),this.height=i}return h(r,[{key:"Equals",value:function(e){return null!==e&&(e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height)}}]),r}();m.RectArea=a;m.Coordinate=function e(t,n){w(this,e),this.x=t,this.y=n};m.Size=function e(t,n){w(this,e),this.width=t,this.height=n};var f=function(){function e(){w(this,e)}return h(e,[{key:"FormatRectArea",value:function(e){var t=null;if(e instanceof m.RectArea)t=e;else if("object"===u(e)&&null!==e){if(isNaN(e.width)||isNaN(e.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");t=new m.RectArea(0,0,e.width,e.height)}return t}}]),e}();m.RectUtils=f,m.sRectUitls=new m.RectUtils;var g=function(){function d(){w(this,d)}return h(d,[{key:"StringWithFont",value:function(e,t,n,i,r,a,s,o,l,u){var h="";!0===s&&(h="italic");var c="";return!0===o&&(c="bold"),{str:""+e,font:n=n||d._sDefaultFont,size:t=t||d._sDefaultFontSize,italic:h,bold:c,stroke_width:u=u||-1,alignment:i=i||"left",vertical_align:r=r||"middle",textColour:a=a||d._sDefaultFontColor,backgroundColour:d._sDefaultBackgroundColor,enableBlend:!0,shadow:l=l||null}}},{key:"TextAttr",value:function(e,t){return{text_overflow:e=e||"none",word_wrap:t=t||"none"}}},{key:"GetTextWidth",value:function(e){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextWidth(e):e.str.length*e.size+1}},{key:"GetTextRect",value:function(e,t,n,i,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextRect(e,t,n,i,r):{width:t.width,height:t.height}}},{key:"GetTextInfo",value:function(e,t,n,i,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextInfo(e,t,n,i,r):{start:0,end:e.length,width:t.width,height:t.height}}},{key:"GetCursorOffset",value:function(e,t,n,i,r,a,s){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorOffset(e,t,n,i,r,a,s):0}},{key:"GetCursorPosition",value:function(e,t,n,i,r,a){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorPosition(e,t,n,i,r,a):{x:0,y:0}}}]),d}();g._sDefaultFont="黑体",g._sDefaultFontSize=30,g._sDefaultFontColor="#FFFFFF",g._sDefaultBackgroundColor="rgba(0, 0, 0, 0)",m.TextUtils=g,m.sTextUtils=new m.TextUtils,m.TextShaderType={LinearGradient:0,Image:1};m.TextShader=function e(t,n){w(this,e),this.Type=t,this.Params=n};var T=function(){function t(){w(this,t);var e=(new m.LayoutView).GetRenderer();this._Renderer=e,this.StringWithFont=m.sTextUtils.StringWithFont("",0,void 0,"center","middle",void 0,!1,!1,void 0),this.RectArea=new m.RectArea(0,0,0,0),this.TextAttr=m.sTextUtils.TextAttr("ellipsis","none"),this.Marquee=null,this.Shader=null,this.IsInstantLoad=!0,this.LineHeight=0}return h(t,[{key:"SetInstantLoad",value:function(e){return this.IsInstantLoad=e,this}},{key:"SetStringWithFont",value:function(e){return this.StringWithFont=e,this}},{key:"SetFontStyle",value:function(e,t,n,i,r,a,s,o,l){return"object"===u(e)?this.StringWithFont=m.sTextUtils.StringWithFont("",void 0!==e.size?e.size:10,void 0!==e.font?e.font:"宋体",void 0!==e.hAlign?e.hAlign:"center",void 0!==e.vAlign?e.vAlign:"middle",void 0!==e.textColor?e.textColor:"#000000",void 0!==e.italic&&e.italic,void 0!==e.bold&&e.bold,void 0!==e.shadow?e.shadow:null):this.StringWithFont=m.sTextUtils.StringWithFont("",e,t,n,i,r,a,s,o,l),this}},{key:"SetRectArea",value:function(e){return e instanceof m.RectArea?this.RectArea=e:this.RectArea=new m.RectArea(e.x,e.y,e.width,e.height),this}},{key:"SetViewSize",value:function(e){return e instanceof m.RectArea||(e=new m.RectArea(e.x,e.y,e.width,e.height)),this.SetRectArea(e),0===this.LineHeight&&0!==e.height&&(this.LineHeight=e.height),this}},{key:"SetTextAttr",value:function(e){var t,n;return t=e.hasOwnProperty("textOverflow")?e.textOverflow:e.hasOwnProperty("text_overflow")?e.text_overflow:"clip",n=e.hasOwnProperty("wordWrap")?e.wordWrap:e.hasOwnProperty("word_wrap")?e.word_wrap:"none",this.TextAttr={word_wrap:n,text_overflow:t},this}},{key:"SetMarquee",value:function(e){return e&&(this.Marquee={repetition:"infinite",direction:"left",speed:"normal"},e.repetition&&(this.Marquee.repetition=e.repetition),e.direction&&(this.Marquee.direction=e.direction),e.speed&&(this.Marquee.speed=e.speed)),this}},{key:"SetShader",value:function(e){return this.Shader=e,this}},{key:"SetLineHeight",value:function(e){return this.LineHeight=e,this}},{key:"Clone",value:function(){var e=new t;return e.StringWithFont=this.StringWithFont,e.RectArea=this.RectArea,e.TextAttr=this.TextAttr,e.LineHeight=this.LineHeight,e}}]),t}();m.TextViewParams=T,window.TextViewParams=m.TextViewParams;var k=function(){function y(e,t,n,i,r){var a=this;w(this,y),this._layoutView=null,this._textWidth=0,this._textViewReahHeight=0,this._marqueeRunning=!0,this._marqueePause=!1,this._marqueeCurrentNum=2,this._textView=null,this._TextViewParams=t,this._NeedQuick=void 0!==i&&i,this._marquee=t.Marquee,this._rectArea=t.RectArea,this._DrawCount=0,this._ShowInterval=0,this._TextureManager=e,this._Shader=t.Shader,this._IsInstantLoad=t.IsInstantLoad?1:0,this._AutoHeight=!1,this._EnableTextureOnloadCallback=!!r;var s,o,l=this,u=t.RectArea.width,h=t.RectArea.height,c=null;null!==this._marquee?((c=new m.ClipView).Init(),c.SetClipRect(0,0,u,h,!0),c.SetId("matrixClipLayoutview"),c.OnDettachFromSystem=function(){l._marqueeRunning=!1,m.ClipView.prototype.OnDettachFromSystem.call(this)}):(c=new m.LayoutView).OnDettachFromSystem=function(){this._TextureOnloadCallbacksTimer&&(clearTimeout(this._TextureOnloadCallbacksTimer),this._TextureOnloadCallbacksTimer=null)},s=c.GetRenderer(),this._Renderer=s;var d=n;d=d||t.StringWithFont.str,d=this._ConvertEscToString(d);var f=!1;0<t.StringWithFont.italic.length&&(f=!0);var v=!1;0<t.StringWithFont.bold.length&&(v=!0),o=m.sTextUtils.StringWithFont(d,t.StringWithFont.size,t.StringWithFont.font,t.StringWithFont.alignment,t.StringWithFont.vertical_align,t.StringWithFont.textColour,f,v,t.StringWithFont.shadow,t.StringWithFont.stroke_width),(void 0===t.Marquee||null===t.Marquee)&&this._NeedQuick?this._textWidth=t.RectArea.width-2*t.RectArea.x:this._textWidth=m.sTextUtils.GetTextWidth(o),this.addTextView(c,o,t.TextAttr,t.RectArea,t.Marquee,t.LineHeight),this._TextureOnloadCallbacksTimer&&(clearTimeout(this._TextureOnloadCallbacksTimer),this._TextureOnloadCallbacksTimer=null),this._TextureOnloadCallbacksTimer=setTimeout(function(){r&&r({width:a._textView.Element.clientWidth,height:a._textView.Element.clientHeight})},0),this._layoutView=c,this._TextTexture=null,this._MarqueeTimer=null}return h(y,[{key:"_ConvertEscToString",value:function(e){var t=""+e;return-1!==t.indexOf("&quot;")&&(t=t.replace(/&quot;/gi,'"')),-1!==t.indexOf("&amp;")&&(t=t.replace(/&amp;/gi,"&")),-1!==t.indexOf("&lt;")&&(t=t.replace(/&lt;/gi,">")),-1!==t.indexOf("&gt;")&&(t=t.replace(/&gt;/gi,"<")),-1!==t.indexOf("&nbsp;")&&(t=t.replace(/&nbsp;/gi," ")),t}},{key:"EnableAutoHeight",value:function(){this._AutoHeight=!0,this._textView.EnableAutoHeight()}},{key:"addTextView",value:function(e,t,n,i,r,a){var s,o=i.height,l=m.Clone(i),u=null;0!==t.str.length?(s=this._TextureManager.GetTextTextureByMultiRows(t,n,l,a,this._NeedQuick,this._Shader,this._IsInstantLoad),this._TextTexture=s.texture,this._textViewReahHeight=s.real_height,(u=new m.LayoutView).Init(new m.TextureSetting(s.texture,null,null,!0)),u.SetId("Text-"+t.str),e.AddView(u,new m.LayoutParams({x:0,y:0,width:l.width,height:o})),this._textView=u):(this._textViewReahHeight=0,m.LogI("t_StringWithFont.str.length is 0"))}},{key:"GetLayoutView",value:function(){return this._layoutView}},{key:"GetTextWidth",value:function(){return this._textView?this._textView.Element.clientWidth:Math.floor(this._textWidth+.5)}},{key:"StartAnimation",value:function(e){e&&null!==this._textView&&this._textView.StartAnimation(e)}}]),y}();m.TextViewEx=k,m.TextViewControl=k,m.Clone=function(e){var t=JSON.stringify(e);return JSON.parse(t)},window.Clone=m.Clone;var S=function(){function e(){w(this,e),this._AlreadyExited=!1,window.PersistTimer&&(this._AlreadyExited=!0)}return h(e,[{key:"setTimeout",value:function(e,t){return this._AlreadyExited&&window.PersistTimer.setTimeout?window.PersistTimer.setTimeout(e,t):window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){this._AlreadyExited&&window.PersistTimer.clearTimeout?window.PersistTimer.clearTimeout(e):window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){if(!this._AlreadyExited||!window.PersistTimer.setInterval)return window.setInterval(e,t);window.PersistTimer.setInterval(e,t)}},{key:"clearInterval",value:function(e){this._AlreadyExited&&window.PersistTimer.clearInterval?window.PersistTimer.clearInterval(e):window.clearInterval(e)}}]),e}();m.PersistTimer=new S;var _=function(){function e(){w(this,e)}return h(e,[{key:"setTimeout",value:function(e,t){return window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){return window.setInterval(e,t)}},{key:"clearInterval",value:function(e){window.clearInterval(e)}}]),e}();m.ForegroundTimer=new _,m.EasingTypeIn=0,m.EasingTypeOut=1,m.EasingTypeInOut=2,m.EasingTypeBezier=3,m.EasingTypeBlink=4,m.EasingTypeDeceleration=5,m.EasingTypeSteps=6;var x=function(){function e(){w(this,e)}return h(e,[{key:"Package",value:function(){}},{key:"_GetBasePackage",value:function(e){return{T:e,St:null}}}]),e}();m.EasingBase=x;var R=function(){v(t,m.EasingBase);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeIn)}}]),t}();m.EasingIn=R;var E=function(){v(t,m.EasingBase);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeOut)}}]),t}();m.EasingOut=E;var C=function(){v(t,m.EasingBase);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeInOut)}}]),t}();m.EasingInOut=C;var b=function(){v(t,m.EasingBase);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeDeceleration)}}]),t}();m.EasingDeceleration=b;var I=function(){v(t,m.EasingBase);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(m.EasingTypeBlink)}}]),t}();m.EasingBlink=I;var O=function(){v(o,m.EasingBase);var s=y(o);function o(e,t,n,i,r){var a;return w(this,o),(a=s.call(this))._Inited=!1,a._X1=e,a._X2=n,a._Y1=t,a._Y2=i,a._Duration=r,a}return h(o,[{key:"Pacakge",value:function(){var e=this._GetBasePackage(m.EasingTypeBezier);return e.St={X1:this._X1,X2:this._X2,Y1:this._Y1,Y2:this._Y2,Dur:this._Duration},e}}]),o}();m.BezierEasing=O;var A=function(){v(r,m.EasingBase);var i=y(r);function r(e,t){var n;return w(this,r),(n=i.call(this))._Steps=e,n._Type=t,n}return h(r,[{key:"Pacakge",value:function(){var e=this._GetBasePackage(m.EasingTypeSteps);return e.St={S:this._Steps,T:this._Type},e}}]),r}();m.StepsEasing=A,m.Easing={Circular:{In:new m.EasingIn,Out:new m.EasingOut,InOut:new m.EasingInOut,Deceleration:new m.EasingDeceleration}},window.Easing=m.Easing,m.ColorSpace={RGBA_8888:"RGBA_8888",RGBA_4444:"RGBA_4444",RGBA_5551:"RGBA_5551",RGB_565:"RGB_565",RGB_ETC1:"RGB_ETC1",RGBA_ETC1:"RGBA_ETC1"},m.QRCodeLevel={L:1,M:0,Q:3,H:2};var L=function(){function i(e,t,n){w(this,i),this._Manager=e,n&&m.sRenderTextureDelegateManager.CreateTextureStatus().SetResourceInfo(n);this.RenderTexture=m.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(t),this._CallbackIdToken=0,this._OnLoadCallback=[],m.ForgeDebug.EnableTextureTracer&&(e._ImageTextureTracer.push(this),this._TracerDescript="")}return h(i,[{key:"UnloadTex",value:function(){this._OnLoadCallback=[],null!==this.RenderTexture&&(0<this._CallbackIdToken&&(this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken),this._CallbackIdToken=0),this.RenderTexture.UndoRef(),this.RenderTexture=null),this._TracerDescript=""}},{key:"RegisterLoadImageCallback",value:function(e,t,n){this.IsLoaded()&&null!==t?t(n):null!==t&&(this._OnLoadCallback.push({callback:t,params:n}),0===this._CallbackIdToken&&(m.Assert(null!==this.RenderTexture),this._CallbackIdToken=this.RenderTexture.RegisterOnloadCallback(i.prototype._InvokeOnLoadCallbacks.bind(this))))}},{key:"_InvokeOnLoadCallbacks",value:function(){var e=this._OnLoadCallback;this._OnLoadCallback=[];for(var t=0;t<e.length;t++){var n=e[t];n.callback(n.params)}this.RenderTexture&&this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken)}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}},{key:"SetTextureTracerDescript",value:function(e){this._TracerDescript=e}},{key:"ReallocRenderTexture",value:function(){}},{key:"Unloaded",get:function(){return null===this.RenderTexture||this.RenderTexture.Unloaded},set:function(){}},{key:"LoadTime",get:function(){return null!==this.RenderTexture?this.RenderTexture.LoadTime:0},set:function(){}},{key:"Width",get:function(){return null!==this.RenderTexture?this.RenderTexture.Width:0},set:function(){}},{key:"Height",get:function(){return null!==this.RenderTexture?this.RenderTexture.Height:0},set:function(){}}]),i}();m.ImageTexture=L;var M=function(){v(u,m.ImageTexture);var l=y(u);function u(e,t,n,i,r,a){var s;w(this,u);var o=m.sRenderTextureDelegateManager.CreateResourceInfo(e.GetId(),"IMG");return o.Set={URL:t,Siz:i,Clr:r||"",IsF:n?1:0,NtS:a,ILd:0},(s=l.call(this,e,o)).Name="IMG",s.Source=t,s.IsForever=n?1:0,s.TargetSize=i,s.ColorSpace=r||"",s.NetSetting=a||null,s._InstantLoad=0,s._ImageElement=new Image,s._ImageElement.onload=function(){this._Loaded()}.bind(c(s)),s._ImageElement.onerror=function(){this._Loaded()}.bind(c(s)),s._ImageElement.src=t,s.RenderTexture.NeedCheckExpired=!0,s}return h(u,[{key:"_Loaded",value:function(){this.RenderTexture.Unloaded=!1,this.RenderTexture.LoadTime=Date.now(),this.RenderTexture.Width=this._ImageElement.width,this.RenderTexture.Height=this._ImageElement.height,this.RenderTexture.InvokeOnloadCallbacks()}},{key:"InstantLoad",value:function(e){if(this._InstantLoad=e?1:0,this.RenderTexture){var t=this.RenderTexture.GetResourceInfo();null!==t&&(t.Set.ILd=this._InstantLoad,this.RenderTexture.SetResourceInfo(t))}return this}},{key:"ReallocRenderTexture",value:function(){if(this.IsForever)m.LogE("ReallocRenderTexture(): NOT need for forever texture");else{var e=this.Source,t=this.TargetSize,n=this.ColorSpace,i=this.IsForever,r=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Manager.GetId(),this.Name);r.Set={URL:e,Siz:t,Clr:n,IsF:i,ILd:this._InstantLoad},this.RenderTexture=m.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(r),this._Manager.CachedTextureManager.CacheTheTexture(this)}}}]),u}();m.UrlImageTexture=M;var V=function(){function t(e){w(this,t),this._TextureManager=e,this._Renderer=e.GetRenderer(),this._CachedTextureStack=[],this._LockedTextureStack=[],this._MemoryLimited=10485760,this._VisibleMark=1}return h(t,[{key:"SetMemoryLimited",value:function(e){this._MemoryLimited=1024*e*1024}},{key:"_FindTexture",value:function(e,t,n){for(var i=this._CachedTextureStack.length-1;0<=i;i--){var r=this._CachedTextureStack[i];if(r.Source===e&&(t===r.TargetSize||null!==t&&t.Equals(r.TargetSize))&&n===r.ColorSpace){if(null===r.RenderTexture)continue;return r}}return null}},{key:"CacheTheTexture",value:function(e){for(var t=this._CachedTextureStack.length-1;0<=t;t--)if(e===this._CachedTextureStack[t])return;this._CachedTextureStack.push(e)}},{key:"_MarkVisibleViewTextures",value:function(e,t){e.TextureSetting&&e.TextureSetting.Texture&&(e.TextureSetting.Texture.VisibleMark=t);for(var n=e.ChildViews.length,i=0;i<n;i++){var r=e.ChildViews[i];r&&"VISIBLE"!==r.Visibility||this._MarkVisibleViewTextures(r,t)}}},{key:"ReduceInvisibleTexture",value:function(e){this._MarkVisibleViewTextures(e,++this._VisibleMark);for(var t=0;t<this._CachedTextureStack.length;t++){var n=this._CachedTextureStack[t];n.VisibleMark!==this._VisibleMark&&(n.UnloadTex(),this._CachedTextureStack.splice(t,1),t--)}}},{key:"GetCacheSize",value:function(){return this._CachedTextureStack.length}}]),t}();m.CachedTextureManager=V;var P=new Map,j=0,F=new Map,N=0,D=function(){function e(){w(this,e),this.CachedTextureManager=new m.CachedTextureManager(this),this._ForeverCachedTextureManager=new m.CachedTextureManager(this),this._AtlasDataInfo={atlas_data:[],buffer_data_offset:0,textures:[]},this._ClearTimer=-1,this._ImageTextureTracer=[],this._Id=e.sTextureManagerToken++,this._CacheMaxSize=100,this.StartScavengerCachedTimer()}return h(e,[{key:"StartScavengerCachedTimer",value:function(){-1===this._ClearTimer&&(this._ClearTimer=m.ForegroundTimer.setInterval(this.ScavengerCached.bind(this),3e4))}},{key:"GetId",value:function(){return this._Id}},{key:"GetRenderer",value:function(){return m.sDeprecatedRenderer}},{key:"GetImage",value:function(e,t,n){return e?this._GetImageInternal(e,null,m.ColorSpace.RGBA_8888,t,!1,n):(m.LogI("GetImage, url is null!"),null)}},{key:"GetImage2",value:function(e,t,n,i,r){if(!e)return m.LogI("GetImage2, url is null!"),null;var a=m.sRectUitls.FormatRectArea(n);return"string"!=typeof i&&(i=0<=e.indexOf(".pkm")?0<=e.indexOf(".pkma")?m.ColorSpace.RGBA_ETC1:m.ColorSpace.RGB_ETC1:m.ColorSpace.RGB_565),this._GetImageInternal(e,a,i,t,!1,r)}},{key:"_GetImageInternal",value:function(e,t,n,i,r,a){if(i){var s=this._ForeverCachedTextureManager._FindTexture(e,t,n);if(s)return s}else{var o=this.CachedTextureManager._FindTexture(e,t,n);if(o)return o}var l=new m.UrlImageTexture(this,e,i,t,n,a);return l.IsForever?this._ForeverCachedTextureManager.CacheTheTexture(l):this.CachedTextureManager.CacheTheTexture(l),l}},{key:"GetRoundCornerMask",value:function(e,t){return this.GetCustomCornerMask(e,t,t,t,t)}},{key:"GetCustomCornerMask",value:function(e,t,n,i,r){var a=m.sRectUitls.FormatRectArea(e),s=Math.max(t,n,i,r);if(s>a.width/2||s>a.height/2)return m.LogE("TextureManager.GetRoundCornerMask(): radius is too large, radius="+s+" w="+a.width+" h="+a.height),null;var o=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CCM");o.Set={W:a.width,H:a.height,LT:t,RT:n,LB:i,RB:r};var l=new m.ImageTexture(this,o);return m.ForgeDebug.EnableTextureTracer&&l.SetTextureTracerDescript("CornerMask"),l}},{key:"GetOneCornerMask",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"OCM");t.Set={Rad:e};var n=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&n.SetTextureTracerDescript("OneCornerMask"),n}},{key:"_getParamsId",value:function(e,t){var n=e.font,i=e.size,r=e.italic,a=e.bold,s=e.alignment,o=e.vertical_align,l=e.textColour,u=e.backgroundColour,h=e.shadow,c="";e.stroke_width&&(c=e.stroke_width);var d=t.text_overflow,f=t.word_wrap,v=[n,r,a,h,c].join(":"),y=[i,s,o,d,f].join(":"),g="",m="";return P.has(v)?g=P.get(v):(g="TS"+j,P.set(v,g),j++),F.has(y)?m=F.get(y):(m="DS"+N,F.set(y,m),N++),[g,m,l,u]}},{key:"GetTextTextureByMultiRows",value:function(e,t,n,i,r,a,s){var o=e.str;if(null===o||0===o.length)return null;var l=m.sRenderBridge.GetScreenInfo().scaleRatio,u=m.Clone(n);u.x*=l,u.y*=l,u.width*=l,u.height*=l;var h=m.Clone(e);h.size=Math.ceil(h.size*l),i*=l;var c=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"T");if(c.Set={ST:e.str,AT:JSON.stringify({TO:t.text_overflow,WW:t.word_wrap}),RA:JSON.stringify({X:parseInt(u.x+.5),Y:parseInt(u.y+.5),W:parseInt(u.width+.5),H:parseInt(u.height+.5)}),LH:parseInt(i+.5),ILD:void 0!==s?s:1},a&&(c.Set.SH=JSON.stringify({T:a.Type,P:a.Params})),void 0!==window.JsView&&void 0!==window.JsView.ForgeNativeRevision&&0<window.JsView.ForgeNativeRevision){var d=this._getParamsId(h,t,a);c.Set.PI={FS:d[0],DS:d[1],TC:d[2],BC:d[3]}}m.sRenderTextureDelegateManager.AppendFontStatusIfNeed(c.Set,h);var f=null;c.Set.FO&&(f={STA:{Nam:"T",Sta:c.Set.FO}});var v=new m.ImageTexture(this,c,f),y=u.height;void 0!==window.PlatformUtils&&!1===r&&(y=window.PlatformUtils.GetTextRect(o,u,h,t,i).height);if(y=Math.floor(y/l+.5),m.ForgeDebug.EnableTextureTracer){var g=e.str;8<g.length&&(g=e.str.substr(0,8)+"..."),v.SetTextureTracerDescript("["+g+"]")}return{texture:v,real_height:y}}},{key:"GetColorTexture",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CT");t.Set={Clr:e};var n=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&n.SetTextureTracerDescript("Color["+e+"]"),n}},{key:"ScavengerCached",value:function(){this.CachedTextureManager.GetCacheSize()>=this._CacheMaxSize&&this.CachedTextureManager.ReduceInvisibleTexture(m.sRootView)}},{key:"GetOffScreenMediaTexture",value:function(e){if(void 0===window.OffscreenVideoPlayer||!(e instanceof window.OffscreenVideoPlayer))return null;if(!e.hasTerminator()){var t=this._BuildVideoTexture(e);e.setResourceTerminator(function(){t.UnloadTex()})}return this._BuildVideoTexture(e)}},{key:"_BuildVideoTexture",value:function(e){var t=m.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"VPLY");t.Set={Hdl:e.mediaHandler()};var n=new m.ImageTexture(this,t);return m.ForgeDebug.EnableTextureTracer&&n.SetTextureTracerDescript("Video["+e.mediaHandler()+"]"),n}}]),e}();D.sTextureManagerToken=100,m.TextureManager=D,window.TextureManager=m.TextureManager;var B=function(){function e(){w(this,e)}return h(e,[{key:"SetTextureTracer",value:function(){}},{key:"GetTextureTracer",value:function(){return null}}]),e}();m.LayoutViewDebugClass=B,window.ForgeDebug=m.ForgeDebug=new m.LayoutViewDebugClass;var G=function(){function t(){w(this,t),this.Width=0,this.Height=0,this.MarginTop=0,this.MarginLeft=0,this.MarginRight=0,this.MarginBottom=0,this.Z=0,this.SizeAdjust=!1}return h(t,[{key:"SetPosition",value:function(e,t,n){this.MarginTop=t,this.MarginLeft=e,n&&(this.Z=n)}},{key:"SetSize",value:function(e,t){this.Width=e,this.Height=t}},{key:"Clone",value:function(){var e=new t;return e.Width=this.Width,e.Height=this.Height,e.MarginTop=this.MarginTop,e.MarginLeft=this.MarginLeft,e.MarginRight=this.MarginRight,e.MarginBottom=this.MarginBottom,e.Z=this.Z,e.SizeAdjust=this.SizeAdjust,e}},{key:"Equals",value:function(e){return e.Width===this.Width&&e.Height===this.Height&&e.MarginTop===this.MarginTop&&e.MarginLeft===this.MarginLeft&&e.MarginRight===this.MarginRight&&e.MarginBottom===this.MarginBottom&&e.Z===this.Z}}]),t}();m.LayoutParamsBase=G;var U=function(){v(i,m.LayoutParamsBase);var n=y(i);function i(e){var t;return w(this,i),t=n.call(this),e instanceof m.RectArea&&(e={x:e.x,y:e.y,width:e.width,height:e.height}),e&&(e.x?t.MarginLeft=e.x:e.marginLeft&&(t.MarginLeft=e.marginLeft),e.y?t.MarginTop=e.y:e.marginTop&&(t.MarginTop=e.marginTop),e.z&&(t.Z=e.z),e.width&&(t.Width=e.width),e.height&&(t.Height=e.height),isNaN(t.MarginTop)&&(m.LogE("isNaN(this.MarginTop)!"),t.MarginTop=0),isNaN(t.MarginLeft)&&(m.LogE("isNaN(this.MarginLeft)!"),t.MarginLeft=0),"MatchParent"!==t.Width?isNaN(t.Width)&&m.LogE("isNaN(this.Width)!"):t.SizeAdjust=!0,"MatchParent"!==t.Height?isNaN(t.Height)&&m.LogE("isNaN(this.Height)!"):t.SizeAdjust=!0),t}return i}();m.LayoutParams=U,window.LayoutParams=m.LayoutParams;var W=function(){function e(){w(this,e),this._IdTokenGenerator=66,(m.sRenderTextureDelegateManager=this)._CheckExpiredTime=0}return h(e,[{key:"CreateTextureStatus",value:function(){var e=new m.RenderTextureDelegate(this,0);return e.DoRef(),e}},{key:"CreateTexture",value:function(){var e=new m.RenderTextureDelegate(this,this._IdTokenGenerator++);return e.DoRef(),e}},{key:"RecycleTexture",value:function(){}},{key:"CreateResourceInfo",value:function(e,t){return{Id:0,Nam:t,Set:null,TmId:e,NdLd:0}}},{key:"AppendFontStatusIfNeed",value:function(e,t){var n={};n.Fo=t.font,n.Si=t.size,n.It=t.italic,n.Bo=t.bold,n.Al=t.alignment,n.Ve=t.vertical_align,n.Tx=t.textColour,n.Ba=t.backgroundColour,n.En=t.enableBlend,n.Sh=t.shadow,t.stroke_width?n.Stk=t.stroke_width:n.Stk=-1,e.FO=JSON.stringify(n)}}]),e}();m.RenderTextureDelegateManager=W,m.sRenderTextureDelegateManager=new m.RenderTextureDelegateManager;var H=function(){function i(e,t){if(w(this,i),this.IdToken=t,this._Manager=e,this._Reference=0,this._SyncingResourceInfo=null,this._OnloadCallbacks={},this._OnloadCallbacksSize=0,this._OnloadCallbackIdGenerator=1,this.Unloaded=!0,this.LoadTime=0,this.RequireTime=0,this.ForceExpire=!1,this.NeedCheckExpired=!1,m.ForgeDebug.GetTextureTracer()){var n=new Error;this.Stack=n.stack}}return h(i,[{key:"DoRef",value:function(){this._Reference++}},{key:"UndoRef",value:function(){this._Reference--,0===this._Reference&&(0<this._OnloadCallbacksSize&&(this._OnloadCallbacks={}),this._Manager.RecycleTexture(this))}},{key:"SetResourceInfo",value:function(e){e.Id=this.IdToken,this._SyncingResourceInfo=e}},{key:"GetResourceInfo",value:function(){return this._SyncingResourceInfo}},{key:"ReadSyncInfo",value:function(){var e=this._SyncingResourceInfo;return this._SyncingResourceInfo=null,e}},{key:"RegisterOnloadCallback",value:function(e){var t=this._OnloadCallbackIdGenerator++;return this._OnloadCallbacks[""+t]=e,this._OnloadCallbacksSize++,null!==this._SyncingResourceInfo&&(this._SyncingResourceInfo.NdLd=1),t}},{key:"UnregisterOnloadCallback",value:function(e){delete this._OnloadCallbacks[""+e],this._OnloadCallbacksSize--}},{key:"InvokeOnloadCallbacks",value:function(){if(0<this._OnloadCallbacksSize)for(var e in this._OnloadCallbacks)this._OnloadCallbacks[e]()}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}}]),i}();m.RenderTextureDelegate=H;var z=function(){function e(){w(this,e),(m.sDeprecatedRenderer=this)._SharedTextureManager=this.CreateTextureManager()}return h(e,[{key:"SetUserId",value:function(e){m.sRenderBridge.UpdateUserId(e)}},{key:"GetScreenInfo",value:function(){return m.sRenderBridge.GetScreenInfo()}},{key:"StringWithFont",value:function(){return m.sTextUtils.StringWithFont.apply(this,arguments)}},{key:"GetTextWidth",value:function(){return m.sTextUtils.GetTextWidth.apply(this,arguments)}},{key:"GetTextUtils",value:function(){return m.sTextUtils}},{key:"RectArea",value:function(e,t,n,i){return new m.RectArea(e,t,n,i)}},{key:"TextAttr",value:function(){return m.sTextUtils.TextAttr.apply(this,arguments)}},{key:"GarbageCollect",value:function(){m.LogM("GarbageCollect called")}},{key:"TriggerFrameDraw",value:function(){m.sRenderBridge.RequestSwap()}},{key:"GetSharedTextureManager",value:function(){return this._SharedTextureManager}},{key:"CreateTextureManager",value:function(){return new m.TextureManager}}]),e}();m.DeprecatedRenderer=z,m.sDeprecatedRenderer=null,window.gRootView=null,m.sRootView=null;var Y=function(){function r(e,t,n,i){w(this,r),this.Texture=e,this._IsTextureExternal=!1,t instanceof m.ImageTexture?(t&&t.RenderTexture&&t.RenderTexture.NeedCheckExpired&&(t.RenderTexture.RequireTime=0),this.MaskSetting=new m.ViewTextureMask(t)):this.MaskSetting=t,e&&e.RenderTexture&&e.RenderTexture.NeedCheckExpired&&(e.RenderTexture.RequireTime=0),this._IsMaskTextureExternal=!1,this.TextureBeforeImageLoad=n,this._IsPreloadImageTextureExternal=!1,void 0===i&&(i=!0),this.HasAlpha=i}return h(r,[{key:"SetExternal",value:function(e,t,n){this._IsTextureExternal=e,this._IsMaskTextureExternal=t,this._IsPreloadImageTextureExternal=n}},{key:"ReleaseInternalTexture",value:function(){!this._IsTextureExternal&&this.Texture&&(this.Texture.UnloadTex(),this.Texture=null),!this._IsMaskTextureExternal&&this.MaskSetting&&(this.MaskSetting.UnLoad(),this.MaskSetting=null),!this._IsPreloadImageTextureExternal&&this.TextureBeforeImageLoad&&(this.TextureBeforeImageLoad.UnloadTex(),this.TextureBeforeImageLoad=null)}},{key:"DebugPrint",value:function(){return" _IsTextureExternal="+this._IsTextureExternal}}]),r}();m.TextureSetting=Y,window.TextureSetting=m.TextureSetting;var J=function(){v(s,m.TextureSetting);var a=y(s);function s(e,t,n,i){var r;return w(this,s),(r=a.call(this,e,t,n,i)).SetExternal(!0,!0,!0),r}return s}();m.ExternalTextureSetting=J,window.ExternalTextureSetting=m.ExternalTextureSetting;var q=function(){function n(e){w(this,n);var t=e.RectInfo;this.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},this.LayoutParams=JSON.parse(JSON.stringify(e.LayoutParams))}return h(n,[{key:"ApplyToView",value:function(e){var t=this.RectInfo;e.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},e.LayoutParams=JSON.parse(JSON.stringify(this.LayoutParams))}}]),n}();m.PackedLayout=q;var X=function(){function e(){w(this,e),this._MaskType="COMMON"}return h(e,[{key:"Type",value:function(){return this._MaskType}},{key:"UnLoad",value:function(){}}]),e}();m.ViewMask=X;var K=function(){v(i,m.ViewMask);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this))._MaskType="TEXTURE",t.ImageTexture=e,t}return h(i,[{key:"UnLoad",value:function(){this.ImageTexture.UnloadTex()}}]),i}();m.ViewTextureMask=K;var Z=function(){v(s,m.ViewMask);var a=y(s);function s(e,t,n,i){var r;return w(this,s),(r=a.call(this))._MaskType="CORNER",r._TopLeft=e,r._TopRight=isNaN(t)?e:t,r._BottomLeft=isNaN(n)?e:n,r._BottomRight=isNaN(i)?e:i,r._CornersWidth=[0,0,0,0],r._CornersDisable=[0===r._TopLeft?1:0,0===r._TopRight?1:0,0===r._BottomLeft?1:0,0===r._BottomRight?1:0],r}return h(s,[{key:"UnLoad",value:function(){}}]),s}();m.ViewRoundCornerMask=Z;var Q=0,$=function(){function n(e,t){w(this,n),(this.TextureSetting=e)&&console.error("LayoutViewBase constructor texture_setting not undefined!"),this.Visibility="VISIBLE",this.LayoutParams=null,this.ParentView=null,this.ChildViews=[],this.zIndex=0,this._DebugCount=++Q,this.childZIndexCount=0,this._IsChildOfRootView=!1,"root"===t?this.Element=window.originDocument.getElementById(t):"svg"===t||"path"===t?this.Element=document.createElementNS("http://www.w3.org/2000/svg",t):(this.Element=window.originDocument.createElement(t),this.Element.style.position="absolute"),this._TransitionStore={},this.TransformAnimationObj=null,this._TextureAnimationObj=null}return h(n,[{key:"Init",value:function(e){this.ResetTexture(e)}},{key:"AddView",value:function(e,t){null!==t?t instanceof m.LayoutParamsBase?e.LayoutParams=t.Clone():e.LayoutParams=new m.LayoutParams(t):null===e.LayoutParams&&(e.LayoutParams=new m.LayoutParams({x:0,y:0})),null!==e.LayoutParams&&(e.LayoutParams.MarginLeft&&(e.Element.style.left=e.LayoutParams.MarginLeft+"px"),e.LayoutParams.MarginTop&&(e.Element.style.top=e.LayoutParams.MarginTop+"px"),e.LayoutParams.Width&&(e.Element.style.width=e.LayoutParams.Width+"px"),e.LayoutParams.Height?e.Element.style.height=e.LayoutParams.Height+"px":e.Element.style.height=""),(e.ParentView=this).ChildViews.push(e),this._IsChildOfRootView&&e._OnAttachToSystem()}},{key:"RemoveView",value:function(e){for(var t=0;t<this.ChildViews.length;t++)if(this.ChildViews[t]===e){e.IsChildOfRootView()&&e._OnDetachFromSystem(),this.ChildViews.splice(t,1),e.ParentView=null;break}}},{key:"_OnDetachFromSystem",value:function(){this._IsChildOfRootView=!1;for(var e=0;e<this.ChildViews.length;e++){this.ChildViews[e]._OnDetachFromSystem()}this.ParentView.Element.removeChild(this.Element)}},{key:"ClearViews",value:function(){var e=this.ChildViews.length;if(0!==e){for(var t=0;t<e;t++){var n=this.ChildViews[t];n&&n.IsChildOfRootView()&&n._OnDetachFromSystem()}this.ChildViews=[]}}},{key:"_ResetTextStyle",value:function(e){if(this.Element.textContent=e.Set.ST,this.Element.style.overflow="hidden",e.Set.AT){var t=JSON.parse(e.Set.AT);this.Element.style.textOverflow=t.TO,"none"==t.WW&&(this.Element.style.whiteSpace="nowrap")}if(e.Set.RA){var n=JSON.parse(e.Set.RA);this.Element.style.width=n.W+"px",this.Element.style.height=n.H+"px"}if(e.Set.LH&&(this.Element.style.lineHeight=e.Set.LH+"px"),e.Set.FO){var i=JSON.parse(e.Set.FO);i.Tx&&(this.Element.style.color=i.Tx),i.Fo&&(this.Element.style.fontFamily=i.Fo),i.Si&&(this.Element.style.fontSize=i.Si+"px"),i.Ba&&(this.Element.style.backgroundColor=i.Ba),i.It&&(this.Element.style.fontStyle="italic"),i.Bo?this.Element.style.fontWeight="bold":this.Element.style.fontWeight="normal",i.Al&&(this.Element.style.textAlign=i.Al),i.Ve&&(this.Element.style.verticalAlign=i.Ve)}}},{key:"_SetBorderRadius",value:function(e){this.Element.style.borderRadius=e._TopLeft+"px "+e._TopRight+"px "+e._BottomRight+"px "+e._BottomLeft+"px"}},{key:"ResetTexture",value:function(e){if(this.TextureSetting=e)if(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)this.Element.style.backgroundImage="url("+e.Texture.Source+")",this.Element.style.backgroundSize="100% 100%";else if(e.Texture.RenderTexture&&e.Texture.RenderTexture._SyncingResourceInfo){var t=e.Texture.RenderTexture._SyncingResourceInfo;if("T"===t.Nam)this._ResetTextStyle(t);else if("CT"===t.Nam)this.Element.style.backgroundColor=t.Set.Clr;else if("VPLY"===t.Nam){var n=t.Set.Hdl;this.LayoutParams&&(n.style.width=this.LayoutParams.Width+"px",n.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(n)}}}},{key:"SetVisibility",value:function(e){this.Element.style.visibility="string"==typeof e?e.toLocaleLowerCase():"inherit"}},{key:"_OnAttachToSystem",value:function(){"svg"!==this.Element.id&&"path"!==this.Element.id||console.log("_OnAttachToSystem appendChild"),this.ParentView.Element.appendChild(this.Element),this._IsChildOfRootView=!0;for(var e=this.ChildViews,t=0;t<e.length;t++)e[t]._OnAttachToSystem()}},{key:"IsChildOfRootView",value:function(){return this._IsChildOfRootView}},{key:"_ConvertTimingFunc",value:function(e){var t="linear";if(e.T)switch(e.T){case m.EasingTypeIn:t="ease-in";break;case m.EasingTypeOut:t="ease-out";break;case m.EasingTypeInOut:t="ease-in-out";break;case m.EasingTypeBezier:t="cubic-bezier("+e.St.X1+","+e.St.Y1+","+e.St.X2+","+e.St.Y2+")";break;case m.EasingTypeSteps:t="steps("+e.St.S+","+(0==e.St.T?"start":"end")+")";break;case m.EasingTypeBlink:case m.EasingTypeDeceleration:}return t}},{key:"ClearAnimation",value:function(){-1!=this._AnimationOpacity&&(this._AnimationOpacity=-1)}},{key:"StartAnimation",value:function(t,e,n){if(void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(t),this.TransformAnimationObj=null,this.Element.style.animation=null,this.Element.style.webkitAnimation=null),this.TransformAnimationObj=t,!isNaN(n)&&0<n&&t.EnableDelay(n),t.Start(this),t&&t._SettingInfo&&t._SettingInfo.Set){var i=t._SettingInfo.Set.Kf,r=t._SettingInfo.Set.Ts;if(i&&(0<=i.indexOf("@keyframes")||0<=i.indexOf("@-webkit-keyframes"))){var a=i.split(" ")[1];0<=a.indexOf("{")&&(a=a.substr(0,a.indexOf("{")));var s=t._SettingInfo.Rpt,o="linear";t._SettingInfo.E&&(o=this._ConvertTimingFunc(t._SettingInfo.E));var l=a+" "+t._SettingInfo.Dur/1e3+"s "+o+" "+t._SettingInfo.Dly/1e3+"s "+(-1===s?"infinite":s);console.log("StartAnimation style_anim:",l),this.Element.style.animation=l,this.Element.addEventListener("animationend",function(e){e.stopPropagation(),t.OnEnd()}),this.Element.style.webkitAnimation=l,this.Element.addEventListener("webkitAnimationEnd",function(e){e.stopPropagation(),t.OnEnd()})}else if(r&&0<=r.length){for(var u="",h=0;h<r.length;h++){var c="linear",d=r[h];d.tf&&(c=this._ConvertTimingFunc(d.tf)),u=d.name+" "+d.dur/1e3+"s "+c+" "+d.dly/1e3+"s",this._TransitionStore[d.name]=u}if(u){var f="";for(var v in this._TransitionStore)f&&(f+=","),f+=this._TransitionStore[v];this.Element.style.transition=f,this.Element.addEventListener("transitionend",function(e){e.stopPropagation(),t.OnEnd()}),this.Element.style.webkitTransition=f,this.Element.addEventListener("webkitTransitionEnd",function(e){e.stopPropagation(),t.OnEnd()})}}}}},{key:"StopAnimation",value:function(){void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(),this.TransformAnimationObj=null,this.Element.style.animation=null,this.Element.style.webkitAnimation=null)}},{key:"StartTextureAnimation",value:function(e){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(e),this._TextureAnimationObj=null),(this._TextureAnimationObj=e).AsTextureAnimation(),e.Start(this),this._RequestLayout()}},{key:"StopTextureAnimation",value:function(){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(),this._TextureAnimationObj=null)}},{key:"StopAllAnimations",value:function(){this.StopAnimation(),this.StopTextureAnimation();for(var e=0;e<this.ChildViews.length;e++)this.ChildViews[e].StopAllAnimations()}},{key:"GetAnimation",value:function(){return this.TransformAnimationObj}},{key:"DetachAnimation",value:function(e){this.TransformAnimationObj==e&&(this.TransformAnimationObj=null,this.Element.style.animation=null,this.Element.style.webkitAnimation=null)}},{key:"ResetCssTransform",value:function(e){e!==this._CssTransform&&(console.log("ResetCssTransform transform_string:",e),this.Element.style.transform=e,this._CssTransform=e)}},{key:"SetId",value:function(e){this.Id=e}},{key:"ResetLayoutParams",value:function(e){if(null!==e){e instanceof m.LayoutParamsBase?this.LayoutParams=e.Clone():this.LayoutParams=new m.LayoutParams(e),this.Element.style.left=this.LayoutParams.MarginLeft+"px",this.Element.style.top=this.LayoutParams.MarginTop+"px",this.LayoutParams.Width&&(this.Element.style.width=this.LayoutParams.Width+"px"),this.LayoutParams.Height&&(this.Element.style.height=this.LayoutParams.Height+"px");var t=this.TextureSetting;if(t&&t.Texture.RenderTexture&&t.Texture.RenderTexture._SyncingResourceInfo){var n=t.Texture.RenderTexture._SyncingResourceInfo;if("VPLY"===n.Nam){var i=n.Set.Hdl;this.LayoutParams&&(i.style.width=this.LayoutParams.Width+"px",i.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(i)}}}else m.ThrowError("ResetLayoutParams(): new params is null")}},{key:"GetRenderer",value:function(){return m.LayoutViewBase.sRenderer}},{key:"GetLayoutParams",value:function(){return this.LayoutParams?this.LayoutParams.Clone():new m.LayoutParams}},{key:"EnableAutoHeight",value:function(){this._AutoHeight=!0}}]),n}();$.DivId=0,m.LayoutViewBase=$;var ee=function(){v(i,m.LayoutViewBase);var n=y(i);function i(e,t){return w(this,i),!e||e instanceof m.TextureSetting||m.ThrowError("ERROR:LayoutView need TextureSetting as parameter"),t=t||"div",n.call(this,e,t)}return i}();m.LayoutView=ee,window.LayoutView=m.LayoutView;var te=function(){v(n,m.LayoutView);var t=y(n);function n(){var e;return w(this,n),(e=t.call(this,void 0,"root"))._ViewType=1,e._IsChildOfRootView=!0,window.gRootView=c(e),m.sRootView=c(e),e}return h(n,[{key:"Init",value:function(e){this.InitLayoutViewStaticValues(e),this.ResetLayoutParams({x:0,y:0,width:1280,height:720})}},{key:"InitLayoutViewStaticValues",value:function(e){m.LayoutViewBase.sRenderer=e,m.LayoutViewBase.sInternalTextureManager=e.GetSharedTextureManager(),m.LayoutViewBase.sIdentityMat4=new m.Mat4,m.LayoutViewBase.sNullDirectParentMat4=new m.Mat4,m.LayoutViewBase.sBakeFlipYMat4=(new m.Mat4).rotatex(180)}}]),n}();m.RootView=te,window.RootView=m.RootView;var ne=function(){function a(e,t,n,i,r){w(this,a),this.coordX=e,this.coordY=t,this.width=n,this.height=i,this.useScissors=r,this.maskStencil=null}return h(a,[{key:"updateInfo",value:function(e,t,n,i,r){this.coordX=e,this.coordY=t,this.width=n,this.height=i,this.useScissors=r}},{key:"setMaskStencil",value:function(e){this.maskStencil=e}}]),a}(),ie=function(){v(i,m.LayoutView);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this,e,"div"))._ClipRectInfo=null,t.Id="ClipView",t.TextureSetting=null,t}return h(i,[{key:"SetId",value:function(e){this.Id=e+"_ClipView"}},{key:"SetClipRect",value:function(e,t,n,i,r){null===this._ClipRectInfo?this._ClipRectInfo=new ne(e,t,n,i,r):this._ClipRectInfo.updateInfo(e,t,n,i,r);var a=e,s=t,o=this.LayoutParams.Width-a-n,l=this.LayoutParams.Height-s-i;this.Element.style.overflow="hidden",this.Element.style.clipPath="inset("+s+"px "+o+"px "+l+"px "+a+"px)"}}]),i}();m.ClipView=ie,window.ClipView=m.ClipView;var re=function(){v(i,m.LayoutView);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this,e,"div"))._HorizontalRepeats=[0,0,0,0],t._VerticalRepeats=[0,0,0,0],t._HorizontalPadding=[0,0],t._VerticalPadding=[0,0],t}return h(i,[{key:"ResetTexture",value:function(e){if((this.TextureSetting=e)&&(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)){var t=e.Texture.RenderTexture.Width,n=e.Texture.RenderTexture.Width,i=this._HorizontalRepeats[0],r=t-this._HorizontalRepeats[1]-i,a=this._VerticalRepeats[0],s=n-this._VerticalRepeats[1]-a,o=a+" "+r+" "+s+" "+i;this.Element.style.borderImage="url("+e.Texture.Source+") "+o+" fill";var l=this._HorizontalPadding[0],u=t-this._HorizontalPadding[1]-l,h=this._VerticalPadding[0],c=n-this._VerticalPadding[1]-h;this.Element.style.borderImageWidth=a+"px "+r+"px "+s+"px "+i+"px",this.Element.style.borderImageOutset=h+"px "+u+"px "+c+"px "+l+"px"}}},{key:"SetRepeat",value:function(e,t){m.Assert(e.length<=2),m.Assert(t.length<=2);for(var n=0;n<2;n++)n<e.length?(this._HorizontalRepeats[2*n]=e[n].start,this._HorizontalRepeats[2*n+1]=e[n].width):(this._HorizontalRepeats[2*n]=0,this._HorizontalRepeats[2*n+1]=0),n<t.length?(this._VerticalRepeats[2*n]=t[n].start,this._VerticalRepeats[2*n+1]=t[n].width):(this._VerticalRepeats[2*n]=0,this._VerticalRepeats[2*n+1]=0);return this}},{key:"SetPadding",value:function(e,t){return m.Assert(null!==e),m.Assert(null!==t),this._VerticalPadding[0]=t.start,this._VerticalPadding[1]=t.width,this._HorizontalPadding[0]=e.start,this._HorizontalPadding[1]=e.width,this}}]),i}();m.NinePatchView=re;var ae=function(){v(i,m.LayoutView);var n=y(i);function i(e){w(this,i);var t=e.substr(3);return n.call(this,void 0,t)}return h(i,[{key:"setAttribute",value:function(e,t){this.Element.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){this.Element.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.Element.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.Element.hasAttribute(e)}},{key:"textContent",get:function(){return this.Element.textContent},set:function(e){this.Element.textContent=e}}]),i}();m.JsvElementView=ae,m.AnimationEnable={ReleaseAfterEndCallback:0};var se=function(){function e(){w(this,e),this.IdToken=0,this._AttachedGroup=null,this.AnimationListenerObj=null,this._AnimationClose=!1,this._LayoutViewRef=null,this._IsTextureAnim=!1}return h(e,[{key:"SetAnimationListener",value:function(e){this.AnimationListenerObj=e}},{key:"AddAnimationListener",value:function(e){this.AnimationListenerObj&&e.AddInherit(this.AnimationListenerObj),this.SetAnimationListener(e)}},{key:"GetAnimationListener",value:function(){return this.AnimationListenerObj}},{key:"Cancel",value:function(e){this._LayoutViewRef&&this._LayoutViewRef.DetachAnimation(this);var t=this.AnimationListenerObj;if(t&&t.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,t.OnAnimationEnd(!1)),this._AttachedGroup){var n=!0;e&&(n=e._AttachedGroup!==this._AttachedGroup),n&&(this._AttachedGroup.CancelFromInternalAnimation(this),this._AttachedGroup=null)}}},{key:"RemoveFromGroup",value:function(){this._AttachedGroup=null}},{key:"AsTextureAnimation",value:function(){this._IsTextureAnim=!0}},{key:"Start",value:function(e){(this._LayoutViewRef=e)&&!this._IsTextureAnim&&e.ClearAnimation()}},{key:"SetCannotDisable",value:function(){}},{key:"OnStart",value:function(){var e=this.AnimationListenerObj;e&&e.OnAnimationStart&&e.OnAnimationStart()}},{key:"OnEnd",value:function(){this._LayoutViewRef&&(this._LayoutViewRef.DetachAnimation(this),this._LayoutViewRef=null);var e=this.AnimationListenerObj;e&&e.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,e.OnAnimationEnd(!0))}},{key:"OnViewHide",value:function(){var e=this.AnimationListenerObj;e&&e.OnViewNoVisible&&e.OnViewNoVisible()}}]),e}();m.AnimationBase=se;var oe=function(){function i(e,t,n){w(this,i),this.OnAnimationStart=e,this._OnAnimationStart=e,this.OnAnimationEnd=t,this._OnAnimationEnd=t,this.OnViewNoVisible=n,this._OnViewNoVisible=n,this._AttachedGroup=null,this._InheritListener=[]}return h(i,[{key:"AddInherit",value:function(e){if(e){if(0===this._InheritListener.length){var n=this;this.OnAnimationStart=function(){n._OnAnimationStart&&n._OnAnimationStart();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnAnimationStart&&this._InheritListener[e].OnAnimationStart()},this.OnAnimationEnd=function(e){n._OnAnimationEnd&&n._OnAnimationEnd(e);for(var t=0;t<this._InheritListener.length;t++)this._InheritListener[t].OnAnimationEnd&&this._InheritListener[t].OnAnimationEnd(e)},this.OnViewNoVisible=function(){n._OnViewNoVisible&&n._OnViewNoVisible();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnViewNoVisible&&this._InheritListener[e].OnViewNoVisible()}}this._InheritListener.push(e)}}}]),i}();m.AnimationListener=oe,m.AnimationManager=function(){function e(){w(this,e),this._EndAckAnimationList=[],this._StartingAnimationList=[],this._CancelingAnimationIdList=[],this._SyncInfo={EndAck:null,Start:null,Cancel:null},this._ActiveAnimationList={},this._IdTokenGenerator=1}return h(e,[{key:"GenerateIdToken",value:function(){return this._IdTokenGenerator++}},{key:"CreateBaseSetting",value:function(e,t,n,i){var r=null;return i&&(r=i.Pacakge()),{ID:e,Nam:t,V_C:0,Dur:Math.floor(n),E:r,En:-1,Set:null,Dly:0}}},{key:"UpdateIdToken",value:function(e,t){e.ID=t}},{key:"ScheduleSyncEndAckAnimation",value:function(e){this._EndAckAnimationList.push(e.IdToken),m.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncStartingAnimation",value:function(e){this._StartingAnimationList.push(e),m.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncCancelAnimation",value:function(e){if(this._ActiveAnimationList[""+e.IdToken])this._CancelingAnimationIdList.push(e.IdToken),delete this._ActiveAnimationList[""+e.IdToken],m.sRenderBridge.RequestSwap();else for(var t=this._StartingAnimationList.length-1;0<=t;t--)this._StartingAnimationList[t].IdToken===e.IdToken&&this._StartingAnimationList.splice(t,1)}},{key:"ProcessViewHideEvents",value:function(e){for(var t=e.length,n=0;n<t;n++){var i=this._ActiveAnimationList[""+e[n]];i&&i.OnViewHide()}}},{key:"ProcessEndEvents",value:function(e){for(var t=e.length,n=0;n<t;n++){var i=this._ActiveAnimationList[""+e[n]];i&&(i.OnEnd(),delete this._ActiveAnimationList[""+e[n]])}}}]),e}(),m.sAnimationManager=null,m.AnimationDelegate=function(){v(a,m.AnimationBase);var r=y(a);function a(e,t,n){var i;return w(this,a),(i=r.call(this)).IdToken=m.sAnimationManager.GenerateIdToken(),i._SettingInfo=m.sAnimationManager.CreateBaseSetting(i.IdToken,e,t,n),i._Enable=-1,i._AnimationUsed=!1,i}return h(a,[{key:"SetAnimationListener",value:function(e){d(s(a.prototype),"SetAnimationListener",this).call(this,e),this.AnimationListenerObj&&this.AnimationListenerObj.OnViewNoVisible?this._SettingInfo.V_C=1:this._SettingInfo.V_C=0}},{key:"EnableDelay",value:function(e){return this._SettingInfo.Dly=e,this}},{key:"EnableInfinite",value:function(){return this._SettingInfo.Rpt=-1,this}},{key:"SetRepeat",value:function(e){return this._SettingInfo.Rpt=e,this}},{key:"SetForceSmooth",value:function(e,t){isNaN(t)&&(t=50),(t<10||60<t)&&m.LogE("Fps rate should be 10 ~ 60"),e?this._SettingInfo.Mfr=t:delete this._SettingInfo.Mfr}},{key:"Start",value:function(e){this._AnimationUsed&&(m.sAnimationManager.ScheduleSyncCancelAnimation(this),this.IdToken=m.sAnimationManager.GenerateIdToken(),m.sAnimationManager.UpdateIdToken(this._SettingInfo,this.IdToken)),m.sAnimationManager.ScheduleSyncStartingAnimation(this),d(s(a.prototype),"Start",this).call(this,e),this._AnimationUsed=!0}},{key:"Cancel",value:function(e){m.sAnimationManager.ScheduleSyncCancelAnimation(this),d(s(a.prototype),"Cancel",this).call(this,e)}},{key:"OnEnd",value:function(){this._Enable===m.AnimationEnable.ReleaseAfterEndCallback&&m.sAnimationManager.ScheduleSyncEndAckAnimation(this),d(s(a.prototype),"OnEnd",this).call(this)}},{key:"GetSetting",value:function(){return this._SettingInfo}},{key:"Clone",value:function(){var e=JSON.parse(JSON.stringify()),t=new m.AnimationDelegate("CLONE",0,null);return e.ID=t._SettingInfo.ID,e.V_C=0,t._SettingInfo=e,t}},{key:"Enable",value:function(e){this._SettingInfo.En=e,this._Enable=e}}]),a}(),m.TranslateAnimation=function(){v(u,m.AnimationDelegate);var l=y(u);function u(e,t,n,i,r,a){var s;w(this,u);var o={X0:e,X1:t,Y0:n,Y1:i};return(s=l.call(this,"TL",r,a))._SettingInfo.Set=o,s}return u}(),m.FuncAnimation=function(){v(s,m.AnimationDelegate);var a=y(s);function s(e,t,n){var i;if(w(this,s),void 0!==window.JsView&&67<=window.JsView.ForgeNativeRevision){var r={F:e};(i=a.call(this,"FC2",t,n))._SettingInfo.Set=r}else(i=a.call(this,"FC",t,n))._SettingInfo.Set={X:"0",Y:"0",Z:"0"};return o(i)}return s}(),m.MultiFactorAnimation=function(){v(o,m.AnimationDelegate);var s=y(o);function o(e,t,n,i){var r;w(this,o);var a={FSA:t,PP:e};return(r=s.call(this,"MF",n,i))._SettingInfo.Set=a,r}return o}(),m.RotateAnimation=function(){v(u,m.AnimationDelegate);var l=y(u);function u(e,t,n,i,r,a){var s;w(this,u),s=l.call(this,"RO",r,a),n instanceof m.Vec3||(n=new m.Vec3(n)),i instanceof m.Vec3||(i=new m.Vec3(i));var o={SA:e,OA:t,AN:n.data,AX:i.data};return s._SettingInfo.Set=o,s}return u}(),m.BasicScaleAnimation=function(){v(f,m.AnimationDelegate);var d=y(f);function f(e,t,n,i,r,a,s,o,l,u){var h;w(this,f),h=d.call(this,"SC",s,o);var c={SW:e=Math.round(e),SH:t=Math.round(t),EW:n=Math.round(n),EH:i=Math.round(i),AX:r,AY:a,BW:l=l?Math.round(l):n,BH:u=u?Math.round(u):i};return h._SettingInfo.Set=c,h}return f}(),m.ScaleAnimation=function(){v(c,m.BasicScaleAnimation);var h=y(c);function c(e,t,n,i,r,a){w(this,c);var s=200*e,o=200*e,l=200*t,u=200*t;return h.call(this,s,o,l,u,n,i,r,a,200,200)}return c}(),m.OpacityAnimation=function(){v(o,m.AnimationDelegate);var s=y(o);function o(e,t,n,i){var r;w(this,o),(r=s.call(this,"OP",n,i))._StartOpacity=e,r._EndOpacity=t,r._OffsetOpacity=t-e;var a={SO:e,EO:t};return r._SettingInfo.Set=a,r}return o}(),m.CssKeyframeAnimation=function(){v(o,m.AnimationDelegate);var s=y(o);function o(e,t,n,i,r){var a;return w(this,o),(a=s.call(this,"CK",t,n))._SettingInfo.Set={Kf:e,VL:{vw:i||0,vh:r||0}},a}return o}(),m.CssTransitionAnimation=function(){v(i,m.AnimationDelegate);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this,"CT",null,null))._SettingInfo.Set={Ts:e},t}return i}(),m.AnimationEnable={ReleaseAfterEndCallback:0},window.TranslateAnimation=m.TranslateAnimation;var le=function(){function r(e,t){w(this,r),this.set(e,t)}return h(r,[{key:"add",value:function(e,t){return e instanceof r?(this.x+=e.x,this.y+=e.y):(this.x+=e||0,this.y+=t||0),this}},{key:"angle",value:function(e){if(void 0!==e)return this.set(this.length(),0).rotate(e);var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"angleDeg",value:function(e){return void 0!==e?this.angle(e/180*Math.PI):180*this.angle()/Math.PI}},{key:"clone",value:function(){return new r(this.x,this.y)}},{key:"cross",value:function(e,t){return e instanceof r?this.x*e.y-this.y*e.x:this.x*t-this.y*e}},{key:"distance",value:function(e,t){var n=this.distanceSq(e,t);if(void 0!==n)return Math.sqrt(n)}},{key:"distanceSq",value:function(e,t){var n,i;if(e instanceof r)n=e.x-this.x,i=e.y-this.y;else{if(void 0===t)return;n=e-this.x,i=t-this.y}return n*n+i*i}},{key:"dot",value:function(e,t){return e instanceof r?this.x*e.x+this.y*e.y:this.x*e+this.y*t}},{key:"equals",value:function(e,t,n){return e instanceof r?(t=t||0,Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t):void 0!==t&&(n=n||0,Math.abs(this.x-e)<=n&&Math.abs(this.y-t)<=n)}},{key:"length",value:function(){return Math.sqrt(this.lengthSq())}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"negate",value:function(){return this.scale(-1)}},{key:"normalize",value:function(){return this.scale(1/this.length())}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(this.x*t-this.y*n,this.x*n+this.y*t)}},{key:"rotateDeg",value:function(e){return this.rotate(e/180*Math.PI)}},{key:"scale",value:function(e,t){return this.x*=e,this.y*=t||e,this}},{key:"set",value:function(e,t){return e instanceof r?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this}},{key:"setPolar",value:function(e,t){return this.set(t,0).rotate(e)}},{key:"setPolarDeg",value:function(e,t){return this.setPolar(e/180*Math.PI,t)}},{key:"sub",value:function(e,t){return void 0!==t?(this.x-=e,this.y-=t):(this.x-=e.x,this.y-=e.y),this}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}}]),r}();function ue(e,t,n){return n=n||0,Math.abs(e-t)<Math.abs(n)}var he=function(e,t){return ue(e,0,t)},ce=function(e,t,n){return t<e?e<n?e:n:t},de=1/3,fe=new le(0,0),ve=1e-4;function ye(e){return"[object Array]"===Object.prototype.toString.call(e)}function ge(e){if(!ye(e))throw"Polygon must be an array of points";switch(u(e[0])){case"number":if(e.length%2!=0)throw"Polygon that contains array of numbers must has even length ([x0, y0, x1, y1, ...., xn, yn])";for(var t=[],n=0;n<e.length;n+=2)t.push(new le(e[n],e[n+1]));return t;case"object":return e.map(ye(e[0])?function(e){return new le(e[0],e[1])}:function(e){return new le(e.x,e.y)});default:throw"Passed polygon is not an array of 2D coordinates"}}function me(a){if(1===a.length)return new le(a[0]);var s=new le(0,0);a.forEach(function(e){return s.add(e)}),s.scale(1/a.length);var o=new le,l=0;return a.forEach(function(e,t){var n=new le(e),i=new le(t+1===a.length?a[0]:a[t+1]);n.add(-s.x,-s.y),i.add(-s.x,-s.y);var r=.5*n.cross(i);l+=r,o.add(n.add(i).scale(de).scale(r))}),he(l,ve)?o.set(a[0]):o.scale(1/l).add(s)}function we(e,t){for(var n=e[0],i=t.dot(e[0]),r=0,a=1;a<e.length;a++)i<(r=t.dot(e[a]))&&(i=r,n=e[a]);return new le(n)}function pe(e,t,n){var i=we(e,n),r=we(t,n.negate());return new le(i.sub(r))}function Te(e,t){var n=new le(0,0),i=new le(e).negate(),r=new le(t).sub(e),a=r.dot(r);if(he(a,ve))return n.set(e);var s=i.dot(r)/a;return s=ce(s,0,1),n.set(r.scale(s).add(e))}function ke(e,t){e=ge(e),t=ge(t);var n,i,r,a=me(e),s=me(t).add(a.negate());n=pe(e,t,s),i=pe(e,t,s.negate());for(var o=0;o<30;o++){var l=Te(n,i);if(he(l.length(),ve))return 0;s.set(l.negate().normalize());var u=(r=pe(e,t,s)).dot(s),h=n.dot(s);if(he(u-h,ve))return u;n.distanceSq(fe)<i.distanceSq(fe)?i=r:n=r}return 0}function Se(e){return 48<=e&&e<=57}function _e(e,t){switch(e){case"translate3d":return Ee.translate(t[0],t[1],t[2]);case"scale3d":return Ee.scale(t[0],t[1],t[2]);case"rotate3d":return Ee.rotate(t[0],t[1],t[2],t[3]);case"skew":return Ee.skew(t[0],t[1]);case"matrix":return Ee.transform2d(t[0],t[1],t[2],t[3],t[4],t[5]);case"matrix3d":return new Ee(4,4,t);default:throw"no support type "+e}}function xe(e){var t=getComputedStyle(e),n=t.transform?t.transform:t.webkitTransform,i=function(e){var t=[];if(!e)return t;for(var n="",i=0;i<e.length;i++){var r=e.charCodeAt(i);!Se(r)&&46!=r&&45!=r||(n+=e[i]),32!=r&&i!=e.length-1||(t.push(parseFloat(n)),n="")}return t}(t.transformOrigin?t.transformOrigin:t.webkitTransformOrigin),r=function(e){var t=Ee.identity();if(!e)return t;for(var n,i="",r="",a=[],s=0,o=0;o<e.length;o++){var l=e.charCodeAt(o);0==s?(65<=(n=l)&&n<=90||97<=n&&n<=122||Se(l))&&(i+=e[o]):!Se(l)&&46!=l&&45!=l&&101!=l||(r+=e[o]),40==l?(s=1,r="",a=[]):41==l?(a.push(parseFloat(r)),t=Ee.multiply(t,_e(i,a)),i="",s=0):44==l&&(a.push(parseFloat(r)),r="")}return t}(n),a=e.parentElement?e.parentElement.getBoundingClientRect():{x:0,y:0},s=parseFloat(t.left.substr(0,t.left.length-2))+a.x,o=parseFloat(t.top.substr(0,t.top.length-2))+a.y,l=parseFloat(t.width.substr(0,t.width.length-2)),u=parseFloat(t.height.substr(0,t.height.length-2)),h=[s,o,0,1,s+l,o,0,1,s,o+u,0,1,s+l,o+u,0,1],c=Ee.translate(-s-i[0],-o-i[1],0),d=Ee.translate(s+i[0],o+i[1],0),f=Ee.multiply(d,Ee.multiply(r,c)),v=Ee.multiply(f,new Ee(4,4,h));return[v.element[0],v.element[1],v.element[4],v.element[5],v.element[8],v.element[9],v.element[12],v.element[13]]}var Re=function(e,t){return he(ke(e,t),ve)},Ee=function(){function g(e,t,n){w(this,g),this.element=n,this.row=e,this.column=t}return h(g,null,[{key:"multiply",value:function(e,t){if(e.column!==t.row)throw"matrix multiply error";for(var n=[],i=0;i<e.row;i++)for(var r=0;r<t.column;r++)for(var a=n[i+r*t.column]=0;a<e.column;a++)n[i+r*t.column]+=e.element[i+a*e.column]*t.element[a+r*t.column];return new g(e.row,t.column,n)}},{key:"identity",value:function(){return new g(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"translate",value:function(e,t,n){return new g(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1])}},{key:"scale",value:function(e,t,n){return new g(4,4,[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1])}},{key:"rotate",value:function(e,t,n,i){var r=Math.cos(i/180*Math.PI),a=Math.sin(i/180*Math.PI),s=Math.sqrt(e*e+t*t+n*n);if(1!=s){var o=1/s;e*=o,t*=o,n*=o}var l=1-r,u=e*t,h=t*n,c=n*e,d=e*a,f=t*a,v=n*a,y=[];return y[0]=e*e*l+r,y[1]=u*l+v,y[2]=c*l-f,y[3]=0,y[4]=u*l-v,y[5]=t*t*l+r,y[6]=h*l+d,y[7]=0,y[8]=c*l+f,y[9]=h*l-d,y[10]=n*n*l+r,y[11]=0,y[12]=0,y[13]=0,y[14]=0,y[15]=1,new g(4,4,y)}},{key:"skew",value:function(e,t){var n=new Array(16).fill(0),i=2*Math.PI*(t/360),r=-2*Math.PI*(e/360);return n[0]=1-r*i,n[1]=-Math.tan(i),n[4]=Math.tan(r),n[5]=1,n[10]=1,n[15]=1,new g(4,4,n)}},{key:"transform2d",value:function(e,t,n,i,r,a){return new g(4,4,[e,t,0,0,n,i,0,0,0,0,1,0,r,a,0,1])}}]),g}(),Ce=function(){function r(e,t,n,i){w(this,r),this._Id=e,this._Element1=t,this._Element2=n,this._Callback=i,this._Contacted=!1,this._Recycled=!1}return h(r,[{key:"Recycle",value:function(){this._Recycled=!0,this._Callback=null,this._Element1=null,this._Element2=null}},{key:"TestCollision",value:function(){this._Recycled||(Re(xe(this._Element1),xe(this._Element2))?this._Contacted||(this._Contacted=!0,this._Callback&&this._Callback.OnBeginContact&&this._Callback.OnBeginContact()):this._Contacted&&(this._Callback&&this._Callback.OnEndContact&&this._Callback.OnEndContact(),this._Contacted=!1))}}]),r}(),be=0,Ie=function(){function e(){w(this,e),this._SensorMap={},this._SensorCount=0}return h(e,[{key:"TestCollision",value:function(){for(var e in this._SensorMap)this._SensorMap[e]._Recycled?(delete this._SensorMap[e],this._SensorCount--):this._SensorMap[e].TestCollision()}},{key:"HasTrace",value:function(){return 0!=this._SensorCount}},{key:"StartTrace",value:function(e,t,n){var i=new Ce(be++,e.Element,t.Element,n);return this._SensorMap[be]=i,this._SensorCount++,m.sRenderBridge.BeginHtmlFrameLoop(),i}}]),e}();m.sImpactSensorManager=new Ie,m.sImpactSensorManager.Callback=function(){return function e(t,n){w(this,e),this.OnBeginContact=t,this.OnEndContact=n}}();var Oe=function(){function l(e,t){if(w(this,l),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",e){if(!0===e.startsWith("url")){var n=e.indexOf("(")+1,i=e.lastIndexOf(")");e=e.substring(n,i).trim()}if(!0!==e.startsWith("data:")){if(!0===e.startsWith("/")&&(e=document.location.origin+e),!0===e.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var r=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,r)}e=window.JsView.React.__MainPath+e.substring(1)}if(this.href=e,t){var a=this.href.indexOf("?"),s=0<a?this.href.substring(0,a):this.href;this.search=1<a?this.href.substring(a):"",a=s.indexOf("://"),this.protocol=0<a?s.substring(0,a+1):"";var o=1<a?s.substring(a+3):"";a=o.indexOf("/"),this.host=0<a?o.substring(0,a):"",this.pathname=1<a?o.substring(a):"",this.origin=0<a?this.protocol+"//"+this.host:"",a=this.host.indexOf(":"),this.hostname=0<a?this.host.substring(0,a):"",this.port=1<a?this.host.substring(a+1):"",console.log("create total parse URL, this=",this)}}else this.href=e}}return h(l,[{key:"replace",value:function(e){this.href=e}}]),l}(),Ae=function(){function o(){w(this,o)}return h(o,null,[{key:"SetBackgroundColor",value:function(e,t,n){var i,r=o.TextureManager.GetColorTexture(t);n&&(i=new m.ViewRoundCornerMask(n.topLeft,n.topRight,n.bottomLeft,n.bottomRight));var a=new m.TextureSetting(r,i);e.ResetTexture(a)}},{key:"SetBackgroundImage",value:function(e,t,n,i){if("string"==typeof t&&(t=new Oe(t)),t instanceof Oe==!1)throw Error("Bad Argument.",t);var r,a=o.TextureManager.GetImage(t.href);n&&(r=new m.ViewRoundCornerMask(n.topLeft,n.topRight,n.bottomLeft,n.bottomRight));var s=new m.ExternalTextureSetting(a,r);e.ResetTexture(s),i&&a.RegisterLoadImageCallback(null,function(){i({width:a.Width,height:a.Height})})}},{key:"SetVideoTexture",value:function(e,t,n){var i,r=o.TextureManager.GetColorTexture(t);n&&(i=new m.ViewRoundCornerMask(n.topLeft,n.topRight,n.bottomLeft,n.bottomRight));var a=new m.TextureSetting(r,i);e.ResetTexture(a)}},{key:"GetTextWidth",value:function(e){return e.str||(e.str=""),e.font||(e.font=m.TextUtils._sDefaultFont),e.size||(e.size=m.TextUtils._sDefaultFontSize),"italic"!==e.italic&&(e.italic=""),"bold"!==e.bold&&(e.bold=""),window.PlatformUtils.GetTextWidth(e)}},{key:"RequestSwap",value:function(){m.sRenderBridge.RequestSwap()}},{key:"SetImgTexSize",value:function(e,t){var n={size:t,refNum:0};o.TextureInfo.Cache[e.Source]=n}},{key:"RefImgTexSize",value:function(i,r){var e=o.TextureInfo.Cache[i.Source];e?(0<e.refNum?e.refNum++:e.refNum=1,r(e.size)):i.RegisterLoadImageCallback(null,function(){var e={width:i.Width,height:i.Height};r(e);var t=o.TextureInfo.Cache[i.Source];if(t)0<t.refNum?t.refNum++:t.refNum=1;else{var n={size:e,refNum:1};o.TextureInfo.Cache[i.Source]=n}})}},{key:"UnrefImgTexSize",value:function(e){if(e){var t=o.TextureInfo.Cache[e.Source];t&&(t.refNum--,t.refNum<=0&&o.TextureInfo.Unused.add(e.Source))}}},{key:"ClearUnusedTexSize",value:function(){var e,t=p(o.TextureInfo.Unused);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=o.TextureInfo.Cache[n];i.refNum<-2?(delete o.TextureInfo.Cache[n],o.TextureInfo.Unused.delete(n)):i.refNum<=0?i.refNum--:o.TextureInfo.Unused.delete(n)}}catch(e){t.e(e)}finally{t.f()}}}]),o}();Ae.TextureInfo={Cache:{},Unused:new Set},Ae.TextureManager=null,Ae.RootView=null,Ae.RootActivity=null,Ae.HaltKeyEvent=!1;var Le=function(){function n(e){w(this,n),this.type=e,this.cachedValues=null,this.onSyncCallback=null}return h(n,[{key:"setOnSyncCallback",value:function(e){this.onSyncCallback=e,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(e,t){this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t,this.syncLastCaches(!1),Ae.RequestSwap()}},{key:"syncLastCaches",value:function(e){var t=n.LastModified[this.type];!e&&t===this||(n.LastModified[this.type]=this,t&&t.cachedValues&&"function"==typeof t.onSyncCallback&&(t.onSyncCallback(t.cachedValues),t.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){console.log("JsvLazySyncCache.SyncAllCachedProperty()");for(var e=0,t=Object.values(n.LastModified);e<t.length;e++){t[e].syncLastCaches(!0)}}}]),n}();Le.LastModified={};var Me=function(){function e(){w(this,e),this._ScreenInfo={width:160,height:90,x:.0125,y:2/90,perspective:.0125,scaleRatio:1,designedWidth:1280},this._FrameLoopFunc=null}return h(e,[{key:"BeginHtmlFrameLoop",value:function(){null==this._FrameLoopFunc&&window.requestAnimationFrame&&(this._FrameLoopFunc=this._OnAnimation.bind(this),window.requestAnimationFrame(this._FrameLoopFunc))}},{key:"_OnAnimation",value:function(){m.sImpactSensorManager.TestCollision();var e=!1;m.sImpactSensorManager.HasTrace()&&(e=!0),e?window.requestAnimationFrame(this._FrameLoopFunc):this._FrameLoopFunc=null}},{key:"GetScreenInfo",value:function(){return this._ScreenInfo}},{key:"InitScreenBuffer",value:function(e,t){isNaN(e)&&(e=1),isNaN(t)&&(t=1280);var n=t*e,i=n/16*9;this._ScreenInfo.width=Math.floor(n),this._ScreenInfo.height=Math.floor(i),this._ScreenInfo.x=2/this._ScreenInfo.width,this._ScreenInfo.y=2/this._ScreenInfo.height,this._ScreenInfo.perspective=this._ScreenInfo.x,this._ScreenInfo.scaleRatio=e,this._ScreenInfo.designedWidth=t}},{key:"RequestSwap",value:function(){this._OnRequesting||(this._OnRequesting=!0,this._SwapTimer=m.PersistTimer.setTimeout(this._DoRequestSwap.bind(this),0))}},{key:"_DoRequestSwap",value:function(){Le.SyncAllCachedProperty(),Ae.ClearUnusedTexSize(),this._OnRequesting=!1}},{key:"InstantPerformSwap",value:function(){this._OnRequesting&&(this._OnRequesting=!1,0<this._SwapTimer&&(m.PersistTimer.clearTimeout(this._SwapTimer),this._SwapTimer=-1),this._DoRequestSwap(!1))}}]),e}();m.RenderBridge=Me,m.sRenderBridge=new m.RenderBridge,m.sAnimationManager=new m.AnimationManager;var Ve=function(){function t(e){w(this,t),this.ownerDocument=window.document,this.nodeType=e,this.parentNode=null,this.jsvEventListener=null}return h(t,[{key:"appendChild",value:function(e){e.parentNode=this}},{key:"removeChild",value:function(e){e.parentNode=null}},{key:"insertBefore",value:function(e){e.parentNode=this}},{key:"addEventListener",value:function(e,t){this.jsvEventListener||(this.jsvEventListener={});var n=this.jsvEventListener[e];n||(n=new Set,this.jsvEventListener[e]=n),n.add(t)}},{key:"removeEventListener",value:function(e,t){if(this.jsvEventListener){var n=this.jsvEventListener[e];n&&(n.delete(t),n.size<=0&&this.jsvEventListener.hasOwnProperty(e)&&delete this.jsvEventListener[e],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(e){if(this.jsvEventListener){var t=this.jsvEventListener[e.type];if(t){e.target||(e.target=document.activeElement);var n,i=p(t);try{for(i.s();!(n=i.n()).done;){(0,n.value)(e)}}catch(e){i.e(e)}finally{i.f()}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No event added.")}}]),t}();Ve.ELEMENT_NODE=1,Ve.TEXT_NODE=3,Ve.DOCUMENT_NODE=9;var Pe=function(){function t(e){w(this,t),this.target=null,this.timeStamp=Date.now(),this.type=e}return h(t,[{key:"initEvent",value:function(e){this.type=e}}]),t}(),je=function(){v(t,Pe);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return t}();je.Type={FOCUS:"focus",BLUR:"blur"};function Fe(e){if(w(this,Fe),this.top=null,this.right=null,this.bottom=null,this.left=null,e&&!1!==e.startsWith("inset")){var t=e.indexOf("(")+1,n=e.substring(t),i=Be.ConvertRect(n);this.top=i.top,this.right=i.right,this.bottom=i.bottom,this.left=i.left}else console.error("Inset.Parse() InvalidArgs: value=",e)}function Ne(e){if(w(this,Ne),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,e){var t=e.indexOf(")")+1,n=e.substring(0,t),i=e.substring(t);this.source=new Oe(n),this.slice=Be.ConvertRect(i)}else console.error("BorderImage.constructor() InvalidArgs: value=",e)}var De=function(){v(t,Pe);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return t}(),Be=function(){function g(){w(this,g)}return h(g,null,[{key:"ConvertFloat",value:function(e){return!e||"string"!=typeof e?e:parseFloat(e)}},{key:"ConvertPx",value:function(e){return!e||"string"!=typeof e?e:"0"===e?0:e.endsWith("px")?parseInt(e):e}},{key:"ConvertRect",value:function(e){var t=g.SplitString(e," "),n={top:0<t.length?parseInt(t[0]):0,right:1<t.length?parseInt(t[1]):null,bottom:2<t.length?parseInt(t[2]):null,left:3<t.length?parseInt(t[3]):null};return n.right=n.right||0===n.right?n.right:n.top,n.bottom=n.bottom||0===n.bottom?n.bottom:n.top,n.left=n.left||0===n.left?n.left:n.right,n}},{key:"ConvertCorner",value:function(e){var t=g.SplitString(e," "),n={topLeft:0<t.length?parseInt(t[0]):0,topRight:1<t.length?parseInt(t[1]):null,bottomRight:2<t.length?parseInt(t[2]):null,bottomLeft:3<t.length?parseInt(t[3]):null};return n.topRight=n.topRight||0===n.topRight?n.topRight:n.topLeft,n.bottomRight=n.bottomRight||0===n.bottomRight?n.bottomRight:n.topLeft,n.bottomLeft=n.bottomLeft||0===n.bottomLeft?n.bottomLeft:n.bottomRight,n}},{key:"ConvertSize",value:function(e){var t=g.SplitString(e," "),n={width:0<t.length?parseInt(t[0]):0,height:1<t.length?parseInt(t[1]):null};return n.height=n.height||0===n.height?n.height:n.width,n}},{key:"ConvertAnimation",value:function(e){if(null===e||0===e.length)return null;var t=e.indexOf("cubic-bezier"),n=[];if(0<=t){var i,r=e.indexOf(")"),a=e.substring(t,r+1),s=p(g.SplitString(e,a));try{for(s.s();!(i=s.n()).done;){var o=i.value,l=g.SplitString(o," ");n=n.concat(l)}}catch(e){s.e(e)}finally{s.f()}n.push(a)}else n=g.SplitString(e," ");for(var u=null,h=0,c=1,d=e.includes("alternate"),f=2;f<n.length;f++)if("infinite"!==n[f]){var v=g.ConvertTimeMs(n[f]);!1===isNaN(v)?h=v:(v=parseFloat(n[f]),!1===isNaN(v)?c=v:u=n[f])}else c=-1;var y=1<n.length?g.ConvertTimeMs(n[1]):0;return{name:0<n.length?n[0]:"",duration:y,timingFunction:g.ConvertEasing(u,y),delay:h,iterationCount:c,direction:d}}},{key:"ConvertTransition",value:function(e){if(null==e||0==e.length)return null;for(var t={},n=new Array,i=e.split(","),r=0;r<i.length;r++)if(0<=i[r].indexOf("(")){for(var a=r;a<i.length&&i[a].indexOf(")")<0;)a++;for(var s="",o=r;o<=a;o++)o!=r&&(s+=","),s+=i[o];r=a,n=n.concat(s)}else n=n.concat(i[r]);var l,u=p(n);try{for(u.s();!(l=u.n()).done;){var h=l.value,c=g.ConvertAnimation(h);if("all"==(t[c.name]=c).name)for(var d=new Array("opacity","left","top","width","height"),f=0,v=d;f<v.length;f++){t[v[f]]=c}}}catch(e){u.e(e)}finally{u.f()}return t}},{key:"ConvertTimeMs",value:function(e){var t=NaN;return(e=(e=e||"").trim()).endsWith("ms")?t=1:e.endsWith("s")&&(t=1e3),t*=parseFloat(e)}},{key:"ConvertEasing",value:function(e,t){var n=m.Easing.Circular.InOut;if(!e)return n;if(e.includes("ease"))n=e.includes("-in-out")?m.Easing.Circular.InOut:e.includes("-out")?m.Easing.Circular.Out:e.includes("-in")?m.Easing.Circular.In:m.Easing.Circular.InOut;else if(e.includes("linear"))n=null;else if(e.includes("cubic-bezier")){var i=g.ConvertBezier(e);n=new m.BezierEasing(i.x1,i.y1,i.x2,i.y2,t)}else if(e.includes("steps")){var r=g.ConvertSteps(e);n=new m.StepsEasing(r.steps,r.type)}return n}},{key:"ConvertBezier",value:function(e){var t=e.indexOf("(");0<=t&&(e=e.substring(t+1));var n=g.SplitString(e,",");return{x1:0<n.length?parseFloat(n[0]):0,y1:1<n.length?parseFloat(n[1]):0,x2:2<n.length?parseFloat(n[2]):0,y2:3<n.length?parseFloat(n[3]):0}}},{key:"ConvertSteps",value:function(e){var t=e.indexOf("(");0<=t&&(e=e.substring(t+1));var n=g.SplitString(e,",");return{steps:0<n.length?parseInt(n[0]):1,type:!(1<n.length)||n[1].includes("start")?0:1}}},{key:"ConvertOverflow",value:function(e){return(e=e||"").includes("hidden")?Ge.Overflow.HIDDEN:Ge.Overflow.VISIBLE}},{key:"ConvertObjectFit",value:function(e){return(e=e||"").includes("fill")?Ge.ObjectFit.FILL:e.includes("contain")?Ge.ObjectFit.CONTAIN:e.includes("cover")?Ge.ObjectFit.COVER:e.includes("none")?Ge.ObjectFit.NONE:e.includes("scale-down")?Ge.ObjectFit.SCALEDOWN:Ge.ObjectFit.CONTAIN}},{key:"SplitString",value:function(e,t){var n=(e=e||"").trim().split(t);if(" "!==t)return n;var i,r=[],a=p(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;s&&r.push(s)}}catch(e){a.e(e)}finally{a.f()}return r}}]),g}(),Ge=function(){function i(){w(this,i),this.jsvStore={},this.jsvLazySyncCache=new Le("style")}return h(i,[{key:"setProperty",value:function(e,t){if("function"==typeof document.jsvCheckStyleFormat&&document.jsvCheckStyleFormat(e,t),t=this.jsvConvertPropValue(e,t),this.jsvStore[e]!==t){this.jsvStore[e]=t;var n=i.JsvGetStyleType(e);this.jsvLazySyncCache.setCacheProperty(n,void 0)}}},{key:"getPropertyValue",value:function(e){return this.jsvStore[e]}},{key:"jsvSetChangedListener",value:function(r){this.jsvLazySyncCache.setOnSyncCallback(function(e){for(var t={},n=0,i=Object.keys(e);n<i.length;n++){t[i[n]]=!0}r(t)})}},{key:"jsvConvertPropValue",value:function(e,t){switch(e){case i.PROP.VISIBILITY:return t.toUpperCase();case i.PROP.OVERFLOW:return Be.ConvertOverflow(t);case i.PROP.OBJECTFIT:return Be.ConvertObjectFit(t);case i.PROP.TRANSFORM:return t;case i.PROP.CLIPPATH:return new Fe(t);case i.PROP.BORDERIMAGE:return new Ne(t);case i.PROP.BORDERIMAGEWIDTH:case i.PROP.BORDERIMAGEOUTSET:return Be.ConvertRect(t);case i.PROP.BORDERRADIUS:return Be.ConvertCorner(t);case i.PROP.ANIMATION:return Be.ConvertAnimation(t);case i.PROP.TRANSITION:return Be.ConvertTransition(t);case i.PROP.OPACITY:return Be.ConvertFloat(t);default:return Be.ConvertPx(t)}}}],[{key:"JsvGetStyleType",value:function(e){switch(e){case i.PROP.LEFT:case i.PROP.RIGHT:case i.PROP.TOP:case i.PROP.BOTTOM:return i.TYPE.LAYOUT_POS;case i.PROP.WIDTH:case i.PROP.HEIGHT:case i.PROP.VISIBILITY:case i.PROP.CLIPPATH:case i.PROP.OVERFLOW:case i.PROP.OBJECTFIT:case i.PROP.TRANSFORM:return i.TYPE.LAYOUT_SIZE;case i.PROP.BACKGROUNDCOLOR:case i.PROP.BACKGROUNDIMAGE:case i.PROP.BORDERRADIUS:return i.TYPE.BACKGROUND;case i.PROP.COLOR:case i.PROP.LINEHEIGHT:case i.PROP.WHITESPACE:case i.PROP.FONTFAMILY:case i.PROP.FONTSIZE:case i.PROP.FONTSTYLE:case i.PROP.FONTWEIGHT:case i.PROP.TEXTALIGN:case i.PROP.TEXTSHADOW:case i.PROP.TEXTOVERFLOW:return i.TYPE.FOREGROUND;case i.PROP.BORDERIMAGE:case i.PROP.BORDERIMAGEWIDTH:case i.PROP.BORDERIMAGEOUTSET:return i.TYPE.BORDER;case i.PROP.ANIMATION:return i.TYPE.ANIMATION;case i.PROP.TRANSITION:return i.TYPE.TRANSITION;case i.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+e),null}}}]),i}();Ge.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation",TRANSITION:"transition"},Ge.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},Ge.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},Ge.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function Ue(e){var t=Ge.PROP[e];Object.defineProperty(Ge.prototype,t,{set:function(e){this.setProperty(t,e)},get:function(){return this.getPropertyValue(t)}})}for(var We in Ge.PROP)Ue(We);var He=function(){v(l,Ve);var n=y(l);function l(e){var t;return w(this,l),(t=n.call(this,Ve.ELEMENT_NODE)).parentElement=null,t.tagName=t.constructor.name.replace("Element","").toUpperCase(),t.childElementCount=0,t.childNodes=[],t.firstElementChild=null,t.lastElementChild=null,t.tagName===l.TAG.STYLE?(t.style=null,t.jsvMainView=null):(t.style=new Ge,t.jsvMainView=new m.LayoutView),t.jsvMaskView=null,t.jsvAnimation=null,t.jsvStore={transition:null,textContent:null,clientWidth:null},t.jsvLazySyncCache=new Le("element"),t.instantSwapCallback=null,t}return h(l,[{key:"appendChild",value:function(e){if(d(s(l.prototype),"appendChild",this).call(this,e),(e.parentElement=this).firstElementChild||(this.firstElementChild=e),this.lastElementChild=e,this.childNodes.push(e),this.childElementCount++,e.nodeType===Ve.ELEMENT_NODE&&e.tagName!==l.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);e.jsvOnLoadForgeView(),e.style.jsvSetChangedListener(e.jsvOnStyleChanged.bind(e));var t=e.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(e.jsvMaskView,t)}}},{key:"removeChild",value:function(e){d(s(l.prototype),"removeChild",this).call(this,e),e.parentElement=null,e instanceof l&&(e.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(e.jsvMaskView))}},{key:"insertBefore",value:function(e,t){d(s(l.prototype),"appendChild",this).call(this,e,t),(e.parentElement=this).appendChild(e)}},{key:"setAttribute",value:function(e,t){console.log("Element.setAttribute() name="+e+", value=",t),this[e]=t,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,t)}},{key:"removeAttribute",value:function(e){this[e]=void 0,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,void 0)}},{key:"getAttribute",value:function(e){return this[e]}},{key:"hasAttribute",value:function(e){return console.log("Element.hasAttribute() name="+e),!!this[e]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var e=document.activeElement;if(document.activeElement=this,e){var t=new je(je.Type.BLUR);t.target=e,document.dispatchEvent(t)}var n=new je(je.Type.FOCUS);document.dispatchEvent(n)}},{key:"jsvOnLoadForgeView",value:function(){var t=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new m.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(e){t.jsvMainView.SetElementProp(e,Ae.RootActivity)})}},{key:"jsvOnUnloadForgeView",value:function(){this.jsvMainView&&this.jsvMainView.ClearViews()}},{key:"jsvOnStyleChanged",value:function(e){var t=!!e[Ge.TYPE.LAYOUT_SIZE];console.log("cchtest jsvOnStyleChanged ",e),e[Ge.TYPE.LAYOUT_POS]&&(t||this.jsvFlushViewLayout()),e[Ge.TYPE.LAYOUT_SIZE]&&this.jsvFlushViewLayout(),e[Ge.TYPE.BACKGROUND]&&this.jsvFlushViewBackground(),e[Ge.TYPE.ANIMATION]&&this.jsvFlushViewAnimation(),e[Ge.TYPE.TRANSITION]&&(this.jsvStore.transition=null,this.jsvFlushViewTransition())}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var e={x:this.style.left,y:this.style.top,width:this.style.width,height:this.style.height};if(this.jsvMaskView.ResetLayoutParams(e),this.jsvMaskView.ResetCssTransform(this.style.transform),this.jsvMaskView!==this.jsvMainView){var t={x:0,y:0,width:e.width,height:e.height};this.jsvMainView.ResetLayoutParams(t)}this.jsvMaskView.SetVisibility(this.style.visibility);var n=null;this.style.clipPath?n={x:this.style.clipPath.left,y:this.style.clipPath.top,width:e.width-this.style.clipPath.left-this.style.clipPath.right,height:e.height-this.style.clipPath.top-this.style.clipPath.bottom}:!this.style.objectFit&&this.style.overflow!==Ge.Overflow.HIDDEN||(n={x:0,y:0,width:this.style.width,height:this.style.height}),n&&this.jsvMaskView.SetClipRect(n.x,n.y,n.width,n.height,!0),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&Ae.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius),this.style.backgroundImage&&Ae.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius)}},{key:"jsvFlushViewAnimation",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.animation){var e=document.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation=new m.CssKeyframeAnimation(e,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var n=this,t=new m.AnimationListener(null,function(e){if(e){var t=new De("animationend");t.target=n,document.dispatchEvent(t),null==n.instantSwapCallback&&(n.instantSwapCallback=m.sRenderBridge.InstantPerformSwap.bind(m.sRenderBridge)),Promise.resolve().then(n.instantSwapCallback)}},null);this.jsvAnimation.Enable(m.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(t),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.transition){this.jsvStore.transition||(this.jsvStore.transition={});var e=[];for(var t in this.style.transition){var n=this.jsvStore.transition[t],i=this.style[t];if(this.jsvStore.transition[t]=i,void 0!==n&&n!==i){var r=this.style.transition[t],a={name:t,dur:r.duration,tf:null,dly:r.delay,from:n,to:i};r.timingFunction&&(a.tf=r.timingFunction.Pacakge()),e.push(a)}}e.length<=0||(this.jsvAnimation=new m.CssTransitionAnimation(e),this.jsvMaskView.StartAnimation(this.jsvAnimation))}}},{key:"clientWidth",get:function(){return this.style.width}}],[{key:"JsvFitViewLayout",value:function(e,t,n){var i={x:0,y:0,width:e.width,height:e.height},r={width:0,height:0},a=e.width/e.height,s=t.width/t.height;if(!s)return i;if(!a){if(0===e.width||0===e.height)return i;0===a?e.width=e.height*s:isNaN(a)&&(e.height=e.width/s),a=e.width/e.height}if(!a)return i.width=t.width,i.height=t.height,i;switch(n=n||Ge.ObjectFit.CONTAIN){case Ge.ObjectFit.FILL:r.width=e.width,r.height=e.height;break;case Ge.ObjectFit.NONE:r.width=t.width,r.height=t.height;break;case Ge.ObjectFit.COVER:r=l.JsvStretchSize(e,s,s<a);break;case Ge.ObjectFit.SCALEDOWN:var o=a<s;e.width>t.width&&e.height>t.height&&(o=s<a),r=l.JsvStretchSize(e,s,o);break;case Ge.ObjectFit.CONTAIN:r=l.JsvStretchSize(e,s,a<s);break;default:throw Error("Unexpected object-fit.")}return i.x=(e.width-r.width)/2,i.y=(e.height-r.height)/2,i.width=r.width,i.height=r.height,i}},{key:"JsvStretchSize",value:function(e,t,n){var i={width:0,height:0};return n?(i.width=e.width,i.height=e.width/t):(i.height=e.height,i.width=e.height*t),i}}]),l}();He.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},He.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};function ze(e){w(this,ze);var t=e.indexOf(ze.KeyFramesFlag)+ze.KeyFramesFlag.length,n=e.indexOf("{"),i=e.substring(t,n);this.name=i.trim(),this.cssText=e}var Ye=function(){v(n,He);var t=y(n);function n(){var e;return w(this,n),(e=t.call(this)).jsvContentView=null,e.jsvRefedImgTex=null,e}return h(n,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new m.NinePatchView),d(s(n.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){d(s(n.prototype),"jsvOnUnloadForgeView",this).call(this),Ae.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(e){d(s(n.prototype),"jsvOnStyleChanged",this).call(this,e);var t=!!e[Ge.TYPE.FOREGROUND];e[Ge.TYPE.LAYOUT_SIZE]&&(t||this.jsvFlushViewForeground()),e[Ge.TYPE.FOREGROUND]&&this.jsvFlushViewForeground(),e[Ge.TYPE.BORDER]&&this.jsvFlushViewBorder()}},{key:"jsvFlushViewForeground",value:function(){var n=this;if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var e=this.jsvGetTextParams(),t=void 0===this.style.height||0==this.style.height,i=t?function(e,t){n.clientHeight=e.height}:null,r=new m.TextViewEx(Ae.TextureManager,e,this.jsvStore.textContent,!0,i);t&&r.EnableAutoHeight();var a=r.GetLayoutView();this.jsvContentView.AddView(a)}}},{key:"jsvFlushViewBorder",value:function(){if(this.jsvMaskView)if(this.style.clipPath)console.error("BorderImage is conflicting with ClipPath.");else if(this.style.borderImage){Ae.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex&&this.jsvRefedImgTex.Source===this.style.borderImage.source.href||(this.jsvRefedImgTex=Ae.TextureManager.GetImage(this.style.borderImage.source.href));var e=Be.ConvertPx(this.getAttribute("jsv-borderimage-width")),t=Be.ConvertPx(this.getAttribute("jsv-borderimage-height"));e&&t&&(console.log("Custom cache image size with: "+e+"/"+t),Ae.SetImgTexSize(this.jsvRefedImgTex,{width:e,height:t})),Ae.RefImgTexSize(this.jsvRefedImgTex,function(e){var t=this.style.borderImageOutset?this.style.borderImageOutset:Be.ConvertRect();this.jsvMaskView.SetPadding({start:t.left,width:e.width-t.left-t.right},{start:t.top,width:e.height-t.top-t.bottom});var n=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:n.left,width:e.width-n.left-n.right}],[{start:n.top,width:e.height-n.top-n.bottom}]);var i=new m.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(i)}.bind(this))}}},{key:"jsvGetTextParams",value:function(){var e={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"nowrap"===this.style.whiteSpace?"none":"normal"},t={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top"},n=this.style.textShadow?this.style.textShadow.split(" "):void 0;n&&(t.shadow={shadowOffsetX:parseInt(n[0]),shadowOffsetY:parseInt(n[1]),shadowBlur:parseInt(n[2]),shadowColor:n[3]});var i=this.style.fontSize?this.style.fontSize+4:14;this.style.lineHeight&&(i=this.style.lineHeight);var r=new m.TextViewParams;r.SetTextAttr(e),r.SetFontStyle(t),r.SetLineHeight(i);var a=this.style.width;return void 0===a&&(a=this.clientWidth),r.SetViewSize(new m.RectArea(0,0,a,this.style.height)),r}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(e){this.jsvStore.textContent=e,this.jsvStore.clientWidth=null,this.jsvContentView||(this.jsvContentView=new m.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var e=this.style.width;if(e||0===e)return e;if(this.jsvStore.textContent){if(this.jsvStore.clientWidth||0===this.jsvStore.clientWidth)return this.jsvStore.clientWidth;var t={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=Ae.GetTextWidth(t),this.jsvStore.clientWidth}return d(s(n.prototype),"clientWidth",this)}}]),n}(),Je=function(){v(n,He);var e=y(n);function n(){return w(this,n),e.apply(this,arguments)}return h(n,[{key:"setAttribute",value:function(e,t){d(s(n.prototype),"setAttribute",this).call(this,e,t),e===He.ATTRIBUTE.SRC&&Ae.SetBackgroundImage(this.jsvMainView,t,this.style.borderRadius,this.jsvOnLoaded.bind(this))}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(He.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(e){var t={width:this.style.width,height:this.style.height},n=He.JsvFitViewLayout(t,e,this.style.objectFit);this.style.left&&(n.x+=this.style.left),this.style.top&&(n.y+=this.style.top),this.jsvMainView.ResetLayoutParams(n)}}]),n}();ze.KeyFramesFlag="@keyframes";var qe=function(){function t(e){w(this,t),this.jsvCssRules=null,this.jsvTextContent=e}return h(t,[{key:"insertRule",value:function(e,t){if(console.log("StyleSheet.insertRule() rule="+e),void 0===t&&(t=this.jsvCssRules.length),e.indexOf(ze.KeyFramesFlag)<0)throw Error("StyleSheet.insertRule() Rule is not supported except keyframes.");var n=new ze(e);this.jsvCssRules.splice(t,0,n)}},{key:"deleteRule",value:function(e){console.log("StyleSheet.deleteRule() index="+e),this.jsvCssRules.splice(e,1)}},{key:"cssRules",get:function(){if(this.jsvCssRules)return this.jsvCssRules;if(this.jsvCssRules=new Array,this.jsvTextContent.indexOf(ze.KeyFramesFlag)<0)return this.jsvCssRules;var e=this.jsvTextContent.split(ze.KeyFramesFlag);for(var t in e)0!=t&&this.insertRule(ze.KeyFramesFlag+e[t]);return this.jsvCssRules}}]),t}(),Xe=function(){v(i,He);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this,e)).textContent=null,t}return h(i,[{key:"appendChild",value:function(e){d(s(i.prototype),"appendChild",this).call(this,e);var t=new qe(e.textContent);document.jsvAppendStyleSheet(t)}},{key:"removeChild",value:function(e){throw d(s(i.prototype),"removeChild",this).call(this,e),Error("Failed to removeChild, unimplement!.")}}]),i}(),Ke=function(){v(r,m.LayoutView);var i=y(r);function r(e,t){var n;return w(this,r),(n=i.call(this,e,t))._DetachListener=null,n}return h(r,[{key:"registerDetachListener",value:function(e){this._DetachListener=e}},{key:"unRegisterDetachListener",value:function(){this._DetachListener=null}},{key:"_OnDetachFromSystem",value:function(){console.log("JsvMediaView _OnDetachFromSystem"),this._DetachListener&&this._DetachListener()}}]),r}(),Ze=function(){v(i,He);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this)).jsvMediaView=null,t.jsvMedia=null,e&&(t.src=e),t}return h(i,[{key:"addEventListener",value:function(e,t,n){d(s(i.prototype),"addEventListener",this).call(this,e,t,n),this.jsvAddMediaListener(e)}},{key:"jsvOnLoaded",value:function(){this.jsvMediaView=new Ke,this.jsvMediaView.registerDetachListener(this.jsvOnUnloadForgeView.bind(this)),this.jsvMainView.AddView(this.jsvMediaView)}},{key:"jsvOnLoadForgeView",value:function(){console.log("MediaElement jsvOnLoadForgeView"),d(s(i.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){console.log("MediaElement jsvOnUnloadForgeView"),this.jsvMediaView&&(this.jsvMediaView.unRegisterDetachListener(),this.jsvMediaView=null),d(s(i.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){var e=this.jsvEventListener;if(e)for(var t in e.keys)this.jsvAddMediaListener(t)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.pause(),this.jsvMedia.unload&&this.jsvMedia.unload(),this.jsvMedia.releaseResource&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy())),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(t){var n=this;this.jsvMedia||this.jsvInit(),this.jsvMedia.addEventListener(t,function(){var e=new Pe(t);e.target=n,d(s(i.prototype),"dispatchEvent",n).call(n,e)})}},{key:"src",set:function(e){e=e&&new Oe(e).href;this.jsvMedia||this.jsvInit(),e!==this.jsvMedia.src&&(this.jsvMedia.src=e)}}]),i}();for(var Qe in Ze.HOOKS={Audio:Audio,Video:OffscreenVideoPlayer},Ze.PROP={SetOnly:["autoplay","loop"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},Ze.PROP){var $e,et=p(Ze.PROP[Qe]);try{var tt=function(){var t=$e.value,e={};"SetOnly"!==Qe&&"SetAndGet"!==Qe||(e.set=function(e){this.jsvMedia||this.jsvInit(),this.jsvMedia[t]=e}),"GetOnly"!==Qe&&"SetAndGet"!==Qe||(e.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[t]}),"Function"===Qe&&(e=function(){var e;return this.jsvMedia||this.jsvInit(),this.jsvMedia[t]?(e=this.jsvMedia)[t].apply(e,arguments):null}),e instanceof Function?Ze.prototype[t]=e:Object.defineProperty(Ze.prototype,t,e)};for(et.s();!($e=et.n()).done;)tt()}catch(e){et.e(e)}finally{et.f()}}var nt=function(){v(i,Ze);var n=y(i);function i(e){var t;return w(this,i),t=n.call(this,e),console.log("AudioElement.constructor()",c(t)),t}return h(i,[{key:"jsvInit",value:function(){this.jsvMedia=new Ze.HOOKS.Audio,d(s(i.prototype),"jsvInit",this).call(this),this.jsvOnLoaded()}},{key:"jsvRelease",value:function(){d(s(i.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),i}(),it=function(){v(i,Ze);var n=y(i);function i(e){var t;return w(this,i),t=n.call(this,e),console.log("VideoElement.constructor()",c(t)),t}return h(i,[{key:"jsvOnStyleChanged",value:function(e){d(s(i.prototype),"jsvOnStyleChanged",this).call(this,e),e[Ge.TYPE.LAYOUT_SIZE]&&this.jsvFlushVideoView()}},{key:"jsvFlushVideoView",value:function(){if(this.jsvMediaView){var e={width:this.style.width,height:this.style.height},t={width:this.jsvMedia.videoWidth,height:this.jsvMedia.videoHeight},n=He.JsvFitViewLayout(e,t,this.style.objectFit);this.jsvMediaView.ResetLayoutParams(n)}}},{key:"jsvInit",value:function(){this.jsvMedia=new Ze.HOOKS.Video,this.addEventListener("load",this.jsvOnLoaded.bind(this)),d(s(i.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){d(s(i.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(d(s(i.prototype),"jsvOnLoaded",this).call(this),this.jsvMediaView){var e=Ae.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),t=new m.TextureSetting(e);this.jsvMediaView.ResetTexture(t)}this.jsvFlushVideoView()}}]),i}();for(var rt in it.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},it.PROP){var at,st=p(it.PROP[rt]);try{var ot=function(){var t=at.value,e={};"SetOnly"!==rt&&"SetAndGet"!==rt||(e.set=function(e){this.media[t]=e}),"GetOnly"!==rt&&"SetAndGet"!==rt||(e.get=function(){return this.media[t]}),it.prototype[t]=e};for(st.s();!(at=st.n()).done;)ot()}catch(e){st.e(e)}finally{st.f()}}var lt=function(){function e(){w(this,e),this.src=null,this.onerror=null,this.onload=null,this.charset=null,this.timeout=120}return h(e,[{key:"setAttribute",value:function(e,t){console.log("ScriptElement.setAttribute() name="+e+", value=",t),this[e]=t}},{key:"jsvActiveScript",value:function(){if(null!=this.src){var e=new Oe(this.src);console.log("load script with url="+e.href);var n=this;window.JsView.runJsWithUrl(e.href,!1,function(e,t){n.onLoadResult(e,t)})}}},{key:"onLoadResult",value:function(e,t){console.log("onLoadResult "+e+" "+t),e?this.onload&&this.onload():this.onerror&&this.onerror({type:"jsvErr_"+t,target:this})}}]),e}(),ut=function(){v(t,He);var e=y(t);function t(){return w(this,t),e.apply(this,arguments)}return t}(),ht=function(){v(i,He);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this)).jsvMainView=new m.JsvElementView(e),t}return h(i,[{key:"setAttribute",value:function(e,t){d(s(i.prototype),"setAttribute",this).call(this,e,t),this.jsvMainView.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){d(s(i.prototype),"removeAttribute",this).call(this,e),this.jsvMainView.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.jsvMainView.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.jsvMainView.hasAttribute(e)}},{key:"jsvOnStyleChanged",value:function(e){d(s(i.prototype),"jsvOnStyleChanged",this).call(this,e)}},{key:"textContent",get:function(){return this.jsvMainView.textContent},set:function(e){this.jsvMainView.textContent=e}}]),i}(),ct=function(){v(i,Ve);var n=y(i);function i(e){var t;return w(this,i),(t=n.call(this,Ve.TEXT_NODE)).textContent=e,t}return i}(),dt=function(){function e(){w(this,e),console.log("Document header construct")}return h(e,[{key:"appendChild",value:function(e){e instanceof lt&&(console.log("Found append script in head."),e.jsvActiveScript())}},{key:"removeChild",value:function(){console.warn("Failed to header.removeChild, unimplemented!.")}}]),e}(),ft=function(){v(n,Ve);var t=y(n);function n(){var e;return w(this,n),(e=t.call(this,Ve.DOCUMENT_NODE)).location=window.location,e.rootElement=new Ye,e.rootElement.ownerDocument=c(e),e.rootElement.id="root",e.activeElement=e.rootElement,e.cookie="",e.styleSheets=new Array,e.jsvIsReady=!1,e.head=new dt,e}return h(n,[{key:"createElement",value:function(e){switch(e){case n.DIV_ELEMENT:case n.FDIV_ELEMENT:return new Ye;case n.IMG_ELEMENT:case n.FIMG_ELEMENT:return new Je;case n.STYLE_ELEMENT:return new Xe;case n.AUDIO_ELEMENT:return new nt;case n.VIDEO_ELEMENT:return new it;case n.SCRIPT_ELEMENT:return console.log("Document.createElement() create script"),window.JsView?new lt:window.originDocument.createElement("script");default:return 0!==e.indexOf("jsv")||window.JsView?(console.warn("Document.createElement() unknown name="+e),new ut(e)):new ht(e)}}},{key:"createTextNode",value:function(e){return console.log("Document.createTextNode() text="+e),new ct(e)}},{key:"createEvent",value:function(e){return new Pe(e)}},{key:"getElementById",value:function(e){if("root"===e||"app"===e)return this.rootElement;throw Error("Document.getElementById() id="+e+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(e){if("head"===e||"#app"===e)return this.rootElement;throw Error("Document.querySelector() selectors="+e+" is UNIMPLEMENTED.")}},{key:"jsvAppendStyleSheet",value:function(e){document.styleSheets.push(e)}},{key:"jsvGetKeyFrames",value:function(e){var t,n=p(this.styleSheets);try{for(n.s();!(t=n.n()).done;){var i,r=p(t.value.cssRules);try{for(r.s();!(i=r.n()).done;){var a=i.value;if(a.name==e)return a.cssText}}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}var s,o="@keyframes ",l=o+e,u=p(this.styleSheets);try{for(u.s();!(s=u.n()).done;){var h=s.value,c=h.jsvTextContent,d=c.indexOf(l);if(!(d<0)){var f=c.indexOf("-keyframes",d+1),v=c.indexOf(o,d+1);v<0&&(v=c.length),0<f&&f<v&&(v=f);var y=c.substring(d,v);return h.insertRule(y,0),y}}}catch(e){u.e(e)}finally{u.f()}return null}},{key:"jsvUpdateRootElement",value:function(e){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=e,this.jsvIsReady=!0}}]),n}();ft.DIV_ELEMENT="div",ft.IMG_ELEMENT="img",ft.STYLE_ELEMENT="style",ft.VIDEO_ELEMENT="video",ft.AUDIO_ELEMENT="audio",ft.SCRIPT_ELEMENT="script",ft.FIMG_ELEMENT="fimg",ft.FDIV_ELEMENT="fdiv";var vt=function(){function n(){w(this,n)}return h(n,null,[{key:"_isUndefined",value:function(e,t){var n=void 0===t;return n&&console.error(e+" property is undefined!"),n}},{key:"_keyframesCheck",value:function(e,t){n._isUndefined(e,t)||t.indexOf("transform")<0&&t.indexOf("opacity")<0&&console.error("keyframes property is only support transform and opacity, value:",t)}},{key:"_clipPathCheck",value:function(e,t){n._isUndefined(e,t)||t.startsWith("inset")||console.error("clipPath property is support inset only.")}},{key:"_transitionOtherCheck",value:function(e,t){n._isUndefined(e,t)||console.error(e+" property is not support, you can use transition property, e.g. transition='width 2s'")}},{key:"_transitionCheck",value:function(e,t){n._isUndefined(e,t)}},{key:"_transformCheck",value:function(e,t){n._isUndefined(e,t)||t.indexOf("translate3d")<0&&t.indexOf("scale3d")<0&&t.indexOf("rotate3d")<0&&t.indexOf("skew")<0&&console.error("transform property's value only support translate3d、scale3d、rotate3d、skew, value:",t)}},{key:"_textOverflowCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"clip":case"ellipsis":break;default:console.error("textOverflow property's value is not support, value:",t)}}},{key:"_whiteSpaceCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"normal":case"nowrap":break;default:console.error("whiteSpace property's value is not support, value:",t)}}},{key:"_textAlignCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"left":case"right":case"center":break;default:console.error("textAlign property's value is not support, value:",t)}}},{key:"_lineHeightCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"normal":case"inherit":console.error("lineHeight property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("lineHeight property's value is support number only, value:",t)}}},{key:"_colorCheck",value:function(e,t){n._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("color property value is not valid, need startwith rgba or #, value:",t))}},{key:"_visibilityCheck",value:function(e,t){n._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&"inherit"!==t&&console.error("visibility property's value is not support, value:",t)}},{key:"_overflowCheck",value:function(e,t){n._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&console.error("overflow property's value is support visible or hidden only, value:",t)}},{key:"_topCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("top property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("top property's value is support number only, value:",t)}}},{key:"_leftCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("left property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("left property's value is support number only, value:",t)}}},{key:"_heightCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("height property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("height property's value is support number only, value:",t)}}},{key:"_widthCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("width property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("width property's value is support number only, value:",t)}}},{key:"_fontSizeCheck",value:function(e,t){if(!n._isUndefined(e,t))switch(t){case"smaller":case"larger":case"inherit":case"x-small":case"xx-small":case"small":case"large":case"medium":case"x-large":case"xx-large":console.error("fontSize property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("fontSize property's value is support number only, value:",t)}}},{key:"_fontWeightCheck",value:function(e,t){n._isUndefined(e,t)||"bold"!==t&&console.error("fontWeight property's value is support bold only, value:",t)}},{key:"_fontStyleCheck",value:function(e,t){n._isUndefined(e,t)||"italic"!==t&&console.error("fontWeight property's value is support italic only, value:",t)}},{key:"_borderRadiusCheck",value:function(e,t){n._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderRadius property's value is not support, value:",t)}},{key:"_borderImageWidthCheck",value:function(e,t){n._isUndefined(e,t)}},{key:"_borderImageOutsetCheck",value:function(e,t){n._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderImageOutsetCheck property's value is not support, value:",t)}},{key:"_borderImageCheck",value:function(e,t){n._isUndefined(e,t)||t.indexOf("fill")<0&&console.error("borderImage property's value is not contain fill, e.g. source slice, but value:",t)}},{key:"_backgroundOtherCheck",value:function(e){console.error(e+" property not support, you can use backgroundImage property, e.g. backgroundImage=`url(${iconImgPath})`")}},{key:"_backgroundImageCheck",value:function(e,t){n._isUndefined(e,t)||"inherit"==t&&console.error("backgroundImage property's value is not support, value:",t)}},{key:"_backgroundColorCheck",value:function(e,t){n._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("backgroundColor property value is not valid, need startwith rgba or #, value:",t))}},{key:"_animationCheck",value:function(){}},{key:"_animationOtherNotSupport",value:function(e){console.error(e+" property is not support, you can use animation property, e.g. animation='mymove 5s infinite'")}},{key:"get",value:function(e){return n.ValidStyleMap[e]}}]),n}();vt.ValidStyleMap={animation:{check:vt._animationCheck.bind(vt)},animationName:{check:vt._animationOtherNotSupport.bind(vt)},animationDuration:{check:vt._animationOtherNotSupport.bind(vt)},animationTimingFunction:{check:vt._animationOtherNotSupport.bind(vt)},animationDelay:{check:vt._animationOtherNotSupport.bind(vt)},animationIterationCount:{check:vt._animationOtherNotSupport.bind(vt)},animationDirection:{check:vt._animationOtherNotSupport.bind(vt)},animationPlayState:{check:vt._animationOtherNotSupport.bind(vt)},animationFillMode:{check:vt._animationOtherNotSupport.bind(vt)},background:{check:vt._backgroundOtherCheck.bind(vt)},backgroundColor:{check:vt._backgroundColorCheck.bind(vt)},backgroundImage:{check:vt._backgroundImageCheck.bind(vt)},borderImage:{check:vt._borderImageCheck.bind(vt)},borderImageOutset:{check:vt._borderImageOutsetCheck.bind(vt)},borderImageWidth:{check:vt._borderImageWidthCheck.bind(vt)},borderRadius:{check:vt._borderRadiusCheck.bind(vt)},height:{check:vt._heightCheck.bind(vt)},width:{check:vt._widthCheck.bind(vt)},fontFamily:{check:null},fontSize:{check:vt._fontSizeCheck.bind(vt)},fontStyle:{check:vt._fontStyleCheck.bind(vt)},fontWeight:{check:vt._fontWeightCheck.bind(vt)},left:{check:vt._leftCheck.bind(vt)},overflow:{check:vt._overflowCheck.bind(vt)},top:{check:vt._topCheck.bind(vt)},visibility:{check:vt._visibilityCheck.bind(vt)},color:{check:vt._colorCheck.bind(vt)},lineHeight:{check:vt._lineHeightCheck.bind(vt)},textAlign:{check:vt._textAlignCheck.bind(vt)},whiteSpace:{check:vt._whiteSpaceCheck.bind(vt)},textOverflow:{check:vt._textOverflowCheck.bind(vt)},transform:{check:vt._transformCheck.bind(vt)},transition:{check:vt._transitionCheck.bind(vt)},transitionProperty:{check:vt._transitionOtherCheck.bind(vt)},transitionDuration:{check:vt._transitionOtherCheck.bind(vt)},transitionTimingFunction:{check:vt._transitionOtherCheck.bind(vt)},transitionDelay:{check:vt._transitionOtherCheck.bind(vt)},clipPath:{check:vt._clipPathCheck.bind(vt)},keyframes:{check:vt._keyframesCheck.bind(vt)}};var yt=new ft;window.document.createElement=yt.createElement.bind(yt),window.document.createTextNode=yt.createTextNode.bind(yt),window.document.getElementById=yt.getElementById.bind(yt),window.document.querySelector=yt.querySelector.bind(yt),window.document.createEvent=yt.createEvent.bind(yt),console.log("Hook Document ..."),window.document.dispatchEvent=yt.dispatchEvent.bind(yt),window.document.jsvAppendStyleSheet=function(e){var t=window.originDocument.createElement("style");t.type="text/css",t.innerHTML=e.jsvTextContent,this.getElementsByTagName("Head")[0].appendChild(t)},window.document.jsvGetKeyFrames=function(e){for(var t="",n=document.styleSheets,i=0;i<n.length;++i){var r=n[i];if(r.cssRules)for(var a=0;a<r.cssRules.length;++a){var s=r.cssRules[a];if(s&&s.name===e){t=s.cssText;break}}}return t&&document.jsvCheckStyleFormat("keyframes",t),t},window.document.jsvCheckStyleFormat=function(e,t){var n=vt.get(e);n?n.check&&n.check(e,t):console.error(e+" property is not support.")},Ae.TextureManager=new m.TextureManager,Ae.RootView=new m.RootView,yt.jsvUpdateRootElement(Ae.RootView),console.log("Using JsView HTML")});
