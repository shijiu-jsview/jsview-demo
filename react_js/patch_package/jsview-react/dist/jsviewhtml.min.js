!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).jsviewreact={},e.React)}(this,function(e,a){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a,void 0===window.Forge&&(window.Forge={});var y=window.Forge;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],0<=t.indexOf(i)||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function v(n){return function(){var e,t=c(n);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(e){return}}}()){var i=c(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return l(this,e)}}function f(e,t,i){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function O(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return m(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?m(e,t):void 0}}(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}console.log("Define Forge ..."),window.originDocument={},window.originDocument.createElement=window.document.createElement.bind(window.document),window.originDocument.createTextNode=window.document.createTextNode.bind(window.document),window.originDocument.getElementById=window.document.getElementById.bind(window.document),window.originDocument.querySelector=window.document.querySelector.bind(window.document),window.originDocument.createEvent=window.document.createEvent.bind(window.document),window.originDocument.dispatchEvent=window.document.dispatchEvent.bind(window.document);var t=function(){function r(){g(this,r)}return h(r,null,[{key:"getTextPixelWith",value:function(e,t){null===r.sCanvas&&(r.sCanvas=window.originDocument.createElement("canvas"));var i=r.sCanvas.getContext("2d");i.font=t;var n=i.measureText(e);return Math.ceil(n.width)}},{key:"GetTextWidth",value:function(e){return this.getTextPixelWith(e.str,e.size+"px "+e.font)}},{key:"GetTextRect",value:function(e,t,i,n,r){var s=Math.ceil(i.size*e.length/t.width)*r;return s>t.height&&(s=t.height),{width:t.width,height:s}}}]),r}();t.sCanvas=null,window.PlatformUtils=t;var s=function(){function t(){g(this,t),this.state={}}return h(t,[{key:"buildPlatformInstance",value:function(){var e=this;this.VideoEle=window.originDocument.createElement("VIDEO"),this.VideoEle.addEventListener("loadedmetadata",function(){e.hasOwnProperty("onload")&&e.onload(),e.hasOwnProperty("onloadedmetadata")&&e.onloadedmetadata()})}},{key:"addEventListener",value:function(t,e){var i=this;this["on"+t]=e,this.VideoEle.addEventListener(t,function(e){i["on"+t](e)})}},{key:"load",value:function(){this.VideoEle.load()}},{key:"pause",value:function(){this.VideoEle.pause(),this.setState("paused",!0,"boolean"),this.hasOwnProperty("onpause")&&this.onpause()}},{key:"play",value:function(){this.setState("paused",!1,"boolean"),this.VideoEle.play(),this.hasOwnProperty("onplay")&&this.onplay()}},{key:"unload",value:function(){this.setState("paused",!0,"boolean"),this.VideoEle.isRenderable=!1,this.VideoEle.unload()}},{key:"setState",value:function(e,t,i){u(t)===i?(this.VideoEle.setAttribute(e,t),this.state[e]=t,console.log("set "+e+" = "+t)):console.warn("invalid paramter type to set "+e+". value is not "+i)}},{key:"getState",value:function(e){var t=this.state[e];return console.log("get "+e+" = "+t),void 0===t&&(t=this.VideoEle.getAttribute(e),this.state[e]=t),t}},{key:"onError",value:function(e){this.VideoEle.isRenderable=!1,this.hasOwnProperty("onerror")&&this.onerror(e.currentTarget.error.code)}},{key:"mediaHandler",value:function(){return this.VideoEle}},{key:"autoplay",set:function(e){e&&this.play()}},{key:"currentTime",get:function(){return this.VideoEle.currentTime},set:function(e){this.VideoEle.isRenderable=!1,this.VideoEle.currentTime=e,this.setState("seek",e,"number")}},{key:"duration",get:function(){return this.VideoEle.duration}},{key:"loop",set:function(e){this.VideoEle.loop="boolean"!=typeof e||e}},{key:"muted",get:function(){return this.getState("muted")},set:function(e){this.setState("muted",e,"boolean")}},{key:"paused",get:function(){return this.VideoEle.paused}},{key:"playbackRate",get:function(){return this.getState("rate")},set:function(e){this.setState("rate",e,"number")}},{key:"src",set:function(e){this.setState("src",e,"string")}},{key:"style",get:function(){var t=this;return{set bottom(e){t.setState("style",'{"bottom":"'+e+'"}',"string")},set left(e){t.setState("style",'{"left":"'+e+'"}',"string")},set right(e){t.setState("style",'{"right":"'+e+'"}',"string")},set top(e){t.setState("style",'{"top":"'+e+'"}',"string")},set height(e){t.setState("style",'{"height":"'+e+'"}',"string")},set width(e){t.setState("style",'{"width":"'+e+'"}',"string")}}}},{key:"volume",get:function(){return this.getState("volume")},set:function(e){this.setState("volume",e,"number")}},{key:"playableDuration",get:function(){return this.VideoEle.playableDuration}}],[{key:"setDesignMapWidth",value:function(e){"number"==typeof e?t.prototype.designMapWidth=e:console.warn("Invalid paramter type to set "+e+". It is not number.")}}]),t}();s.prototype.designMapWidth=0;var _=function(){p(i,s);var t=v(i);function i(){var e;return g(this,i),(e=t.call(this))._ReleaseCallbacks=[],e._ResourceTerminater=null,f(c(i.prototype),"buildPlatformInstance",d(e)).call(d(e)),e}return h(i,[{key:"setResourceTerminator",value:function(e){this._ResourceTerminater=e}},{key:"hasTerminator",value:function(){return null!=this._ResourceTerminater}},{key:"listenToRelease",value:function(e){this._ReleaseCallbacks.push(e)}},{key:"unload",value:function(){f(c(i.prototype),"unload",this).call(this),null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"releaseResource",value:function(){for(var e=0;e<this._ReleaseCallbacks.length;e++)this._ReleaseCallbacks[e]();null!=this._ResourceTerminater&&this._ResourceTerminater(),this._ResourceTerminater=null}},{key:"onPlatformDestroy",value:function(){}}]),i}();window.OffscreenVideoPlayer=_,y.LogF=function(e){},y.LogE=function(e){},y.LogW=function(e){},y.LogI=function(e){},y.LogD=function(e){},y.LogM=function(e){},y.ThrowError=function(e){throw new Error(e)},y.Assert=function(e){if(!e)throw new Error("ASSERT!!!!!")},y.EnableLog=function(e){y.LogM=console.log.bind(console),0<e&&(y.LogF=console.error.bind(console)),1<e&&(y.LogE=console.error.bind(console)),2<e&&(y.LogW=console.warn.bind(console)),3<e&&(y.LogI=console.log.bind(console)),4<e&&(y.LogD=console.debug.bind(console))};var w=function(){function r(e,t,i,n){g(this,r),this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return h(r,[{key:"Equals",value:function(e){return null!==e&&(e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height)}}]),r}();y.RectArea=w;y.Coordinate=function e(t,i){g(this,e),this.x=t,this.y=i};y.Size=function e(t,i){g(this,e),this.width=t,this.height=i};var S=function(){function e(){g(this,e)}return h(e,[{key:"FormatRectArea",value:function(e){var t=null;if(e instanceof y.RectArea)t=e;else if("object"===u(e)&&null!==e){if(isNaN(e.width)||isNaN(e.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");t=new y.RectArea(0,0,e.width,e.height)}return t}}]),e}();y.RectUtils=S,y.sRectUitls=new y.RectUtils;var b=function(){function d(){g(this,d)}return h(d,[{key:"StringWithFont",value:function(e,t,i,n,r,s,a,o,l,u){var h="";!0===a&&(h="italic");var c="";return!0===o&&(c="bold"),{str:""+e,font:i=i||d._sDefaultFont,size:t=t||d._sDefaultFontSize,italic:h,bold:c,stroke_width:u=u||-1,alignment:n=n||"left",vertical_align:r=r||"middle",textColour:s=s||d._sDefaultFontColor,backgroundColour:d._sDefaultBackgroundColor,enableBlend:!0,shadow:l=l||null}}},{key:"TextAttr",value:function(e,t){return{text_overflow:e=e||"none",word_wrap:t=t||"none"}}},{key:"GetTextWidth",value:function(e){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextWidth(e):e.str.length*e.size+1}},{key:"GetTextRect",value:function(e,t,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextRect(e,t,i,n,r):{width:t.width,height:t.height}}},{key:"GetTextInfo",value:function(e,t,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextInfo(e,t,i,n,r):{start:0,end:e.length,width:t.width,height:t.height}}},{key:"GetCursorOffset",value:function(e,t,i,n,r,s,a){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorOffset(e,t,i,n,r,s,a):0}},{key:"GetCursorPosition",value:function(e,t,i,n,r,s){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorPosition(e,t,i,n,r,s):{x:0,y:0}}}]),d}();b._sDefaultFont="黑体",b._sDefaultFontSize=30,b._sDefaultFontColor="#FFFFFF",b._sDefaultBackgroundColor="rgba(0, 0, 0, 0)",y.TextUtils=b,y.sTextUtils=new y.TextUtils,y.TextShaderType={LinearGradient:0,Image:1};y.TextShader=function e(t,i){g(this,e),this.Type=t,this.Params=i};var k=function(){function t(){g(this,t);var e=(new y.LayoutView).GetRenderer();this._Renderer=e,this.StringWithFont=y.sTextUtils.StringWithFont("",0,void 0,"center","middle",void 0,!1,!1,void 0),this.RectArea=new y.RectArea(0,0,0,0),this.TextAttr=y.sTextUtils.TextAttr("ellipsis","none"),this.Marquee=null,this.Shader=null,this.IsInstantLoad=!0,this.LineHeight=0}return h(t,[{key:"SetInstantLoad",value:function(e){return this.IsInstantLoad=e,this}},{key:"SetStringWithFont",value:function(e){return this.StringWithFont=e,this}},{key:"SetFontStyle",value:function(e,t,i,n,r,s,a,o,l){return"object"===u(e)?this.StringWithFont=y.sTextUtils.StringWithFont("",void 0!==e.size?e.size:10,void 0!==e.font?e.font:"宋体",void 0!==e.hAlign?e.hAlign:"center",void 0!==e.vAlign?e.vAlign:"middle",void 0!==e.textColor?e.textColor:"#000000",void 0!==e.italic&&e.italic,void 0!==e.bold&&e.bold,void 0!==e.shadow?e.shadow:null):this.StringWithFont=y.sTextUtils.StringWithFont("",e,t,i,n,r,s,a,o,l),this}},{key:"SetRectArea",value:function(e){return e instanceof y.RectArea?this.RectArea=e:this.RectArea=new y.RectArea(e.x,e.y,e.width,e.height),this}},{key:"SetViewSize",value:function(e){return e instanceof y.RectArea||(e=new y.RectArea(e.x,e.y,e.width,e.height)),this.SetRectArea(e),0===this.LineHeight&&0!==e.height&&(this.LineHeight=e.height),this}},{key:"SetTextAttr",value:function(e){var t,i;return t=e.hasOwnProperty("textOverflow")?e.textOverflow:e.hasOwnProperty("text_overflow")?e.text_overflow:"clip",i=e.hasOwnProperty("wordWrap")?e.wordWrap:e.hasOwnProperty("word_wrap")?e.word_wrap:"none",this.TextAttr={word_wrap:i,text_overflow:t},this}},{key:"SetMarquee",value:function(e){return e&&(this.Marquee={repetition:"infinite",direction:"left",speed:"normal"},e.repetition&&(this.Marquee.repetition=e.repetition),e.direction&&(this.Marquee.direction=e.direction),e.speed&&(this.Marquee.speed=e.speed)),this}},{key:"SetShader",value:function(e){return this.Shader=e,this}},{key:"SetLineHeight",value:function(e){return this.LineHeight=e,this}},{key:"Clone",value:function(){var e=new t;return e.StringWithFont=this.StringWithFont,e.RectArea=this.RectArea,e.TextAttr=this.TextAttr,e.LineHeight=this.LineHeight,e}}]),t}();y.TextViewParams=k,window.TextViewParams=y.TextViewParams;var I=function(){function f(e,t,i,n){g(this,f),this._layoutView=null,this._textWidth=0,this._textViewReahHeight=0,this._marqueeRunning=!0,this._marqueeCurrentNum=2,this._textView=null,this._TextViewParams=t,this._NeedQuick=void 0!==n&&n,this._marquee=t.Marquee,this._rectArea=t.RectArea,this._DrawCount=0,this._ShowInterval=0,this._TextureManager=e,this._Shader=t.Shader,this._IsInstantLoad=t.IsInstantLoad?1:0;var r,s,a=this,o=t.RectArea.width,l=t.RectArea.height,u=null;null!==this._marquee?((u=new y.ClipView).Init(),u.SetClipRect(0,0,o,l,!0),u.SetId("matrixClipLayoutview"),u.OnDettachFromSystem=function(){a._marqueeRunning=!1,y.ClipView.prototype.OnDettachFromSystem.call(this)}):u=new y.LayoutView,r=u.GetRenderer(),this._Renderer=r;var h=i;h=h||t.StringWithFont.str,h=this._ConvertEscToString(h);var c=!1;0<t.StringWithFont.italic.length&&(c=!0);var d=!1;0<t.StringWithFont.bold.length&&(d=!0),s=y.sTextUtils.StringWithFont(h,t.StringWithFont.size,t.StringWithFont.font,t.StringWithFont.alignment,t.StringWithFont.vertical_align,t.StringWithFont.textColour,c,d,t.StringWithFont.shadow,t.StringWithFont.stroke_width),(void 0===t.Marquee||null===t.Marquee)&&this._NeedQuick?this._textWidth=t.RectArea.width-2*t.RectArea.x:this._textWidth=y.sTextUtils.GetTextWidth(s),this.addTextView(u,s,t.TextAttr,t.RectArea,t.Marquee,t.LineHeight),this._layoutView=u,this._TextTexture=null}return h(f,[{key:"_ConvertEscToString",value:function(e){var t=""+e;return-1!==t.indexOf("&quot;")&&(t=t.replace(/&quot;/gi,'"')),-1!==t.indexOf("&amp;")&&(t=t.replace(/&amp;/gi,"&")),-1!==t.indexOf("&lt;")&&(t=t.replace(/&lt;/gi,">")),-1!==t.indexOf("&gt;")&&(t=t.replace(/&gt;/gi,"<")),-1!==t.indexOf("&nbsp;")&&(t=t.replace(/&nbsp;/gi," ")),t}},{key:"addTextView",value:function(e,t,i,n,r,s){var a,o=n.height,l=y.Clone(n),u=null;0!==t.str.length?(a=this._TextureManager.GetTextTextureByMultiRows(t,i,l,s,this._NeedQuick,this._Shader,this._IsInstantLoad),this._TextTexture=a.texture,this._textViewReahHeight=a.real_height,(u=new y.LayoutView).Init(new y.TextureSetting(a.texture,null,null,!0)),u.SetId("Text-"+t.str),e.AddView(u,new y.LayoutParams({x:0,y:0,width:l.width,height:o})),this._textView=u):(this._textViewReahHeight=0,y.LogI("t_StringWithFont.str.length is 0"))}},{key:"GetLayoutView",value:function(){return this._layoutView}},{key:"GetTextWidth",value:function(){return this._textView?this._textView.Div.clientWidth:Math.floor(this._textWidth+.5)}},{key:"StartAnimation",value:function(e){e&&null!==this._textView&&this._textView.StartAnimation(e)}}]),f}();y.TextViewEx=I,y.TextViewControl=I,y.Clone=function(e){var t=JSON.stringify(e);return JSON.parse(t)},window.Clone=y.Clone;var T=function(){function e(){g(this,e),this._AlreadyExited=!1,window.PersistTimer&&(this._AlreadyExited=!0)}return h(e,[{key:"setTimeout",value:function(e,t){return this._AlreadyExited&&window.PersistTimer.setTimeout?window.PersistTimer.setTimeout(e,t):window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){this._AlreadyExited&&window.PersistTimer.clearTimeout?window.PersistTimer.clearTimeout(e):window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){if(!this._AlreadyExited||!window.PersistTimer.setInterval)return window.setInterval(e,t);window.PersistTimer.setInterval(e,t)}},{key:"clearInterval",value:function(e){this._AlreadyExited&&window.PersistTimer.clearInterval?window.PersistTimer.clearInterval(e):window.clearInterval(e)}}]),e}();y.PersistTimer=new T;var x=function(){function e(){g(this,e)}return h(e,[{key:"setTimeout",value:function(e,t){return window.setTimeout(e,t)}},{key:"clearTimeout",value:function(e){window.clearTimeout(e)}},{key:"setInterval",value:function(e,t){return window.setInterval(e,t)}},{key:"clearInterval",value:function(e){window.clearInterval(e)}}]),e}();y.ForegroundTimer=new x,y.EasingTypeIn=0,y.EasingTypeOut=1,y.EasingTypeInOut=2,y.EasingTypeBezier=3,y.EasingTypeBlink=4,y.EasingTypeDeceleration=5;var E=function(){function e(){g(this,e)}return h(e,[{key:"Package",value:function(){}},{key:"_GetBasePackage",value:function(e){return{T:e,St:null}}}]),e}();y.EasingBase=E;var R=function(){p(t,y.EasingBase);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeIn)}}]),t}();y.EasingIn=R;var L=function(){p(t,y.EasingBase);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeOut)}}]),t}();y.EasingOut=L;var C=function(){p(t,y.EasingBase);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeInOut)}}]),t}();y.EasingInOut=C;var A=function(){p(t,y.EasingBase);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeDeceleration)}}]),t}();y.EasingDeceleration=A;var P=function(){p(t,y.EasingBase);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeBlink)}}]),t}();y.EasingBlink=P;var F=function(){p(o,y.EasingBase);var a=v(o);function o(e,t,i,n,r){var s;return g(this,o),(s=a.call(this))._Inited=!1,s._X1=e,s._X2=i,s._Y1=t,s._Y2=n,s._Duration=r,s}return h(o,[{key:"Pacakge",value:function(){var e=this._GetBasePackage(y.EasingTypeBezier);return e.St={X1:this._X1,X2:this._X2,Y1:this._Y1,Y2:this._Y2,Dur:this._Duration},e}}]),o}();y.BezierEasing=F,y.Easing={Circular:{In:new y.EasingIn,Out:new y.EasingOut,InOut:new y.EasingInOut,Deceleration:new y.EasingDeceleration}},window.Easing=y.Easing,y.ColorSpace={RGBA_8888:"RGBA_8888",RGBA_4444:"RGBA_4444",RGBA_5551:"RGBA_5551",RGB_565:"RGB_565",RGB_ETC1:"RGB_ETC1",RGBA_ETC1:"RGBA_ETC1"},y.QRCodeLevel={L:1,M:0,Q:3,H:2};var V=function(){function n(e,t,i){g(this,n),this._Manager=e,i&&y.sRenderTextureDelegateManager.CreateTextureStatus().SetResourceInfo(i);this.RenderTexture=y.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(t),this._CallbackIdToken=0,this._OnLoadCallback=[],y.ForgeDebug.EnableTextureTracer&&(e._ImageTextureTracer.push(this),this._TracerDescript="")}return h(n,[{key:"UnloadTex",value:function(){this._OnLoadCallback=[],null!==this.RenderTexture&&(0<this._CallbackIdToken&&(this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken),this._CallbackIdToken=0),this.RenderTexture.UndoRef(),this.RenderTexture=null),this._TracerDescript=""}},{key:"RegisterLoadImageCallback",value:function(e,t,i){this.IsLoaded()&&null!==t?t(i):null!==t&&(this._OnLoadCallback.push({callback:t,params:i}),0===this._CallbackIdToken&&(y.Assert(null!==this.RenderTexture),this._CallbackIdToken=this.RenderTexture.RegisterOnloadCallback(n.prototype._InvokeOnLoadCallbacks.bind(this))))}},{key:"_InvokeOnLoadCallbacks",value:function(){var e=this._OnLoadCallback;this._OnLoadCallback=[];for(var t=0;t<e.length;t++){var i=e[t];i.callback(i.params)}this.RenderTexture&&this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken)}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}},{key:"SetTextureTracerDescript",value:function(e){this._TracerDescript=e}},{key:"ReallocRenderTexture",value:function(){}},{key:"Unloaded",get:function(){return null===this.RenderTexture||this.RenderTexture.Unloaded},set:function(){}},{key:"LoadTime",get:function(){return null!==this.RenderTexture?this.RenderTexture.LoadTime:0},set:function(){}},{key:"Width",get:function(){return null!==this.RenderTexture?this.RenderTexture.Width:0},set:function(){}},{key:"Height",get:function(){return null!==this.RenderTexture?this.RenderTexture.Height:0},set:function(){}}]),n}();y.ImageTexture=V;var M=function(){p(u,y.ImageTexture);var l=v(u);function u(e,t,i,n,r,s){var a;g(this,u);var o=y.sRenderTextureDelegateManager.CreateResourceInfo(e.GetId(),"IMG");return o.Set={URL:t,Siz:n,Clr:r||"",IsF:i?1:0,NtS:s,ILd:0},(a=l.call(this,e,o)).Name="IMG",a.Source=t,a.IsForever=i?1:0,a.TargetSize=n,a.ColorSpace=r||"",a.NetSetting=s||null,a._InstantLoad=0,a._ImageElement=new Image,a._ImageElement.onload=function(){this._Loaded()}.bind(d(a)),a._ImageElement.onerror=function(){this._Loaded()}.bind(d(a)),a._ImageElement.src=t,a.RenderTexture.NeedCheckExpired=!0,a}return h(u,[{key:"_Loaded",value:function(){this.RenderTexture.Unloaded=!1,this.RenderTexture.LoadTime=Date.now(),this.RenderTexture.Width=this._ImageElement.width,this.RenderTexture.Height=this._ImageElement.height,this.RenderTexture.InvokeOnloadCallbacks()}},{key:"InstantLoad",value:function(e){if(this._InstantLoad=e?1:0,this.RenderTexture){var t=this.RenderTexture.GetResourceInfo();null!==t&&(t.Set.ILd=this._InstantLoad,this.RenderTexture.SetResourceInfo(t))}return this}},{key:"ReallocRenderTexture",value:function(){if(this.IsForever)y.LogE("ReallocRenderTexture(): NOT need for forever texture");else{var e=this.Source,t=this.TargetSize,i=this.ColorSpace,n=this.IsForever,r=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Manager.GetId(),this.Name);r.Set={URL:e,Siz:t,Clr:i,IsF:n,ILd:this._InstantLoad},this.RenderTexture=y.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(r),this._Manager.CachedTextureManager.CacheTheTexture(this)}}}]),u}();y.UrlImageTexture=M;var N=function(){function t(e){g(this,t),this._TextureManager=e,this._Renderer=e.GetRenderer(),this._CachedTextureStack=[],this._LockedTextureStack=[],this._MemoryLimited=10485760,this._VisibleMark=1}return h(t,[{key:"SetMemoryLimited",value:function(e){this._MemoryLimited=1024*e*1024}},{key:"_FindTexture",value:function(e,t,i){for(var n=this._CachedTextureStack.length-1;0<=n;n--){var r=this._CachedTextureStack[n];if(r.Source===e&&(t===r.TargetSize||null!==t&&t.Equals(r.TargetSize))&&i===r.ColorSpace){if(null===r.RenderTexture)continue;return r}}return null}},{key:"CacheTheTexture",value:function(e){for(var t=this._CachedTextureStack.length-1;0<=t;t--)if(e===this._CachedTextureStack[t])return;this._CachedTextureStack.push(e)}},{key:"_MarkVisibleViewTextures",value:function(e,t){e.TextureSetting&&e.TextureSetting.Texture&&(e.TextureSetting.Texture.VisibleMark=t);for(var i=e.ChildViews.length,n=0;n<i;n++){var r=e.ChildViews[n];r&&"VISIBLE"!==r.Visibility||this._MarkVisibleViewTextures(r,t)}}},{key:"ReduceInvisibleTexture",value:function(e){this._MarkVisibleViewTextures(e,++this._VisibleMark);for(var t=0;t<this._CachedTextureStack.length;t++){var i=this._CachedTextureStack[t];i.VisibleMark!==this._VisibleMark&&(i.UnloadTex(),this._CachedTextureStack.splice(t,1),t--)}}},{key:"GetCacheSize",value:function(){return this._CachedTextureStack.length}}]),t}();y.CachedTextureManager=N;var j=new Map,D=0,B=new Map,U=0,G=function(){function e(){g(this,e),this.CachedTextureManager=new y.CachedTextureManager(this),this._ForeverCachedTextureManager=new y.CachedTextureManager(this),this._AtlasDataInfo={atlas_data:[],buffer_data_offset:0,textures:[]},this._ClearTimer=-1,this._ImageTextureTracer=[],this._Id=e.sTextureManagerToken++,this._CacheMaxSize=100,this.StartScavengerCachedTimer()}return h(e,[{key:"StartScavengerCachedTimer",value:function(){-1===this._ClearTimer&&(this._ClearTimer=y.ForegroundTimer.setInterval(this.ScavengerCached.bind(this),3e4))}},{key:"GetId",value:function(){return this._Id}},{key:"GetRenderer",value:function(){return y.sDeprecatedRenderer}},{key:"GetImage",value:function(e,t,i){return e?this._GetImageInternal(e,null,y.ColorSpace.RGBA_8888,t,!1,i):(y.LogI("GetImage, url is null!"),null)}},{key:"GetImage2",value:function(e,t,i,n,r){if(!e)return y.LogI("GetImage2, url is null!"),null;var s=y.sRectUitls.FormatRectArea(i);return"string"!=typeof n&&(n=0<=e.indexOf(".pkm")?0<=e.indexOf(".pkma")?y.ColorSpace.RGBA_ETC1:y.ColorSpace.RGB_ETC1:y.ColorSpace.RGB_565),this._GetImageInternal(e,s,n,t,!1,r)}},{key:"_GetImageInternal",value:function(e,t,i,n,r,s){if(n){var a=this._ForeverCachedTextureManager._FindTexture(e,t,i);if(a)return a}else{var o=this.CachedTextureManager._FindTexture(e,t,i);if(o)return o}var l=new y.UrlImageTexture(this,e,n,t,i,s);return l.IsForever?this._ForeverCachedTextureManager.CacheTheTexture(l):this.CachedTextureManager.CacheTheTexture(l),l}},{key:"GetRoundCornerMask",value:function(e,t){return this.GetCustomCornerMask(e,t,t,t,t)}},{key:"GetCustomCornerMask",value:function(e,t,i,n,r){var s=y.sRectUitls.FormatRectArea(e),a=Math.max(t,i,n,r);if(a>s.width/2||a>s.height/2)return y.LogE("TextureManager.GetRoundCornerMask(): radius is too large, radius="+a+" w="+s.width+" h="+s.height),null;var o=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CCM");o.Set={W:s.width,H:s.height,LT:t,RT:i,LB:n,RB:r};var l=new y.ImageTexture(this,o);return y.ForgeDebug.EnableTextureTracer&&l.SetTextureTracerDescript("CornerMask"),l}},{key:"GetOneCornerMask",value:function(e){var t=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"OCM");t.Set={Rad:e};var i=new y.ImageTexture(this,t);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("OneCornerMask"),i}},{key:"_getParamsId",value:function(e,t){var i=e.font,n=e.size,r=e.italic,s=e.bold,a=e.alignment,o=e.vertical_align,l=e.textColour,u=e.backgroundColour,h=e.shadow,c="";e.stroke_width&&(c=e.stroke_width);var d=t.text_overflow,f=t.word_wrap,g=[i,r,s,h,c].join(":"),p=[n,a,o,d,f].join(":"),v="",y="";return j.has(g)?v=j.get(g):(v="TS"+D,j.set(g,v),D++),B.has(p)?y=B.get(p):(y="DS"+U,B.set(p,y),U++),[v,y,l,u]}},{key:"GetTextTextureByMultiRows",value:function(e,t,i,n,r,s,a){var o=e.str;if(null===o||0===o.length)return null;var l=y.sRenderBridge.GetScreenInfo().scaleRatio,u=y.Clone(i);u.x*=l,u.y*=l,u.width*=l,u.height*=l;var h=y.Clone(e);h.size=Math.ceil(h.size*l),n*=l;var c=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"T");if(c.Set={ST:e.str,AT:JSON.stringify({TO:t.text_overflow,WW:t.word_wrap}),RA:JSON.stringify({X:parseInt(u.x+.5),Y:parseInt(u.y+.5),W:parseInt(u.width+.5),H:parseInt(u.height+.5)}),LH:parseInt(n+.5),ILD:void 0!==a?a:1},s&&(c.Set.SH=JSON.stringify({T:s.Type,P:s.Params})),void 0!==window.JsView&&void 0!==window.JsView.ForgeNativeRevision&&0<window.JsView.ForgeNativeRevision){var d=this._getParamsId(h,t,s);c.Set.PI={FS:d[0],DS:d[1],TC:d[2],BC:d[3]}}y.sRenderTextureDelegateManager.AppendFontStatusIfNeed(c.Set,h);var f=null;c.Set.FO&&(f={STA:{Nam:"T",Sta:c.Set.FO}});var g=new y.ImageTexture(this,c,f),p=u.height;void 0!==window.PlatformUtils&&!1===r&&(p=window.PlatformUtils.GetTextRect(o,u,h,t,n).height);if(p=Math.floor(p/l+.5),y.ForgeDebug.EnableTextureTracer){var v=e.str;8<v.length&&(v=e.str.substr(0,8)+"..."),g.SetTextureTracerDescript("["+v+"]")}return{texture:g,real_height:p}}},{key:"GetColorTexture",value:function(e){var t=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CT");t.Set={Clr:e};var i=new y.ImageTexture(this,t);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Color["+e+"]"),i}},{key:"ScavengerCached",value:function(){this.CachedTextureManager.GetCacheSize()>=this._CacheMaxSize&&this.CachedTextureManager.ReduceInvisibleTexture(y.sRootView)}},{key:"GetOffScreenMediaTexture",value:function(e){if(void 0===window.OffscreenVideoPlayer||!(e instanceof window.OffscreenVideoPlayer))return null;if(!e.hasTerminator()){var t=this._BuildVideoTexture(e);e.setResourceTerminator(function(){t.UnloadTex()})}return this._BuildVideoTexture(e)}},{key:"_BuildVideoTexture",value:function(e){var t=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"VPLY");t.Set={Hdl:e.mediaHandler()};var i=new y.ImageTexture(this,t);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Video["+e.mediaHandler()+"]"),i}}]),e}();G.sTextureManagerToken=100,y.TextureManager=G,window.TextureManager=y.TextureManager;var H=function(){function e(){g(this,e)}return h(e,[{key:"SetTextureTracer",value:function(){}},{key:"GetTextureTracer",value:function(){return null}}]),e}();y.LayoutViewDebugClass=H,window.ForgeDebug=y.ForgeDebug=new y.LayoutViewDebugClass;var W=function(){function t(){g(this,t),this.Width=0,this.Height=0,this.MarginTop=0,this.MarginLeft=0,this.MarginRight=0,this.MarginBottom=0,this.Z=0,this.SizeAdjust=!1}return h(t,[{key:"SetPosition",value:function(e,t,i){this.MarginTop=t,this.MarginLeft=e,i&&(this.Z=i)}},{key:"SetSize",value:function(e,t){this.Width=e,this.Height=t}},{key:"Clone",value:function(){var e=new t;return e.Width=this.Width,e.Height=this.Height,e.MarginTop=this.MarginTop,e.MarginLeft=this.MarginLeft,e.MarginRight=this.MarginRight,e.MarginBottom=this.MarginBottom,e.Z=this.Z,e.SizeAdjust=this.SizeAdjust,e}},{key:"Equals",value:function(e){return e.Width===this.Width&&e.Height===this.Height&&e.MarginTop===this.MarginTop&&e.MarginLeft===this.MarginLeft&&e.MarginRight===this.MarginRight&&e.MarginBottom===this.MarginBottom&&e.Z===this.Z}}]),t}();y.LayoutParamsBase=W;var z=function(){p(n,y.LayoutParamsBase);var i=v(n);function n(e){var t;return g(this,n),t=i.call(this),e instanceof y.RectArea&&(e={x:e.x,y:e.y,width:e.width,height:e.height}),e&&(e.x?t.MarginLeft=e.x:e.marginLeft&&(t.MarginLeft=e.marginLeft),e.y?t.MarginTop=e.y:e.marginTop&&(t.MarginTop=e.marginTop),e.z&&(t.Z=e.z),e.width&&(t.Width=e.width),e.height&&(t.Height=e.height),isNaN(t.MarginTop)&&(y.LogE("isNaN(this.MarginTop)!"),t.MarginTop=0),isNaN(t.MarginLeft)&&(y.LogE("isNaN(this.MarginLeft)!"),t.MarginLeft=0),"MatchParent"!==t.Width?isNaN(t.Width)&&y.LogE("isNaN(this.Width)!"):t.SizeAdjust=!0,"MatchParent"!==t.Height?isNaN(t.Height)&&y.LogE("isNaN(this.Height)!"):t.SizeAdjust=!0),t}return n}();y.LayoutParams=z,window.LayoutParams=y.LayoutParams;var K=function(){function e(){g(this,e),this._IdTokenGenerator=66,(y.sRenderTextureDelegateManager=this)._CheckExpiredTime=0}return h(e,[{key:"CreateTextureStatus",value:function(){var e=new y.RenderTextureDelegate(this,0);return e.DoRef(),e}},{key:"CreateTexture",value:function(){var e=new y.RenderTextureDelegate(this,this._IdTokenGenerator++);return e.DoRef(),e}},{key:"RecycleTexture",value:function(){}},{key:"CreateResourceInfo",value:function(e,t){return{Id:0,Nam:t,Set:null,TmId:e,NdLd:0}}},{key:"AppendFontStatusIfNeed",value:function(e,t){var i={};i.Fo=t.font,i.Si=t.size,i.It=t.italic,i.Bo=t.bold,i.Al=t.alignment,i.Ve=t.vertical_align,i.Tx=t.textColour,i.Ba=t.backgroundColour,i.En=t.enableBlend,i.Sh=t.shadow,t.stroke_width?i.Stk=t.stroke_width:i.Stk=-1,e.FO=JSON.stringify(i)}}]),e}();y.RenderTextureDelegateManager=K,y.sRenderTextureDelegateManager=new y.RenderTextureDelegateManager;var Y=function(){function n(e,t){if(g(this,n),this.IdToken=t,this._Manager=e,this._Reference=0,this._SyncingResourceInfo=null,this._OnloadCallbacks={},this._OnloadCallbacksSize=0,this._OnloadCallbackIdGenerator=1,this.Unloaded=!0,this.LoadTime=0,this.RequireTime=0,this.ForceExpire=!1,this.NeedCheckExpired=!1,y.ForgeDebug.GetTextureTracer()){var i=new Error;this.Stack=i.stack}}return h(n,[{key:"DoRef",value:function(){this._Reference++}},{key:"UndoRef",value:function(){this._Reference--,0===this._Reference&&(0<this._OnloadCallbacksSize&&(this._OnloadCallbacks={}),this._Manager.RecycleTexture(this))}},{key:"SetResourceInfo",value:function(e){e.Id=this.IdToken,this._SyncingResourceInfo=e}},{key:"GetResourceInfo",value:function(){return this._SyncingResourceInfo}},{key:"ReadSyncInfo",value:function(){var e=this._SyncingResourceInfo;return this._SyncingResourceInfo=null,e}},{key:"RegisterOnloadCallback",value:function(e){var t=this._OnloadCallbackIdGenerator++;return this._OnloadCallbacks[""+t]=e,this._OnloadCallbacksSize++,null!==this._SyncingResourceInfo&&(this._SyncingResourceInfo.NdLd=1),t}},{key:"UnregisterOnloadCallback",value:function(e){delete this._OnloadCallbacks[""+e],this._OnloadCallbacksSize--}},{key:"InvokeOnloadCallbacks",value:function(){if(0<this._OnloadCallbacksSize)for(var e in this._OnloadCallbacks)this._OnloadCallbacks[e]()}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}}]),n}();y.RenderTextureDelegate=Y;var J=function(){function e(){g(this,e),(y.sDeprecatedRenderer=this)._SharedTextureManager=this.CreateTextureManager()}return h(e,[{key:"SetUserId",value:function(e){y.sRenderBridge.UpdateUserId(e)}},{key:"GetScreenInfo",value:function(){return y.sRenderBridge.GetScreenInfo()}},{key:"StringWithFont",value:function(){return y.sTextUtils.StringWithFont.apply(this,arguments)}},{key:"GetTextWidth",value:function(){return y.sTextUtils.GetTextWidth.apply(this,arguments)}},{key:"GetTextUtils",value:function(){return y.sTextUtils}},{key:"RectArea",value:function(e,t,i,n){return new y.RectArea(e,t,i,n)}},{key:"TextAttr",value:function(){return y.sTextUtils.TextAttr.apply(this,arguments)}},{key:"GarbageCollect",value:function(){y.LogM("GarbageCollect called")}},{key:"TriggerFrameDraw",value:function(){y.sRenderBridge.RequestSwap()}},{key:"GetSharedTextureManager",value:function(){return this._SharedTextureManager}},{key:"CreateTextureManager",value:function(){return new y.TextureManager}}]),e}();y.DeprecatedRenderer=J,y.sDeprecatedRenderer=null,window.gRootView=null,y.sRootView=null;var X=function(){function r(e,t,i,n){g(this,r),this.Texture=e,this._IsTextureExternal=!1,t instanceof y.ImageTexture?(t&&t.RenderTexture&&t.RenderTexture.NeedCheckExpired&&(t.RenderTexture.RequireTime=0),this.MaskSetting=new y.ViewTextureMask(t)):this.MaskSetting=t,e&&e.RenderTexture&&e.RenderTexture.NeedCheckExpired&&(e.RenderTexture.RequireTime=0),this._IsMaskTextureExternal=!1,this.TextureBeforeImageLoad=i,this._IsPreloadImageTextureExternal=!1,void 0===n&&(n=!0),this.HasAlpha=n}return h(r,[{key:"SetExternal",value:function(e,t,i){this._IsTextureExternal=e,this._IsMaskTextureExternal=t,this._IsPreloadImageTextureExternal=i}},{key:"ReleaseInternalTexture",value:function(){!this._IsTextureExternal&&this.Texture&&(this.Texture.UnloadTex(),this.Texture=null),!this._IsMaskTextureExternal&&this.MaskSetting&&(this.MaskSetting.UnLoad(),this.MaskSetting=null),!this._IsPreloadImageTextureExternal&&this.TextureBeforeImageLoad&&(this.TextureBeforeImageLoad.UnloadTex(),this.TextureBeforeImageLoad=null)}},{key:"DebugPrint",value:function(){return" _IsTextureExternal="+this._IsTextureExternal}}]),r}();y.TextureSetting=X,window.TextureSetting=y.TextureSetting;var q=function(){p(a,y.TextureSetting);var s=v(a);function a(e,t,i,n){var r;return g(this,a),(r=s.call(this,e,t,i,n)).SetExternal(!0,!0,!0),r}return a}();y.ExternalTextureSetting=q,window.ExternalTextureSetting=y.ExternalTextureSetting;var Z=function(){function i(e){g(this,i);var t=e.RectInfo;this.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},this.LayoutParams=JSON.parse(JSON.stringify(e.LayoutParams))}return h(i,[{key:"ApplyToView",value:function(e){var t=this.RectInfo;e.RectInfo={coordX:t.coordX,coordY:t.coordY,width:t.width,height:t.height},e.LayoutParams=JSON.parse(JSON.stringify(this.LayoutParams))}}]),i}();y.PackedLayout=Z;var Q=function(){function e(){g(this,e),this._MaskType="COMMON"}return h(e,[{key:"Type",value:function(){return this._MaskType}},{key:"UnLoad",value:function(){}}]),e}();y.ViewMask=Q;var $=function(){p(n,y.ViewMask);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this))._MaskType="TEXTURE",t.ImageTexture=e,t}return h(n,[{key:"UnLoad",value:function(){this.ImageTexture.UnloadTex()}}]),n}();y.ViewTextureMask=$;var ee=function(){p(a,y.ViewMask);var s=v(a);function a(e,t,i,n){var r;return g(this,a),(r=s.call(this))._MaskType="CORNER",r._TopLeft=e,r._TopRight=isNaN(t)?e:t,r._BottomLeft=isNaN(i)?e:i,r._BottomRight=isNaN(n)?e:n,r._CornersWidth=[0,0,0,0],r._CornersDisable=[0===r._TopLeft?1:0,0===r._TopRight?1:0,0===r._BottomLeft?1:0,0===r._BottomRight?1:0],r}return h(a,[{key:"UnLoad",value:function(){}}]),a}();y.ViewRoundCornerMask=ee;var te=function(){function i(e,t){g(this,i),(this.TextureSetting=e)&&console.error("LayoutViewBase constructor texture_setting not undefined!"),this.Visibility="VISIBLE",this.LayoutParams=null,this.ParentView=null,this.ChildViews=[],this.zIndex=0,this.childZIndexCount=0,this._IsChildOfRootView=!1,"root"===t?this.Element=window.originDocument.getElementById(t):"svg"===t||"path"===t?this.Element=document.createElementNS("http://www.w3.org/2000/svg",t):(this.Element=window.originDocument.createElement(t),this.Element.style.position="absolute"),this._TransitionStore={},this.TransformAnimationObj=null,this._TextureAnimationObj=null}return h(i,[{key:"Init",value:function(e){this.ResetTexture(e)}},{key:"AddView",value:function(e,t){null!==t?t instanceof y.LayoutParamsBase?e.LayoutParams=t.Clone():e.LayoutParams=new y.LayoutParams(t):null===e.LayoutParams&&(e.LayoutParams=new y.LayoutParams({x:0,y:0})),null!==e.LayoutParams&&(e.LayoutParams.MarginLeft&&(e.Element.style.left=e.LayoutParams.MarginLeft+"px"),e.LayoutParams.MarginTop&&(e.Element.style.top=e.LayoutParams.MarginTop+"px"),e.LayoutParams.Width&&(e.Element.style.width=e.LayoutParams.Width+"px"),e.LayoutParams.Height&&(e.Element.style.height=e.LayoutParams.Height+"px")),(e.ParentView=this).ChildViews.push(e),this._IsChildOfRootView&&e._OnAttachToSystem()}},{key:"RemoveView",value:function(e){for(var t=0;t<this.ChildViews.length;t++)if(this.ChildViews[t]===e){e.IsChildOfRootView()&&e._OnDetachFromSystem(),this.ChildViews.splice(t,1),e.ParentView=null;break}}},{key:"_OnDetachFromSystem",value:function(){this._IsChildOfRootView=!1;for(var e=0;e<this.ChildViews.length;e++){this.ChildViews[e]._OnDetachFromSystem()}this.ParentView.Element.removeChild(this.Element)}},{key:"ClearViews",value:function(){var e=this.ChildViews.length;if(0!==e){for(var t=0;t<e;t++){var i=this.ChildViews[t];i&&i.IsChildOfRootView()&&i._OnDetachFromSystem()}this.ChildViews=[]}}},{key:"_ResetTextStyle",value:function(e){if(this.Element.textContent=e.Set.ST,this.Element.style.overflow="hidden",e.Set.AT){var t=JSON.parse(e.Set.AT);this.Element.style.textOverflow=t.TO,"none"==t.WW&&(this.Element.style.whiteSpace="nowrap")}if(e.Set.RA){var i=JSON.parse(e.Set.RA);this.Element.style.width=i.W+"px",this.Element.style.height=i.H+"px"}if(e.Set.LH&&(this.Element.style.lineHeight=e.Set.LH+"px"),e.Set.FO){var n=JSON.parse(e.Set.FO);n.Tx&&(this.Element.style.color=n.Tx),n.Fo&&(this.Element.style.fontFamily=n.Fo),n.Si&&(this.Element.style.fontSize=n.Si+"px"),n.Ba&&(this.Element.style.backgroundColor=n.Ba),n.It&&(this.Element.style.italic="italic"),n.Bo?this.Element.style.fontWeight="bold":this.Element.style.fontWeight="normal",n.Al&&(this.Element.style.textAlign=n.Al),n.Ve&&(this.Element.style.verticalAlign=n.Ve)}}},{key:"_SetBorderRadius",value:function(e){this.Element.style.borderRadius=e._TopLeft+"px "+e._TopRight+"px "+e._BottomLeft+"px "+e._BottomRight+"px"}},{key:"ResetTexture",value:function(e){if(this.TextureSetting=e)if(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)this.Element.style.backgroundImage="url("+e.Texture.Source+")",this.Element.style.backgroundSize="100% 100%";else if(e.Texture.RenderTexture&&e.Texture.RenderTexture._SyncingResourceInfo){var t=e.Texture.RenderTexture._SyncingResourceInfo;if("T"===t.Nam)this._ResetTextStyle(t);else if("CT"===t.Nam)this.Element.style.backgroundColor=t.Set.Clr;else if("VPLY"===t.Nam){var i=t.Set.Hdl;this.LayoutParams&&(i.style.width=this.LayoutParams.Width+"px",i.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(i)}}}},{key:"SetVisibility",value:function(e){this.Element.style.visibility="string"==typeof e?e.toLocaleLowerCase():"inherit"}},{key:"_OnAttachToSystem",value:function(){"svg"!==this.Element.id&&"path"!==this.Element.id||console.log("_OnAttachToSystem appendChild"),this.ParentView.Element.appendChild(this.Element),this._IsChildOfRootView=!0;for(var e=this.ChildViews,t=0;t<e.length;t++)e[t]._OnAttachToSystem()}},{key:"IsChildOfRootView",value:function(){return this._IsChildOfRootView}},{key:"_ConvertTimingFunc",value:function(e){var t="linear";if(e.T)switch(e.T){case y.EasingTypeIn:t="ease-in";break;case y.EasingTypeOut:t="ease-out";break;case y.EasingTypeInOut:t="ease-in-out";break;case y.EasingTypeBezier:t="cubic-bezier("+e.St.X1+","+e.St.Y1+","+e.St.X2+","+e.St.Y2+")";break;case y.EasingTypeBlink:case y.EasingTypeDeceleration:}return t}},{key:"ClearAnimation",value:function(){-1!=this._AnimationOpacity&&(this._AnimationOpacity=-1)}},{key:"StartAnimation",value:function(e,t,i){if(void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(e),this.TransformAnimationObj=null),this.TransformAnimationObj=e,!isNaN(i)&&0<i&&e.EnableDelay(i),e.Start(this),e&&e._SettingInfo&&e._SettingInfo.Set){var n=e._SettingInfo.Set.Kf,r=e._SettingInfo.Set.Ts;if(n&&(0<=n.indexOf("@keyframes")||0<=n.indexOf("@-webkit-keyframes"))){var s=n.split(" ")[1];0<=s.indexOf("{")&&(s=s.substr(0,s.indexOf("{")));var a=e._SettingInfo.Rpt,o="linear";e._SettingInfo.E&&(o=this._ConvertTimingFunc(e._SettingInfo.E));var l=s+" "+e._SettingInfo.Dur/1e3+"s "+o+" "+e._SettingInfo.Dly/1e3+"s "+(-1===a?"infinite":a);console.log("StartAnimation style_anim:",l),this.Element.style.animation=l,this.Element.addEventListener("animationend",function(){e.OnEnd()}),this.Element.style.webkitAnimation=l,this.Element.addEventListener("webkitAnimationEnd",function(){e.OnEnd()})}else if(r&&0<=r.length){for(var u="",h=0;h<r.length;h++){var c="linear",d=r[h];d.tf&&(c=this._ConvertTimingFunc(d.tf)),u=d.name+" "+d.dur/1e3+"s "+c+" "+d.dly/1e3+"s",this._TransitionStore[d.name]=u}if(u){var f="";for(var g in this._TransitionStore)f&&(f+=","),f+=this._TransitionStore[g];this.Element.style.transition=f,this.Element.addEventListener("transitionend",function(){e.OnEnd()}),this.Element.style.webkitTransition=f,this.Element.addEventListener("webkitTransitionEnd",function(){e.OnEnd()})}}}}},{key:"StopAnimation",value:function(){void 0!==this.TransformAnimationObj&&this.TransformAnimationObj&&(this.TransformAnimationObj.Cancel(),this.TransformAnimationObj=null)}},{key:"StartTextureAnimation",value:function(e){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(e),this._TextureAnimationObj=null),(this._TextureAnimationObj=e).AsTextureAnimation(),e.Start(this),this._RequestLayout()}},{key:"StopTextureAnimation",value:function(){void 0!==this._TextureAnimationObj&&this._TextureAnimationObj&&(this._TextureAnimationObj.Cancel(),this._TextureAnimationObj=null)}},{key:"StopAllAnimations",value:function(){this.StopAnimation(),this.StopTextureAnimation();for(var e=0;e<this.ChildViews.length;e++)this.ChildViews[e].StopAllAnimations()}},{key:"GetAnimation",value:function(){return this.TransformAnimationObj}},{key:"DetachAnimation",value:function(e){this.TransformAnimationObj==e&&(this.TransformAnimationObj=null,this.Element.style.animation=null,this.Element.style.webkitAnimation=null)}},{key:"ResetCssTransform",value:function(e){e!==this._CssTransform&&(console.log("ResetCssTransform transform_string:",e),this.Element.style.transform=e,this._CssTransform=e)}},{key:"SetId",value:function(e){this.Id=e}},{key:"ResetLayoutParams",value:function(e){if(null!==e){e instanceof y.LayoutParamsBase?this.LayoutParams=e.Clone():this.LayoutParams=new y.LayoutParams(e),this.Element.style.left=this.LayoutParams.MarginLeft+"px",this.Element.style.top=this.LayoutParams.MarginTop+"px",this.LayoutParams.Width&&(this.Element.style.width=this.LayoutParams.Width+"px"),this.LayoutParams.Height&&(this.Element.style.height=this.LayoutParams.Height+"px");var t=this.TextureSetting;if(t&&t.Texture.RenderTexture&&t.Texture.RenderTexture._SyncingResourceInfo){var i=t.Texture.RenderTexture._SyncingResourceInfo;if("VPLY"===i.Nam){var n=i.Set.Hdl;this.LayoutParams&&(n.style.width=this.LayoutParams.Width+"px",n.style.height=this.LayoutParams.Height+"px"),this.Element.appendChild(n)}}}else y.ThrowError("ResetLayoutParams(): new params is null")}},{key:"GetRenderer",value:function(){return y.LayoutViewBase.sRenderer}},{key:"GetLayoutParams",value:function(){return this.LayoutParams?this.LayoutParams.Clone():new y.LayoutParams}}]),i}();te.DivId=0,y.LayoutViewBase=te;var ie=function(){p(n,y.LayoutViewBase);var i=v(n);function n(e,t){return g(this,n),!e||e instanceof y.TextureSetting||y.ThrowError("ERROR:LayoutView need TextureSetting as parameter"),t=t||"div",i.call(this,e,t)}return n}();y.LayoutView=ie,window.LayoutView=y.LayoutView;var ne=function(){p(i,y.LayoutView);var t=v(i);function i(){var e;return g(this,i),(e=t.call(this,void 0,"root"))._ViewType=1,e._IsChildOfRootView=!0,window.gRootView=d(e),y.sRootView=d(e),e}return h(i,[{key:"Init",value:function(e){this.InitLayoutViewStaticValues(e),this.ResetLayoutParams({x:0,y:0,width:1280,height:720})}},{key:"InitLayoutViewStaticValues",value:function(e){y.LayoutViewBase.sRenderer=e,y.LayoutViewBase.sInternalTextureManager=e.GetSharedTextureManager(),y.LayoutViewBase.sIdentityMat4=new y.Mat4,y.LayoutViewBase.sNullDirectParentMat4=new y.Mat4,y.LayoutViewBase.sBakeFlipYMat4=(new y.Mat4).rotatex(180)}}]),i}();y.RootView=ne,window.RootView=y.RootView;var re=function(){function s(e,t,i,n,r){g(this,s),this.coordX=e,this.coordY=t,this.width=i,this.height=n,this.useScissors=r,this.maskStencil=null}return h(s,[{key:"updateInfo",value:function(e,t,i,n,r){this.coordX=e,this.coordY=t,this.width=i,this.height=n,this.useScissors=r}},{key:"setMaskStencil",value:function(e){this.maskStencil=e}}]),s}(),se=function(){p(n,y.LayoutView);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e,"div"))._ClipRectInfo=null,t.Id="ClipView",t.TextureSetting=null,t}return h(n,[{key:"SetId",value:function(e){this.Id=e+"_ClipView"}},{key:"SetClipRect",value:function(e,t,i,n,r){null===this._ClipRectInfo?this._ClipRectInfo=new re(e,t,i,n,r):this._ClipRectInfo.updateInfo(e,t,i,n,r),this.Element.style.left=this.LayoutParams.MarginLeft+e+"px",this.Element.style.top=this.LayoutParams.MarginTop+t+"px",this.Element.style.overflow="hidden",this.Element.style.width=i+"px",this.Element.style.height=n+"px"}}]),n}();y.ClipView=se,window.ClipView=y.ClipView;var ae=function(){p(n,y.LayoutView);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e,"div"))._HorizontalRepeats=[0,0,0,0],t._VerticalRepeats=[0,0,0,0],t._HorizontalPadding=[0,0],t._VerticalPadding=[0,0],t}return h(n,[{key:"ResetTexture",value:function(e){if((this.TextureSetting=e)&&(e.MaskSetting&&"CORNER"===e.MaskSetting._MaskType&&this._SetBorderRadius(e.MaskSetting),e.Texture.Source)){var t=e.Texture.RenderTexture.Width,i=e.Texture.RenderTexture.Width,n=this._HorizontalRepeats[0],r=t-this._HorizontalRepeats[1]-n,s=this._VerticalRepeats[0],a=i-this._VerticalRepeats[1]-s,o=s+" "+r+" "+a+" "+n;this.Element.style.borderImage="url("+e.Texture.Source+") "+o+" fill";var l=this._HorizontalPadding[0],u=t-this._HorizontalPadding[1]-l,h=this._VerticalPadding[0],c=i-this._VerticalPadding[1]-h;this.Element.style.borderImageWidth=s+"px "+r+"px "+a+"px "+n+"px",this.Element.style.borderImageOutset=h+"px "+u+"px "+c+"px "+l+"px"}}},{key:"SetRepeat",value:function(e,t){y.Assert(e.length<=2),y.Assert(t.length<=2);for(var i=0;i<2;i++)i<e.length?(this._HorizontalRepeats[2*i]=e[i].start,this._HorizontalRepeats[2*i+1]=e[i].width):(this._HorizontalRepeats[2*i]=0,this._HorizontalRepeats[2*i+1]=0),i<t.length?(this._VerticalRepeats[2*i]=t[i].start,this._VerticalRepeats[2*i+1]=t[i].width):(this._VerticalRepeats[2*i]=0,this._VerticalRepeats[2*i+1]=0);return this}},{key:"SetPadding",value:function(e,t){return y.Assert(null!==e),y.Assert(null!==t),this._VerticalPadding[0]=t.start,this._VerticalPadding[1]=t.width,this._HorizontalPadding[0]=e.start,this._HorizontalPadding[1]=e.width,this}}]),n}();y.NinePatchView=ae;var oe=function(){p(n,y.LayoutView);var i=v(n);function n(e){g(this,n);var t=e.substr(3);return i.call(this,void 0,t)}return h(n,[{key:"setAttribute",value:function(e,t){this.Element.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){this.Element.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.Element.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.Element.hasAttribute(e)}},{key:"textContent",get:function(){return this.Element.textContent},set:function(e){this.Element.textContent=e}}]),n}();y.JsvElementView=oe,y.AnimationEnable={ReleaseAfterEndCallback:0};var le=function(){function e(){g(this,e),this.IdToken=0,this._AttachedGroup=null,this.AnimationListenerObj=null,this._AnimationClose=!1,this._LayoutViewRef=null,this._IsTextureAnim=!1}return h(e,[{key:"SetAnimationListener",value:function(e){this.AnimationListenerObj=e}},{key:"AddAnimationListener",value:function(e){this.AnimationListenerObj&&e.AddInherit(this.AnimationListenerObj),this.SetAnimationListener(e)}},{key:"GetAnimationListener",value:function(){return this.AnimationListenerObj}},{key:"Cancel",value:function(e){this._LayoutViewRef&&this._LayoutViewRef.DetachAnimation(this);var t=this.AnimationListenerObj;if(t&&t.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,t.OnAnimationEnd(!1)),this._AttachedGroup){var i=!0;e&&(i=e._AttachedGroup!==this._AttachedGroup),i&&(this._AttachedGroup.CancelFromInternalAnimation(this),this._AttachedGroup=null)}}},{key:"RemoveFromGroup",value:function(){this._AttachedGroup=null}},{key:"AsTextureAnimation",value:function(){this._IsTextureAnim=!0}},{key:"Start",value:function(e){(this._LayoutViewRef=e)&&!this._IsTextureAnim&&e.ClearAnimation()}},{key:"SetCannotDisable",value:function(){}},{key:"OnStart",value:function(){var e=this.AnimationListenerObj;e&&e.OnAnimationStart&&e.OnAnimationStart()}},{key:"OnEnd",value:function(){this._LayoutViewRef&&(this._LayoutViewRef.DetachAnimation(this),this._LayoutViewRef=null);var e=this.AnimationListenerObj;e&&e.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,e.OnAnimationEnd(!0))}},{key:"OnViewHide",value:function(){var e=this.AnimationListenerObj;e&&e.OnViewNoVisible&&e.OnViewNoVisible()}}]),e}();y.AnimationBase=le;var ue=function(){function n(e,t,i){g(this,n),this.OnAnimationStart=e,this._OnAnimationStart=e,this.OnAnimationEnd=t,this._OnAnimationEnd=t,this.OnViewNoVisible=i,this._OnViewNoVisible=i,this._AttachedGroup=null,this._InheritListener=[]}return h(n,[{key:"AddInherit",value:function(e){if(e){if(0===this._InheritListener.length){var i=this;this.OnAnimationStart=function(){i._OnAnimationStart&&i._OnAnimationStart();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnAnimationStart&&this._InheritListener[e].OnAnimationStart()},this.OnAnimationEnd=function(e){i._OnAnimationEnd&&i._OnAnimationEnd(e);for(var t=0;t<this._InheritListener.length;t++)this._InheritListener[t].OnAnimationEnd&&this._InheritListener[t].OnAnimationEnd(e)},this.OnViewNoVisible=function(){i._OnViewNoVisible&&i._OnViewNoVisible();for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnViewNoVisible&&this._InheritListener[e].OnViewNoVisible()}}this._InheritListener.push(e)}}}]),n}();y.AnimationListener=ue,y.AnimationManager=function(){function e(){g(this,e),this._EndAckAnimationList=[],this._StartingAnimationList=[],this._CancelingAnimationIdList=[],this._SyncInfo={EndAck:null,Start:null,Cancel:null},this._ActiveAnimationList={},this._IdTokenGenerator=1}return h(e,[{key:"GenerateIdToken",value:function(){return this._IdTokenGenerator++}},{key:"CreateBaseSetting",value:function(e,t,i,n){var r=null;return n&&(r=n.Pacakge()),{ID:e,Nam:t,V_C:0,Dur:Math.floor(i),E:r,En:-1,Set:null,Dly:0}}},{key:"UpdateIdToken",value:function(e,t){e.ID=t}},{key:"ScheduleSyncEndAckAnimation",value:function(e){this._EndAckAnimationList.push(e.IdToken),y.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncStartingAnimation",value:function(e){this._StartingAnimationList.push(e),y.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncCancelAnimation",value:function(e){if(this._ActiveAnimationList[""+e.IdToken])this._CancelingAnimationIdList.push(e.IdToken),delete this._ActiveAnimationList[""+e.IdToken],y.sRenderBridge.RequestSwap();else for(var t=this._StartingAnimationList.length-1;0<=t;t--)this._StartingAnimationList[t].IdToken===e.IdToken&&this._StartingAnimationList.splice(t,1)}},{key:"ProcessViewHideEvents",value:function(e){for(var t=e.length,i=0;i<t;i++){var n=this._ActiveAnimationList[""+e[i]];n&&n.OnViewHide()}}},{key:"ProcessEndEvents",value:function(e){for(var t=e.length,i=0;i<t;i++){var n=this._ActiveAnimationList[""+e[i]];n&&(n.OnEnd(),delete this._ActiveAnimationList[""+e[i]])}}}]),e}(),y.sAnimationManager=null,y.AnimationDelegate=function(){p(s,y.AnimationBase);var r=v(s);function s(e,t,i){var n;return g(this,s),(n=r.call(this)).IdToken=y.sAnimationManager.GenerateIdToken(),n._SettingInfo=y.sAnimationManager.CreateBaseSetting(n.IdToken,e,t,i),n._Enable=-1,n._AnimationUsed=!1,n}return h(s,[{key:"SetAnimationListener",value:function(e){f(c(s.prototype),"SetAnimationListener",this).call(this,e),this.AnimationListenerObj&&this.AnimationListenerObj.OnViewNoVisible?this._SettingInfo.V_C=1:this._SettingInfo.V_C=0}},{key:"EnableDelay",value:function(e){return this._SettingInfo.Dly=e,this}},{key:"EnableInfinite",value:function(){return this._SettingInfo.Rpt=-1,this}},{key:"SetRepeat",value:function(e){return this._SettingInfo.Rpt=e,this}},{key:"SetForceSmooth",value:function(e,t){isNaN(t)&&(t=50),(t<10||60<t)&&y.LogE("Fps rate should be 10 ~ 60"),e?this._SettingInfo.Mfr=t:delete this._SettingInfo.Mfr}},{key:"Start",value:function(e){this._AnimationUsed&&(y.sAnimationManager.ScheduleSyncCancelAnimation(this),this.IdToken=y.sAnimationManager.GenerateIdToken(),y.sAnimationManager.UpdateIdToken(this._SettingInfo,this.IdToken)),y.sAnimationManager.ScheduleSyncStartingAnimation(this),f(c(s.prototype),"Start",this).call(this,e),this._AnimationUsed=!0}},{key:"Cancel",value:function(e){y.sAnimationManager.ScheduleSyncCancelAnimation(this),f(c(s.prototype),"Cancel",this).call(this,e)}},{key:"OnEnd",value:function(){this._Enable===y.AnimationEnable.ReleaseAfterEndCallback&&y.sAnimationManager.ScheduleSyncEndAckAnimation(this),f(c(s.prototype),"OnEnd",this).call(this)}},{key:"GetSetting",value:function(){return this._SettingInfo}},{key:"Clone",value:function(){var e=JSON.parse(JSON.stringify()),t=new y.AnimationDelegate("CLONE",0,null);return e.ID=t._SettingInfo.ID,e.V_C=0,t._SettingInfo=e,t}},{key:"Enable",value:function(e){this._SettingInfo.En=e,this._Enable=e}}]),s}(),y.TranslateAnimation=function(){p(u,y.AnimationDelegate);var l=v(u);function u(e,t,i,n,r,s){var a;g(this,u);var o={X0:e,X1:t,Y0:i,Y1:n};return(a=l.call(this,"TL",r,s))._SettingInfo.Set=o,a}return u}(),y.FuncAnimation=function(){p(a,y.AnimationDelegate);var s=v(a);function a(e,t,i){var n;if(g(this,a),void 0!==window.JsView&&67<=window.JsView.ForgeNativeRevision){var r={F:e};(n=s.call(this,"FC2",t,i))._SettingInfo.Set=r}else(n=s.call(this,"FC",t,i))._SettingInfo.Set={X:"0",Y:"0",Z:"0"};return l(n)}return a}(),y.MultiFactorAnimation=function(){p(o,y.AnimationDelegate);var a=v(o);function o(e,t,i,n){var r;g(this,o);var s={FSA:t,PP:e};return(r=a.call(this,"MF",i,n))._SettingInfo.Set=s,r}return o}(),y.RotateAnimation=function(){p(u,y.AnimationDelegate);var l=v(u);function u(e,t,i,n,r,s){var a;g(this,u),a=l.call(this,"RO",r,s),i instanceof y.Vec3||(i=new y.Vec3(i)),n instanceof y.Vec3||(n=new y.Vec3(n));var o={SA:e,OA:t,AN:i.data,AX:n.data};return a._SettingInfo.Set=o,a}return u}(),y.BasicScaleAnimation=function(){p(f,y.AnimationDelegate);var d=v(f);function f(e,t,i,n,r,s,a,o,l,u){var h;g(this,f),h=d.call(this,"SC",a,o);var c={SW:e=Math.round(e),SH:t=Math.round(t),EW:i=Math.round(i),EH:n=Math.round(n),AX:r,AY:s,BW:l=l?Math.round(l):i,BH:u=u?Math.round(u):n};return h._SettingInfo.Set=c,h}return f}(),y.ScaleAnimation=function(){p(c,y.BasicScaleAnimation);var h=v(c);function c(e,t,i,n,r,s){g(this,c);var a=200*e,o=200*e,l=200*t,u=200*t;return h.call(this,a,o,l,u,i,n,r,s,200,200)}return c}(),y.OpacityAnimation=function(){p(o,y.AnimationDelegate);var a=v(o);function o(e,t,i,n){var r;g(this,o),(r=a.call(this,"OP",i,n))._StartOpacity=e,r._EndOpacity=t,r._OffsetOpacity=t-e;var s={SO:e,EO:t};return r._SettingInfo.Set=s,r}return o}(),y.CssKeyframeAnimation=function(){p(o,y.AnimationDelegate);var a=v(o);function o(e,t,i,n,r){var s;return g(this,o),(s=a.call(this,"CK",t,i))._SettingInfo.Set={Kf:e,VL:{vw:n||0,vh:r||0}},s}return o}(),y.CssTransitionAnimation=function(){p(n,y.AnimationDelegate);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,"CT",null,null))._SettingInfo.Set={Ts:e},t}return n}(),y.AnimationEnable={ReleaseAfterEndCallback:0},window.TranslateAnimation=y.TranslateAnimation;var he=function(){function l(e,t){if(g(this,l),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",e){if(!0===e.startsWith("url")){var i=e.indexOf("(")+1,n=e.lastIndexOf(")");e=e.substring(i,n).trim()}if(!0!==e.startsWith("data:")){if(!0===e.startsWith("/")&&(e=document.location.origin+e),!0===e.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var r=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,r)}e=window.JsView.React.__MainPath+e.substring(1)}if(this.href=e,t){var s=this.href.indexOf("?"),a=0<s?this.href.substring(0,s):this.href;this.search=1<s?this.href.substring(s):"",s=a.indexOf("://"),this.protocol=0<s?a.substring(0,s+1):"";var o=1<s?a.substring(s+3):"";s=o.indexOf("/"),this.host=0<s?o.substring(0,s):"",this.pathname=1<s?o.substring(s):"",this.origin=0<s?this.protocol+"//"+this.host:"",s=this.host.indexOf(":"),this.hostname=0<s?this.host.substring(0,s):"",this.port=1<s?this.host.substring(s+1):"",console.log("create total parse URL, this=",this)}}else this.href=e}}return h(l,[{key:"replace",value:function(e){this.href=e}}]),l}(),ce=function(){function o(){g(this,o)}return h(o,null,[{key:"SetBackgroundColor",value:function(e,t,i){var n,r=o.TextureManager.GetColorTexture(t);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var s=new y.TextureSetting(r,n);e.ResetTexture(s)}},{key:"SetBackgroundImage",value:function(e,t,i,n){if("string"==typeof t&&(t=new he(t)),t instanceof he==!1)throw Error("Bad Argument.",t);var r,s=o.TextureManager.GetImage(t.href);i&&(r=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var a=new y.ExternalTextureSetting(s,r);e.ResetTexture(a),n&&s.RegisterLoadImageCallback(null,function(){n({width:s.Width,height:s.Height})})}},{key:"SetVideoTexture",value:function(e,t,i){var n,r=o.TextureManager.GetColorTexture(t);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var s=new y.TextureSetting(r,n);e.ResetTexture(s)}},{key:"GetTextWidth",value:function(e){return e.str||(e.str=""),e.font||(e.font=y.TextUtils._sDefaultFont),e.size||(e.size=y.TextUtils._sDefaultFontSize),"italic"!==e.italic&&(e.italic=""),"bold"!==e.bold&&(e.bold=""),window.PlatformUtils.GetTextWidth(e)}},{key:"RequestSwap",value:function(){y.sRenderBridge.RequestSwap()}},{key:"SetImgTexSize",value:function(e,t){var i={size:t,refNum:0};o.TextureInfo.Cache[e.Source]=i}},{key:"RefImgTexSize",value:function(n,r){var e=o.TextureInfo.Cache[n.Source];e?(0<e.refNum?e.refNum++:e.refNum=1,r(e.size)):n.RegisterLoadImageCallback(null,function(){var e={width:n.Width,height:n.Height};r(e);var t=o.TextureInfo.Cache[n.Source];if(t)0<t.refNum?t.refNum++:t.refNum=1;else{var i={size:e,refNum:1};o.TextureInfo.Cache[n.Source]=i}})}},{key:"UnrefImgTexSize",value:function(e){if(e){var t=o.TextureInfo.Cache[e.Source];t&&(t.refNum--,t.refNum<=0&&o.TextureInfo.Unused.add(e.Source))}}},{key:"ClearUnusedTexSize",value:function(){var e,t=O(o.TextureInfo.Unused);try{for(t.s();!(e=t.n()).done;){var i=e.value,n=o.TextureInfo.Cache[i];n.refNum<-2?(delete o.TextureInfo.Cache[i],o.TextureInfo.Unused.delete(i)):n.refNum<=0?n.refNum--:o.TextureInfo.Unused.delete(i)}}catch(e){t.e(e)}finally{t.f()}}}]),o}();ce.TextureInfo={Cache:{},Unused:new Set},ce.TextureManager=null,ce.RootView=null,ce.RootActivity=null,ce.HaltKeyEvent=!1;var de=function(){function i(e){g(this,i),this.type=e,this.cachedValues=null,this.onSyncCallback=null}return h(i,[{key:"setOnSyncCallback",value:function(e){this.onSyncCallback=e,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(e,t){this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t,this.syncLastCaches(!1),ce.RequestSwap()}},{key:"syncLastCaches",value:function(e){var t=i.LastModified[this.type];!e&&t===this||(i.LastModified[this.type]=this,t&&t.cachedValues&&"function"==typeof t.onSyncCallback&&(t.onSyncCallback(t.cachedValues),t.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){console.log("JsvLazySyncCache.SyncAllCachedProperty()");for(var e=0,t=Object.values(i.LastModified);e<t.length;e++){t[e].syncLastCaches(!0)}}}]),i}();de.LastModified={};var fe=function(){function e(){g(this,e),this._ScreenInfo={width:160,height:90,x:.0125,y:2/90,perspective:.0125,scaleRatio:1,designedWidth:1280}}return h(e,[{key:"GetScreenInfo",value:function(){return this._ScreenInfo}},{key:"InitScreenBuffer",value:function(e,t){isNaN(e)&&(e=1),isNaN(t)&&(t=1280);var i=t*e,n=i/16*9;this._ScreenInfo.width=Math.floor(i),this._ScreenInfo.height=Math.floor(n),this._ScreenInfo.x=2/this._ScreenInfo.width,this._ScreenInfo.y=2/this._ScreenInfo.height,this._ScreenInfo.perspective=this._ScreenInfo.x,this._ScreenInfo.scaleRatio=e,this._ScreenInfo.designedWidth=t}},{key:"RequestSwap",value:function(){this._OnRequesting||(this._OnRequesting=!0,this._SwapTimer=y.PersistTimer.setTimeout(this._DoRequestSwap.bind(this),0))}},{key:"_DoRequestSwap",value:function(){de.SyncAllCachedProperty(),ce.ClearUnusedTexSize(),this._OnRequesting=!1}},{key:"InstantPerformSwap",value:function(){this._OnRequesting&&(this._OnRequesting=!1,0<this._SwapTimer&&(y.PersistTimer.clearTimeout(this._SwapTimer),this._SwapTimer=-1),this._DoRequestSwap(!1))}}]),e}();y.RenderBridge=fe,y.sRenderBridge=new y.RenderBridge,y.sAnimationManager=new y.AnimationManager;var ge=function(){function t(e){g(this,t),this.ownerDocument=window.document,this.nodeType=e,this.parentNode=null,this.jsvEventListener=null}return h(t,[{key:"appendChild",value:function(e){e.parentNode=this}},{key:"removeChild",value:function(e){e.parentNode=null}},{key:"insertBefore",value:function(e){e.parentNode=this}},{key:"addEventListener",value:function(e,t){this.jsvEventListener||(this.jsvEventListener={});var i=this.jsvEventListener[e];i||(i=new Set,this.jsvEventListener[e]=i),i.add(t)}},{key:"removeEventListener",value:function(e,t){if(this.jsvEventListener){var i=this.jsvEventListener[e];i&&(i.delete(t),i.size<=0&&this.jsvEventListener.hasOwnProperty(e)&&delete this.jsvEventListener[e],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(e){if(this.jsvEventListener){var t=this.jsvEventListener[e.type];if(t){e.target||(e.target=document.activeElement);var i,n=O(t);try{for(n.s();!(i=n.n()).done;){(0,i.value)(e)}}catch(e){n.e(e)}finally{n.f()}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+e.type+". No event added.")}}]),t}();ge.ELEMENT_NODE=1,ge.TEXT_NODE=3,ge.DOCUMENT_NODE=9;var pe=function(){function t(e){g(this,t),this.target=null,this.timeStamp=Date.now(),this.type=e}return h(t,[{key:"initEvent",value:function(e){this.type=e}}]),t}(),ve=function(){p(t,pe);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return t}();ve.Type={FOCUS:"focus",BLUR:"blur"};function ye(e){if(g(this,ye),this.top=null,this.right=null,this.bottom=null,this.left=null,e&&!1!==e.startsWith("inset")){var t=e.indexOf("(")+1,i=e.substring(t),n=we.ConvertRect(i);this.top=n.top,this.right=n.right,this.bottom=n.bottom,this.left=n.left}else console.error("Inset.Parse() InvalidArgs: value=",e)}function me(e){if(g(this,me),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,e){var t=e.indexOf(")")+1,i=e.substring(0,t),n=e.substring(t);this.source=new he(i),this.slice=we.ConvertRect(n)}else console.error("BorderImage.constructor() InvalidArgs: value=",e)}var _e=function(){p(t,pe);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return t}(),we=function(){function v(){g(this,v)}return h(v,null,[{key:"ConvertFloat",value:function(e){return!e||"string"!=typeof e?e:parseFloat(e)}},{key:"ConvertPx",value:function(e){return!e||"string"!=typeof e?e:"0"===e?0:e.endsWith("px")?parseInt(e):e}},{key:"ConvertRect",value:function(e){var t=v.SplitString(e," "),i={top:0<t.length?parseInt(t[0]):0,right:1<t.length?parseInt(t[1]):null,bottom:2<t.length?parseInt(t[2]):null,left:3<t.length?parseInt(t[3]):null};return i.right=i.right||0===i.right?i.right:i.top,i.bottom=i.bottom||0===i.bottom?i.bottom:i.top,i.left=i.left||0===i.left?i.left:i.right,i}},{key:"ConvertCorner",value:function(e){var t=v.SplitString(e," "),i={topLeft:0<t.length?parseInt(t[0]):0,topRight:1<t.length?parseInt(t[1]):null,bottomRight:2<t.length?parseInt(t[2]):null,bottomLeft:3<t.length?parseInt(t[3]):null};return i.topRight=i.topRight||0===i.topRight?i.topRight:i.topLeft,i.bottomRight=i.bottomRight||0===i.bottomRight?i.bottomRight:i.topLeft,i.bottomLeft=i.bottomLeft||0===i.bottomLeft?i.bottomLeft:i.bottomRight,i}},{key:"ConvertSize",value:function(e){var t=v.SplitString(e," "),i={width:0<t.length?parseInt(t[0]):0,height:1<t.length?parseInt(t[1]):null};return i.height=i.height||0===i.height?i.height:i.width,i}},{key:"ConvertAnimation",value:function(e){if(null===e||0===e.length)return null;var t=e.indexOf("cubic-bezier"),i=[];if(0<=t){var n,r=e.indexOf(")"),s=e.substring(t,r+1),a=O(v.SplitString(e,s));try{for(a.s();!(n=a.n()).done;){var o=n.value,l=v.SplitString(o," ");i=i.concat(l)}}catch(e){a.e(e)}finally{a.f()}i.push(s)}else i=v.SplitString(e," ");for(var u=null,h=0,c=1,d=e.includes("alternate"),f=2;f<i.length;f++)if("infinite"!==i[f]){var g=v.ConvertTimeMs(i[f]);!1===isNaN(g)?h=g:(g=parseFloat(i[f]),!1===isNaN(g)?c=g:u=i[f])}else c=-1;var p=1<i.length?v.ConvertTimeMs(i[1]):0;return{name:0<i.length?i[0]:"",duration:p,timingFunction:v.ConvertEasing(u,p),delay:h,iterationCount:c,direction:d}}},{key:"ConvertTransition",value:function(e){if(null==e||0==e.length)return null;for(var t={},i=new Array,n=e.split(","),r=0;r<n.length;r++)if(0<=n[r].indexOf("(")){for(var s=r;s<n.length&&n[s].indexOf(")")<0;)s++;for(var a="",o=r;o<=s;o++)o!=r&&(a+=","),a+=n[o];r=s,i=i.concat(a)}else i=i.concat(n[r]);var l,u=O(i);try{for(u.s();!(l=u.n()).done;){var h=l.value,c=v.ConvertAnimation(h);if("all"==(t[c.name]=c).name)for(var d=new Array("opacity","left","top","width","height"),f=0,g=d;f<g.length;f++){t[g[f]]=c}}}catch(e){u.e(e)}finally{u.f()}return t}},{key:"ConvertTimeMs",value:function(e){var t=NaN;return(e=(e=e||"").trim()).endsWith("ms")?t=1:e.endsWith("s")&&(t=1e3),t*=parseFloat(e)}},{key:"ConvertEasing",value:function(e,t){var i=y.Easing.Circular.InOut;if(!e)return i;if(e.includes("ease"))i=e.includes("-in-out")?y.Easing.Circular.InOut:e.includes("-out")?y.Easing.Circular.Out:e.includes("-in")?y.Easing.Circular.In:y.Easing.Circular.InOut;else if(e.includes("linear"))i=null;else if(e.includes("cubic-bezier")){var n=v.ConvertBezier(e);i=new y.BezierEasing(n.x1,n.y1,n.x2,n.y2,t)}return i}},{key:"ConvertBezier",value:function(e){var t=e.indexOf("(");0<=t&&(e=e.substring(t+1));var i=v.SplitString(e,",");return{x1:0<i.length?parseFloat(i[0]):0,y1:1<i.length?parseFloat(i[1]):0,x2:2<i.length?parseFloat(i[2]):0,y2:3<i.length?parseFloat(i[3]):0}}},{key:"ConvertOverflow",value:function(e){return(e=e||"").includes("hidden")?Se.Overflow.HIDDEN:Se.Overflow.VISIBLE}},{key:"ConvertObjectFit",value:function(e){return(e=e||"").includes("fill")?Se.ObjectFit.FILL:e.includes("contain")?Se.ObjectFit.CONTAIN:e.includes("cover")?Se.ObjectFit.COVER:e.includes("none")?Se.ObjectFit.NONE:e.includes("scale-down")?Se.ObjectFit.SCALEDOWN:Se.ObjectFit.CONTAIN}},{key:"SplitString",value:function(e,t){var i=(e=e||"").trim().split(t);if(" "!==t)return i;var n,r=[],s=O(i);try{for(s.s();!(n=s.n()).done;){var a=n.value;a&&r.push(a)}}catch(e){s.e(e)}finally{s.f()}return r}}]),v}(),Se=function(){function n(){g(this,n),this.jsvStore={},this.jsvLazySyncCache=new de("style")}return h(n,[{key:"setProperty",value:function(e,t){if("function"==typeof document.jsvCheckStyleFormat&&document.jsvCheckStyleFormat(e,t),t=this.jsvConvertPropValue(e,t),this.jsvStore[e]!==t){this.jsvStore[e]=t;var i=n.JsvGetStyleType(e);this.jsvLazySyncCache.setCacheProperty(i,void 0)}}},{key:"getPropertyValue",value:function(e){return this.jsvStore[e]}},{key:"jsvSetChangedListener",value:function(t){this.jsvLazySyncCache.setOnSyncCallback(function(e){t(Object.keys(e))})}},{key:"jsvConvertPropValue",value:function(e,t){switch(e){case n.PROP.VISIBILITY:return t.toUpperCase();case n.PROP.OVERFLOW:return we.ConvertOverflow(t);case n.PROP.OBJECTFIT:return we.ConvertObjectFit(t);case n.PROP.TRANSFORM:return t;case n.PROP.CLIPPATH:return new ye(t);case n.PROP.BORDERIMAGE:return new me(t);case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return we.ConvertRect(t);case n.PROP.BORDERRADIUS:return we.ConvertCorner(t);case n.PROP.ANIMATION:return we.ConvertAnimation(t);case n.PROP.TRANSITION:return we.ConvertTransition(t);case n.PROP.OPACITY:return we.ConvertFloat(t);default:return we.ConvertPx(t)}}}],[{key:"JsvGetStyleType",value:function(e){switch(e){case n.PROP.LEFT:case n.PROP.RIGHT:case n.PROP.TOP:case n.PROP.BOTTOM:return n.TYPE.LAYOUT_POS;case n.PROP.WIDTH:case n.PROP.HEIGHT:case n.PROP.VISIBILITY:case n.PROP.CLIPPATH:case n.PROP.OVERFLOW:case n.PROP.OBJECTFIT:case n.PROP.TRANSFORM:return n.TYPE.LAYOUT_SIZE;case n.PROP.BACKGROUNDCOLOR:case n.PROP.BACKGROUNDIMAGE:case n.PROP.BORDERRADIUS:return n.TYPE.BACKGROUND;case n.PROP.COLOR:case n.PROP.LINEHEIGHT:case n.PROP.WHITESPACE:case n.PROP.FONTFAMILY:case n.PROP.FONTSIZE:case n.PROP.FONTSTYLE:case n.PROP.FONTWEIGHT:case n.PROP.TEXTALIGN:case n.PROP.TEXTSHADOW:case n.PROP.TEXTOVERFLOW:return n.TYPE.FOREGROUND;case n.PROP.BORDERIMAGE:case n.PROP.BORDERIMAGEWIDTH:case n.PROP.BORDERIMAGEOUTSET:return n.TYPE.BORDER;case n.PROP.ANIMATION:return n.TYPE.ANIMATION;case n.PROP.TRANSITION:return n.TYPE.TRANSITION;case n.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+e),null}}}]),n}();Se.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation",TRANSITION:"transition"},Se.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},Se.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},Se.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function be(e){var t=Se.PROP[e];Object.defineProperty(Se.prototype,t,{set:function(e){this.setProperty(t,e)},get:function(){return this.getPropertyValue(t)}})}for(var ke in Se.PROP)be(ke);var Ie=function(){p(l,ge);var i=v(l);function l(e){var t;return g(this,l),(t=i.call(this,ge.ELEMENT_NODE)).parentElement=null,t.tagName=t.constructor.name.replace("Element","").toUpperCase(),t.childElementCount=0,t.childNodes=[],t.firstElementChild=null,t.lastElementChild=null,t.tagName===l.TAG.STYLE?(t.style=null,t.jsvMainView=null):(t.style=new Se,t.jsvMainView=new y.LayoutView),t.jsvMaskView=null,t.jsvAnimation=null,t.jsvStore={transition:null,textContent:null,clientWidth:null},t.jsvLazySyncCache=new de("element"),t.instantSwapCallback=null,t}return h(l,[{key:"appendChild",value:function(e){if(f(c(l.prototype),"appendChild",this).call(this,e),(e.parentElement=this).firstElementChild||(this.firstElementChild=e),this.lastElementChild=e,this.childNodes.push(e),this.childElementCount++,e.nodeType===ge.ELEMENT_NODE&&e.tagName!==l.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);e.jsvOnLoadForgeView(),e.style.jsvSetChangedListener(e.jsvOnStyleChanged.bind(e));var t=e.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(e.jsvMaskView,t)}}},{key:"removeChild",value:function(e){f(c(l.prototype),"removeChild",this).call(this,e),e.parentElement=null,e instanceof l&&(e.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(e.jsvMaskView))}},{key:"insertBefore",value:function(e,t){f(c(l.prototype),"appendChild",this).call(this,e,t),(e.parentElement=this).appendChild(e)}},{key:"setAttribute",value:function(e,t){console.log("Element.setAttribute() name="+e+", value=",t),this[e]=t,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,t)}},{key:"removeAttribute",value:function(e){this[e]=void 0,e.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(e,void 0)}},{key:"getAttribute",value:function(e){return this[e]}},{key:"hasAttribute",value:function(e){return console.log("Element.hasAttribute() name="+e),!!this[e]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var e=document.activeElement;if(document.activeElement=this,e){var t=new ve(ve.Type.BLUR);t.target=e,document.dispatchEvent(t)}var i=new ve(ve.Type.FOCUS);document.dispatchEvent(i)}},{key:"jsvOnLoadForgeView",value:function(){var t=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new y.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(e){t.jsvMainView.SetElementProp(e)})}},{key:"jsvOnUnloadForgeView",value:function(){}},{key:"jsvOnStyleChanged",value:function(e){var t,i=e.includes(Se.TYPE.LAYOUT_SIZE),n=O(e);try{for(n.s();!(t=n.n()).done;){switch(t.value){case Se.TYPE.LAYOUT_POS:if(i)break;this.jsvFlushViewLayout();break;case Se.TYPE.LAYOUT_SIZE:this.jsvFlushViewLayout();break;case Se.TYPE.BACKGROUND:this.jsvFlushViewBackground();break;case Se.TYPE.ANIMATION:this.jsvFlushViewAnimation();break;case Se.TYPE.TRANSITION:this.jsvStore.transition=null,this.jsvFlushViewTransition()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var e={x:this.style.left,y:this.style.top,width:this.style.width,height:this.style.height};if(this.jsvMaskView.ResetLayoutParams(e),this.jsvMaskView.ResetCssTransform(this.style.transform),this.jsvMaskView!==this.jsvMainView){var t={x:0,y:0,width:e.width,height:e.height};this.jsvMainView.ResetLayoutParams(t)}this.jsvMaskView.SetVisibility(this.style.visibility);var i=null;this.style.clipPath?i={x:this.style.clipPath.left,y:this.style.clipPath.top,width:e.width-this.style.clipPath.left-this.style.clipPath.right,height:e.height-this.style.clipPath.top-this.style.clipPath.bottom}:!this.style.objectFit&&this.style.overflow!==Se.Overflow.HIDDEN||(i={x:0,y:0,width:this.style.width,height:this.style.height}),i&&this.jsvMaskView.SetClipRect(i.x,i.y,i.width,i.height,!0),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&ce.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius),this.style.backgroundImage&&ce.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius)}},{key:"jsvFlushViewAnimation",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.animation){var e=document.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation=new y.CssKeyframeAnimation(e,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var i=this,t=new y.AnimationListener(null,function(e){if(e){var t=new _e("animationend");t.target=i,document.dispatchEvent(t),null==i.instantSwapCallback&&(i.instantSwapCallback=y.sRenderBridge.InstantPerformSwap.bind(y.sRenderBridge)),Promise.resolve().then(i.instantSwapCallback)}},null);this.jsvAnimation.Enable(y.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(t),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.style.transition){this.jsvStore.transition||(this.jsvStore.transition={});var e=[];for(var t in this.style.transition){var i=this.jsvStore.transition[t],n=this.style[t];if(this.jsvStore.transition[t]=n,void 0!==i&&i!==n){var r=this.style.transition[t],s={name:t,dur:r.duration,tf:null,dly:r.delay,from:i,to:n};r.timingFunction&&(s.tf=r.timingFunction.Pacakge()),e.push(s)}}e.length<=0||(this.jsvAnimation=new y.CssTransitionAnimation(e),this.jsvMaskView.StartAnimation(this.jsvAnimation))}}},{key:"clientWidth",get:function(){return this.style.width}}],[{key:"JsvFitViewLayout",value:function(e,t,i){var n={x:0,y:0,width:e.width,height:e.height},r={width:0,height:0},s=e.width/e.height,a=t.width/t.height;if(!a)return n;if(!s){if(0===e.width||0===e.height)return n;0===s?e.width=e.height*a:isNaN(s)&&(e.height=e.width/a),s=e.width/e.height}if(!s)return n.width=t.width,n.height=t.height,n;switch(i=i||Se.ObjectFit.CONTAIN){case Se.ObjectFit.FILL:r.width=e.width,r.height=e.height;break;case Se.ObjectFit.NONE:r.width=t.width,r.height=t.height;break;case Se.ObjectFit.COVER:r=l.JsvStretchSize(e,a,a<s);break;case Se.ObjectFit.SCALEDOWN:var o=s<a;e.width>t.width&&e.height>t.height&&(o=a<s),r=l.JsvStretchSize(e,a,o);break;case Se.ObjectFit.CONTAIN:r=l.JsvStretchSize(e,a,s<a);break;default:throw Error("Unexpected object-fit.")}return n.x=(e.width-r.width)/2,n.y=(e.height-r.height)/2,n.width=r.width,n.height=r.height,n}},{key:"JsvStretchSize",value:function(e,t,i){var n={width:0,height:0};return i?(n.width=e.width,n.height=e.width/t):(n.height=e.height,n.width=e.height*t),n}}]),l}();Ie.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},Ie.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};function Te(e){g(this,Te);var t=e.indexOf(Te.KeyFramesFlag)+Te.KeyFramesFlag.length,i=e.indexOf("{"),n=e.substring(t,i);this.name=n.trim(),this.cssText=e}var xe=function(){p(r,Ie);var t=v(r);function r(){var e;return g(this,r),(e=t.call(this)).jsvContentView=null,e.jsvRefedImgTex=null,e}return h(r,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new y.NinePatchView),f(c(r.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){f(c(r.prototype),"jsvOnUnloadForgeView",this).call(this),ce.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(e){f(c(r.prototype),"jsvOnStyleChanged",this).call(this,e);var t,i=e.includes(Se.TYPE.FOREGROUND),n=O(e);try{for(n.s();!(t=n.n()).done;){switch(t.value){case Se.TYPE.LAYOUT_SIZE:if(i)break;this.jsvFlushViewForeground();break;case Se.TYPE.FOREGROUND:this.jsvFlushViewForeground();break;case Se.TYPE.BORDER:this.jsvFlushViewBorder()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"jsvFlushViewForeground",value:function(){if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var e=this.jsvGetTextParams(),t=new y.TextViewEx(ce.TextureManager,e,this.jsvStore.textContent,!0).GetLayoutView();this.jsvContentView.AddView(t)}}},{key:"jsvFlushViewBorder",value:function(){if(this.jsvMaskView)if(this.style.clipPath)console.error("BorderImage is conflicting with ClipPath.");else if(this.style.borderImage){ce.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex&&this.jsvRefedImgTex.Source===this.style.borderImage.source.href||(this.jsvRefedImgTex=ce.TextureManager.GetImage(this.style.borderImage.source.href));var e=we.ConvertPx(this.getAttribute("jsv-borderimage-width")),t=we.ConvertPx(this.getAttribute("jsv-borderimage-height"));e&&t&&(console.log("Custom cache image size with: "+e+"/"+t),ce.SetImgTexSize(this.jsvRefedImgTex,{width:e,height:t})),ce.RefImgTexSize(this.jsvRefedImgTex,function(e){var t=this.style.borderImageOutset?this.style.borderImageOutset:we.ConvertRect();this.jsvMaskView.SetPadding({start:t.left,width:e.width-t.left-t.right},{start:t.top,width:e.height-t.top-t.bottom});var i=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:i.left,width:e.width-i.left-i.right}],[{start:i.top,width:e.height-i.top-i.bottom}]);var n=new y.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(n)}.bind(this))}}},{key:"jsvGetTextParams",value:function(){var e={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"nowrap"===this.style.whiteSpace?"none":"normal"},t={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top"},i=this.style.textShadow?this.style.textShadow.split(" "):void 0;i&&(t.shadow={shadowOffsetX:parseInt(i[0]),shadowOffsetY:parseInt(i[1]),shadowBlur:parseInt(i[2]),shadowColor:i[3]});var n=this.style.fontSize?this.style.fontSize+4:14;this.style.lineHeight&&(n=this.style.lineHeight);var r=new y.TextViewParams;r.SetTextAttr(e),r.SetFontStyle(t),r.SetLineHeight(n);var s=this.style.width;return void 0===s&&(s=this.clientWidth),r.SetViewSize(new y.RectArea(0,0,s,this.style.height)),r}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(e){this.jsvStore.textContent=e,this.jsvStore.clientWidth=null,this.jsvContentView||(this.jsvContentView=new y.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var e=this.style.width;if(e||0===e)return e;if(this.jsvStore.textContent){if(this.jsvStore.clientWidth||0===this.jsvStore.clientWidth)return this.jsvStore.clientWidth;var t={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=ce.GetTextWidth(t),this.jsvStore.clientWidth}return f(c(r.prototype),"clientWidth",this)}}]),r}(),Ee=function(){p(i,Ie);var e=v(i);function i(){return g(this,i),e.apply(this,arguments)}return h(i,[{key:"setAttribute",value:function(e,t){f(c(i.prototype),"setAttribute",this).call(this,e,t),e===Ie.ATTRIBUTE.SRC&&ce.SetBackgroundImage(this.jsvMainView,t,this.style.borderRadius,this.jsvOnLoaded.bind(this))}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(Ie.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(e){var t={width:this.style.width,height:this.style.height},i=Ie.JsvFitViewLayout(t,e,this.style.objectFit);this.style.left&&(i.x+=this.style.left),this.style.top&&(i.y+=this.style.top),this.jsvMainView.ResetLayoutParams(i)}}]),i}();Te.KeyFramesFlag="@keyframes";var Re=function(){function t(e){g(this,t),this.jsvCssRules=null,this.jsvTextContent=e}return h(t,[{key:"insertRule",value:function(e,t){if(console.log("StyleSheet.insertRule() rule="+e),void 0===t&&(t=this.jsvCssRules.length),e.indexOf(Te.KeyFramesFlag)<0)throw Error("StyleSheet.insertRule() Rule is not supported except keyframes.");var i=new Te(e);this.jsvCssRules.splice(t,0,i)}},{key:"deleteRule",value:function(e){console.log("StyleSheet.deleteRule() index="+e),this.jsvCssRules.splice(e,1)}},{key:"cssRules",get:function(){if(this.jsvCssRules)return this.jsvCssRules;if(this.jsvCssRules=new Array,this.jsvTextContent.indexOf(Te.KeyFramesFlag)<0)return this.jsvCssRules;var e=this.jsvTextContent.split(Te.KeyFramesFlag);for(var t in e)0!=t&&this.insertRule(Te.KeyFramesFlag+e[t]);return this.jsvCssRules}}]),t}(),Oe=function(){p(n,Ie);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e)).textContent=null,t}return h(n,[{key:"appendChild",value:function(e){f(c(n.prototype),"appendChild",this).call(this,e);var t=new Re(e.textContent);document.jsvAppendStyleSheet(t)}},{key:"removeChild",value:function(e){throw f(c(n.prototype),"removeChild",this).call(this,e),Error("Failed to removeChild, unimplement!.")}}]),n}(),Le=function(){p(n,Ie);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this)).jsvMedia=null,e&&(t.src=e),t}return h(n,[{key:"addEventListener",value:function(e,t,i){f(c(n.prototype),"addEventListener",this).call(this,e,t,i),this.jsvAddMediaListener(e)}},{key:"jsvOnLoadForgeView",value:function(){f(c(n.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){f(c(n.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){var e=this.jsvEventListener;if(e)for(var t in e.keys)this.jsvAddMediaListener(t)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy()),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(t){var i=this;this.jsvMedia||this.jsvInit(),this.jsvMedia.addEventListener(t,function(){var e=new pe(t);e.target=i,f(c(n.prototype),"dispatchEvent",i).call(i,e)})}},{key:"src",set:function(e){e=e&&new he(e).href;this.jsvMedia||this.jsvInit(),this.jsvMedia.src=e}}]),n}();for(var Ce in Le.HOOKS={Audio:Audio,Video:window.OffscreenVideoPlayer},Le.PROP={SetOnly:["autoplay","loop"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},Le.PROP){var Ae,Pe=O(Le.PROP[Ce]);try{var Fe=function(){var t=Ae.value,e={};"SetOnly"!==Ce&&"SetAndGet"!==Ce||(e.set=function(e){this.jsvMedia||this.jsvInit(),this.jsvMedia[t]=e}),"GetOnly"!==Ce&&"SetAndGet"!==Ce||(e.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[t]}),"Function"===Ce&&(e=function(){var e;return this.jsvMedia||this.jsvInit(),(e=this.jsvMedia)[t].apply(e,arguments)}),e instanceof Function?Le.prototype[t]=e:Object.defineProperty(Le.prototype,t,e)};for(Pe.s();!(Ae=Pe.n()).done;)Fe()}catch(e){Pe.e(e)}finally{Pe.f()}}var Ve=function(){p(n,Le);var i=v(n);function n(e){var t;return g(this,n),t=i.call(this,e),console.log("AudioElement.constructor()",d(t)),t}return h(n,[{key:"jsvInit",value:function(){this.jsvMedia=new Le.HOOKS.Audio,f(c(n.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){f(c(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),n}(),Me=function(){p(n,Le);var i=v(n);function n(e){var t;return g(this,n),t=i.call(this,e),console.log("VideoElement.constructor()",d(t)),t}return h(n,[{key:"jsvOnStyleChanged",value:function(e){f(c(n.prototype),"jsvOnStyleChanged",this).call(this,e);var t,i=O(e);try{for(i.s();!(t=i.n()).done;){switch(t.value){case Se.TYPE.LAYOUT_SIZE:this.jsvFlushVideoView()}}}catch(e){i.e(e)}finally{i.f()}}},{key:"jsvFlushVideoView",value:function(){if(this.jsvVideoView){var e={width:this.style.width,height:this.style.height},t={width:this.jsvMedia.videoWidth,height:this.jsvMedia.videoHeight},i=Ie.JsvFitViewLayout(e,t,this.style.objectFit);this.jsvVideoView.ResetLayoutParams(i)}}},{key:"jsvInit",value:function(){this.jsvMedia=new Le.HOOKS.Video,this.addEventListener("load",this.jsvOnLoaded.bind(this)),f(c(n.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){f(c(n.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(!this.jsvVideoView){var e=ce.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),t=new y.TextureSetting(e);this.jsvVideoView=new y.LayoutView,this.jsvVideoView.ResetTexture(t),this.jsvMainView.AddView(this.jsvVideoView)}this.jsvFlushVideoView()}}]),n}();for(var Ne in Me.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},Me.PROP){var je,De=O(Me.PROP[Ne]);try{var Be=function(){var t=je.value,e={};"SetOnly"!==Ne&&"SetAndGet"!==Ne||(e.set=function(e){this.media[t]=e}),"GetOnly"!==Ne&&"SetAndGet"!==Ne||(e.get=function(){return this.media[t]}),Me.prototype[t]=e};for(De.s();!(je=De.n()).done;)Be()}catch(e){De.e(e)}finally{De.f()}}var Ue=function(){p(t,Ie);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return t}(),Ge=function(){p(n,Ie);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this)).jsvMainView=new y.JsvElementView(e),t}return h(n,[{key:"setAttribute",value:function(e,t){f(c(n.prototype),"setAttribute",this).call(this,e,t),this.jsvMainView.setAttribute(e,t)}},{key:"removeAttribute",value:function(e){f(c(n.prototype),"removeAttribute",this).call(this,e),this.jsvMainView.removeAttribute(e)}},{key:"getAttribute",value:function(e){return this.jsvMainView.getAttribute(e)}},{key:"hasAttribute",value:function(e){return this.jsvMainView.hasAttribute(e)}},{key:"jsvOnStyleChanged",value:function(e){f(c(n.prototype),"jsvOnStyleChanged",this).call(this,e)}},{key:"textContent",get:function(){return this.jsvMainView.textContent},set:function(e){this.jsvMainView.textContent=e}}]),n}(),He=function(){p(n,ge);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,ge.TEXT_NODE)).textContent=e,t}return n}(),We=function(){p(i,ge);var t=v(i);function i(){var e;return g(this,i),(e=t.call(this,ge.DOCUMENT_NODE)).location=window.location,e.rootElement=new xe,e.rootElement.ownerDocument=d(e),e.rootElement.id="root",e.activeElement=e.rootElement,e.cookie="",e.styleSheets=new Array,e.jsvIsReady=!1,e}return h(i,[{key:"createElement",value:function(e){switch(e){case i.DIV_ELEMENT:case i.FDIV_ELEMENT:return new xe;case i.IMG_ELEMENT:case i.FIMG_ELEMENT:return new Ee;case i.STYLE_ELEMENT:return new Oe;case i.AUDIO_ELEMENT:return new Ve;case i.VIDEO_ELEMENT:return new Me;default:return 0===e.indexOf("jsv")?new Ge(e):(console.warn("Document.createElement() unknown name="+e),new Ue(e))}}},{key:"createTextNode",value:function(e){return console.log("Document.createTextNode() text="+e),new He(e)}},{key:"createEvent",value:function(e){return new pe(e)}},{key:"getElementById",value:function(e){if("root"===e||"app"===e)return this.rootElement;throw Error("Document.getElementById() id="+e+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(e){if("head"===e||"#app"===e)return this.rootElement;throw Error("Document.querySelector() selectors="+e+" is UNIMPLEMENTED.")}},{key:"jsvAppendStyleSheet",value:function(e){document.styleSheets.push(e)}},{key:"jsvGetKeyFrames",value:function(e){var t,i=O(this.styleSheets);try{for(i.s();!(t=i.n()).done;){var n,r=O(t.value.cssRules);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(s.name==e)return s.cssText}}catch(e){r.e(e)}finally{r.f()}}}catch(e){i.e(e)}finally{i.f()}var a,o="@keyframes ",l=o+e,u=O(this.styleSheets);try{for(u.s();!(a=u.n()).done;){var h=a.value,c=h.jsvTextContent,d=c.indexOf(l);if(!(d<0)){var f=c.indexOf("-keyframes",d+1),g=c.indexOf(o,d+1);g<0&&(g=c.length),0<f&&f<g&&(g=f);var p=c.substring(d,g);return h.insertRule(p,0),p}}}catch(e){u.e(e)}finally{u.f()}return null}},{key:"jsvUpdateRootElement",value:function(e){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=e,this.jsvIsReady=!0}}]),i}();We.DIV_ELEMENT="div",We.IMG_ELEMENT="img",We.STYLE_ELEMENT="style",We.VIDEO_ELEMENT="video",We.AUDIO_ELEMENT="audio",We.FIMG_ELEMENT="fimg",We.FDIV_ELEMENT="fdiv";var ze=function(){function i(){g(this,i)}return h(i,null,[{key:"_isUndefined",value:function(e,t){var i=void 0===t;return i&&console.error(e+" property is undefined!"),i}},{key:"_keyframesCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("transform")<0&&t.indexOf("opacity")<0&&console.error("keyframes property is only support transform and opacity, value:",t)}},{key:"_clipPathCheck",value:function(e,t){i._isUndefined(e,t)||t.startsWith("inset")||console.error("clipPath property is support inset only.")}},{key:"_transitionOtherCheck",value:function(e,t){i._isUndefined(e,t)||console.error(e+" property is not support, you can use transition property, e.g. transition='width 2s'")}},{key:"_transitionCheck",value:function(e,t){i._isUndefined(e,t)}},{key:"_transformCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("translate3d")<0&&t.indexOf("scale3d")<0&&t.indexOf("rotate3d")<0&&t.indexOf("skew")<0&&console.error("transform property's value only support translate3d、scale3d、rotate3d、skew, value:",t)}},{key:"_textOverflowCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"clip":case"ellipsis":break;default:console.error("textOverflow property's value is not support, value:",t)}}},{key:"_whiteSpaceCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"normal":case"nowrap":break;default:console.error("whiteSpace property's value is not support, value:",t)}}},{key:"_textAlignCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"left":case"right":case"center":break;default:console.error("textAlign property's value is not support, value:",t)}}},{key:"_lineHeightCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"normal":case"inherit":console.error("lineHeight property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("lineHeight property's value is support number only, value:",t)}}},{key:"_colorCheck",value:function(e,t){i._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("color property value is not valid, need startwith rgba or #, value:",t))}},{key:"_visibilityCheck",value:function(e,t){i._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&"inherit"!==t&&console.error("visibility property's value is not support, value:",t)}},{key:"_overflowCheck",value:function(e,t){i._isUndefined(e,t)||"visible"!==t&&"hidden"!==t&&console.error("overflow property's value is support visible or hidden only, value:",t)}},{key:"_topCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("top property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("top property's value is support number only, value:",t)}}},{key:"_leftCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("left property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("left property's value is support number only, value:",t)}}},{key:"_heightCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("height property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("height property's value is support number only, value:",t)}}},{key:"_widthCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"auto":case"inherit":console.error("width property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("width property's value is support number only, value:",t)}}},{key:"_fontSizeCheck",value:function(e,t){if(!i._isUndefined(e,t))switch(t){case"smaller":case"larger":case"inherit":case"x-small":case"xx-small":case"small":case"large":case"medium":case"x-large":case"xx-large":console.error("fontSize property's value is support number only, value:",t);break;default:0<=t.indexOf("%")&&console.error("fontSize property's value is support number only, value:",t)}}},{key:"_fontWeightCheck",value:function(e,t){i._isUndefined(e,t)||"bold"!==t&&console.error("fontWeight property's value is support bold only, value:",t)}},{key:"_fontStyleCheck",value:function(e,t){i._isUndefined(e,t)||"italic"!==t&&console.error("fontWeight property's value is support italic only, value:",t)}},{key:"_borderRadiusCheck",value:function(e,t){i._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderRadius property's value is not support, value:",t)}},{key:"_borderImageWidthCheck",value:function(e,t){i._isUndefined(e,t)}},{key:"_borderImageOutsetCheck",value:function(e,t){i._isUndefined(e,t)||4<t.split(" ").length&&console.error("borderImageOutsetCheck property's value is not support, value:",t)}},{key:"_borderImageCheck",value:function(e,t){i._isUndefined(e,t)||t.indexOf("fill")<0&&console.error("borderImage property's value is not contain fill, e.g. source slice, but value:",t)}},{key:"_backgroundOtherCheck",value:function(e){console.error(e+" property not support, you can use backgroundImage property, e.g. backgroundImage=`url(${iconImgPath})`")}},{key:"_backgroundImageCheck",value:function(e,t){i._isUndefined(e,t)||"inherit"==t&&console.error("backgroundImage property's value is not support, value:",t)}},{key:"_backgroundColorCheck",value:function(e,t){i._isUndefined(e,t)||0===t.indexOf("rgba")||(0===t.indexOf("#")?7!==t.length&&console.error("backgroundColor property value's length is not valid, value:",t):console.error("backgroundColor property value is not valid, need startwith rgba or #, value:",t))}},{key:"_animationCheck",value:function(){}},{key:"_animationOtherNotSupport",value:function(e){console.error(e+" property is not support, you can use animation property, e.g. animation='mymove 5s infinite'")}},{key:"get",value:function(e){return i.ValidStyleMap[e]}}]),i}();ze.ValidStyleMap={animation:{check:ze._animationCheck.bind(ze)},animationName:{check:ze._animationOtherNotSupport.bind(ze)},animationDuration:{check:ze._animationOtherNotSupport.bind(ze)},animationTimingFunction:{check:ze._animationOtherNotSupport.bind(ze)},animationDelay:{check:ze._animationOtherNotSupport.bind(ze)},animationIterationCount:{check:ze._animationOtherNotSupport.bind(ze)},animationDirection:{check:ze._animationOtherNotSupport.bind(ze)},animationPlayState:{check:ze._animationOtherNotSupport.bind(ze)},animationFillMode:{check:ze._animationOtherNotSupport.bind(ze)},background:{check:ze._backgroundOtherCheck.bind(ze)},backgroundColor:{check:ze._backgroundColorCheck.bind(ze)},backgroundImage:{check:ze._backgroundImageCheck.bind(ze)},borderImage:{check:ze._borderImageCheck.bind(ze)},borderImageOutset:{check:ze._borderImageOutsetCheck.bind(ze)},borderImageWidth:{check:ze._borderImageWidthCheck.bind(ze)},borderRadius:{check:ze._borderRadiusCheck.bind(ze)},height:{check:ze._heightCheck.bind(ze)},width:{check:ze._widthCheck.bind(ze)},fontFamily:{check:null},fontSize:{check:ze._fontSizeCheck.bind(ze)},fontStyle:{check:ze._fontStyleCheck.bind(ze)},fontWeight:{check:ze._fontWeightCheck.bind(ze)},left:{check:ze._leftCheck.bind(ze)},overflow:{check:ze._overflowCheck.bind(ze)},top:{check:ze._topCheck.bind(ze)},visibility:{check:ze._visibilityCheck.bind(ze)},color:{check:ze._colorCheck.bind(ze)},lineHeight:{check:ze._lineHeightCheck.bind(ze)},textAlign:{check:ze._textAlignCheck.bind(ze)},whiteSpace:{check:ze._whiteSpaceCheck.bind(ze)},textOverflow:{check:ze._textOverflowCheck.bind(ze)},transform:{check:ze._transformCheck.bind(ze)},transition:{check:ze._transitionCheck.bind(ze)},transitionProperty:{check:ze._transitionOtherCheck.bind(ze)},transitionDuration:{check:ze._transitionOtherCheck.bind(ze)},transitionTimingFunction:{check:ze._transitionOtherCheck.bind(ze)},transitionDelay:{check:ze._transitionOtherCheck.bind(ze)},clipPath:{check:ze._clipPathCheck.bind(ze)},keyframes:{check:ze._keyframesCheck.bind(ze)}};var Ke,Ye=new We;window.document.createElement=Ye.createElement.bind(Ye),window.document.createTextNode=Ye.createTextNode.bind(Ye),window.document.getElementById=Ye.getElementById.bind(Ye),window.document.querySelector=Ye.querySelector.bind(Ye),window.document.createEvent=Ye.createEvent.bind(Ye),console.log("Hook Document ..."),window.document.dispatchEvent=Ye.dispatchEvent.bind(Ye),window.document.jsvAppendStyleSheet=function(e){var t=window.originDocument.createElement("style");t.type="text/css",t.innerHTML=e.jsvTextContent,this.getElementsByTagName("Head")[0].appendChild(t)},window.document.jsvGetKeyFrames=function(e){for(var t="",i=document.styleSheets,n=0;n<i.length;++n){var r=i[n];if(r.cssRules)for(var s=0;s<r.cssRules.length;++s){var a=r.cssRules[s];if(a&&a.name===e){t=a.cssText;break}}}return t&&document.jsvCheckStyleFormat("keyframes",t),t},window.document.jsvCheckStyleFormat=function(e,t){var i=ze.get(e);i?i.check&&i.check(e,t):console.error(e+" property is not support.")},ce.TextureManager=new y.TextureManager,ce.RootView=new y.RootView,Ye.jsvUpdateRootElement(ce.RootView),Ke="undefined"!=typeof ForgeExtension?y:{LogM:console.log.bind(console),LogF:console.error.bind(console),LogE:console.error.bind(console),LogW:console.warn.bind(console),LogI:console.log.bind(console),LogD:console.debug.bind(console),ThrowError:function(e){throw new Error(e)},Assert:function(e){if(!e)throw new Error("ASSERT!!!!!")},BaseActivity:function e(){g(this,e)}};var Je=function(){function n(e,t,i){g(this,n),this.PageName=e,this._FocusChild=null,this._LatestFocusChild=null,this.SubPages=[],this._ParentPage=null,this._ConsumeKeycodeUntilUp=-1,this.TouchDispatcher=null,this._Acc=.001,this._KeyLock=!1,this._CVSet=null,this._AutoShow=!1,this._IsShowing=!1,this._HostActivity=i,t&&this.SetContentView(t)}return h(n,[{key:"OnRenderFrame",value:function(){Ke.LogE("OnRenderFrame() MUST override")}},{key:"OnKeyDown",value:function(){return!1}},{key:"OnKeyUp",value:function(){return!1}},{key:"DispatchKeyDown",value:function(e){if(this._KeyLock)return!0;var t=!1;return(n.LastFocusPage=this)._FocusChild&&(t=this._FocusChild.DispatchKeyDown(e)),t=t||this.OnKeyDown(e)}},{key:"DispatchKeyUp",value:function(e){if(this._KeyLock)return!0;var t=!1;return this._FocusChild&&(t=this._FocusChild.DispatchKeyUp(e)),t=t||this.OnKeyUp(e)}},{key:"PrintLastFocusPage",value:function(){var e="------"+this.PageName+"\n",t=this._ParentPage;return t&&(e+=t.PrintLastFocusPage()),e}},{key:"OnMouseDown",value:function(){return!1}},{key:"EnableTouchDispatcher",value:function(){this.TouchDispatcher=new y.TouchDispatcher(this)}},{key:"DisableTouchDispatcher",value:function(){this.TouchDispatcher=null}},{key:"GetTouchView",value:function(){return null}},{key:"GetSwipeParams",value:function(e,t,i){var n=void 0===i||0===i?this._Acc:i,r=e*e/2/n;e<0&&(r=-r);var s=t*t/2/n;return t<0&&(s=-s),{durationX:Math.floor(Math.abs(e/n)),durationY:Math.floor(Math.abs(t/n)),distanceX:r,distanceY:s}}},{key:"OnTouch",value:function(){return!1}},{key:"DispatchTouch",value:function(e){var t=!1;return this.TouchDispatcher&&(t=this.TouchDispatcher.OnTouch(e)),t}},{key:"LostTouchFocus",value:function(){}},{key:"OnJavaKey",value:function(){return!0}},{key:"OnPlatformKey",value:function(){return!0}},{key:"PassPlatformKey",value:function(e,t){if(this._KeyLock)return!1;var i=this.OnPlatformKey(e,t);return i=i&&this.OnJavaKey(e,t)}},{key:"DispatchJavaKey",value:function(e,t){if(e===this._ConsumeKeycodeUntilUp)return 1===t&&(this._ConsumeKeycodeUntilUp=-1),y.LogM("Consume Javakey until up keycode="+e+" keyaction="+t),!1;if(this._KeyLock)return!1;-1!==this._ConsumeKeycodeUntilUp&&(y.LogE("ERROR: Other key pressed before locked key release"),this._ConsumeKeycodeUntilUp=-1);var i=this._FocusChild,n=!0;return i&&(n=i.DispatchJavaKey(e,t)),n=n&&this.PassPlatformKey(e,t),i!==this._FocusChild&&0===t&&this.CosumeAllKeyUnitlUpForFocusChange(e),n}},{key:"CosumeAllKeyUnitlUpForFocusChange",value:function(e){this._ParentPage?this._ParentPage.CosumeAllKeyUnitlUpForFocusChange(e):this._ConsumeKeycodeUntilUp=e}},{key:"OnHostActivityGetFocus",value:function(){this._ConsumeKeycodeUntilUp=-1}},{key:"IsFocus",value:function(){return!this._ParentPage||this._ParentPage._FocusChild===this}},{key:"_IsLeafInChain",value:function(){return this.IsFocus()&&!this._FocusChild}},{key:"SetParent",value:function(e,t){null!==e?(null!==t&&this.SetContentView(t),e instanceof Ke.BaseActivity&&(e=e.GetRootPageBase()),(this._ParentPage=e).SubPages.push(this),this._HostActivity=e._HostActivity,e._IsShowing&&this._AutoShow&&this._OnShowInternal()):Ke.ThrowError("ERROR: parent is null")}},{key:"SetParentPage",value:function(e){this.SetParent(e)}},{key:"RemoveSubPage",value:function(e){e===this._FocusChild&&(this._FocusChild=null),e===this._LatestFocusChild&&(this._LatestFocusChild=null);for(var t=0;t<this.SubPages.length;t++)if(e===this.SubPages[t]){e._OnHideInternal(),this.SubPages.splice(t,1);break}}},{key:"ClearSubPages",value:function(){this.SubPages=[],this._FocusChild=null,this._LatestFocusChild=null}},{key:"GetParentPage",value:function(){return this._ParentPage}},{key:"Focus",value:function(e){if(this.IsFocus()){if(!e)return void Ke.LogI("Already focused page_name="+this.PageName);if(this._IsLeafInChain())return void Ke.LogI("Already focused page_name="+this.PageName)}if(this._ParentPage){for(var t,i=[],n=this;n._ParentPage&&!n.IsFocus();)i.push(n),n=n._ParentPage;t=e&&0===i.length?this._FocusChild:i[i.length-1]._ParentPage._FocusChild;for(var r=[];t;)r.push(t),t=t._FocusChild;for(var s=r.length-1;0<=s;s--)r[s]._BlurInternal();for(var a=i.length-1;0<=a;a--)i[a]._FocusInternal();if(!e)for(var o=i[0];o._LatestFocusChild&&null===o._FocusChild;)o._LatestFocusChild.Focus(),(o=o._FocusChild)||Ke.ThrowError("ERROR: focus chain is broken")}}},{key:"_FocusInternal",value:function(){this._ParentPage?((this._ParentPage._FocusChild=this)._ParentPage._LatestFocusChild=this).OnFocus():y.LogE("No dispatcher")}},{key:"_BlurInternal",value:function(){this._ParentPage||y.LogE("No dispacher"),this._ParentPage._FocusChild===this?(this._ParentPage._FocusChild=null,this.OnBlur()):Ke.LogW("Not focus yet, page name="+this.PageName)}},{key:"GetFocusChild",value:function(){return this._FocusChild}},{key:"Hide",value:function(){this._AutoShow=!1,this._OnHideInternal()}},{key:"Show",value:function(e){this._OnShowInternal(),e&&this.Focus()}},{key:"OnFocus",value:function(){Ke.LogW("No overrided Page OnFocus event, page name="+this.PageName)}},{key:"OnBlur",value:function(){Ke.LogW("No overrided Page OnBlur event, page name="+this.PageName)}},{key:"OnShow",value:function(){Ke.LogW("No overrided Page OnShow event, page name="+this.PageName)}},{key:"OnHide",value:function(){Ke.LogW("No overrided Page OnHide event, page name="+this.PageName)}},{key:"_OnShowInternal",value:function(){for(var e,t=0;t<this.SubPages.length;t++)(e=this.SubPages[t])._AutoShow&&e._OnShowInternal();this._IsShowing||(this._IsShowing=!0,this.OnShow())}},{key:"_OnHideInternal",value:function(){for(var e,t=0;t<this.SubPages.length;t++)(e=this.SubPages[t])._IsShowing&&e._OnHideInternal();this._IsShowing&&(this._IsShowing=!1,this.OnHide())}},{key:"GetMainView",value:function(){return null===this._CVSet&&(this._CVSet=new y.MainViewSetting(null,null)),this._CVSet}},{key:"GetContentView",value:function(){return null===this._CVSet?null:this._CVSet.View}},{key:"SetContentView",value:function(e){null!==e&&(null!==this._CVSet&&this._CVSet.View.BindedPageBase(null),this._CVSet=new y.MainViewSetting(e,null),e.BindedPageBase(this))}},{key:"OnContentViewLostInternal",value:function(){this.OnContentViewLost()}},{key:"OnContentViewLost",value:function(){}},{key:"GetHostActivity",value:function(){return this._HostActivity}},{key:"SetHostActivity",value:function(e){this._HostActivity=e}},{key:"GetTextureManager",value:function(){return null!==this._HostActivity?this._HostActivity.GetTextureManager():null}},{key:"SetAutoShow",value:function(e){this._AutoShow=e}},{key:"KeyLock",value:function(){this._KeyLock=!0}},{key:"UnKeyLock",value:function(){this._KeyLock=!1}}]),n}();Je.LastFocusPage=null;var Xe,qe,Ze,Qe,$e,et=(Xe=Object,qe=Xe.getPrototypeOf||function(e){return e.__proto__},Ze=Xe.setPrototypeOf||function(e,t){return e.__proto__=t,e},Qe="object"===("undefined"==typeof Reflect?"undefined":u(Reflect))?Reflect.construct:function(e,t,i){var n,r=[null];return r.push.apply(r,t),n=e.bind.apply(e,r),Ze(new n,i.prototype)},function(e){var t=qe(e);return Ze(e,Ze(function(){return Qe(t,arguments,qe(this).constructor)},t))}),tt=function(){function e(){g(this,e),this._ChildMap={},this._FocusNodeName=null}return h(e,[{key:"add",value:function(e,t){this._ChildMap[e]=t,this._FocusNodeName==e&&t.Focus()}},{key:"focus",value:function(e){var t=this._ChildMap[e];return this._FocusNodeName=e,!!t&&(t.Focus(),!0)}},{key:"forEach",value:function(e){for(var t in this._ChildMap)e(this._ChildMap[t],t,this._ChildMap)}}]),e}();$e=window.JsView?y.PageBase:Je;var it=et(function(){p(n,$e);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._OnKeyDown=null,t._OnKeyUp=null,t._OnFocus=null,t._OnBlur=null,t._DispatchKeyDown=null,t._DispatchKeyUp=null,t._Mounted=!1,t.BranchName=null,t.Router=null,t._TmpRouter=null,t._SubNodes=t.SubPages,t._AutoShow=!1,t}return h(n,[{key:"UpdateMountState",value:function(){for(var e in this._Mounted=!0,this._SubNodes)this._SubNodes[e].UpdateMountState()}},{key:"SetRouter",value:function(e){this.Router=e}},{key:"RouterAdd",value:function(e,t){this.Router?this.Router.add(e,t):this._ParentPage?this._ParentPage.RouterAdd(e,t):(this._TmpRouter||(this._TmpRouter=new tt),this._TmpRouter.add(e,t))}},{key:"SetBranchName",value:function(e){this.BranchName=e}},{key:"SetOnKeyDown",value:function(e){this._OnKeyDown=e}},{key:"SetOnKeyUp",value:function(e){this._OnKeyUp=e}},{key:"SetOnFocus",value:function(e){this._OnFocus=e}},{key:"SetOnBlur",value:function(e){this._OnBlur=e}},{key:"SetDispatchKeyUp",value:function(e){this._DispatchKeyUp=e}},{key:"SetDispatchKeyDown",value:function(e){this._DispatchKeyDown=e}},{key:"OnKeyDown",value:function(e){return!!this._OnKeyDown&&this._OnKeyDown(e)}},{key:"OnKeyUp",value:function(e){return!!this._OnKeyUp&&this._OnKeyUp(e)}},{key:"DispatchKeyDown",value:function(e){var t=!1;return this._DispatchKeyDown&&(t=this._DispatchKeyDown(e)),!!t||f(c(n.prototype),"DispatchKeyDown",this).call(this,e)}},{key:"DispatchKeyUp",value:function(e){var t=!1;return this._DispatchKeyUp&&(t=this._DispatchKeyUp(e)),!!t||f(c(n.prototype),"DispatchKeyUp",this).call(this,e)}},{key:"AttachToActivity",value:function(e,t){f(c(n.prototype),"SetParent",this).call(this,e,t)}},{key:"SetParent",value:function(e){var i=this;null!=e&&(f(c(n.prototype),"SetParent",this).call(this,e,null),this._ParentPage._Mounted&&(this.UpdateMountState(),n.CurFocus&&n.CurFocus.Focus()),this._TmpRouter&&(this._TmpRouter.forEach(function(e,t){i._ParentPage.RouterAdd(t,e)}),this._TmpRouter=null),this.BranchName&&this._ParentPage.RouterAdd(this.BranchName,this))}},{key:"Focus",value:function(e){if(!this._Mounted)return n.CurFocus=this,void console.log("page base tree not build, cache focus");f(c(n.prototype),"Focus",this).call(this,e)}},{key:"OnFocus",value:function(){this._OnFocus&&this._OnFocus()}},{key:"OnBlur",value:function(){this._OnBlur&&this._OnBlur()}}]),n}());it.CurFocus=null,it.LastFocusNode=null,it.RootPageNode=null;function nt(e){var t=""+at++;return ot[t]=e,t}function rt(e){delete ot[e]}function st(e){return ot[e]}var at=0,ot={};it.pbMap=ot;var lt=function(){p(d,a.Component);var c=v(d);function d(e){var t;g(this,d);var i=(t=c.call(this,e)).props.onKeyUp,n=t.props.onKeyDown,r=t.props.onFocus,s=t.props.onBlur,a=t.props.dispathchKeyDown,o=t.props.dispathcKeyUp,l=t.props.branchName,u=t.props.router,h=new it(t.props.id);return l&&h.SetBranchName(l),n&&h.SetOnKeyDown(n),i&&h.SetOnKeyUp(i),r&&h.SetOnFocus(r),s&&h.SetOnBlur(s),a&&h.SetDispatchKeyDown(a),o&&h.SetDispatchKeyUp(o),u&&h.SetRouter(u),t._FocusNodeId=nt(h),t}return h(d,[{key:"render",value:function(){var t=this,e=this.props,i=(e.onKeyDown,e.onKeyUp,e.onFocus,e.onBlur,e.dispathchKeyDown,e.dispathcKeyUp,e.focus,e.branchName,e.router,r(e,["onKeyDown","onKeyUp","onFocus","onBlur","dispathchKeyDown","dispathcKeyUp","focus","branchName","router"]));return a.createElement("div",o({ref:function(e){t._Element=e}},i,{__pbid:this._FocusNodeId}))}},{key:"componentDidMount",value:function(){for(var e=st(this._FocusNodeId),t=this._Element;t.parentElement;){var i=(t=t.parentElement).getAttribute("__pbid");if(i){var n=st(i);e.SetParent(n);break}}}},{key:"componentWillUnmount",value:function(){console.log(this.props.id+"unmount"),this._Element.setAttribute("__pbid",""),this._Element=null,st(this._FocusNodeId).ClearSubPages(),rt(this._FocusNodeId)}}]),d}(),ut=function(){p(s,a.Component);var r=v(s);function s(e){var t;g(this,s),t=r.call(this,e);var i,n=new it("root");return t._FocusNodeId=nt(n),i=n,it.RootPageBase=i,window.JsView?n.AttachToActivity(ce.RootActivity,ce.RootView):(window.addEventListener("keydown",function(e){st(t._FocusNodeId).DispatchKeyDown(e),e.preventDefault&&e.preventDefault()}),window.addEventListener("keyup",function(e){st(t._FocusNodeId).DispatchKeyUp(e),e.preventDefault&&e.preventDefault()})),t}return h(s,[{key:"render",value:function(){return a.createElement("div",o({__pbid:this._FocusNodeId},this.props))}},{key:"componentDidMount",value:function(){console.log("Root didmount"),st(this._FocusNodeId).UpdateMountState(),it.CurFocus&&it.CurFocus.Focus()}},{key:"componentWillUnmount",value:function(){console.log("Root unmount"),st(this._FocusNodeId).ClearSubPages(),rt(this._FocusNodeId)}}]),s}(),ht=function(){function i(e,t){g(this,i),this.Ranges=[],void 0!==e&&void 0!==t&&this.Ranges.push(new ct(e,t))}return h(i,[{key:"Merge",value:function(e){for(var t=!1,i=this.Ranges.length,n=0;n<this.Ranges.length;n++){if(e.End+1<this.Ranges[n].Start){i=n;break}if(this.Ranges[n].Merge(e)){for(t=!0;n+1<this.Ranges.length&&this.Ranges[n].Merge(this.Ranges[n+1]);)this.Ranges.splice(n+1,1);break}}t||this.Ranges.splice(i,0,e)}},{key:"Exclude",value:function(e){for(var t=0;t<this.Ranges.length&&!(e.End<this.Ranges[t].Start);t++){var i=this.Ranges[t].Exclude(e);if(this.Ranges[t].IsEmpty()&&(this.Ranges.splice(t,1),t--),null!==i.newSplitedRange){this.Ranges.splice(t+1,0,i.newSplitedRange);break}}}},{key:"ForEach",value:function(e,t){if(e)if(t)for(var i=this.Ranges.length-1;0<=i;i--)for(var n=this.Ranges[i].End;n>=this.Ranges[i].Start;n--)e(n);else for(var r=0;r<this.Ranges.length;r++)for(var s=this.Ranges[r].Start;s<=this.Ranges[r].End;s++)e(s);else console.log("Callback function is invalid")}}]),i}(),ct=function(){function i(e,t){g(this,i),this.Start=e,this.End=t}return h(i,[{key:"Merge",value:function(e){return this.IsInterAct(e)?(this.Start>e.Start&&(this.Start=e.Start),this.End<e.End&&(this.End=e.End),!0):this.End+1===e.Start?(this.End=e.End,!0):this.Start===e.End+1&&(this.Start=e.Start,!0)}},{key:"IsInterAct",value:function(e){return e.Start<this.Start?!(e.End<this.Start):e.Start<=this.End}},{key:"Exclude",value:function(e){var t={success:!1,newSplitedRange:null};return this.IsInterAct(e)&&(e.Start<=this.Start?e.End<this.End?this.Start=e.End+1:this.Clear():(e.End<this.End&&(t.newSplitedRange=new i(e.End+1,this.End)),this.End=e.Start-1),t.success=!0),t}},{key:"IsEmpty",value:function(){return this.Start>this.End}},{key:"Clear",value:function(){this.End=this.Start-1}},{key:"Clone",value:function(){return new i(this.Start,this.End)}}]),i}(),dt=function(){function r(e,t,i,n){g(this,r),this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return h(r,[{key:"Equals",value:function(e){return null!==e&&(e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height)}}]),r}(),ft=(new(function(){function e(){g(this,e)}return h(e,[{key:"FormatRectArea",value:function(e){var t=null;if(e instanceof dt)t=e;else if("object"===u(e)&&null!==e){if(isNaN(e.width)||isNaN(e.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");t=new dt(0,0,e.width,e.height)}return t}}]),e}()),function(){function n(e,t,i){g(this,n),this.IdsMap=[],this._IdsTotal=-1,this.List=[],this.Orient={type:e,widthMax:t},this.Layout={type:i||"relative"}}return h(n,[{key:"SetIdsMap",value:function(e,t){this.IdsMap[e]=t,this._IdsTotal=-1,this.List[t].id=e}},{key:"AddItem",value:function(e){this.List.push(e)}},{key:"GetIdsTotal",value:function(){if(this._IdsTotal<0){for(var e=0,t=0;t<this.List.length;t++)0<=this.List[t].id&&e++;this._IdsTotal=e}return this._IdsTotal}}]),n}());ft.getTemplateItem=function(e,t){return{id:-1,hasSub:!!e.hasSub,xPos:e.blocks.x?e.blocks.x:0,yPos:e.blocks.y?e.blocks.y:0,centerXPos:0,centerYPos:0,width:e.blocks.w,height:e.blocks.h,focusAble:void 0===e.focusable||e.focusable,needRedraw:void 0===e.needRedraw||e.needRedraw,onBottomLine:!1,view:null,data:t}};function gt(){}function pt(){return null}var vt=function(){function r(e,t,i,n){g(this,r),this._Gaps=[{GapStart:0,GapEnd:i-1}],this._FenceTotalWidth=i,this.AheadOffset=n,0<t&&this._SplitGap(0,e,t)}return h(r,[{key:"HasGapFor",value:function(e){for(var t=0;t<this._Gaps.length;t++)if(this._Gaps[t].GapEnd-this._Gaps[t].GapStart+1>=e)return{startPos:this._Gaps[t].GapStart};return null}},{key:"MarkGapUsed",value:function(e,t){if(t<=0)return this._Gaps.length;for(var i=e+t-1,n=-1,r=0;r<this._Gaps.length;r++)if(this._Gaps[r].GapStart<=e&&this._Gaps[r].GapEnd>=i){n=r;break}return-1===n&&console.log("Error in mark gap used, not found suitable gap of offset="+this.AheadOffset),this._SplitGap(n,e,t),this._Gaps.length}},{key:"_SplitGap",value:function(e,t,i){var n=this._Gaps.splice(e,1)[0],r=t+i-1;(t<n.GapStart||r>n.GapEnd)&&console.log("ERROR in split Fence Gap, range overflow"),r!==n.GapEnd&&this._Gaps.splice(e,0,{GapStart:1+r,GapEnd:n.GapEnd}),t!==n.GapStart&&this._Gaps.splice(e,0,{GapStart:n.GapStart,GapEnd:t-1})}},{key:"Fork",value:function(e){var t=new r(0,0,0,0);return t._Gaps=JSON.parse(JSON.stringify(this._Gaps)),t._FenceTotalWidth=this._FenceTotalWidth,t.AheadOffset=e,t}}]),r}(),yt=function(){function s(e,t,i,n,r){g(this,s),this._Template=new ft(e,t,i),this._FenceStack=[new vt(0,0,this._Template.Orient.widthMax,0)],this._Identity=0,this._MoveLimitArea=new dt(0,0,n,r),this._FenceEdge={StartX:0,StartY:0},this._NotOccupiedEdgeList=[],this._SupportHistoryPath=!1,this._VisibleRangeSearchBaseItem=null}return h(s,[{key:"_CheckNeighborItemMatching",value:function(e,t,i){var n=!1,r=t.edgeObj,s=i.edgeObj,a="rightEdge",o="leftEdge";switch(e){case"left":a="rightEdge",o="leftEdge";break;case"right":a="leftEdge",o="rightEdge";break;case"top":a="bottomEdge",o="topEdge";break;case"bottom":o="bottomEdge",a="topEdge";break;default:console.log("_CheckNeighborItemMatching unknown direction:"+e)}var l=s[a].range.Start,u=s[a].range.Clone();s[a].range.Exclude(r[o].range),r[o].range.Exclude(u);var h=s[a].range.Start;return s[a].range.IsEmpty()&&(n=!(s[a]=null)),r[o].range.IsEmpty()&&(n=!(r[o]=null)),l!==h&&(n=!0),n}},{key:"_FindNearestNeighbor",value:function(e){for(var t=e.edgeObj,i=-1,n=-1,r=-1,s=-1,a=-1,o=-1,l=-1,u=-1,h=0;h<this._NotOccupiedEdgeList.length;h++){var c=this._NotOccupiedEdgeList[h],d=c.edgeObj;if(e!==c){if(null!==t.leftEdge&&null!==d.rightEdge&&t.leftEdge.x>=d.rightEdge.x&&t.leftEdge.range.IsInterAct(d.rightEdge.range)){if(-1===a){a=t.leftEdge.x-d.rightEdge.x,i=h;continue}if(a>t.leftEdge.x-d.rightEdge.x){a=t.leftEdge.x-d.rightEdge.x,i=h;continue}}if(null!==t.rightEdge&&null!==d.leftEdge&&t.rightEdge.x<=d.leftEdge.x&&t.rightEdge.range.IsInterAct(d.leftEdge.range)){if(-1===o){o=d.leftEdge.x-t.rightEdge.x,n=h;continue}if(o>d.leftEdge.x-t.rightEdge.x){o=d.leftEdge.x-t.rightEdge.x,n=h;continue}}if(null!==t.topEdge&&null!==d.bottomEdge&&t.topEdge.y>=d.bottomEdge.y&&t.topEdge.range.IsInterAct(d.bottomEdge.range)){if(-1===l){l=t.topEdge.y-d.bottomEdge.y,r=h;continue}if(l>t.topEdge.y-d.bottomEdge.y){l=t.topEdge.y-d.bottomEdge.y,r=h;continue}}if(null!==t.bottomEdge&&null!==d.topEdge&&t.bottomEdge.y<=d.topEdge.y&&t.bottomEdge.range.IsInterAct(d.topEdge.range)){if(-1===u){u=d.topEdge.y-t.bottomEdge.y,s=h;continue}if(u>d.topEdge.y-t.bottomEdge.y){u=d.topEdge.y-t.bottomEdge.y,s=h;continue}}}}return{left:i,right:n,top:r,bottom:s}}},{key:"_CalculateNeighborItem",value:function(e){for(var t=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],r=n.edgeObj,s=n.index;if(this._Template.Orient.type===mt){if(null===r.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!e&&r.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===r.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!e&&r.rightEdge.x>this._FenceEdge.StartX)continue}var a=this._FindNearestNeighbor(n);if(-1!==a.left){var o=this._NotOccupiedEdgeList[a.left],l=o.index;if(e)t[l].tmpNeighborIndexList.right.push(s),t[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,o)&&(t[l].neighborIndexList.right.push(s),t[s].neighborIndexList.left.push(l),t[l].tmpNeighborIndexList.right=[],t[s].tmpNeighborIndexList.left=[])}if(-1!==a.right){var u=this._NotOccupiedEdgeList[a.right],h=u.index;if(e)t[h].tmpNeighborIndexList.left.push(s),t[s].tmpNeighborIndexList.right.push(h);else this._CheckNeighborItemMatching("right",n,u)&&(t[h].neighborIndexList.left.push(s),t[s].neighborIndexList.right.push(h),t[h].tmpNeighborIndexList.left=[],t[s].tmpNeighborIndexList.right=[])}if(-1!==a.top){var c=this._NotOccupiedEdgeList[a.top],d=c.index;if(e)t[d].tmpNeighborIndexList.bottom.push(s),t[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(t[d].neighborIndexList.bottom.push(s),t[s].neighborIndexList.top.push(d),t[d].tmpNeighborIndexList.bottom=[],t[s].tmpNeighborIndexList.top=[])}if(-1!==a.bottom){var f=this._NotOccupiedEdgeList[a.bottom],g=f.index;if(e)t[g].tmpNeighborIndexList.top.push(s),t[s].tmpNeighborIndexList.bottom.push(g);else this._CheckNeighborItemMatching("bottom",n,f)&&(t[g].neighborIndexList.top.push(s),t[s].neighborIndexList.bottom.push(g),t[g].tmpNeighborIndexList.top=[],t[s].tmpNeighborIndexList.bottom=[])}}}},{key:"_TryCalculateNeighborItem",value:function(e,t,i,n,r){var s={index:e,edgeObj:{leftEdge:{x:t,range:new ct(i,i+r-1)},rightEdge:{x:t+n,range:new ct(i,i+r-1)},topEdge:{y:i,range:new ct(t,t+n-1)},bottomEdge:{y:i+r,range:new ct(t,t+n-1)}}};0===t&&(s.edgeObj.leftEdge=null),0===i&&(s.edgeObj.topEdge=null);var a=!1,o=this._Template.Orient.widthMax,l=this._FenceEdge.StartX,u=this._FenceEdge.StartY;this._Template.Orient.type===mt?(t+n===o&&(s.edgeObj.rightEdge=null),i>this._FenceEdge.StartY&&(a=!0,u=i)):(i+r===o&&(s.edgeObj.bottomEdge=null),t>this._FenceEdge.StartX&&(a=!0,l=t)),this._FenceEdge.StartX=l,this._FenceEdge.StartY=u,this._NotOccupiedEdgeList.push(s),a&&this._CalculateNeighborItem()}},{key:"_UpdateLastFenceEdge",value:function(){for(var e=this._FenceEdge,t={StartX:-1,StartY:-1},i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i].edgeObj;this._Template.Orient.type===mt?null!==n.bottomEdge&&n.bottomEdge.y>e.StartY&&(-1===t.StartY||n.bottomEdge.y<t.StartY)&&(t.StartY=n.bottomEdge.y):null!==n.rightEdge&&n.rightEdge.x>e.StartX&&(-1===t.StartX||n.rightEdge.y<t.StartX)&&(t.StartX=n.rightEdge.x)}this._FenceEdge=t}},{key:"ParseTemplateItem",value:function(e,t){var i,n,r,s,a=ft.getTemplateItem(e,t),o=this._FenceStack,l=-1,u=1,h=a.id,c=a.width,d=a.height,f=0,g=0,p=0,v=0,y=0;if("relative"===this._Template.Layout.type){v=this._Template.Orient.type===mt?c:d,y=this._Template.Orient.type===mt?d:c;for(var m=null,_=null;0<o.length;){var w=o[o.length-1];if(null!==(_=w.HasGapFor(v))){m=w;break}o.pop()}null!==_?(f=_.startPos,g=m.AheadOffset):console.log("ERROR: coding error, header full gap fence lost"),p=this._Template.Orient.type===mt?(i=f,r=v,((n=g)+(s=y))/this._MoveLimitArea.height):(n=f,s=v,((i=g)+(r=y))/this._MoveLimitArea.width)}else i=a.xPos,n=a.yPos,r=c,s=d,p=this._Template.Orient.type===mt?(n+s)/this._MoveLimitArea.height:(i+r)/this._MoveLimitArea.width;-1===l&&(l=h);var S=Math.ceil(p);0<=p&&S!==u&&(u=S,l=h),a.curPageHeadId=l,a.neighborIndexList={left:[],top:[],right:[],bottom:[]},a.tmpNeighborIndexList={left:[],top:[],right:[],bottom:[]},a.pathHistory={left:null,top:null,right:null,bottom:null},a.xPos=i,a.yPos=n,a.centerXPos=Math.floor(i+r/2)-1,a.centerYPos=Math.floor(n+s/2)-1,this._Template.Orient.type!==mt&&n+s===this._Template.Orient.widthMax&&(a.onBottomLine=!0),this._Template.AddItem(a),a.focusAble&&this._Template.SetIdsMap(this._Identity++,this._Template.List.length-1),this._TryCalculateNeighborItem(this._Template.List.length-1,a.xPos,a.yPos,a.width,a.height);var b=g+y-1;o[0].AheadOffset<=b&&o.splice(0,0,new vt(0,0,this._Template.Orient.widthMax,1+b));for(var k=!1,I=!1,T=-1,x=o.length-1;0<=x;x--){if(!(o[x].AheadOffset<=b)){o[x].AheadOffset===1+b&&(I=!0),T=x;break}o[x].AheadOffset===b&&(k=!0),0===o[x].MarkGapUsed(f,v)&&o.splice(x,1)}var E=b;if(!k&&T+1<=o.length-1){var R=o[T+1].Fork(E);o.splice(T+1,0,R)}if(!I&&0<T){var O=o[T].Fork(1+E);o.splice(T+1,0,O)}}},{key:"GetItem",value:function(e){return this._Template.List[this._Template.IdsMap[e]]}},{key:"_CheckIdsHasFocusable",value:function(e){for(var t=this._Template.List,i=!1,n=0;n<e.length;n++){if(t[e[n]].focusAble){i=!0;break}}return i}},{key:"_IsInNeighborList",value:function(e,t){for(var i=!1,n=e.length-1;0<=n;n--)if(e[n]===t){i=!0;break}return i}},{key:"_GetValidNeighborIndex",value:function(e,t,i){var n=this._Template.List,r=-1,s=n[t],a=n[e],o=null,l=null;if(0<(o="top"===i?(l=s.neighborIndexList.left,s.neighborIndexList.right):(l=s.neighborIndexList.right,s.neighborIndexList.left)).length)for(var u=0;u<o.length;u++){var h=o[u],c=n[h];if(c.focusAble&&("top"===i&&c.yPos+c.height<=a.yPos||"bottom"===i&&c.yPos>=a.yPos+a.height)){r=h;break}}if(-1===r&&0<l.length)for(var d=0;d<l.length;d++){var f=l[d],g=n[f];if(g.focusAble&&("top"===i&&g.yPos+g.height<=a.yPos||"bottom"===i&&g.yPos>=a.yPos+a.height)){r=f;break}}return r}},{key:"_CaculateNeighborItem",value:function(e){for(var t=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],r=n.edgeObj,s=n.index;if(this._Template.Orient.type===mt){if(null===r.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!e&&r.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===r.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!e&&r.rightEdge.x>this._FenceEdge.StartX)continue}var a=this._FindNearestNeighbor(n);if(-1!==a.left){var o=this._NotOccupiedEdgeList[a.left],l=o.index;if(e)t[l].tmpNeighborIndexList.right.push(s),t[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,o)&&(t[l].neighborIndexList.right.push(s),t[s].neighborIndexList.left.push(l),t[l].tmpNeighborIndexList.right=[],t[s].tmpNeighborIndexList.left=[])}if(-1!==a.right){var u=this._NotOccupiedEdgeList[a.right],h=u.index;if(e)t[h].tmpNeighborIndexList.left.push(s),t[s].tmpNeighborIndexList.right.push(h);else this._CheckNeighborItemMatching("right",n,u)&&(t[h].neighborIndexList.left.push(s),t[s].neighborIndexList.right.push(h),t[h].tmpNeighborIndexList.left=[],t[s].tmpNeighborIndexList.right=[])}if(-1!==a.top){var c=this._NotOccupiedEdgeList[a.top],d=c.index;if(e)t[d].tmpNeighborIndexList.bottom.push(s),t[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(t[d].neighborIndexList.bottom.push(s),t[s].neighborIndexList.top.push(d),t[d].tmpNeighborIndexList.bottom=[],t[s].tmpNeighborIndexList.top=[])}if(-1!==a.bottom){var f=this._NotOccupiedEdgeList[a.bottom],g=f.index;if(e)t[g].tmpNeighborIndexList.top.push(s),t[s].tmpNeighborIndexList.bottom.push(g);else this._CheckNeighborItemMatching("bottom",n,f)&&(t[g].neighborIndexList.top.push(s),t[s].neighborIndexList.bottom.push(g),t[g].tmpNeighborIndexList.top=[],t[s].tmpNeighborIndexList.bottom=[])}}}},{key:"CalculateNeighborWhenAddStop",value:function(){this._UpdateLastFenceEdge(),this._CaculateNeighborItem();this._CaculateNeighborItem(!0);for(var e=this._Template.List,t=e.length-1,i=e[t],n=e.length-1;0<=n;n--)if((i=e[n]).focusAble){t=n;break}for(var r=e.length-1;0<=r;r--){var s=e[r];if(s.focusAble){if(0<s.neighborIndexList.bottom.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.bottom)){var a=s.neighborIndexList.bottom[s.neighborIndexList.bottom.length-1],o=this._GetValidNeighborIndex(r,a,"bottom");-1!==o&&(s.neighborIndexList.bottom=[],s.neighborIndexList.bottom.push(o))}if(0<s.neighborIndexList.top.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.top)){var l=this._GetValidNeighborIndex(r,s.neighborIndexList.top[s.neighborIndexList.top.length-1],"top");-1!==l&&(s.neighborIndexList.top=[],s.neighborIndexList.top.push(l))}}}if(this._Template.Orient.type!==mt){for(var u=null,h=-1,c=0,d=t-1;0<=d;d--){var f=e[d];f.focusAble&&f.yPos>=i.yPos+i.height&&(0!==f.neighborIndexList.right.length&&this._CheckIdsHasFocusable(f.neighborIndexList.right)&&!this._IsInNeighborList(f.neighborIndexList.right,t)||(c=Math.pow(i.xPos-f.xPos,2)+Math.pow(i.yPos-f.yPos,2),(-1===h||c<h)&&(h=c,u=d)))}u&&(i.neighborIndexList.bottom=[],i.neighborIndexList.bottom.push(u))}else for(var g=t-1;0<=g;g--){var p=e[g];p.focusAble&&p.yPos+p.height<i.yPos+i.height&&0===p.neighborIndexList.bottom.length&&p.neighborIndexList.bottom.push(t)}}},{key:"GetNextItem",value:function(e,t,i,n){0===t&&0===i&&console.log("GetNextItem(): offset is 0"),0!==t&&0!==i&&console.log("GetNextItem(): not support change vertical and horizontal and the same time");var r,s=this._Template.IdsMap[e];return r=0!==t?this._GetNextItemVertical(s,t):this._GetNextItemHorizontal(s,i),n&&null===r&&(r=0!==t?this._GetNextLoopItemVertical(s,t):this._GetNextLoopItemHorizontal(s,i)),null===r?-1:r.id}},{key:"_GetNextItemVertical",value:function(e,t){var i=this._Template.List,n=i[e].centerXPos,r="top",s="bottom";0<t&&(s="top",r="bottom");for(var a=i.length-1,o=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){a=l;break}}var u=!1,h=-1,c=null;if(this._SupportHistoryPath&&(c=i[e].pathHistory[r]),null===c){var d=i[e].neighborIndexList[r];if(0<i[e].tmpNeighborIndexList[r].length&&(d=d.concat(i[e].tmpNeighborIndexList[r])),1===d.length)h=d[0],a===e&&"bottom"===r&&o===_t||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),u=!0;else{for(var f=0;f<d.length;f++){var g=i[h=d[f]];if(n<=g.xPos+g.width-1&&n>=g.xPos){a===e&&"bottom"===r&&o===_t||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),u=!0;break}}if(!u||!i[h].focusAble)for(var p=0;p<d.length;p++){var v=d[p];if(i[v].focusAble){a===e&&"bottom"===r&&o===_t||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),h=v,u=!0;break}}}}else h=c,a===e&&"bottom"===r&&o===_t||(i[h].pathHistory[s]=e),u=!0;return u?i[h].focusAble?i[h]:this._GetNextItemVertical(h,t):null}},{key:"_GetNextItemHorizontal",value:function(e,t){var i=this._Template.List,n=i[e].centerYPos,r="left",s="right";0<t&&(s="left",r="right");for(var a=i.length-1,o=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){a=l;break}}var u=!1,h=-1,c=null;if(this._SupportHistoryPath&&(c=i[e].pathHistory[r]),null===c){var d=i[e].neighborIndexList[r];if(0<i[e].tmpNeighborIndexList[r].length&&(d=d.concat(i[e].tmpNeighborIndexList[r])),1===d.length)h=d[0],a===e&&"right"===r&&o===mt||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),u=!0;else{for(var f=0;f<d.length;f++){var g=i[h=d[f]];if(n<=g.yPos+g.height-1&&n>=g.yPos){a===e&&"right"===r&&o===mt||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),u=!0;break}}if(!u||!i[h].focusAble)for(var p=0;p<d.length;p++){var v=d[p];if(i[v].focusAble){a===e&&"right"===r&&o===mt||(i[e].pathHistory[r]=h,i[h].pathHistory[s]=e),h=v,u=!0;break}}}}else h=c,a===e&&"right"===r&&o===mt||(i[h].pathHistory[s]=e),u=!0;return u?i[h].focusAble?i[h]:this._GetNextItemHorizontal(h,t):null}},{key:"_GetNextLoopItemVertical",value:function(e,t){var i=this._Template.List,n=i[e].centerXPos,r="bottom";0<t&&(r="top");var s=!1,a=-1,o=i[e].neighborIndexList[r];for(0<i[e].tmpNeighborIndexList[r].length&&(o=o.concat(i[e].tmpNeighborIndexList[r]));1<=o.length;)for(var l=0;l<o.length;l++){var u=i[a=o[l]];if(n<=u.xPos+u.width-1&&n>=u.xPos){o=i[a].neighborIndexList[r],s=!0;break}}return s?i[a].focusAble?i[a]:this._GetNextLoopItemVertical(a,t):null}},{key:"_GetNextLoopItemHorizontal",value:function(e,t){var i=this._Template.List,n=i[e].centerYPos,r="right";0<t&&(r="left");var s=!1,a=-1,o=i[e].neighborIndexList[r];for(0<i[e].tmpNeighborIndexList[r].length&&(o=o.concat(i[e].tmpNeighborIndexList[r]));1<=o.length;)for(var l=0;l<o.length;l++){var u=i[a=o[l]];if(n<=u.yPos+u.height-1&&n>=u.yPos){o=i[a].neighborIndexList[r],s=!0;break}}return s?i[a].focusAble?i[a]:this._GetNextLoopItemHorizontal(a,t):null}},{key:"GetTemplate",value:function(){return this._Template}},{key:"GetVisibleItemList",value:function(e,t,i){if(t<e)return null;for(var n=this._Template.IdsMap[i],r={resultStartIdx:-1,resultEndIdx:-1,enableBackwardSearching:!0,enableForwardSearching:!0,checkingStartLinePos:e,checkingEndLinePos:t},s={searchDirect:-1,baseIdx:n,checkingStartLineRanges:new ht,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new ht,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:0,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:r},a={searchDirect:1,baseIdx:n,checkingStartLineRanges:new ht,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new ht,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:this._Template.List.length-1,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:r},o=this._Template.Orient.type===mt,l=0;r.enableBackwardSearching||r.enableForwardSearching;)r.enableBackwardSearching&&this._DoSearching(s,-l,o),r.enableForwardSearching&&this._DoSearching(a,l,o),l++;if(r.resultStartIdx<0&&(0<=s.latestOverStartLineIdx&&0<=s.firstStartLineBlockIdx?r.resultStartIdx=s.latestOverStartLineIdx:0<=a.firstStartLineBlockIdx&&(r.resultStartIdx=a.firstStartLineBlockIdx)),r.resultEndIdx<0&&(0<=a.latestOverEndLineIdx&&0<=a.firstEndLineBlockIdx?r.resultEndIdx=a.latestOverEndLineIdx:0<=s.firstEndLineBlockIdx&&(r.resultEndIdx=s.firstEndLineBlockIdx)),r.resultStartIdx<0&&r.resultEndIdx<0){var u=this._Template.List[0],h=o?u.yPos:u.xPos,c=this._Template.List[this._Template.List.length-1],d=o?c.yPos:c.xPos,f=o?c.height:c.width;e<h&&d+f<t&&(r.resultStartIdx=0,r.resultEndIdx=this._Template.List.length-1)}var g=null;r.resultStartIdx<0&&r.resultEndIdx<0||(g={visibleStart:0<=r.resultStartIdx?r.resultStartIdx:0,visibleEnd:0<=r.resultEndIdx?r.resultEndIdx:this._Template.List.length-1});return g}},{key:"_DoSearching",value:function(e,t,i){var n=this._Template.List[e.baseIdx+t],r=i?n.xPos:n.yPos,s=i?n.width:n.height,a=i?n.yPos:n.xPos,o=i?n.height:n.width;if(e.common.resultStartIdx<0&&!e.startLineRangesFulled){var l=!1;if(a<=e.common.checkingStartLinePos&&a+o-1>=e.common.checkingStartLinePos?(e.latestOverStartLineIdx=e.baseIdx+t,e.firstStartLineBlockIdx<0&&(e.firstStartLineBlockIdx=e.baseIdx+t),e.checkingStartLineRanges.Merge(new ct(r,r+s-1)),l=!0):e.searchDirect<0&&a+o-1<=e.common.checkingStartLinePos&&(e.checkingStartLineRanges.Merge(new ct(r,r+s-1)),l=!0),l){var u=e.checkingStartLineRanges.Ranges[0];u&&this.DebugPrint&&u.Start<=0&&u.End>=this._Template.Orient.widthMax-1&&((u.End>this._Template.Orient.widthMax-1||u.Start<0)&&(e.startLineRangesFulled=!0),0<e.searchDirect?e.common.resultStartIdx=e.firstStartLineBlockIdx:e.common.resultStartIdx=e.latestOverStartLineIdx,0<=e.common.resultStartIdx&&(e.common.enableBackwardSearching=!1))}}if(e.common.resultEndIdx<0&&!e.endLineRangesFulled){var h=!1;if(a<=e.common.checkingEndLinePos&&a+o-1>=e.common.checkingEndLinePos?(e.latestOverEndLineIdx=e.baseIdx+t,e.firstEndLineBlockIdx<0&&(e.firstEndLineBlockIdx=e.baseIdx+t),e.checkingEndLineRanges.Merge(new ct(r,r+s-1)),h=!0):0<e.searchDirect&&a>=e.common.checkingEndLinePos&&(e.checkingEndLineRanges.Merge(new ct(r,r+s-1)),h=!0),h){var c=e.checkingEndLineRanges.Ranges[0];c&&this.DebugPrint&&c.Start<=0&&c.End>=this._Template.Orient.widthMax-1&&((c.End>this._Template.Orient.widthMax-1||c.Start<0)&&(e.endLineRangesFulled=!0),e.searchDirect<0?e.common.resultEndIdx=e.firstEndLineBlockIdx:e.common.resultEndIdx=e.latestOverEndLineIdx,0<=e.common.resultEndIdx&&(e.common.enableForwardSearching=!1))}}e.baseIdx+t===e.endSearchingIndex&&(0<e.searchDirect?e.common.enableForwardSearching=!1:e.common.enableBackwardSearching=!1,e.searchToBorder=!0)}}]),s}(),mt=Symbol("vertical"),_t=Symbol("horizontal"),wt={seamLess:Symbol("seamless"),wholePage:Symbol("wholePage"),seamlessFixedId:Symbol("seamlessFixedId")},St={left:Symbol("left"),right:Symbol("right"),top:Symbol("top"),bottom:Symbol("bottom")},bt=function(){p(n,a.Component);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._setVisibility=t._setVisibility.bind(d(t)),t._updateView=t._updateView.bind(d(t)),t._Visibility=!0,t.props.setVisibleFunc&&(t.props.setVisibleFunc(t._setVisibility),t._Visibility=!1),t.props.registerUpdateFunc&&t.props.registerUpdateFunc(t._updateView),t.state={visible:t._Visibility},t}return h(n,[{key:"_updateView",value:function(){this.setState({visible:this._Visibility})}},{key:"_setVisibility",value:function(e){this._Visibility=e,this.setState({visible:this._Visibility})}},{key:"render",value:function(){var e=this.state.visible?"inherit":"hidden";return a.createElement("div",{style:{left:this.props.x,top:this.props.y,visibility:e}},this.props.renderFunc())}}]),n}(),kt=function(){p(n,a.Component);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._updateView=t._updateView.bind(d(t)),t.props.registerUpdateFunc(t._updateView),t.state={renderFunc:pt,onRenderDone:gt},t}return h(n,[{key:"_updateView",value:function(e,t){this.setState({renderFunc:e,onRenderDone:t||gt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),It=function(){p(n,a.Component);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._updateView=t._updateView.bind(d(t)),t.props.registerUpdateFunc(t._updateView),t.state={renderFunc:function(){return null},onRenderDone:gt},t}return h(n,[{key:"_updateView",value:function(e,t){this.setState({renderFunc:e,onRenderDone:t||gt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),Tt=function(){p(n,a.Component);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._updateView=t._updateView.bind(d(t)),t.props.registerUpdateFunc(t._updateView),t.state={renderFunc:function(){return null},onRenderDone:gt},t}return h(n,[{key:"_updateView",value:function(e,t){this.setState({renderFunc:e,onRenderDone:t||gt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),xt=function(){p(t,a.Component);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return h(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return a.createElement("div",null,a.createElement(kt,{registerUpdateFunc:this.props.registerUpdateContentFunc}),a.createElement(Tt,{registerUpdateFunc:this.props.registerUpdateBlurFunc}),a.createElement(It,{registerUpdateFunc:this.props.registerUpdateFocusFunc}))}}]),t}(),Et=function(){p(n,a.Component);var i=v(n);function n(e){var t;return g(this,n),(t=i.call(this,e))._updateView=t._updateView.bind(d(t)),t.props.registerUpdateFunc(t._updateView),t.state={x:0,y:0,transitionCallback:gt},t}return h(n,[{key:"_updateView",value:function(e,t,i){this.setState({x:e,y:t,transitionCallback:i})}},{key:"render",value:function(){return a.createElement("div",{style:{left:this.props.x,top:this.props.y}},a.createElement("div",{style:{transition:this.props.transition,top:this.state.y,left:this.state.x},onTransitionEnd:this.state.transitionCallback},a.createElement(xt,{registerUpdateContentFunc:this.props.registerUpdateContentFunc,registerUpdateFocusFunc:this.props.registerUpdateFocusFunc,registerUpdateBlurFunc:this.props.registerUpdateBlurFunc})))}}]),n}(),Rt=function(){function e(){g(this,e),this._Component=null,this.registerComponent=this.registerComponent.bind(this),this.unregisterComponent=this.unregisterComponent.bind(this),this.dispatch=this.dispatch.bind(this)}return h(e,[{key:"registerComponent",value:function(e){this._Component=e}},{key:"unregisterComponent",value:function(){this._Component=null}},{key:"dispatch",value:function(e){e&&this._Component&&this._Component._dispathcEvent(e)}}]),e}(),Ot=function(){p(t,Rt);var e=v(t);function t(){return g(this,t),e.apply(this,arguments)}return t}();Ot.Type={setFocusId:Symbol("setFocusId"),setFocusRect:Symbol("setFocusRect"),updateItem:Symbol("updateItem"),slideToItem:Symbol("slideTo")};var Lt=function(){p(f,a.Component);var o=v(f);function f(e){var i;g(this,f),(i=o.call(this,e))._OnKeyDown=i._OnKeyDown.bind(d(i)),i._onFocusInner=i._onFocusInner.bind(d(i)),i._onBlurInner=i._onBlurInner.bind(d(i)),i._OnFocusableItemEdge=i._OnFocusableItemEdge.bind(d(i)),i._updateItemVisibility=i._updateItemVisibility.bind(d(i)),i._onTransitionEnd=i._onTransitionEnd.bind(d(i)),i._getContentView=i._getContentView.bind(d(i)),i._getFocusView=i._getFocusView.bind(d(i)),i._getBlurView=i._getBlurView.bind(d(i)),i._onContentUpdate=i._onContentUpdate.bind(d(i)),i._drawItem=i._drawItem.bind(d(i)),i._getSlideAnim=i._getSlideAnim.bind(d(i)),i._setItmeVisible=i._setItmeVisible.bind(d(i)),i._updateFocusItem=i._updateFocusItem.bind(d(i)),i._dispathcEvent=i._dispathcEvent.bind(d(i)),i._getQueryObj=i._getQueryObj.bind(d(i)),i.props.dispatcher&&i.props.dispatcher.registerComponent(d(i)),i._AllState={},i._AllState.isFocus=!1;var t=f._getTemplateParser(i.props);f._AddTemplateItem(i.props,t,0),i._AllState.templateParser=t,i._VisibleItemList=[],i._NeedHideItemList=[],i._ItemVisibleFuncMap=[],i._registerItemVisibleFunc=function(t){return function(e){i._ItemVisibleFuncMap[t]={visible:!1,func:e}}},i._itemUpdateFuncMap={},i._registerItemUpdateFunc=function(t){return function(e){i._itemUpdateFuncMap[t]=e}},i._updateRootFunc=gt,i._registerUpdateRootFunc=function(e){i._updateRootFunc=e},i._updateContentFunc=gt,i._registerUpdateContentFunc=function(e){i._updateContentFunc=e},i._updateFocusFunc=gt,i._registerUpdateFocusFunc=function(e){i._updateFocusFunc=e},i._updateBlurFunc=gt,i._registerUpdateBlurFunc=function(e){i._updateBlurFunc=e},i.queryPosition=function(e){return{xPos:i._AllState.templateParser.GetItem(e).xPos,yPos:i._AllState.templateParser.GetItem(e).yPos}};var n=0,r=0,s=i.props.direction===mt?i.props.height:i.props.width;if(i._VisibleItemList=i._getVisibleItemList(n,r,r+s-1),void 0!==i.props.baseAnchor){var a=i._BaseAnchorInfo2Pos(i.props.baseAnchor,0,s);r=i.props.direction===mt?a.yPos:a.xPos,i._VisibleItemList=i._getVisibleItemList(i.props.baseAnchor.id,r,r+s-1)}return i.props.initFocusId&&(n=i.props.initFocusId,void 0===i.props.baseAnchor&&(r=i._CalculateSlide(i._AllState.templateParser.GetItem(n),1,0),i._VisibleItemList=i._getVisibleItemList(n,r,r+s-1))),i._AllState.enterFocusId=-1,i._AllState.enterFocusRect=null,i._AllState.focusId=n,i._AllState.preFocusId=-1,i._AllState.preEdgeRect=null,i._AllState.visibleStart=r,i._AllState.visibleRange=s,i._AllState.baseAnchor=i.props.baseAnchor,i}return h(f,[{key:"_getQueryObj",value:function(e){return{id:e,queryPosition:this.queryPosition}}},{key:"_getSlideAnim",value:function(){return"left "+this.props.slideTime+"s, top "+this.props.slideTime+"s "+this.props.slideEasing}},{key:"_dispathcEvent",value:function(e){switch(e.type){case Ot.Type.setFocusId:this._AllState.enterFocusId=e.data;break;case Ot.Type.setFocusRect:this._AllState.enterFocusRect=e.data;break;case Ot.Type.updateItem:var t=e.data;if(t){var i,n=this._AllState.templateParser.GetTemplate(),r=O(t);try{for(r.s();!(i=r.n()).done;){var s=i.value,a=n.IdsMap[s];this._itemUpdateFuncMap[a]&&this._itemUpdateFuncMap[a]()}}catch(e){r.e(e)}finally{r.f()}}break;case Ot.Type.slideToItem:e.data&&this._slideViewToAnchor(e.data)}}},{key:"_getVisibleItemList",value:function(e,t,i){var n=this._AllState.templateParser.GetVisibleItemList(t,i,e);return this._AllState.templateParser.GetTemplate().List.slice(n.visibleStart,n.visibleEnd+1)}},{key:"_calculateNearestItemByRect",value:function(e,t){var i=t.direction,n=t.rect,r="",s={x:0,y:0};switch(i){case St.left:r="left",s.x=n.x,s.y=n.y+n.height/4;break;case St.right:r="right",s.x=n.x+n.width,s.y=n.y+n.height/4;break;case St.top:r="up",s.x=n.x+n.width/4,s.y=n.y;break;case St.bottom:r="down",s.x=n.x+n.width/4,s.y=n.y+n.height}var a,o=new ct(s.x,s.x),l=new ct(s.y,s.y),u=null,h=-1,c=0,d=0,f=0,g=this.props.direction===mt?"yPos":"xPos",p=this.props.direction===mt?"height":"width",v=O(e);try{for(v.s();!(a=v.n()).done;){var y=a.value;if(y[g]>=this._AllState.visibleStart&&y[g]+y[p]-1<=this._AllState.visibleStart+this._AllState.visibleRange-1){var m=this.props.direction===mt?y.xPos:y.xPos-this._AllState.visibleStart,_=this.props.direction===mt?y.yPos-this._AllState.visibleStart:y.yPos,w=new ct(m,m+y.width-1),S=new ct(_,_+y.height-1);switch(r){case"left":if(s.x<m+y.width-1)continue;s.y<_?d=Math.pow(s.x-(m+y.width-1),2)+Math.pow(_-s.y,2):l.IsInterAct(S)?d=Math.pow(s.x-(m+y.width-1),2):s.y>_+y.height-1&&(d=Math.pow(s.x-(m+y.width-1),2)+Math.pow(s.y-(_+y.height-1),2)),f=Math.abs(s.x-(m+y.width-1));break;case"right":if(s.x>m)continue;s.y<_?d=Math.pow(m-s.x,2)+Math.pow(_-s.y,2):l.IsInterAct(S)?d=Math.pow(m-s.x,2):s.y>_+y.height-1&&(d=Math.pow(m-s.x,2)+Math.pow(s.y-(_+y.height-1),2)),f=Math.abs(s.x-m);break;case"up":if(s.y<_+y.height-1)continue;s.x<m?d=Math.pow(s.x-m,2)+Math.pow(s.y-(_+y.height-1),2):o.IsInterAct(w)?d=Math.pow(s.y-(_+y.height-1),2):s.x>m+y.width-1&&(d=Math.pow(s.x-(m+y.width-1),2)+Math.pow(s.y-(_+y.height-1),2)),f=Math.abs(s.y-(_+y.height-1));break;case"down":if(s.y>_)continue;s.x<m?d=Math.pow(s.x-m,2)+Math.pow(_-s.y,2):o.IsInterAct(w)?d=Math.pow(_-s.y,2):s.x>m+y.width-1&&(d=Math.pow(s.x-(m+y.width-1),2)+Math.pow(_-s.y,2)),f=Math.abs(s.y-_);break;default:console.log("direction is error:"+r)}(h<0||f<c||c===f&&d<h)&&(h=d,c=f,u=y)}}}catch(e){v.e(e)}finally{v.f()}return u?u.id:0}},{key:"_updateItemVisibility",value:function(e,t){for(var i=this._AllState.templateParser.GetTemplate(),n=0;n<e.length;++n){var r=this._ItemVisibleFuncMap[i.IdsMap[e[n].id]];r&&r.visible!==t&&(r.visible=t,r.func&&r.func(t))}}},{key:"_OnKeyDown",value:function(e){var t=0,i=0;switch(e.keyCode){case 37:t=-1,this._moveToNext(t,i);break;case 38:i=-1,this._moveToNext(t,i);break;case 39:t=1,this._moveToNext(t,i);break;case 40:i=1,this._moveToNext(t,i);break;case 13:var n=this._AllState.templateParser.GetItem(this._AllState.focusId);!n.hasSub&&this.props.onClick&&this.props.onClick(n.data);break;default:return!1}return!0}},{key:"_moveToNext",value:function(e,t,i){var n=this._AllState.templateParser.GetTemplate(),r=this._AllState.preFocusId,s=n.IdsMap[this._AllState.focusId],a=this._AllState.templateParser.GetNextItem(this._AllState.focusId,t,e,this.props.loopFocus);if(0<=a){this._AllState.preFocusId=this._AllState.focusId;var o=this._AllState.templateParser.GetItem(a);this._AllState.focusId=o.id;var l=this.props.direction===mt?t:e,u=this._AllState.visibleStart,h=this._CalculateSlide(o,l,this._AllState.visibleStart);if(u!==h){var c=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(a,h,h+this._AllState.visibleRange-1);var d,f=O(c);try{for(f.s();!(d=f.n()).done;){var g=d.value;this._VisibleItemList.indexOf(g)<0&&this._NeedHideItemList.indexOf(g)<0&&this._NeedHideItemList.push(g)}}catch(e){f.e(e)}finally{f.f()}var p,v=O(this._VisibleItemList);try{for(v.s();!(p=v.n()).done;){var y=p.value,m=this._NeedHideItemList.indexOf(y);0<=m&&this._NeedHideItemList.splice(m,1)}}catch(e){v.e(e)}finally{v.f()}this._AllState.visibleStart=h,this._updateItemVisibility(this._VisibleItemList,!0);var _=this.props.direction===mt?0:-this._AllState.visibleStart,w=this.props.direction===mt?-this._AllState.visibleStart:0;this._updateRootFunc(_,w,this._onTransitionEnd)}if(o.hasSub){var S,b=n.List[s].xPos-n.List[a].xPos,k=n.List[s].yPos-n.List[a].yPos;S=i?(i.rect.x+=b,i.rect.y+=k,i):{direction:null,rect:{x:b,y:k,width:n.List[s].width,height:n.List[s].height}},this._AllState.preEdgeRect=S,this._itemUpdateFuncMap[a]&&this._itemUpdateFuncMap[a]()}else r!==this._AllState.preFocusId&&this._setItmeVisible(n.IdsMap[r],!0),this._updateFocusItem(),this._updateBlurItem();if(0<=this._AllState.preFocusId&&this.props.onItemBlur){var I=this._AllState.templateParser.GetItem(this._AllState.preFocusId).data;this.props.onItemBlur(I,this._getQueryObj(this._AllState.preFocusId))}this._AllState.isFocus&&this.props.onItemFocus&&this.props.onItemFocus(o.data,this._AllState.preEdgeRect,this._getQueryObj(o.id))}else if(this.props.onEdge){var T,x=this.props.direction===mt?0:this._AllState.visibleStart,E=this.props.direction===mt?this._AllState.visibleStart:0;1===e&&(T=St.right),-1===e&&(T=St.left),1===t&&(T=St.bottom),-1===t&&(T=St.top);var R={x:n.List[s].xPos-x,y:n.List[s].yPos-E,width:n.List[s].width,height:n.List[s].height};this.props.onEdge({direction:T,rect:R})}}},{key:"_CalculateSlide",value:function(e,t,i){var n=i,r=n,s=this._AllState.templateParser.GetTemplate().List,a=s[s.length-1],o=this.props.direction===mt?"yPos":"xPos",l=this.props.direction===mt?"height":"width",u=this.props.direction===mt?"bottom":"right",h=this.props.direction===mt?this.props.height:this.props.width;switch(this.props.slideStyle){case wt.seamLess:var c=a[o]+a[l]-h+f._getPadding(this.props)[u];0<t?e[o]+e[l]>n+4*h/5&&(r=e[o]+e[l]-4*h/5):t<0&&e[o]<n+h/5&&(r=e[o]-h/5),r=(r=c<r?c:r)<0?0:r;break;case wt.wholePage:0<t?e[o]+e[l]>n+h+1&&(r=e[o]):t<0&&e[o]<n&&(r=(r=e[o]+e[l]-h)<0?0:r)}return r}},{key:"_OnFocusableItemEdge",value:function(e){var t=0,i=0;switch(e.direction){case St.left:t=-1;break;case St.right:t=1;break;case St.top:i=-1;break;case St.bottom:i=1}this._moveToNext(t,i,e)}},{key:"_ifValidEnterRect",value:function(e){return e&&e.direction&&e.rect}},{key:"_setItmeVisible",value:function(e,t){var i=this._ItemVisibleFuncMap[e];i&&i.visible!==t&&(i.visible=t,i.func&&i.func(t))}},{key:"_onFocusInner",value:function(){var e=void 0!==this._AllState.enterFocusId&&0<=this._AllState.enterFocusId?this._AllState.enterFocusId:this._AllState.focusId;if(e=this._ifValidEnterRect(this._AllState.enterFocusRect)?this._calculateNearestItemByRect(this._VisibleItemList,this._AllState.enterFocusRect):e,this._AllState.isFocus=!0,this._AllState.focusId=e,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=-1,this._updateFocusItem(),this._updateBlurFunc(this._getBlurView),this.props.onItemFocus){var t=this._AllState.templateParser.GetItem(e);this.props.onItemFocus(t.data,null,this._getQueryObj(t.id))}this.props.onFocus&&this.props.onFocus()}},{key:"_onBlurInner",value:function(){this._AllState.isFocus=!1,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=this._AllState.focusId,this._updateFocusFunc(this._getFocusView),this._updateBlurItem(),this.props.onBlur&&this.props.onBlur()}},{key:"_onTransitionEnd",value:function(e){e.stopPropagation(),this._updateItemVisibility(this._NeedHideItemList,!1),this._NeedHideItemList=[]}},{key:"_drawItem",value:function(e){var t=this;return function(){return t.props.renderItem(e.data,t._OnFocusableItemEdge,t._getQueryObj(e.id))}}},{key:"_getContentView",value:function(){var i=this,e=this._AllState.templateParser.GetTemplate().List;return a.createElement("div",{id:"container"},e.map(function(e,t){return a.createElement(bt,{key:e.id,x:e.xPos,y:e.yPos,setVisibleFunc:i._registerItemVisibleFunc(t),registerUpdateFunc:i._registerItemUpdateFunc(t),renderFunc:i._drawItem(e)})}))}},{key:"_onContentUpdate",value:function(){this._updateItemVisibility(this._VisibleItemList,!0),this._updateFocusItem()}},{key:"_drawFocusItem",value:function(e){var t=this;return function(){return t.props.renderFocus(e.data,t._getQueryObj(e.id))}}},{key:"_getFocusView",value:function(){var e=this._AllState.templateParser.GetItem(this._AllState.focusId);return e&&!e.hasSub&&this._AllState.isFocus&&this.props.renderFocus?a.createElement(bt,{key:e.id,x:e.xPos,y:e.yPos,renderFunc:this._drawFocusItem(e)}):null}},{key:"_updateFocusItem",value:function(){this._updateFocusFunc(this._getFocusView);var e=this._AllState.templateParser.GetItem(this._AllState.focusId);e&&!e.hasSub&&this._AllState.isFocus&&this.props.renderFocus&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.focusId],!1)}},{key:"_drawBlurItem",value:function(e){var t=this;return function(){return t.props.renderBlur(e.data,t._renderBlurEndCallback(e.id),t._getQueryObj(e.id))}}},{key:"_getBlurView",value:function(){var e=this._AllState.templateParser.GetItem(this._AllState.preFocusId);return e&&!e.hasSub&&this.props.renderBlur?a.createElement(bt,{key:e.id,x:e.xPos,y:e.yPos,renderFunc:this._drawBlurItem(e)}):null}},{key:"_updateBlurItem",value:function(){this._updateBlurFunc(this._getBlurView);var e=this._AllState.templateParser.GetItem(this._AllState.preFocusId);e&&!e.hasSub&&this.props.renderBlur||this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0)}},{key:"_onFocusUpdate",value:function(){}},{key:"_BaseAnchorInfo2Pos",value:function(e,t,i){var n=e.id,r={xPos:this.props.direction===mt?0:t,yPos:this.props.direction===mt?t:0};if(null!=n){var s=this._AllState.templateParser.GetTemplate().List,a=s[n],o=s[s.length-1];if(a){var l=void 0!==e.type?e.type:"start",u=this.props.direction===mt?"yPos":"xPos",h=this.props.direction===mt?"height":"width",c=this.props.direction===mt?"bottom":"right";switch(l){case"start":r[u]=a[u];break;case"center":r[u]=a[u]-i/2+a[h]/2;break;case"end":r[u]=a[u]+a[h]-1-i}var d=o[u]+o[h]-i+f._getPadding(this.props)[c];r[u]=r[u]>d?d:r[u],r[u]=r[u]<0?0:r[u]}}return r}},{key:"_slideViewToAnchor",value:function(e){var t=this._BaseAnchorInfo2Pos(e,this._AllState.visibleStart,this._AllState.visibleRange);this._AllState.visibleStart=this.props.direction===mt?t.yPos:t.xPos;var i=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(e.id,this._AllState.visibleStart,this._AllState.visibleStart+this._AllState.visibleRange-1);var n,r=O(i);try{for(r.s();!(n=r.n()).done;){var s=n.value;this._VisibleItemList.indexOf(s)<0&&this._NeedHideItemList.indexOf(s)<0&&this._NeedHideItemList.push(s)}}catch(e){r.e(e)}finally{r.f()}this._updateItemVisibility(this._VisibleItemList,!0),this._updateRootFunc(-t.xPos,-t.yPos,this._onTransitionEnd)}},{key:"_onBlurUpdate",value:function(){}},{key:"_renderBlurEndCallback",value:function(e){var t=this;return function(){e===t._AllState.preFocusId&&t._updateBlurFunc(pt),t._setItmeVisible(t._AllState.templateParser.GetTemplate().IdsMap[e],!0)}}},{key:"render",value:function(){return a.createElement(lt,{onKeyDown:this._OnKeyDown,branchName:this.props.branchName,onFocus:this._onFocusInner,onBlur:this._onBlurInner,style:{left:this.props.left,top:this.props.top,width:this.props.width,height:this.props.height,clipPath:"inset(0px 0px 0px 0px)"}},a.createElement(Et,{x:this.props.padding&&void 0!==this.props.padding.left?this.props.padding.left:0,y:this.props.padding&&void 0!==this.props.padding.top?this.props.padding.top:0,transition:this._getSlideAnim(),registerUpdateFunc:this._registerUpdateRootFunc,registerUpdateContentFunc:this._registerUpdateContentFunc,registerUpdateFocusFunc:this._registerUpdateFocusFunc,registerUpdateBlurFunc:this._registerUpdateBlurFunc}))}},{key:"componentDidUpdate",value:function(){var e=this,t=this._AllState.templateParser.GetTemplate().List,i=this.props.data,n=0;for(n=0;n<i.length;++n){for(var r=!1,s=0;s<t.length;++s)if(i[n]===t[s].data){r=!0;break}if(!r)break}var a=!1;if(n===t.length)n!==i.length?(a=!0,f._AddTemplateItem(this.props,this._AllState.templateParser,n)):!this.props.baseAnchor||this.props.baseAnchor.id===this._AllState.baseAnchor.id&&this.props.baseAnchor.type===this._AllState.baseAnchor.type||(this._AllState.baseAnchor=this.props.baseAnchor,this._slideViewToAnchor(this._AllState.baseAnchor));else{a=!0;var o=f._getTemplateParser(this.props);f._AddTemplateItem(this.props,o,0),this._AllState.templateParser=o}a&&this._updateContentFunc(this._getContentView,null),this._AllState.focusId>=this.props.data.length&&(this._AllState.focusId=0,this._AllState.preFocusId=-1,0!==this._AllState.visibleStart&&(this._AllState.visibleStart=0,this._updateRootFunc(0,0,null))),this._updateFocusItem(),this.props.onWidgetUpdate&&Promise.resolve().then(function(){e.props.onWidgetUpdate()})}},{key:"componentDidMount",value:function(){var e=this;if(this._updateContentFunc(this._getContentView,this._onContentUpdate),0!==this._AllState.visibleStart){var t=this.props.direction===mt?0:-this._AllState.visibleStart,i=this.props.direction===mt?-this._AllState.visibleStart:0;this._updateRootFunc(t,i,null)}this.props.onWidgetMount&&Promise.resolve().then(function(){e.props.onWidgetMount()})}}],[{key:"_getPadding",value:function(e){var t={left:0,right:0,top:0,bottom:0};return void 0!==e.padding&&null!==e.padding&&(t={left:void 0===e.padding.left?0:e.padding.left,right:void 0===e.padding.right?0:e.padding.right,top:void 0===e.padding.top?0:e.padding.top,bottom:void 0===e.padding.bottom?0:e.padding.bottom}),t}},{key:"_getTemplateParser",value:function(e){var t=f._getPadding(e),i=e.direction===mt?e.width-t.left-t.right:e.height-t.top-t.bottom,n=e.layoutType?e.layoutType:"relative";return new yt(e.direction,i,n,e.width,e.height)}},{key:"_AddTemplateItem",value:function(e,t,i){for(var n=i;n<e.data.length;n++){var r=e.measures(e.data[n]);t.ParseTemplateItem(r,e.data[n])}t.CalculateNeighborWhenAddStop()}}]),f}();Lt.defaultProps={left:0,top:0,slideEasing:"cubic-bezier(0.14,0.68,0.19,0.87)",slideTime:.2,loopFocus:!1,slideStyle:wt.seamLess},Lt.getMeasureObj=function(e,t,i,n){return{blocks:{w:e,h:t},focusable:i,hasSub:n}},e.BaseDispatcher=Rt,e.EdgeDirection=St,e.Fdiv=lt,e.FdivRoot=ut,e.HORIZONTAL=_t,e.Router=tt,e.SWidgetDispatcher=Ot,e.SimpleWidget=Lt,e.SlideStyle=wt,e.VERTICAL=mt,Object.defineProperty(e,"__esModule",{value:!0})});
