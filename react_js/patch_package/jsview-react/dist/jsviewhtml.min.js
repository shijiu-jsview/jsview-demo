!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t=t||self).jsviewreact={},t.React)}(this,function(t,n){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,void 0===window.Forge&&(window.Forge={});var y=window.Forge;function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function V(r){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?e(Object(s),!0).forEach(function(t){var e,i,n;e=r,n=s[i=t],i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(s,t))})}return r}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],0<=e.indexOf(i)||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],0<=e.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?c(t):e}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}console.log("Define Forge ..."),window.originDocument={},window.originDocument.createElement=window.document.createElement.bind(window.document),window.originDocument.createTextNode=window.document.createTextNode.bind(window.document),window.originDocument.getElementById=window.document.getElementById.bind(window.document),window.originDocument.querySelector=window.document.querySelector.bind(window.document),window.originDocument.createEvent=window.document.createEvent.bind(window.document),window.originDocument.dispatchEvent=window.document.dispatchEvent.bind(window.document);var o=function(){function t(){p(this,t)}return u(t,null,[{key:"GetTextWidth",value:function(t){return t.size*t.str.length+10}},{key:"GetTextRect",value:function(t,e,i,n,r){var s=Math.ceil(i.size*t.length/e.width)*r;return s>e.height&&(s=e.height),{width:e.width,height:s}}}]),t}();window.PlatformUtils=o,y.LogF=function(t){},y.LogE=function(t){},y.LogW=function(t){},y.LogI=function(t){},y.LogD=function(t){},y.LogM=function(t){},y.ThrowError=function(t){throw new Error(t)},y.Assert=function(t){if(!t)throw new Error("ASSERT!!!!!")},y.EnableLog=function(t){y.LogM=console.log.bind(console),0<t&&(y.LogF=console.error.bind(console)),1<t&&(y.LogE=console.error.bind(console)),2<t&&(y.LogW=console.warn.bind(console)),3<t&&(y.LogI=console.log.bind(console)),4<t&&(y.LogD=console.debug.bind(console))};var l=function(){function r(t,e,i,n){p(this,r),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return u(r,[{key:"Equals",value:function(t){return null!==t&&(t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height)}}]),r}();y.RectArea=l;y.Coordinate=function t(e,i){p(this,t),this.x=e,this.y=i};y.Size=function t(e,i){p(this,t),this.width=e,this.height=i};var f=function(){function t(){p(this,t)}return u(t,[{key:"FormatRectArea",value:function(t){var e=null;if(t instanceof y.RectArea)e=t;else if("object"===h(t)&&null!==t){if(isNaN(t.width)||isNaN(t.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");e=new y.RectArea(0,0,t.width,t.height)}return e}}]),t}();y.RectUtils=f,y.sRectUitls=new y.RectUtils;var _=function(){function d(){p(this,d)}return u(d,[{key:"StringWithFont",value:function(t,e,i,n,r,s,a,o,l,h){var u="";!0===a&&(u="italic");var c="";return!0===o&&(c="bold"),{str:""+t,font:i=i||d._sDefaultFont,size:e=e||d._sDefaultFontSize,italic:u,bold:c,stroke_width:h=h||-1,alignment:n=n||"left",vertical_align:r=r||"middle",textColour:s=s||d._sDefaultFontColor,backgroundColour:d._sDefaultBackgroundColor,enableBlend:!0,shadow:l=l||null}}},{key:"TextAttr",value:function(t,e){return{text_overflow:t=t||"none",word_wrap:e=e||"none"}}},{key:"GetTextWidth",value:function(t){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextWidth(t):t.str.length*t.size+1}},{key:"GetTextRect",value:function(t,e,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextRect(t,e,i,n,r):{width:e.width,height:e.height}}},{key:"GetTextInfo",value:function(t,e,i,n,r){return void 0!==window.PlatformUtils?window.PlatformUtils.GetTextInfo(t,e,i,n,r):{start:0,end:t.length,width:e.width,height:e.height}}},{key:"GetCursorOffset",value:function(t,e,i,n,r,s,a){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorOffset(t,e,i,n,r,s,a):0}},{key:"GetCursorPosition",value:function(t,e,i,n,r,s){return void 0!==window.PlatformUtils?window.PlatformUtils.GetCursorPosition(t,e,i,n,r,s):{x:0,y:0}}}]),d}();_._sDefaultFont="黑体",_._sDefaultFontSize=30,_._sDefaultFontColor="#FFFFFF",_._sDefaultBackgroundColor="rgba(0, 0, 0, 0)",y.TextUtils=_,y.sTextUtils=new y.TextUtils,y.TextShaderType={LinearGradient:0,Image:1};y.TextShader=function t(e,i){p(this,t),this.Type=e,this.Params=i};var w=function(){function e(){p(this,e);var t=(new y.LayoutView).GetRenderer();this._Renderer=t,this.StringWithFont=y.sTextUtils.StringWithFont("",0,void 0,"center","middle",void 0,!1,!1,void 0),this.RectArea=new y.RectArea(0,0,0,0),this.TextAttr=y.sTextUtils.TextAttr("ellipsis","none"),this.Marquee=null,this.Shader=null,this.IsInstantLoad=!0,this.LineHeight=0}return u(e,[{key:"SetInstantLoad",value:function(t){return this.IsInstantLoad=t,this}},{key:"SetStringWithFont",value:function(t){return this.StringWithFont=t,this}},{key:"SetFontStyle",value:function(t,e,i,n,r,s,a,o,l){return"object"===h(t)?this.StringWithFont=y.sTextUtils.StringWithFont("",void 0!==t.size?t.size:10,void 0!==t.font?t.font:"宋体",void 0!==t.hAlign?t.hAlign:"center",void 0!==t.vAlign?t.vAlign:"middle",void 0!==t.textColor?t.textColor:"#000000",void 0!==t.italic&&t.italic,void 0!==t.bold&&t.bold,void 0!==t.shadow?t.shadow:null):this.StringWithFont=y.sTextUtils.StringWithFont("",t,e,i,n,r,s,a,o,l),this}},{key:"SetRectArea",value:function(t){return t instanceof y.RectArea?this.RectArea=t:this.RectArea=new y.RectArea(t.x,t.y,t.width,t.height),this}},{key:"SetViewSize",value:function(t){return t instanceof y.RectArea||(t=new y.RectArea(t.x,t.y,t.width,t.height)),this.SetRectArea(t),0===this.LineHeight&&0!==t.height&&(this.LineHeight=t.height),this}},{key:"SetTextAttr",value:function(t){var e,i;return e=t.hasOwnProperty("textOverflow")?t.textOverflow:t.hasOwnProperty("text_overflow")?t.text_overflow:"clip",i=t.hasOwnProperty("wordWrap")?t.wordWrap:t.hasOwnProperty("word_wrap")?t.word_wrap:"none",this.TextAttr={word_wrap:i,text_overflow:e},this}},{key:"SetMarquee",value:function(t){return t&&(this.Marquee={repetition:"infinite",direction:"left",speed:"normal"},t.repetition&&(this.Marquee.repetition=t.repetition),t.direction&&(this.Marquee.direction=t.direction),t.speed&&(this.Marquee.speed=t.speed)),this}},{key:"SetShader",value:function(t){return this.Shader=t,this}},{key:"SetLineHeight",value:function(t){return this.LineHeight=t,this}},{key:"Clone",value:function(){var t=new e(null);return t.StringWithFont=this.StringWithFont,t.RectArea=this.RectArea,t.TextAttr=this.TextAttr,t.LineHeight=this.LineHeight,t}}]),e}();y.TextViewParams=w,window.TextViewParams=y.TextViewParams;var S=function(){function f(t,e,i,n){p(this,f),this._layoutView=null,this._textWidth=0,this._textViewReahHeight=0,this._marqueeRunning=!0,this._marqueeCurrentNum=2,this._textView=null,this._TextViewParams=e,this._NeedQuick=void 0!==n&&n,this._marquee=e.Marquee,this._rectArea=e.RectArea,this._DrawCount=0,this._ShowInterval=0,this._TextureManager=t,this._Shader=e.Shader,this._IsInstantLoad=e.IsInstantLoad?1:0;var r,s,a=this,o=e.RectArea.width,l=e.RectArea.height,h=null;null!==this._marquee?((h=new y.ClipView).Init(),h.SetClipRect(0,0,o,l,!0),h.SetId("matrixClipLayoutview"),h.OnDettachFromSystem=function(){a._marqueeRunning=!1,y.ClipView.prototype.OnDettachFromSystem.call(this)}):h=new y.LayoutView,r=h.GetRenderer(),this._Renderer=r;var u=i;u=u||e.StringWithFont.str,u=this._ConvertEscToString(u);var c=!1;0<e.StringWithFont.italic.length&&(c=!0);var d=!1;0<e.StringWithFont.bold.length&&(d=!0),s=y.sTextUtils.StringWithFont(u,e.StringWithFont.size,e.StringWithFont.font,e.StringWithFont.alignment,e.StringWithFont.vertical_align,e.StringWithFont.textColour,c,d,e.StringWithFont.shadow,e.StringWithFont.stroke_width),void 0!==e.Marquee&&null!==e.Marquee?this._textWidth=y.sTextUtils.GetTextWidth(s):this._NeedQuick?this._textWidth=e.RectArea.width-2*e.RectArea.x:this._textWidth=y.sTextUtils.GetTextWidth(s),this.addTextView(h,s,e.TextAttr,e.RectArea,e.Marquee,e.LineHeight),this._layoutView=h,this._TextTexture=null}return u(f,[{key:"_ConvertEscToString",value:function(t){var e=""+t;return-1!==e.indexOf("&quot;")&&(e=e.replace(/&quot;/gi,'"')),-1!==e.indexOf("&amp;")&&(e=e.replace(/&amp;/gi,"&")),-1!==e.indexOf("&lt;")&&(e=e.replace(/&lt;/gi,">")),-1!==e.indexOf("&gt;")&&(e=e.replace(/&gt;/gi,"<")),-1!==e.indexOf("&nbsp;")&&(e=e.replace(/&nbsp;/gi," ")),e}},{key:"addTextView",value:function(t,e,i,n,r,s){var a,o=n.height,l=y.Clone(n),h=null;0!==e.str.length?(a=this._TextureManager.GetTextTextureByMultiRows(e,i,l,s,this._NeedQuick,this._Shader,this._IsInstantLoad),this._TextTexture=a.texture,this._textViewReahHeight=a.real_height,(h=new y.LayoutView).Init(new y.TextureSetting(a.texture,null,null,!0)),h.SetId("Text-"+e.str),t.AddView(h,new y.LayoutParams({x:0,y:0,width:l.width,height:o})),this._textView=h):(this._textViewReahHeight=0,y.LogI("t_StringWithFont.str.length is 0"))}},{key:"GetLayoutView",value:function(){return this._layoutView}},{key:"GetTextWidth",value:function(){return this._textView?this._textView.Div.clientWidth:Math.floor(this._textWidth+.5)}},{key:"StartAnimation",value:function(t){t&&null!==this._textView&&this._textView.StartAnimation(t)}}]),f}();y.TextViewEx=S,y.TextViewControl=S,y.Clone=function(t){var e=JSON.stringify(t);return JSON.parse(e)},window.Clone=y.Clone;var I=function(){function t(){p(this,t),this._AlreadyExited=!1,window.PersistTimer&&(this._AlreadyExited=!0)}return u(t,[{key:"setTimeout",value:function(t,e){return this._AlreadyExited&&window.PersistTimer.setTimeout?window.PersistTimer.setTimeout(t,e):window.setTimeout(t,e)}},{key:"clearTimeout",value:function(t){this._AlreadyExited&&window.PersistTimer.clearTimeout?window.PersistTimer.clearTimeout(t):window.clearTimeout(t)}},{key:"setInterval",value:function(t,e){if(!this._AlreadyExited||!window.PersistTimer.setInterval)return window.setInterval(t,e);window.PersistTimer.setInterval(t,e)}},{key:"clearInterval",value:function(t){this._AlreadyExited&&window.PersistTimer.clearInterval?window.PersistTimer.clearInterval(t):window.clearInterval(t)}}]),t}();y.PersistTimer=new I;var b=function(){function t(){p(this,t)}return u(t,[{key:"setTimeout",value:function(t,e){return window.setTimeout(t,e)}},{key:"clearTimeout",value:function(t){window.clearTimeout(t)}},{key:"setInterval",value:function(t,e){return window.setInterval(t,e)}},{key:"clearInterval",value:function(t){window.clearInterval(t)}}]),t}();y.ForegroundTimer=new b,y.EasingTypeIn=0,y.EasingTypeOut=1,y.EasingTypeInOut=2,y.EasingTypeBezier=3,y.EasingTypeBlink=4,y.EasingTypeDeceleration=5;var x=function(){function t(){p(this,t)}return u(t,[{key:"Package",value:function(){}},{key:"_GetBasePackage",value:function(t){return{T:t,St:null}}}]),t}();y.EasingBase=x;var T=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,y.EasingBase),u(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeIn)}}]),t}();y.EasingIn=T;var k=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,y.EasingBase),u(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeOut)}}]),t}();y.EasingOut=k;var E=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,y.EasingBase),u(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeInOut)}}]),t}();y.EasingInOut=E;var L=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,y.EasingBase),u(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeDeceleration)}}]),t}();y.EasingDeceleration=L;var R=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,y.EasingBase),u(t,[{key:"Pacakge",value:function(){return this._GetBasePackage(y.EasingTypeBlink)}}]),t}();y.EasingBlink=R;var O=function(){function a(t,e,i,n,r){var s;return p(this,a),(s=m(this,v(a).call(this)))._Inited=!1,s._X1=t,s._X2=i,s._Y1=e,s._Y2=n,s._Duration=r,s}return g(a,y.EasingBase),u(a,[{key:"Pacakge",value:function(){var t=this._GetBasePackage(y.EasingTypeBezier);return t.St={X1:this._X1,X2:this._X2,Y1:this._Y1,Y2:this._Y2,Dur:this._Duration},t}}]),a}();y.BezierEasing=O,y.Easing={Circular:{In:new y.EasingIn,Out:new y.EasingOut,InOut:new y.EasingInOut,Deceleration:new y.EasingDeceleration}},window.Easing=y.Easing,y.ColorSpace={RGBA_8888:"RGBA_8888",RGBA_4444:"RGBA_4444",RGBA_5551:"RGBA_5551",RGB_565:"RGB_565",RGB_ETC1:"RGB_ETC1",RGBA_ETC1:"RGBA_ETC1"},y.QRCodeLevel={L:1,M:0,Q:3,H:2};var A=function(){function n(t,e,i){p(this,n),this._Manager=t,i&&y.sRenderTextureDelegateManager.CreateTextureStatus().SetResourceInfo(i);this.RenderTexture=y.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(e),this._CallbackIdToken=0,this._OnLoadCallback=[],y.ForgeDebug.EnableTextureTracer&&(t._ImageTextureTracer.push(this),this._TracerDescript="")}return u(n,[{key:"UnloadTex",value:function(){this._OnLoadCallback=[],null!==this.RenderTexture&&(0<this._CallbackIdToken&&(this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken),this._CallbackIdToken=0),this.RenderTexture.UndoRef(),this.RenderTexture=null),this._TracerDescript=""}},{key:"RegisterLoadImageCallback",value:function(t,e,i){this.IsLoaded()&&null!==e?e(i):null!==e&&(this._OnLoadCallback.push({callback:e,params:i}),0===this._CallbackIdToken&&(y.Assert(null!==this.RenderTexture),this._CallbackIdToken=this.RenderTexture.RegisterOnloadCallback(n.prototype._InvokeOnLoadCallbacks.bind(this))))}},{key:"_InvokeOnLoadCallbacks",value:function(){var t=this._OnLoadCallback;this._OnLoadCallback=[];for(var e=0;e<t.length;e++){var i=t[e];i.callback(i.params)}this.RenderTexture&&this.RenderTexture.UnregisterOnloadCallback(this._CallbackIdToken)}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}},{key:"SetTextureTracerDescript",value:function(t){this._TracerDescript=t}},{key:"ReallocRenderTexture",value:function(){}},{key:"Unloaded",get:function(){return null===this.RenderTexture||this.RenderTexture.Unloaded},set:function(){}},{key:"LoadTime",get:function(){return null!==this.RenderTexture?this.RenderTexture.LoadTime:0},set:function(){}},{key:"Width",get:function(){return null!==this.RenderTexture?this.RenderTexture.Width:0},set:function(){}},{key:"Height",get:function(){return null!==this.RenderTexture?this.RenderTexture.Height:0},set:function(){}}]),n}();y.ImageTexture=A;var P=function(){function l(t,e,i,n,r,s){var a;p(this,l);var o=y.sRenderTextureDelegateManager.CreateResourceInfo(t.GetId(),"IMG");return o.Set={URL:e,Siz:n,Clr:r||"",IsF:i?1:0,NtS:s,ILd:0},(a=m(this,v(l).call(this,t,o))).Name="IMG",a.Source=e,a.IsForever=i?1:0,a.TargetSize=n,a.ColorSpace=r||"",a.NetSetting=s||null,a._InstantLoad=0,a._ImageElement=new Image,a._ImageElement.onload=function(){this._Loaded()}.bind(c(a)),a._ImageElement.onerror=function(){this._Loaded()}.bind(c(a)),a._ImageElement.src=e,a.RenderTexture.NeedCheckExpired=!0,a}return g(l,y.ImageTexture),u(l,[{key:"_Loaded",value:function(){this.RenderTexture.Unloaded=!1,this.RenderTexture.LoadTime=Date.now(),this.RenderTexture.Width=this._ImageElement.width,this.RenderTexture.Height=this._ImageElement.height,this.RenderTexture.InvokeOnloadCallbacks()}},{key:"InstantLoad",value:function(t){if(this._InstantLoad=t?1:0,this.RenderTexture){var e=this.RenderTexture.GetResourceInfo();null!==e&&(e.Set.ILd=this._InstantLoad,this.RenderTexture.SetResourceInfo(e))}return this}},{key:"ReallocRenderTexture",value:function(){if(this.IsForever)y.LogE("ReallocRenderTexture(): NOT need for forever texture");else{var t=this.Source,e=this.TargetSize,i=this.ColorSpace,n=this.IsForever,r=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Manager.GetId(),this.Name);r.Set={URL:t,Siz:e,Clr:i,IsF:n,ILd:this._InstantLoad},this.RenderTexture=y.sRenderTextureDelegateManager.CreateTexture(),this.RenderTexture.SetResourceInfo(r),this._Manager.CachedTextureManager.CacheTheTexture(this)}}}]),l}();y.UrlImageTexture=P;var C=function(){function e(t){p(this,e),this._TextureManager=t,this._Renderer=t.GetRenderer(),this._CachedTextureStack=[],this._LockedTextureStack=[],this._MemoryLimited=10485760,this._VisibleMark=1}return u(e,[{key:"SetMemoryLimited",value:function(t){this._MemoryLimited=1024*t*1024}},{key:"_FindTexture",value:function(t,e,i){for(var n=this._CachedTextureStack.length-1;0<=n;n--){var r=this._CachedTextureStack[n];if(r.Source===t&&(e===r.TargetSize||null!==e&&e.Equals(r.TargetSize))&&i===r.ColorSpace){if(null===r.RenderTexture)continue;return r}}return null}},{key:"CacheTheTexture",value:function(t){for(var e=this._CachedTextureStack.length-1;0<=e;e--)if(t===this._CachedTextureStack[e])return;this._CachedTextureStack.push(t)}},{key:"_MarkVisibleViewTextures",value:function(t,e){t.TextureSetting&&t.TextureSetting.Texture&&(t.TextureSetting.Texture.VisibleMark=e);for(var i=t.ChildViews.length,n=0;n<i;n++){var r=t.ChildViews[n];r&&"VISIBLE"!==r.Visibility||this._MarkVisibleViewTextures(r,e)}}},{key:"ReduceInvisibleTexture",value:function(t){this._MarkVisibleViewTextures(t,++this._VisibleMark);for(var e=0;e<this._CachedTextureStack.length;e++){var i=this._CachedTextureStack[e];i.VisibleMark!==this._VisibleMark&&(i.UnloadTex(),this._CachedTextureStack.splice(e,1),e--)}}},{key:"GetCacheSize",value:function(){return this._CachedTextureStack.length}}]),e}();y.CachedTextureManager=C;var F=new Map,M=0,N=new Map,D=0,j=function(){function t(){p(this,t),this.CachedTextureManager=new y.CachedTextureManager(this),this._ForeverCachedTextureManager=new y.CachedTextureManager(this),this._AtlasDataInfo={atlas_data:[],buffer_data_offset:0,textures:[]},this._ClearTimer=-1,this._ImageTextureTracer=[],this._Id=t.sTextureManagerToken++,this._CacheMaxSize=100,this.StartScavengerCachedTimer()}return u(t,[{key:"StartScavengerCachedTimer",value:function(){-1===this._ClearTimer&&(this._ClearTimer=y.ForegroundTimer.setInterval(this.ScavengerCached.bind(this),3e4))}},{key:"GetId",value:function(){return this._Id}},{key:"GetRenderer",value:function(){return y.sDeprecatedRenderer}},{key:"GetImage",value:function(t,e,i){return t?this._GetImageInternal(t,null,y.ColorSpace.RGBA_8888,e,!1,i):(y.LogI("GetImage, url is null!"),null)}},{key:"GetImage2",value:function(t,e,i,n,r){if(!t)return y.LogI("GetImage2, url is null!"),null;var s=y.sRectUitls.FormatRectArea(i);return"string"!=typeof n&&(n=0<=t.indexOf(".pkm")?0<=t.indexOf(".pkma")?y.ColorSpace.RGBA_ETC1:y.ColorSpace.RGB_ETC1:y.ColorSpace.RGB_565),this._GetImageInternal(t,s,n,e,!1,r)}},{key:"_GetImageInternal",value:function(t,e,i,n,r,s){if(n){var a=this._ForeverCachedTextureManager._FindTexture(t,e,i);if(a)return a}else{var o=this.CachedTextureManager._FindTexture(t,e,i);if(o)return o}var l=new y.UrlImageTexture(this,t,n,e,i,s);return l.IsForever?this._ForeverCachedTextureManager.CacheTheTexture(l):this.CachedTextureManager.CacheTheTexture(l),l}},{key:"GetRoundCornerMask",value:function(t,e){return this.GetCustomCornerMask(t,e,e,e,e)}},{key:"GetCustomCornerMask",value:function(t,e,i,n,r){var s=y.sRectUitls.FormatRectArea(t),a=Math.max(e,i,n,r);if(a>s.width/2||a>s.height/2)return y.LogE("TextureManager.GetRoundCornerMask(): radius is too large, radius="+a+" w="+s.width+" h="+s.height),null;var o=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CCM");o.Set={W:s.width,H:s.height,LT:e,RT:i,LB:n,RB:r};var l=new y.ImageTexture(this,o);return y.ForgeDebug.EnableTextureTracer&&l.SetTextureTracerDescript("CornerMask"),l}},{key:"GetOneCornerMask",value:function(t){var e=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"OCM");e.Set={Rad:t};var i=new y.ImageTexture(this,e);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("OneCornerMask"),i}},{key:"_getParamsId",value:function(t,e){var i=t.font,n=t.size,r=t.italic,s=t.bold,a=t.alignment,o=t.vertical_align,l=t.textColour,h=t.backgroundColour,u=t.shadow,c="";t.stroke_width&&(c=t.stroke_width);var d=e.text_overflow,f=e.word_wrap,g=[i,r,s,u,c].join(":"),p=[n,a,o,d,f].join(":"),v="",y="";return F.has(g)?v=F.get(g):(v="TS"+M,F.set(g,v),M++),N.has(p)?y=N.get(p):(y="DS"+D,N.set(p,y),D++),[v,y,l,h]}},{key:"GetTextTextureByMultiRows",value:function(t,e,i,n,r,s,a){var o=t.str;if(null===o||0===o.length)return null;var l=y.sRenderBridge.GetScreenInfo().scaleRatio,h=y.Clone(i);h.x*=l,h.y*=l,h.width*=l,h.height*=l;var u=y.Clone(t);u.size=Math.ceil(u.size*l),n*=l;var c=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"T");if(c.Set={ST:t.str,AT:JSON.stringify({TO:e.text_overflow,WW:e.word_wrap}),RA:JSON.stringify({X:parseInt(h.x+.5),Y:parseInt(h.y+.5),W:parseInt(h.width+.5),H:parseInt(h.height+.5)}),LH:parseInt(n+.5),ILD:void 0!==a?a:1},s&&(c.Set.SH=JSON.stringify({T:s.Type,P:s.Params})),void 0!==window.JsView&&void 0!==window.JsView.ForgeNativeRevision&&0<window.JsView.ForgeNativeRevision){var d=this._getParamsId(u,e,s);c.Set.PI={FS:d[0],DS:d[1],TC:d[2],BC:d[3]}}y.sRenderTextureDelegateManager.AppendFontStatusIfNeed(c.Set,u);var f=null;c.Set.FO&&(f={STA:{Nam:"T",Sta:c.Set.FO}});var g=new y.ImageTexture(this,c,f),p=h.height;void 0!==window.PlatformUtils&&!1===r&&(p=window.PlatformUtils.GetTextRect(o,h,u,e,n).height);if(p=Math.floor(p/l+.5),y.ForgeDebug.EnableTextureTracer){var v=t.str;8<v.length&&(v=t.str.substr(0,8)+"..."),g.SetTextureTracerDescript("["+v+"]")}return{texture:g,real_height:p}}},{key:"GetColorTexture",value:function(t){var e=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"CT");e.Set={Clr:t};var i=new y.ImageTexture(this,e);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Color["+t+"]"),i}},{key:"ScavengerCached",value:function(){this.CachedTextureManager.GetCacheSize()>=this._CacheMaxSize&&this.CachedTextureManager.ReduceInvisibleTexture(y.sRootView)}},{key:"GetOffScreenMediaTexture",value:function(t){if(void 0===window.OffscreenVideoPlayer||!(t instanceof window.OffscreenVideoPlayer))return null;if(!t.hasTerminator()){var e=this._BuildVideoTexture(t);t.setResourceTerminator(function(){e.UnloadTex()})}return this._BuildVideoTexture(t)}},{key:"_BuildVideoTexture",value:function(t){var e=y.sRenderTextureDelegateManager.CreateResourceInfo(this._Id,"VPLY");e.Set={Hdl:t.mediaHandler()};var i=new y.ImageTexture(this,e);return y.ForgeDebug.EnableTextureTracer&&i.SetTextureTracerDescript("Video["+t.mediaHandler()+"]"),i}}]),t}();j.sTextureManagerToken=100,y.TextureManager=j,window.TextureManager=y.TextureManager;var B=function(){function t(){p(this,t)}return u(t,[{key:"SetTextureTracer",value:function(){}},{key:"GetTextureTracer",value:function(){return null}}]),t}();y.LayoutViewDebugClass=B,window.ForgeDebug=y.ForgeDebug=new y.LayoutViewDebugClass;var G=function(){function e(){p(this,e),this.Width=0,this.Height=0,this.MarginTop=0,this.MarginLeft=0,this.MarginRight=0,this.MarginBottom=0,this.Z=0,this.SizeAdjust=!1}return u(e,[{key:"SetPosition",value:function(t,e,i){this.MarginTop=e,this.MarginLeft=t,i&&(this.Z=i)}},{key:"SetSize",value:function(t,e){this.Width=t,this.Height=e}},{key:"Clone",value:function(){var t=new e(null);return t.Width=this.Width,t.Height=this.Height,t.MarginTop=this.MarginTop,t.MarginLeft=this.MarginLeft,t.MarginRight=this.MarginRight,t.MarginBottom=this.MarginBottom,t.Z=this.Z,t.SizeAdjust=this.SizeAdjust,t}},{key:"Equals",value:function(t){return t.Width===this.Width&&t.Height===this.Height&&t.MarginTop===this.MarginTop&&t.MarginLeft===this.MarginLeft&&t.MarginRight===this.MarginRight&&t.MarginBottom===this.MarginBottom&&t.Z===this.Z}}]),e}();y.LayoutParamsBase=G;var U=function(){function i(t){var e;return p(this,i),e=m(this,v(i).call(this)),t instanceof y.RectArea&&(t={x:t.x,y:t.y,width:t.width,height:t.height}),t&&(t.x?e.MarginLeft=t.x:t.marginLeft&&(e.MarginLeft=t.marginLeft),t.y?e.MarginTop=t.y:t.marginTop&&(e.MarginTop=t.marginTop),t.z&&(e.Z=t.z),t.width&&(e.Width=t.width),t.height&&(e.Height=t.height),isNaN(e.MarginTop)&&(y.LogE("isNaN(this.MarginTop)!"),e.MarginTop=0),isNaN(e.MarginLeft)&&(y.LogE("isNaN(this.MarginLeft)!"),e.MarginLeft=0),"MatchParent"!==e.Width?isNaN(e.Width)&&y.LogE("isNaN(this.Width)!"):e.SizeAdjust=!0,"MatchParent"!==e.Height?isNaN(e.Height)&&y.LogE("isNaN(this.Height)!"):e.SizeAdjust=!0),e}return g(i,y.LayoutParamsBase),i}();y.LayoutParams=U,window.LayoutParams=y.LayoutParams;var W=function(){function t(){p(this,t),this._IdTokenGenerator=66,(y.sRenderTextureDelegateManager=this)._CheckExpiredTime=0}return u(t,[{key:"CreateTextureStatus",value:function(){var t=new y.RenderTextureDelegate(this,0);return t.DoRef(),t}},{key:"CreateTexture",value:function(){var t=new y.RenderTextureDelegate(this,this._IdTokenGenerator++);return t.DoRef(),t}},{key:"RecycleTexture",value:function(){}},{key:"CreateResourceInfo",value:function(t,e){return{Id:0,Nam:e,Set:null,TmId:t,NdLd:0}}},{key:"AppendFontStatusIfNeed",value:function(t,e){var i={};i.Fo=e.font,i.Si=e.size,i.It=e.italic,i.Bo=e.bold,i.Al=e.alignment,i.Ve=e.vertical_align,i.Tx=e.textColour,i.Ba=e.backgroundColour,i.En=e.enableBlend,i.Sh=e.shadow,e.stroke_width?i.Stk=e.stroke_width:i.Stk=-1,t.FO=JSON.stringify(i)}}]),t}();y.RenderTextureDelegateManager=W,y.sRenderTextureDelegateManager=new y.RenderTextureDelegateManager;var H=function(){function n(t,e){if(p(this,n),this.IdToken=e,this._Manager=t,this._Reference=0,this._SyncingResourceInfo=null,this._OnloadCallbacks={},this._OnloadCallbacksSize=0,this._OnloadCallbackIdGenerator=1,this.Unloaded=!0,this.LoadTime=0,this.RequireTime=0,this.ForceExpire=!1,this.NeedCheckExpired=!1,y.ForgeDebug.GetTextureTracer()){var i=new Error;this.Stack=i.stack}}return u(n,[{key:"DoRef",value:function(){this._Reference++}},{key:"UndoRef",value:function(){this._Reference--,0===this._Reference&&(0<this._OnloadCallbacksSize&&(this._OnloadCallbacks={}),this._Manager.RecycleTexture(this))}},{key:"SetResourceInfo",value:function(t){t.Id=this.IdToken,this._SyncingResourceInfo=t}},{key:"GetResourceInfo",value:function(){return this._SyncingResourceInfo}},{key:"ReadSyncInfo",value:function(){var t=this._SyncingResourceInfo;return this._SyncingResourceInfo=null,t}},{key:"RegisterOnloadCallback",value:function(t){var e=this._OnloadCallbackIdGenerator++;return this._OnloadCallbacks[""+e]=t,this._OnloadCallbacksSize++,null!==this._SyncingResourceInfo&&(this._SyncingResourceInfo.NdLd=1),e}},{key:"UnregisterOnloadCallback",value:function(t){delete this._OnloadCallbacks[""+t],this._OnloadCallbacksSize--}},{key:"InvokeOnloadCallbacks",value:function(){if(0<this._OnloadCallbacksSize)for(var t in this._OnloadCallbacks)this._OnloadCallbacks[t]()}},{key:"IsLoaded",value:function(){return 0!==this.LoadTime&&!this.Unloaded}}]),n}();y.RenderTextureDelegate=H;var z=function(){function t(){p(this,t),(y.sDeprecatedRenderer=this)._SharedTextureManager=this.CreateTextureManager()}return u(t,[{key:"SetUserId",value:function(t){y.sRenderBridge.UpdateUserId(t)}},{key:"GetScreenInfo",value:function(){return y.sRenderBridge.GetScreenInfo()}},{key:"StringWithFont",value:function(){return y.sTextUtils.StringWithFont.apply(this,arguments)}},{key:"GetTextWidth",value:function(){return y.sTextUtils.GetTextWidth.apply(this,arguments)}},{key:"GetTextUtils",value:function(){return y.sTextUtils}},{key:"RectArea",value:function(t,e,i,n){return new y.RectArea(t,e,i,n)}},{key:"TextAttr",value:function(){return y.sTextUtils.TextAttr.apply(this,arguments)}},{key:"GarbageCollect",value:function(){y.LogM("GarbageCollect called")}},{key:"TriggerFrameDraw",value:function(){y.sRenderBridge.RequestSwap()}},{key:"GetSharedTextureManager",value:function(){return this._SharedTextureManager}},{key:"CreateTextureManager",value:function(){return new y.TextureManager}}]),t}();y.DeprecatedRenderer=z,y.sDeprecatedRenderer=null,window.gRootView=null,y.sRootView=null;var K=function(){function r(t,e,i,n){p(this,r),this.Texture=t,this._IsTextureExternal=!1,e instanceof y.ImageTexture?(e&&e.RenderTexture&&e.RenderTexture.NeedCheckExpired&&(e.RenderTexture.RequireTime=0),this.MaskSetting=new y.ViewTextureMask(e)):this.MaskSetting=e,t&&t.RenderTexture&&t.RenderTexture.NeedCheckExpired&&(t.RenderTexture.RequireTime=0),this._IsMaskTextureExternal=!1,this.TextureBeforeImageLoad=i,this._IsPreloadImageTextureExternal=!1,void 0===n&&(n=!0),this.HasAlpha=n}return u(r,[{key:"SetExternal",value:function(t,e,i){this._IsTextureExternal=t,this._IsMaskTextureExternal=e,this._IsPreloadImageTextureExternal=i}},{key:"ReleaseInternalTexture",value:function(){!this._IsTextureExternal&&this.Texture&&(this.Texture.UnloadTex(),this.Texture=null),!this._IsMaskTextureExternal&&this.MaskSetting&&(this.MaskSetting.UnLoad(),this.MaskSetting=null),!this._IsPreloadImageTextureExternal&&this.TextureBeforeImageLoad&&(this.TextureBeforeImageLoad.UnloadTex(),this.TextureBeforeImageLoad=null)}},{key:"DebugPrint",value:function(){return" _IsTextureExternal="+this._IsTextureExternal}}]),r}();y.TextureSetting=K,window.TextureSetting=y.TextureSetting;var Y=function(){function s(t,e,i,n){var r;return p(this,s),(r=m(this,v(s).call(this,t,e,i,n))).SetExternal(!0,!0,!0),r}return g(s,y.TextureSetting),s}();y.ExternalTextureSetting=Y,window.ExternalTextureSetting=y.ExternalTextureSetting;var J=function(){function i(t){p(this,i);var e=t.RectInfo;this.RectInfo={coordX:e.coordX,coordY:e.coordY,width:e.width,height:e.height},this.LayoutParams=JSON.parse(JSON.stringify(t.LayoutParams))}return u(i,[{key:"ApplyToView",value:function(t){var e=this.RectInfo;t.RectInfo={coordX:e.coordX,coordY:e.coordY,width:e.width,height:e.height},t.LayoutParams=JSON.parse(JSON.stringify(this.LayoutParams))}}]),i}();y.PackedLayout=J;var X=function(){function t(){p(this,t),this._MaskType="COMMON"}return u(t,[{key:"Type",value:function(){return this._MaskType}},{key:"UnLoad",value:function(){}}]),t}();y.ViewMask=X;var q=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this)))._MaskType="TEXTURE",e.ImageTexture=t,e}return g(i,y.ViewMask),u(i,[{key:"UnLoad",value:function(){this.ImageTexture.UnloadTex()}}]),i}();y.ViewTextureMask=q;var Z=function(){function s(t,e,i,n){var r;return p(this,s),(r=m(this,v(s).call(this)))._MaskType="CORNER",r._TopLeft=t,r._TopRight=isNaN(e)?t:e,r._BottomLeft=isNaN(i)?t:i,r._BottomRight=isNaN(n)?t:n,r._CornersWidth=[0,0,0,0],r._CornersDisable=[0===r._TopLeft?1:0,0===r._TopRight?1:0,0===r._BottomLeft?1:0,0===r._BottomRight?1:0],r}return g(s,y.ViewMask),u(s,[{key:"UnLoad",value:function(){}}]),s}();y.ViewRoundCornerMask=Z;var Q=function(){function e(t){p(this,e),(this.TextureSetting=t)&&console.error("LayoutViewBase constructor texture_setting not undefined!"),this.Visibility="VISIBLE",this.LayoutParams=null,this.ParentView=null,this.ChildViews=[],this.zIndex=0,this.childZIndexCount=0,this._IsChildOfRootView=!1,this.Div=window.originDocument.createElement("div"),this.Div.style.position="absolute",this.Div.id=e.DivId++}return u(e,[{key:"Init",value:function(t){this.ResetTexture(t)}},{key:"AddView",value:function(t,e){null!==e?e instanceof y.LayoutParamsBase?t.LayoutParams=e.Clone():t.LayoutParams=new y.LayoutParams(e):null===t.LayoutParams&&(t.LayoutParams=new y.LayoutParams({x:0,y:0})),null!==t.LayoutParams&&(t.Div.style.left=t.LayoutParams.MarginLeft+"px",t.Div.style.top=t.LayoutParams.MarginTop+"px",t.LayoutParams.Width&&(t.Div.style.width=t.LayoutParams.Width+"px"),t.LayoutParams.Height&&(t.Div.style.height=t.LayoutParams.Height+"px")),(t.ParentView=this).ChildViews.push(t),this._IsChildOfRootView&&t._OnAttachToSystem()}},{key:"RemoveView",value:function(t){for(var e=0;e<this.ChildViews.length;e++)if(this.ChildViews[e]===t){t.IsChildOfRootView()&&t._OnDetachFromSystem(),this.ChildViews.splice(e,1),t.ParentView=null;break}}},{key:"_OnDetachFromSystem",value:function(){this._IsChildOfRootView=!1;for(var t=0;t<this.ChildViews.length;t++){this.ChildViews[t]._OnDetachFromSystem()}this.ParentView.Div.removeChild(this.Div)}},{key:"ClearViews",value:function(){var t=this.ChildViews.length;if(0!==t){for(var e=0;e<t;e++){var i=this.ChildViews[e];i&&i.IsChildOfRootView()&&i._OnDetachFromSystem()}this.ChildViews=[]}}},{key:"_ResetTextStyle",value:function(t){if(this.Div.textContent=t.Set.ST,this.Div.style.overflow="hidden",t.Set.AT){var e=JSON.parse(t.Set.AT);this.Div.style.textOverflow=e.TO,"none"==e.WW&&(this.Div.style.whiteSpace="nowrap")}if(t.Set.RA){var i=JSON.parse(t.Set.RA);this.Div.style.width=i.W+"px",this.Div.style.height=i.H+"px"}if(t.Set.LH&&(this.Div.style.lineHeight=t.Set.LH+"px"),t.Set.FO){var n=JSON.parse(t.Set.FO);n.Tx&&(this.Div.style.color=n.Tx),n.Fo&&(this.Div.style.fontFamily=n.Fo),n.Si&&(this.Div.style.fontSize=n.Si+"px"),n.Ba&&(this.Div.style.backgroundColor=n.Ba),n.It&&(this.Div.style.italic="italic"),n.Bo?this.Div.style.fontWeight="bold":this.Div.style.fontWeight="normal",n.Al&&(this.Div.style.textAlign=n.Al),n.Ve&&(this.Div.style.verticalAlign=n.Ve)}}},{key:"_SetBorderRadius",value:function(t){this.Div.style.borderRadius=t._TopLeft+"px "+t._TopRight+"px "+t._BottomLeft+"px "+t._BottomRight+"px"}},{key:"ResetTexture",value:function(t){if(this.TextureSetting=t)if(t.MaskSetting&&"CORNER"===t.MaskSetting._MaskType&&this._SetBorderRadius(t.MaskSetting),t.Texture.Source)this.Div.style.backgroundImage="url("+t.Texture.Source+")",this.Div.style.backgroundSize="100% 100%";else if(t.Texture.RenderTexture&&t.Texture.RenderTexture._SyncingResourceInfo){var e=t.Texture.RenderTexture._SyncingResourceInfo;"T"===e.Nam?this._ResetTextStyle(e):"CT"===e.Nam&&(this.Div.style.backgroundColor=e.Set.Clr)}}},{key:"SetVisibility",value:function(t){this.Div.style.visibility="string"==typeof t?t.toLocaleLowerCase():"inherit"}},{key:"_OnAttachToSystem",value:function(){this.ParentView.Div.appendChild(this.Div),this._IsChildOfRootView=!0;for(var t=this.ChildViews,e=0;e<t.length;e++)t[e]._OnAttachToSystem()}},{key:"IsChildOfRootView",value:function(){return this._IsChildOfRootView}},{key:"StartAnimation",value:function(t){if(t&&t._SettingInfo&&t._SettingInfo.Set){var e=t._SettingInfo.Set.Kf,i=t._SettingInfo.Set.Ts;if(e&&0<=e.indexOf("@keyframes")){var n=window.originDocument.createElement("style");n.type="text/css",n.innerHTML=e,this.Div.appendChild(n);var r=e.split(" ")[1];0<=r.indexOf("{")&&(r=r.substr(0,r.indexOf("{")));var s=t._SettingInfo.Rpt,a=r+" "+t._SettingInfo.Dur/1e3+"s "+(-1===s?"infinite":s);console.log("StartAnimation style_anim:",a),this.Div.style.animation=a,this.Div.addEventListener("animationend",function(){t.OnEnd()})}else if(i&&0<=i.length){for(var o="",l=0;l<i.length;l++){var h="ease",u=i[l];if(u.tf)switch(u.tf.T){case y.EasingTypeIn:h="ease-in";break;case y.EasingTypeOut:h="ease-out";break;case y.EasingTypeInOut:h="ease-in-out";break;case y.EasingTypeBezier:h="cubic-bezier("+u.tf.St.X1+","+u.tf.St.Y1+","+u.tf.St.X2+","+u.tf.St.Y2+")";break;case y.EasingTypeBlink:case y.EasingTypeDeceleration:}else h="linear";o&&(o+=","),o+=u.name+" "+u.dur/1e3+"s "+h+" "+u.dly/1e3+"s"}o&&(this.Div.style.transition=o,this.Div.addEventListener("transitionend",function(){t.OnEnd()}))}}}},{key:"ResetCssTransform",value:function(t){t!==this._CssTransform&&(console.log("ResetCssTransform transform_string:",t),this.Div.style.transform=t,this._CssTransform=t)}},{key:"SetId",value:function(t){this.Id=t}},{key:"ResetLayoutParams",value:function(t){null!==t?(t instanceof y.LayoutParamsBase?this.LayoutParams=t.Clone():this.LayoutParams=new y.LayoutParams(t),this.Div.style.left=this.LayoutParams.MarginLeft+"px",this.Div.style.top=this.LayoutParams.MarginTop+"px",this.LayoutParams.Width&&(this.Div.style.width=this.LayoutParams.Width+"px"),this.LayoutParams.Height&&(this.Div.style.height=this.LayoutParams.Height+"px")):y.ThrowError("ResetLayoutParams(): new params is null")}},{key:"GetRenderer",value:function(){return y.LayoutViewBase.sRenderer}},{key:"GetLayoutParams",value:function(){return this.LayoutParams?this.LayoutParams.Clone():new y.LayoutParams}}]),e}();Q.DivId=0,y.LayoutViewBase=Q;var $=function(){function e(t){return p(this,e),!t||t instanceof y.TextureSetting||y.ThrowError("ERROR:LayoutView need TextureSetting as parameter"),m(this,v(e).call(this,t))}return g(e,y.LayoutViewBase),e}();y.LayoutView=$,window.LayoutView=y.LayoutView;var tt=function(){function e(){var t;return p(this,e),(t=m(this,v(e).call(this,void 0)))._ViewType=1,t._IsChildOfRootView=!0,t.Div=window.originDocument.getElementById("root"),window.gRootView=c(t),y.sRootView=c(t),t}return g(e,y.LayoutView),u(e,[{key:"Init",value:function(t){this.InitLayoutViewStaticValues(t),this.ResetLayoutParams({x:0,y:0,width:1280,height:720})}},{key:"InitLayoutViewStaticValues",value:function(t){y.LayoutViewBase.sRenderer=t,y.LayoutViewBase.sInternalTextureManager=t.GetSharedTextureManager(),y.LayoutViewBase.sIdentityMat4=new y.Mat4,y.LayoutViewBase.sNullDirectParentMat4=new y.Mat4,y.LayoutViewBase.sBakeFlipYMat4=(new y.Mat4).rotatex(180)}}]),e}();y.RootView=tt,window.RootView=y.RootView;var et=function(){function s(t,e,i,n,r){p(this,s),this.coordX=t,this.coordY=e,this.width=i,this.height=n,this.useScissors=r,this.maskStencil=null}return u(s,[{key:"updateInfo",value:function(t,e,i,n,r){this.coordX=t,this.coordY=e,this.width=i,this.height=n,this.useScissors=r}},{key:"setMaskStencil",value:function(t){this.maskStencil=t}}]),s}(),it=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._ClipRectInfo=null,e.Id="ClipView",e.TextureSetting=null,e}return g(i,y.LayoutView),u(i,[{key:"SetId",value:function(t){this.Id=t+"_ClipView"}},{key:"SetClipRect",value:function(t,e,i,n,r){null===this._ClipRectInfo?this._ClipRectInfo=new et(t,e,i,n,r):this._ClipRectInfo.updateInfo(t,e,i,n,r),this.Div.style.left=this.LayoutParams.MarginLeft+t+"px",this.Div.style.top=this.LayoutParams.MarginTop+e+"px",this.Div.style.overflow="hidden",this.Div.style.width=i+"px",this.Div.style.height=n+"px"}}]),i}();y.ClipView=it,window.ClipView=y.ClipView;var nt=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._HorizontalRepeats=[0,0,0,0],e._VerticalRepeats=[0,0,0,0],e._HorizontalPadding=[0,0],e._VerticalPadding=[0,0],e}return g(i,y.LayoutView),u(i,[{key:"ResetTexture",value:function(t){if((this.TextureSetting=t)&&(t.MaskSetting&&"CORNER"===t.MaskSetting._MaskType&&this._SetBorderRadius(t.MaskSetting),t.Texture.Source)){var e=t.Texture.RenderTexture.Width,i=t.Texture.RenderTexture.Width,n=this._HorizontalRepeats[0],r=e-this._HorizontalRepeats[1]-n,s=this._VerticalRepeats[0],a=i-this._VerticalRepeats[1]-s,o=s+" "+r+" "+a+" "+n;this.Div.style.borderImage="url("+t.Texture.Source+") "+o+" fill";var l=this._HorizontalPadding[0],h=e-this._HorizontalPadding[1]-l,u=this._VerticalPadding[0],c=i-this._VerticalPadding[1]-u;this.Div.style.borderImageWidth=s+"px "+r+"px "+a+"px "+n+"px",this.Div.style.borderImageOutset=u+"px "+h+"px "+c+"px "+l+"px"}}},{key:"SetRepeat",value:function(t,e){y.Assert(t.length<=2),y.Assert(e.length<=2);for(var i=0;i<2;i++)i<t.length?(this._HorizontalRepeats[2*i]=t[i].start,this._HorizontalRepeats[2*i+1]=t[i].width):(this._HorizontalRepeats[2*i]=0,this._HorizontalRepeats[2*i+1]=0),i<e.length?(this._VerticalRepeats[2*i]=e[i].start,this._VerticalRepeats[2*i+1]=e[i].width):(this._VerticalRepeats[2*i]=0,this._VerticalRepeats[2*i+1]=0);return this}},{key:"SetPadding",value:function(t,e){return y.Assert(null!==t),y.Assert(null!==e),this._VerticalPadding[0]=e.start,this._VerticalPadding[1]=e.width,this._HorizontalPadding[0]=t.start,this._HorizontalPadding[1]=t.width,this}}]),i}();y.NinePatchView=nt,y.AnimationEnable={ReleaseAfterEndCallback:0};var rt=function(){function t(){p(this,t),this.IdToken=0,this._AttachedGroup=null,this.AnimationListenerObj=null,this._AnimationClose=!1,this._LayoutViewRef=null,this._IsTextureAnim=!1}return u(t,[{key:"SetAnimationListener",value:function(t){this.AnimationListenerObj=t}},{key:"AddAnimationListener",value:function(t){this.AnimationListenerObj&&t.AddInherit(this.AnimationListenerObj),this.SetAnimationListener(t)}},{key:"GetAnimationListener",value:function(){return this.AnimationListenerObj}},{key:"Cancel",value:function(t){this._LayoutViewRef&&this._LayoutViewRef.DetachAnimation(this);var e=this.AnimationListenerObj;if(e&&e.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,e.OnAnimationEnd(!1)),this._AttachedGroup){var i=!0;t&&(i=t._AttachedGroup!==this._AttachedGroup),i&&(this._AttachedGroup.CancelFromInternalAnimation(this),this._AttachedGroup=null)}}},{key:"RemoveFromGroup",value:function(){this._AttachedGroup=null}},{key:"AsTextureAnimation",value:function(){this._IsTextureAnim=!0}},{key:"Start",value:function(t){(this._LayoutViewRef=t)&&!this._IsTextureAnim&&t.ClearAnimation()}},{key:"SetCannotDisable",value:function(){}},{key:"OnStart",value:function(){var t=this.AnimationListenerObj;t&&t.OnAnimationStart&&t.OnAnimationStart()}},{key:"OnEnd",value:function(){this._LayoutViewRef&&(this._LayoutViewRef.DetachAnimation(this),this._LayoutViewRef=null);var t=this.AnimationListenerObj;t&&t.OnAnimationEnd&&!this._AnimationClose&&(this._AnimationClose=!0,t.OnAnimationEnd(!0))}},{key:"OnViewHide",value:function(){var t=this.AnimationListenerObj;t&&t.OnViewNoVisible&&t.OnViewNoVisible()}}]),t}();y.AnimationBase=rt;var st=function(){function n(t,e,i){p(this,n),this.OnAnimationStart=t,this._OnAnimationStart=t,this.OnAnimationEnd=e,this._OnAnimationEnd=e,this.OnViewNoVisible=i,this._OnViewNoVisible=i,this._AttachedGroup=null,this._InheritListener=[]}return u(n,[{key:"AddInherit",value:function(t){if(t){if(0===this._InheritListener.length){var i=this;this.OnAnimationStart=function(){i._OnAnimationStart&&i._OnAnimationStart();for(var t=0;t<this._InheritListener.length;t++)this._InheritListener[t].OnAnimationStart&&this._InheritListener[t].OnAnimationStart()},this.OnAnimationEnd=function(t){i._OnAnimationEnd&&i._OnAnimationEnd(t);for(var e=0;e<this._InheritListener.length;e++)this._InheritListener[e].OnAnimationEnd&&this._InheritListener[e].OnAnimationEnd(t)},this.OnViewNoVisible=function(){i._OnViewNoVisible&&i._OnViewNoVisible();for(var t=0;t<this._InheritListener.length;t++)this._InheritListener[t].OnViewNoVisible&&this._InheritListener[t].OnViewNoVisible()}}this._InheritListener.push(t)}}}]),n}();y.AnimationListener=st,y.AnimationManager=function(){function t(){p(this,t),this._EndAckAnimationList=[],this._StartingAnimationList=[],this._CancelingAnimationIdList=[],this._SyncInfo={EndAck:null,Start:null,Cancel:null},this._ActiveAnimationList={},this._IdTokenGenerator=1}return u(t,[{key:"GenerateIdToken",value:function(){return this._IdTokenGenerator++}},{key:"CreateBaseSetting",value:function(t,e,i,n){var r=null;return n&&(r=n.Pacakge()),{ID:t,Nam:e,V_C:0,Dur:Math.floor(i),E:r,En:-1,Set:null,Dly:0}}},{key:"UpdateIdToken",value:function(t,e){t.ID=e}},{key:"ScheduleSyncEndAckAnimation",value:function(t){this._EndAckAnimationList.push(t.IdToken),y.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncStartingAnimation",value:function(t){this._StartingAnimationList.push(t),y.sRenderBridge.RequestSwap()}},{key:"ScheduleSyncCancelAnimation",value:function(t){if(this._ActiveAnimationList[""+t.IdToken])this._CancelingAnimationIdList.push(t.IdToken),delete this._ActiveAnimationList[""+t.IdToken],y.sRenderBridge.RequestSwap();else for(var e=this._StartingAnimationList.length-1;0<=e;e--)this._StartingAnimationList[e].IdToken===t.IdToken&&this._StartingAnimationList.splice(e,1)}},{key:"ProcessViewHideEvents",value:function(t){for(var e=t.length,i=0;i<e;i++){var n=this._ActiveAnimationList[""+t[i]];n&&n.OnViewHide()}}},{key:"ProcessEndEvents",value:function(t){for(var e=t.length,i=0;i<e;i++){var n=this._ActiveAnimationList[""+t[i]];n&&(n.OnEnd(),delete this._ActiveAnimationList[""+t[i]])}}}]),t}(),y.sAnimationManager=null,y.AnimationDelegate=function(){function r(t,e,i){var n;return p(this,r),(n=m(this,v(r).call(this))).IdToken=y.sAnimationManager.GenerateIdToken(),n._SettingInfo=y.sAnimationManager.CreateBaseSetting(n.IdToken,t,e,i),n._Enable=-1,n._AnimationUsed=!1,n}return g(r,y.AnimationBase),u(r,[{key:"SetAnimationListener",value:function(t){d(v(r.prototype),"SetAnimationListener",this).call(this,t),this.AnimationListenerObj&&this.AnimationListenerObj.OnViewNoVisible?this._SettingInfo.V_C=1:this._SettingInfo.V_C=0}},{key:"EnableDelay",value:function(t){return this._SettingInfo.Dly=t,this}},{key:"EnableInfinite",value:function(){return this._SettingInfo.Rpt=-1,this}},{key:"SetRepeat",value:function(t){return this._SettingInfo.Rpt=t,this}},{key:"SetForceSmooth",value:function(t,e){isNaN(e)&&(e=50),(e<10||60<e)&&y.LogE("Fps rate should be 10 ~ 60"),t?this._SettingInfo.Mfr=e:delete this._SettingInfo.Mfr}},{key:"Start",value:function(t){this._AnimationUsed&&(y.sAnimationManager.ScheduleSyncCancelAnimation(this),this.IdToken=y.sAnimationManager.GenerateIdToken(),y.sAnimationManager.UpdateIdToken(this._SettingInfo,this.IdToken)),y.sAnimationManager.ScheduleSyncStartingAnimation(this),d(v(r.prototype),"Start",this).call(this,t),this._AnimationUsed=!0}},{key:"Cancel",value:function(t){y.sAnimationManager.ScheduleSyncCancelAnimation(this),d(v(r.prototype),"Cancel",this).call(this,t)}},{key:"OnEnd",value:function(){this._Enable===y.AnimationEnable.ReleaseAfterEndCallback&&y.sAnimationManager.ScheduleSyncEndAckAnimation(this),d(v(r.prototype),"OnEnd",this).call(this)}},{key:"GetSetting",value:function(){return this._SettingInfo}},{key:"Clone",value:function(){var t=JSON.parse(JSON.stringify()),e=new y.AnimationDelegate("CLONE",0,null);return t.ID=e._SettingInfo.ID,t.V_C=0,e._SettingInfo=t,e}},{key:"Enable",value:function(t){this._SettingInfo.En=t,this._Enable=t}}]),r}(),y.TranslateAnimation=function(){function l(t,e,i,n,r,s){var a;p(this,l);var o={X0:t,X1:e,Y0:i,Y1:n};return(a=m(this,v(l).call(this,"TL",r,s)))._SettingInfo.Set=o,a}return g(l,y.AnimationDelegate),l}(),y.FuncAnimation=function(){function s(t,e,i){var n;if(p(this,s),void 0!==window.JsView&&67<=window.JsView.ForgeNativeRevision){var r={F:t};(n=m(this,v(s).call(this,"FC2",e,i)))._SettingInfo.Set=r}else(n=m(this,v(s).call(this,"FC",e,i)))._SettingInfo.Set={X:"0",Y:"0",Z:"0"};return m(n)}return g(s,y.AnimationDelegate),s}(),y.MultiFactorAnimation=function(){function a(t,e,i,n){var r;p(this,a);var s={FSA:e,PP:t};return(r=m(this,v(a).call(this,"MF",i,n)))._SettingInfo.Set=s,r}return g(a,y.AnimationDelegate),a}(),y.RotateAnimation=function(){function l(t,e,i,n,r,s){var a;p(this,l),a=m(this,v(l).call(this,"RO",r,s)),i instanceof y.Vec3||(i=new y.Vec3(i)),n instanceof y.Vec3||(n=new y.Vec3(n));var o={SA:t,OA:e,AN:i.data,AX:n.data};return a._SettingInfo.Set=o,a}return g(l,y.AnimationDelegate),l}(),y.BasicScaleAnimation=function(){function d(t,e,i,n,r,s,a,o,l,h){var u;p(this,d),u=m(this,v(d).call(this,"SC",a,o));var c={SW:t=Math.round(t),SH:e=Math.round(e),EW:i=Math.round(i),EH:n=Math.round(n),AX:r,AY:s,BW:l=l?Math.round(l):i,BH:h=h?Math.round(h):n};return u._SettingInfo.Set=c,u}return g(d,y.AnimationDelegate),d}(),y.ScaleAnimation=function(){function u(t,e,i,n,r,s){p(this,u);var a=200*t,o=200*t,l=200*e,h=200*e;return m(this,v(u).call(this,a,o,l,h,i,n,r,s,200,200))}return g(u,y.BasicScaleAnimation),u}(),y.OpacityAnimation=function(){function a(t,e,i,n){var r;p(this,a),(r=m(this,v(a).call(this,"OP",i,n)))._StartOpacity=t,r._EndOpacity=e,r._OffsetOpacity=e-t;var s={SO:t,EO:e};return r._SettingInfo.Set=s,r}return g(a,y.AnimationDelegate),a}(),y.CssKeyframeAnimation=function(){function a(t,e,i,n,r){var s;return p(this,a),(s=m(this,v(a).call(this,"CK",e,i)))._SettingInfo.Set={Kf:t,VL:{vw:n||0,vh:r||0}},s}return g(a,y.AnimationDelegate),a}(),y.CssTransitionAnimation=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,"CT",null,null)))._SettingInfo.Set={Ts:t},e}return g(i,y.AnimationDelegate),i}(),y.AnimationEnable={ReleaseAfterEndCallback:0},window.TranslateAnimation=y.TranslateAnimation;var at=function(){function l(t,e){if(p(this,l),this.href="",this.origin="",this.protocol="",this.host="",this.hostname="",this.port="",this.pathname="",this.search="",this.hash="",t){if(!0===t.startsWith("url")){var i=t.indexOf("(")+1,n=t.lastIndexOf(")");t=t.substring(i,n).trim()}if(!0!==t.startsWith("data:")){if(!0===t.startsWith("/")&&(t=document.location.origin+t),!0===t.startsWith("./")&&void 0!==window.JsView&&void 0!==window.JsView.React.JsSubPath){if(void 0===window.JsView.React.__MainPath||"undefined"===window.JsView.React.__MainPathRef||window.JsView.React.__MainPathRef!==document.location.href){window.JsView.React.JsSubPath.startsWith("/")||(window.JsView.React.JsSubPath="/"+window.JsView.React.JsSubPath),window.JsView.React.JsSubPath.endsWith("/")||(window.JsView.React.JsSubPath=window.JsView.React.JsSubPath+"/"),window.JsView.React.__MainPathRef=document.location.href;var r=document.location.pathname.lastIndexOf(window.JsView.React.JsSubPath);window.JsView.React.__MainPath=document.location.origin+document.location.pathname.substring(0,r)}t=window.JsView.React.__MainPath+t.substring(1)}if(this.href=t,e){var s=this.href.indexOf("?"),a=0<s?this.href.substring(0,s):this.href;this.search=1<s?this.href.substring(s):"",s=a.indexOf("://"),this.protocol=0<s?a.substring(0,s+1):"";var o=1<s?a.substring(s+3):"";s=o.indexOf("/"),this.host=0<s?o.substring(0,s):"",this.pathname=1<s?o.substring(s):"",this.origin=0<s?this.protocol+"//"+this.host:"",s=this.host.indexOf(":"),this.hostname=0<s?this.host.substring(0,s):"",this.port=1<s?this.host.substring(s+1):"",console.log("create total parse URL, this=",this)}}else this.href=t}}return u(l,[{key:"replace",value:function(t){this.href=t}}]),l}(),ot=function(){function o(){p(this,o)}return u(o,null,[{key:"SetBackgroundColor",value:function(t,e,i){var n,r=o.TextureManager.GetColorTexture(e);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var s=new y.TextureSetting(r,n);t.ResetTexture(s)}},{key:"SetBackgroundImage",value:function(t,e,i,n){if("string"==typeof e&&(e=new at(e)),e instanceof at==!1)throw Error("Bad Argument.",e);var r,s=o.TextureManager.GetImage(e.href);i&&(r=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var a=new y.ExternalTextureSetting(s,r);t.ResetTexture(a),n&&s.RegisterLoadImageCallback(null,function(){n({width:s.Width,height:s.Height})})}},{key:"SetVideoTexture",value:function(t,e,i){var n,r=o.TextureManager.GetColorTexture(e);i&&(n=new y.ViewRoundCornerMask(i.topLeft,i.topRight,i.bottomLeft,i.bottomRight));var s=new y.TextureSetting(r,n);t.ResetTexture(s)}},{key:"GetTextWidth",value:function(t){return t.str||(t.str=""),t.font||(t.font=y.TextUtils._sDefaultFont),t.size||(t.size=y.TextUtils._sDefaultFontSize),"italic"!==t.italic&&(t.italic=""),"bold"!==t.bold&&(t.bold=""),window.PlatformUtils.GetTextWidth(t)}},{key:"RequestSwap",value:function(){y.sRenderBridge.RequestSwap()}},{key:"RefImgTexSize",value:function(n,r){var t=o.TextureInfo.Cache[n.Source];t?(0<t.refNum?t.refNum++:t.refNum=1,r(t.size)):n.RegisterLoadImageCallback(null,function(){var t={width:n.Width,height:n.Height};r(t);var e=o.TextureInfo.Cache[n.Source];if(e)0<e.refNum?e.refNum++:e.refNum=1;else{var i={size:t,refNum:1};o.TextureInfo.Cache[n.Source]=i}})}},{key:"UnrefImgTexSize",value:function(t){if(t){var e=o.TextureInfo.Cache[t.Source];e&&(e.refNum--,e.refNum<=0&&o.TextureInfo.Unused.add(t.Source))}}},{key:"ClearUnusedTexSize",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=o.TextureInfo.Unused[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var s=n.value,a=o.TextureInfo.Cache[s];a.refNum<-2?(delete o.TextureInfo.Cache[s],o.TextureInfo.Unused.delete(s)):a.refNum<=0?a.refNum--:o.TextureInfo.Unused.delete(s)}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}}}]),o}();ot.TextureInfo={Cache:{},Unused:new Set},ot.TextureManager=null,ot.RootView=null,ot.RootActivity=null,ot.HaltKeyEvent=!1;var lt=function(){function i(t){p(this,i),this.type=t,this.cachedValues=null,this.onSyncCallback=null}return u(i,[{key:"setOnSyncCallback",value:function(t){this.onSyncCallback=t,this.syncLastCaches(!0)}},{key:"setCacheProperty",value:function(t,e){this.cachedValues||(this.cachedValues={}),this.cachedValues[t]=e,this.syncLastCaches(!1),ot.RequestSwap()}},{key:"syncLastCaches",value:function(t){var e=i.LastModified[this.type];!t&&e===this||(i.LastModified[this.type]=this,e&&e.cachedValues&&"function"==typeof e.onSyncCallback&&(e.onSyncCallback(e.cachedValues),e.cachedValues=null))}}],[{key:"SyncAllCachedProperty",value:function(){console.log("JsvLazySyncCache.SyncAllCachedProperty()");for(var t=0,e=Object.values(i.LastModified);t<e.length;t++){e[t].syncLastCaches(!0)}}}]),i}();lt.LastModified={};var ht=function(){function t(){p(this,t),this._ScreenInfo={width:160,height:90,x:.0125,y:2/90,perspective:.0125,scaleRatio:1,designedWidth:1280}}return u(t,[{key:"GetScreenInfo",value:function(){return this._ScreenInfo}},{key:"InitScreenBuffer",value:function(t,e){isNaN(t)&&(t=1),isNaN(e)&&(e=1280);var i=e*t,n=i/16*9;this._ScreenInfo.width=Math.floor(i),this._ScreenInfo.height=Math.floor(n),this._ScreenInfo.x=2/this._ScreenInfo.width,this._ScreenInfo.y=2/this._ScreenInfo.height,this._ScreenInfo.perspective=this._ScreenInfo.x,this._ScreenInfo.scaleRatio=t,this._ScreenInfo.designedWidth=e}},{key:"RequestSwap",value:function(){this._DoRequestSwap()}},{key:"_DoRequestSwap",value:function(){lt.SyncAllCachedProperty(),ot.ClearUnusedTexSize()}},{key:"InstantPerformSwap",value:function(){this._DoRequestSwap(!1)}}]),t}();y.RenderBridge=ht,y.sRenderBridge=new y.RenderBridge,y.sAnimationManager=new y.AnimationManager;var ut=function(){function e(t){p(this,e),this.ownerDocument=window.document,this.nodeType=t,this.parentNode=null,this.jsvEventListener=null}return u(e,[{key:"appendChild",value:function(t){t.parentNode=this}},{key:"removeChild",value:function(t){t.parentNode=null}},{key:"insertBefore",value:function(t){t.parentNode=this}},{key:"addEventListener",value:function(t,e){this.jsvEventListener||(this.jsvEventListener={});var i=this.jsvEventListener[t];i||(i=new Set,this.jsvEventListener[t]=i),i.add(e)}},{key:"removeEventListener",value:function(t,e){if(this.jsvEventListener){var i=this.jsvEventListener[t];i&&(i.delete(e),i.size<=0&&this.jsvEventListener.hasOwnProperty(t)&&delete this.jsvEventListener[t],0===Object.values(this.jsvEventListener).length&&(this.jsvEventListener=null))}}},{key:"dispatchEvent",value:function(t){if(this.jsvEventListener){var e=this.jsvEventListener[t.type];if(e){t.target||(t.target=document.activeElement);var i=!0,n=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){(0,s.value)(t)}}catch(t){n=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw r}}}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No listener added.")}else console.warn("Node.dispatchEvent() Ignore to dispatch event: "+t.type+". No event added.")}}]),e}();ut.ELEMENT_NODE=1,ut.TEXT_NODE=3,ut.DOCUMENT_NODE=9;var ct=function(){function e(t){p(this,e),this.target=null,this.timeStamp=Date.now(),this.type=t}return u(e,[{key:"initEvent",value:function(t){this.type=t}}]),e}(),dt=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,ct),t}();dt.Type={FOCUS:"focus",BLUR:"blur"};function ft(t){if(p(this,ft),this.top=null,this.right=null,this.bottom=null,this.left=null,t&&!1!==t.startsWith("inset")){var e=t.indexOf("(")+1,i=t.substring(e),n=vt.ConvertRect(i);this.top=n.top,this.right=n.right,this.bottom=n.bottom,this.left=n.left}else console.error("Inset.Parse() InvalidArgs: value=",t)}function gt(t){if(p(this,gt),this.source=null,this.slice=null,this.repeat=null,this.outset=null,this.width=null,t){var e=t.indexOf(")")+1,i=t.substring(0,e),n=t.substring(e);this.source=new at(i),this.slice=vt.ConvertRect(n)}else console.error("BorderImage.constructor() InvalidArgs: value=",t)}var pt=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,ct),t}(),vt=function(){function w(){p(this,w)}return u(w,null,[{key:"ConvertFloat",value:function(t){return t?"string"!=typeof t?t:parseFloat(t):t}},{key:"ConvertPx",value:function(t){return t?"string"!=typeof t?t:"0"===t?0:t.endsWith("px")?parseInt(t):t:t}},{key:"ConvertRect",value:function(t){var e=w.SplitString(t," "),i={top:0<e.length?parseInt(e[0]):0,right:1<e.length?parseInt(e[1]):null,bottom:2<e.length?parseInt(e[2]):null,left:3<e.length?parseInt(e[3]):null};return i.right=i.right||0===i.right?i.right:i.top,i.bottom=i.bottom||0===i.bottom?i.bottom:i.top,i.left=i.left||0===i.left?i.left:i.right,i}},{key:"ConvertCorner",value:function(t){var e=w.SplitString(t," "),i={topLeft:0<e.length?parseInt(e[0]):0,topRight:1<e.length?parseInt(e[1]):null,bottomRight:2<e.length?parseInt(e[2]):null,bottomLeft:3<e.length?parseInt(e[3]):null};return i.topRight=i.topRight||0===i.topRight?i.topRight:i.topLeft,i.bottomRight=i.bottomRight||0===i.bottomRight?i.bottomRight:i.topLeft,i.bottomLeft=i.bottomLeft||0===i.bottomLeft?i.bottomLeft:i.bottomRight,i}},{key:"ConvertSize",value:function(t){var e=w.SplitString(t," "),i={width:0<e.length?parseInt(e[0]):0,height:1<e.length?parseInt(e[1]):null};return i.height=i.height||0===i.height?i.height:i.width,i}},{key:"ConvertAnimation",value:function(t){if(null===t||0===t.length)return null;var e=t.indexOf("cubic-bezier"),i=[];if(0<=e){var n=t.indexOf(")"),r=t.substring(e,n+1),s=w.SplitString(t,r),a=!0,o=!1,l=void 0;try{for(var h,u=s[Symbol.iterator]();!(a=(h=u.next()).done);a=!0){var c=h.value,d=w.SplitString(c," ");i=i.concat(d)}}catch(t){o=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(o)throw l}}i.push(r)}else i=w.SplitString(t," ");for(var f=null,g=0,p=1,v=t.includes("alternate"),y=2;y<i.length;y++)if("infinite"!==i[y]){var m=w.ConvertTimeMs(i[y]);!1===isNaN(m)?g=m:(m=parseFloat(i[y]),!1===isNaN(m)?p=m:f=i[y])}else p=-1;var _=1<i.length?w.ConvertTimeMs(i[1]):0;return{name:0<i.length?i[0]:"",duration:_,timingFunction:w.ConvertEasing(f,_),delay:g,iterationCount:p,direction:v}}},{key:"ConvertTimeMs",value:function(t){var e=NaN;return(t=(t=t||"").trim()).endsWith("ms")?e=1:t.endsWith("s")&&(e=1e3),e*=parseFloat(t)}},{key:"ConvertEasing",value:function(t,e){var i=y.Easing.Circular.InOut;if(!t)return i;if(t.includes("ease"))i=t.includes("-in-out")?y.Easing.Circular.InOut:t.includes("-out")?y.Easing.Circular.Out:t.includes("-in")?y.Easing.Circular.In:y.Easing.Circular.InOut;else if(t.includes("linear"))i=null;else if(t.includes("cubic-bezier")){var n=w.ConvertBezier(t);i=new y.BezierEasing(n.x1,n.y1,n.x2,n.y2,e)}return i}},{key:"ConvertBezier",value:function(t){var e=t.indexOf("(");0<=e&&(t=t.substring(e+1));var i=w.SplitString(t,",");return{x1:0<i.length?parseFloat(i[0]):0,y1:1<i.length?parseFloat(i[1]):0,x2:2<i.length?parseFloat(i[2]):0,y2:3<i.length?parseFloat(i[3]):0}}},{key:"ConvertOverflow",value:function(t){return(t=t||"").includes("hidden")?yt.Overflow.HIDDEN:yt.Overflow.VISIBLE}},{key:"ConvertObjectFit",value:function(t){return(t=t||"").includes("fill")?yt.ObjectFit.FILL:t.includes("contain")?yt.ObjectFit.CONTAIN:t.includes("cover")?yt.ObjectFit.COVER:t.includes("none")?yt.ObjectFit.NONE:t.includes("scale-down")?yt.ObjectFit.SCALEDOWN:yt.ObjectFit.CONTAIN}},{key:"SplitString",value:function(t,e){var i=(t=t||"").trim().split(e);if(" "!==e)return i;var n=[],r=!0,s=!1,a=void 0;try{for(var o,l=i[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var h=o.value;h&&n.push(h)}}catch(t){s=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(s)throw a}}return n}}]),w}(),yt=function(){function f(){p(this,f),this.jsvStore={},this.jsvLazySyncCache=new lt("style")}return u(f,[{key:"setProperty",value:function(t,e){if(e=this.jsvConvertPropValue(t,e),this.jsvStore[t]!==e){this.jsvStore[t]=e;var i=f.JsvGetStyleType(t);this.jsvLazySyncCache.setCacheProperty(i,void 0)}}},{key:"getPropertyValue",value:function(t){return this.jsvStore[t]}},{key:"jsvSetChangedListener",value:function(e){this.jsvLazySyncCache.setOnSyncCallback(function(t){e(Object.keys(t))})}},{key:"jsvConvertPropValue",value:function(t,e){switch(t){case f.PROP.VISIBILITY:return e.toUpperCase();case f.PROP.OVERFLOW:return vt.ConvertOverflow(e);case f.PROP.OBJECTFIT:return vt.ConvertObjectFit(e);case f.PROP.TRANSFORM:return e;case f.PROP.CLIPPATH:return new ft(e);case f.PROP.BORDERIMAGE:return new gt(e);case f.PROP.BORDERIMAGEWIDTH:case f.PROP.BORDERIMAGEOUTSET:return vt.ConvertRect(e);case f.PROP.BORDERRADIUS:return vt.ConvertCorner(e);case f.PROP.ANIMATION:return vt.ConvertAnimation(e);case f.PROP.TRANSITION:if(!e)return null;for(var i={},n=vt.SplitString(e,","),r="",s=0;s<n.length;s++){var a=n[s];if(a.indexOf("left")<0&&a.indexOf("top")<0&&a.indexOf("width")<0&&a.indexOf("height")<0&&a.indexOf("opacity")<0)r+=a;else{if(r){var o=vt.ConvertAnimation(r);if("all"===(i[o.name]=o).name)for(var l=0,h=["opacity","left","top","width","height"];l<h.length;l++){i[h[l]]=o}}r=a}if(s==n.length-1&&r){var u=vt.ConvertAnimation(r);if("all"===(i[u.name]=u).name)for(var c=0,d=["opacity","left","top","width","height"];c<d.length;c++){i[d[c]]=u}}}return i;case f.PROP.OPACITY:return vt.ConvertFloat(e);default:return vt.ConvertPx(e)}}}],[{key:"JsvGetStyleType",value:function(t){switch(t){case f.PROP.LEFT:case f.PROP.RIGHT:case f.PROP.TOP:case f.PROP.BOTTOM:return f.TYPE.LAYOUT_POS;case f.PROP.WIDTH:case f.PROP.HEIGHT:case f.PROP.VISIBILITY:case f.PROP.CLIPPATH:case f.PROP.OVERFLOW:case f.PROP.OBJECTFIT:case f.PROP.TRANSFORM:return f.TYPE.LAYOUT_SIZE;case f.PROP.BACKGROUNDCOLOR:case f.PROP.BACKGROUNDIMAGE:case f.PROP.BORDERRADIUS:return f.TYPE.BACKGROUND;case f.PROP.COLOR:case f.PROP.LINEHEIGHT:case f.PROP.WHITESPACE:case f.PROP.FONTFAMILY:case f.PROP.FONTSIZE:case f.PROP.FONTSTYLE:case f.PROP.FONTWEIGHT:case f.PROP.TEXTALIGN:case f.PROP.TEXTSHADOW:case f.PROP.TEXTOVERFLOW:return f.TYPE.FOREGROUND;case f.PROP.BORDERIMAGE:case f.PROP.BORDERIMAGEWIDTH:case f.PROP.BORDERIMAGEOUTSET:return f.TYPE.BORDER;case f.PROP.ANIMATION:return f.TYPE.ANIMATION;case f.PROP.TRANSITION:case f.PROP.OPACITY:break;default:return console.warn("Unknown style type for: "+t),null}}}]),f}();yt.TYPE={LAYOUT_POS:"layout-position",LAYOUT_SIZE:"layout-size",FOREGROUND:"foreground",BACKGROUND:"background",BORDER:"border",ANIMATION:"animation"},yt.Overflow={HIDDEN:Symbol("hidden"),VISIBLE:Symbol("visible")},yt.ObjectFit={FILL:Symbol("fill"),CONTAIN:Symbol("contain"),COVER:Symbol("cover"),NONE:Symbol("none"),SCALEDOWN:Symbol("scale-down")},yt.PROP={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right",WIDTH:"width",HEIGHT:"height",VISIBILITY:"visibility",CLIPPATH:"clipPath",OVERFLOW:"overflow",OBJECTFIT:"objectFit",TRANSFORM:"transform",BACKGROUNDCOLOR:"backgroundColor",BACKGROUNDIMAGE:"backgroundImage",BORDERRADIUS:"borderRadius",COLOR:"color",LINEHEIGHT:"lineHeight",WHITESPACE:"whiteSpace",FONTFAMILY:"fontFamily",FONTSIZE:"fontSize",FONTSTYLE:"fontStyle",FONTWEIGHT:"fontWeight",TEXTALIGN:"textAlign",TEXTSHADOW:"textShadow",TEXTOVERFLOW:"textOverflow",BORDERIMAGE:"borderImage",BORDERIMAGEWIDTH:"borderImageWidth",BORDERIMAGEOUTSET:"borderImageOutset",ANIMATION:"animation",TRANSITION:"transition",OPACITY:"opacity"};function mt(t){var e=yt.PROP[t];Object.defineProperty(yt.prototype,e,{set:function(t){this.setProperty(e,t)},get:function(){return this.getPropertyValue(e)}})}for(var _t in yt.PROP)mt(_t);var wt=function(){function g(){p(this,g)}return u(g,null,[{key:"jsvGetKeyFrames",value:function(t){var e=g.jsvKeyFramesCache[t];if(e)return e;var i="@keyframes ",n=i+t,r=!0,s=!1,a=void 0;try{for(var o,l=g.jsvCache[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var h=o.value,u=h.indexOf(n);if(!(u<0)){var c=h.indexOf("-keyframes",u+1),d=h.indexOf(i,u+1);d<0&&(d=h.length),0<c&&c<d&&(d=c);var f=h.substring(u,d);return g.jsvKeyFramesCache[t]=f}}}catch(t){s=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(s)throw a}}return null}}]),g}();wt.jsvCache=new Set,wt.jsvKeyFramesCache={};var St=function(){function l(t){var e;return p(this,l),(e=m(this,v(l).call(this,ut.ELEMENT_NODE))).parentElement=null,e.tagName=e.constructor.name.replace("Element","").toUpperCase(),e.childElementCount=0,e.childNodes=[],e.firstElementChild=null,e.lastElementChild=null,e.tagName===l.TAG.STYLE?(e.style=null,e.jsvMainView=null):(e.style=new yt,e.jsvMainView=new y.LayoutView),e.jsvMaskView=null,e.jsvAnimation=null,e.jsvStore={transition:null,textContent:null,clientWidth:null},e.jsvLazySyncCache=new lt("element"),e}return g(l,ut),u(l,[{key:"appendChild",value:function(t){if(console.warn("Element.appendChild() this=",this," child=",t),d(v(l.prototype),"appendChild",this).call(this,t),(t.parentElement=this).firstElementChild||(this.firstElementChild=t),this.lastElementChild=t,this.childNodes.push(t),this.childElementCount++,t.nodeType===ut.ELEMENT_NODE&&t.tagName!==l.TAG.STYLE){if(!1===document.jsvIsReady)return void console.warn("Element.appendChild() Failed to append child to Forge. jsvIsReady="+document.jsvIsReady);t.jsvOnLoadForgeView(),t.style.jsvSetChangedListener(t.jsvOnStyleChanged.bind(t));var e=t.jsvMaskView.GetLayoutParams();this.jsvMainView.AddView(t.jsvMaskView,e)}}},{key:"removeChild",value:function(t){d(v(l.prototype),"removeChild",this).call(this,t),t.parentElement=null,t instanceof l&&(t.jsvOnUnloadForgeView(),this.jsvMainView.RemoveView(t.jsvMaskView))}},{key:"insertBefore",value:function(t,e){d(v(l.prototype),"appendChild",this).call(this,t,e),(t.parentElement=this).appendChild(t)}},{key:"setAttribute",value:function(t,e){console.log("Element.setAttribute() name="+t+", value=",e),this[t]=e,t.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,e)}},{key:"removeAttribute",value:function(t){this[t]=void 0,t.startsWith(l.ATTRIBUTE.JSVPREFIX)&&this.jsvLazySyncCache.setCacheProperty(t,void 0)}},{key:"getAttribute",value:function(t){return this[t]}},{key:"hasAttribute",value:function(t){return console.log("Element.hasAttribute() name="+t),!!this[t]}},{key:"focus",value:function(){console.log("Element.focus()"),document.activeElement&&document.activeElement.onfocus();var t=document.activeElement;if(document.activeElement=this,t){var e=new dt(dt.Type.BLUR);e.target=t,document.dispatchEvent(e)}var i=new dt(dt.Type.FOCUS);document.dispatchEvent(i)}},{key:"jsvOnLoadForgeView",value:function(){var e=this;if(this.style.clipPath||this.style.overflow||this.style.objectFit){if(this.jsvMaskView)throw Error("React: jsvMaskView is conflicting.");this.jsvMaskView=new y.ClipView}else this.jsvMaskView||(this.jsvMaskView=this.jsvMainView);this.jsvMaskView!==this.jsvMainView&&this.jsvMaskView.AddView(this.jsvMainView),this.jsvLazySyncCache.setOnSyncCallback(function(t){e.jsvMainView.SetElementProp(t)})}},{key:"jsvOnUnloadForgeView",value:function(){}},{key:"jsvOnStyleChanged",value:function(t){var e=t.includes(yt.TYPE.LAYOUT_SIZE),i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){switch(s.value){case yt.TYPE.LAYOUT_POS:if(e)break;this.jsvFlushViewLayout();break;case yt.TYPE.LAYOUT_SIZE:this.jsvFlushViewLayout();break;case yt.TYPE.BACKGROUND:this.jsvFlushViewBackground();break;case yt.TYPE.ANIMATION:this.jsvFlushViewAnimation()}}}catch(t){n=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"jsvFlushViewLayout",value:function(){if(!(this.style.clipPath||this.style.overflow||this.style.objectFit)||this.jsvMaskView){var t={x:this.style.left,y:this.style.top,width:this.style.width,height:this.style.height};if(this.jsvMaskView.ResetLayoutParams(t),this.jsvMaskView.ResetCssTransform(this.style.transform),this.jsvMaskView!==this.jsvMainView){var e={x:0,y:0,width:t.width,height:t.height};this.jsvMainView.ResetLayoutParams(e)}this.jsvMaskView.SetVisibility(this.style.visibility);var i=null;this.style.clipPath?i={x:this.style.clipPath.left,y:this.style.clipPath.top,width:t.width-this.style.clipPath.left-this.style.clipPath.right,height:t.height-this.style.clipPath.top-this.style.clipPath.bottom}:this.style.objectFit?i={x:0,y:0,width:this.style.width,height:this.style.height}:this.style.overflow===yt.Overflow.HIDDEN&&(i={x:0,y:0,width:this.style.width,height:this.style.height}),i&&this.jsvMaskView.SetClipRect(i.x,i.y,i.width,i.height,!0),this.jsvFlushViewTransition()}else console.error("Element.jsvFlushViewLayout() InvalidOpt: clippath=",this.style.clipPath)}},{key:"jsvFlushViewBackground",value:function(){this.style.backgroundColor&&ot.SetBackgroundColor(this.jsvMainView,this.style.backgroundColor,this.style.borderRadius),this.style.backgroundImage&&ot.SetBackgroundImage(this.jsvMainView,this.style.backgroundImage,this.style.borderRadius)}},{key:"jsvFlushViewAnimation",value:function(){if(this.style.animation){var t=wt.jsvGetKeyFrames(this.style.animation.name);this.jsvAnimation&&this.jsvAnimation.Cancel(),this.jsvAnimation=new y.CssKeyframeAnimation(t,this.style.animation.duration,this.style.animation.timingFunction,this.style.width?this.style.width:this.clientWidth,this.style.height),this.jsvAnimation.EnableDelay(this.style.animation.delay).SetRepeat(this.style.animation.iterationCount);var i=this,e=new y.AnimationListener(null,function(t){if(t){var e=new pt("animationend");e.target=i,document.dispatchEvent(e),y.sRenderBridge.InstantPerformSwap()}},null);this.jsvAnimation.Enable(y.AnimationEnable.ReleaseAfterEndCallback),this.jsvAnimation.SetAnimationListener(e),this.jsvMaskView.StartAnimation(this.jsvAnimation)}}},{key:"jsvFlushViewTransition",value:function(){if(this.style.transition){this.jsvStore.transition||(this.jsvStore.transition={});var t=[];for(var e in this.style.transition){var i=this.jsvStore.transition[e],n=this.style[e];this.jsvStore.transition[e]=n;var r=this.style.transition[e],s={name:e,dur:r.duration,tf:null,dly:r.delay,from:i,to:n};r.timingFunction&&(s.tf=r.timingFunction.Pacakge()),t.push(s)}t.length<=0||(this.jsvAnimation&&this.jsvAnimation.Cancel(),this.jsvAnimation=new y.CssTransitionAnimation(t),this.jsvMaskView.StartAnimation(this.jsvAnimation))}}},{key:"clientWidth",get:function(){return this.style.width}}],[{key:"JsvFitViewLayout",value:function(t,e,i){var n={x:0,y:0,width:t.width,height:t.height},r={width:0,height:0},s=t.width/t.height,a=e.width/e.height;if(console.warn("Element.JsvFitViewLayout() viewRatio="+s),!a)return n;if(!s){if(0===t.width||0===t.height)return n;0===s?t.width=t.height*a:isNaN(s)&&(t.height=t.width/a),s=t.width/t.height}if(console.warn("Element.JsvFitViewLayout() viewRatio="+s),!s)return n.width=e.width,n.height=e.height,n;switch(i=i||yt.ObjectFit.CONTAIN){case yt.ObjectFit.FILL:r.width=t.width,r.height=t.height;break;case yt.ObjectFit.NONE:r.width=e.width,r.height=e.height;break;case yt.ObjectFit.COVER:r=l.JsvStretchSize(t,a,a<s);break;case yt.ObjectFit.SCALEDOWN:var o=s<a;t.width>e.width&&t.height>e.height&&(o=a<s),r=l.JsvStretchSize(t,a,o);break;case yt.ObjectFit.CONTAIN:r=l.JsvStretchSize(t,a,s<a),console.warn("Element.JsvFitViewLayout() expectSize="+JSON.stringify(r));break;default:throw Error("Unexpected object-fit.")}return n.x=(t.width-r.width)/2,n.y=(t.height-r.height)/2,n.width=r.width,n.height=r.height,n}},{key:"JsvStretchSize",value:function(t,e,i){var n={width:0,height:0};return i?(n.width=t.width,n.height=t.width/e):(n.height=t.height,n.width=t.height*e),n}}]),l}();St.TAG={DIV:"DIV",IMAGE:"IMAGE",STYLE:"STYLE",AUDIO:"AUDIO",VIDEO:"VIDEO"},St.ATTRIBUTE={SRC:"src",JSVPREFIX:"jsv"};var It=function(){function o(){var t;return p(this,o),(t=m(this,v(o).call(this))).jsvContentView=null,t.jsvRefedImgTex=null,t}return g(o,St),u(o,[{key:"jsvOnLoadForgeView",value:function(){this.style.borderImage&&(this.jsvMaskView=new y.NinePatchView),d(v(o.prototype),"jsvOnLoadForgeView",this).call(this)}},{key:"jsvOnUnloadForgeView",value:function(){d(v(o.prototype),"jsvOnUnloadForgeView",this).call(this),ot.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex=null}},{key:"jsvOnStyleChanged",value:function(t){d(v(o.prototype),"jsvOnStyleChanged",this).call(this,t);var e=t.includes(yt.TYPE.FOREGROUND),i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){switch(s.value){case yt.TYPE.LAYOUT_SIZE:if(e)break;this.jsvFlushViewForeground();break;case yt.TYPE.FOREGROUND:this.jsvFlushViewForeground();break;case yt.TYPE.BORDER:this.jsvFlushViewBorder()}}}catch(t){n=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"jsvFlushViewForeground",value:function(){if(this.jsvContentView&&(this.jsvContentView.ClearViews(),this.jsvStore.textContent)){var t=this.jsvGetTextParams(),e=new y.TextViewEx(ot.TextureManager,t,this.jsvStore.textContent,!0).GetLayoutView();this.jsvContentView.AddView(e)}}},{key:"jsvFlushViewBorder",value:function(){this.jsvMaskView&&(this.style.clipPath?console.error("BorderImage is conflicting with ClipPath."):this.style.borderImage&&(ot.UnrefImgTexSize(this.jsvRefedImgTex),this.jsvRefedImgTex&&this.jsvRefedImgTex.Source===this.style.borderImage.source.href||(this.jsvRefedImgTex=ot.TextureManager.GetImage(this.style.borderImage.source.href)),ot.RefImgTexSize(this.jsvRefedImgTex,function(t){var e=this.style.borderImageOutset?this.style.borderImageOutset:vt.ConvertRect();this.jsvMaskView.SetPadding({start:e.left,width:t.width-e.left-e.right},{start:e.top,width:t.height-e.top-e.bottom});var i=this.style.borderImage.slice;this.jsvMaskView.SetRepeat([{start:i.left,width:t.width-i.left-i.right}],[{start:i.top,width:t.height-i.top-i.bottom}]);var n=new y.ExternalTextureSetting(this.jsvRefedImgTex);this.jsvMaskView.ResetTexture(n)}.bind(this))))}},{key:"jsvGetTextParams",value:function(){var t={textOverflow:this.style.textOverflow?this.style.textOverflow:"clip",wordWrap:"nowrap"===this.style.whiteSpace?"none":"normal"},e={textColor:this.style.color,font:this.style.fontFamily,size:this.style.fontSize,italic:"italic"===this.style.fontStyle,bold:"bold"===this.style.fontWeight,hAlign:this.style.textAlign?this.style.textAlign:"left",vAlign:this.style.lineHeight?"middle":"top"},i=this.style.textShadow?this.style.textShadow.split(" "):void 0;i&&(e.shadow={shadowOffsetX:parseInt(i[0]),shadowOffsetY:parseInt(i[1]),shadowBlur:parseInt(i[2]),shadowColor:i[3]});var n=this.style.fontSize?this.style.fontSize+4:14;this.style.lineHeight&&(n=this.style.lineHeight);var r=new y.TextViewParams;r.SetTextAttr(t),r.SetFontStyle(e),r.SetLineHeight(n);var s=this.style.width;return void 0===s&&(s=this.clientWidth),r.SetViewSize(new y.RectArea(0,0,s,this.style.height)),r}},{key:"textContent",get:function(){return this.jsvStore.textContent},set:function(t){this.jsvStore.textContent=t,this.jsvStore.clientWidth=null,this.jsvContentView||(this.jsvContentView=new y.LayoutView,this.jsvMainView.AddView(this.jsvContentView)),this.parentElement&&this.jsvFlushViewForeground()}},{key:"clientWidth",get:function(){var t=this.style.width;if(t||0===t)return t;if(this.jsvStore.textContent){if(this.jsvStore.clientWidth||0===this.jsvStore.clientWidth)return this.jsvStore.clientWidth;var e={str:this.jsvStore.textContent,font:this.style.fontFamily,size:this.style.fontSize,italic:this.style.fontStyle,bold:this.style.fontWeight};return this.jsvStore.clientWidth=ot.GetTextWidth(e),console.warn("DivElement.clientWidth() clientWidth="+this.jsvStore.clientWidth),this.jsvStore.clientWidth}return d(v(o.prototype),"clientWidth",this)}}]),o}(),bt=function(){function i(){return p(this,i),m(this,v(i).apply(this,arguments))}return g(i,St),u(i,[{key:"setAttribute",value:function(t,e){d(v(i.prototype),"setAttribute",this).call(this,t,e),t===St.ATTRIBUTE.SRC&&ot.SetBackgroundImage(this.jsvMainView,e,this.style.borderRadius,this.jsvOnLoaded.bind(this))}},{key:"jsvFlushViewBackground",value:function(){this.getAttribute(St.ATTRIBUTE.SRC)}},{key:"jsvOnLoaded",value:function(t){var e={width:this.style.width,height:this.style.height},i=St.JsvFitViewLayout(e,t,this.style.objectFit);this.style.left&&(i.x+=this.style.left),this.style.top&&(i.y+=this.style.top),console.warn("ImageElement.jsvOnLoaded() layout="+JSON.stringify(i)),this.jsvMainView.ResetLayoutParams(i)}}]),i}(),xt=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t))).textContent=null,e}return g(i,St),u(i,[{key:"appendChild",value:function(t){d(v(i.prototype),"appendChild",this).call(this,t),wt.jsvCache.add(t.textContent),this.textContent=t.textContent}},{key:"removeChild",value:function(t){d(v(i.prototype),"removeChild",this).call(this,t),wt.jsvCache.delete(t.textContent),this.textContent=null}}]),i}(),Tt=function(){function n(t){var e;return p(this,n),(e=m(this,v(n).call(this))).jsvMedia=null,t&&(e.src=t),e}return g(n,St),u(n,[{key:"addEventListener",value:function(t,e,i){d(v(n.prototype),"addEventListener",this).call(this,t,e,i),this.jsvAddMediaListener(t)}},{key:"jsvOnLoadForgeView",value:function(){d(v(n.prototype),"jsvOnLoadForgeView",this).call(this),this.jsvMedia||this.jsvInit()}},{key:"jsvOnUnloadForgeView",value:function(){d(v(n.prototype),"jsvOnUnloadForgeView",this).call(this),this.jsvRelease()}},{key:"jsvInit",value:function(){console.warn("MediaElement.jsvInit() this.jsvMedia="+this.jsvMedia);var t=this.jsvEventListener;if(t)for(var e in t.keys)this.jsvAddMediaListener(e)}},{key:"jsvRelease",value:function(){this.jsvMedia&&(this.jsvMedia.releaseResource(),this.jsvMedia.onPlatformDestroy()),this.jsvEventListener=null}},{key:"jsvAddMediaListener",value:function(e){var i=this;this.jsvMedia||this.jsvInit(),this.jsvMedia.addEventListener(e,function(){var t=new ct(e);d(v(n.prototype),"dispatchEvent",i).call(i,t)})}},{key:"src",set:function(t){t=t&&new at(t).href;this.jsvMedia||this.jsvInit(),this.jsvMedia.src=t}}]),n}();for(var kt in Tt.HOOKS={Audio:Audio,Video:window.JsView?window.OffscreenVideoPlayer:"/TODO for html"},Tt.PROP={SetOnly:["autoplay","loop"],GetOnly:["duration","paused"],SetAndGet:["currentTime","muted","playbackRate","preload","volume"],Function:["load","pause","play","unload"]},Tt.PROP){var Et=Tt.PROP[kt],Lt=!0,Rt=!1,Ot=void 0;try{for(var At,Pt=function(){var e=At.value,t={};"SetOnly"!==kt&&"SetAndGet"!==kt||(t.set=function(t){this.jsvMedia||this.jsvInit(),this.jsvMedia[e]=t}),"GetOnly"!==kt&&"SetAndGet"!==kt||(t.get=function(){return this.jsvMedia||this.jsvInit(),this.jsvMedia[e]}),"Function"===kt&&(t=function(){var t;return this.jsvMedia||this.jsvInit(),(t=this.jsvMedia)[e].apply(t,arguments)}),t instanceof Function?Tt.prototype[e]=t:Object.defineProperty(Tt.prototype,e,t)},Ct=Et[Symbol.iterator]();!(Lt=(At=Ct.next()).done);Lt=!0)Pt()}catch(t){Rt=!0,Ot=t}finally{try{Lt||null==Ct.return||Ct.return()}finally{if(Rt)throw Ot}}}var Ft=function(){function i(t){var e;return p(this,i),e=m(this,v(i).call(this,t)),console.log("AudioElement.constructor()",c(e)),e}return g(i,Tt),u(i,[{key:"jsvInit",value:function(){this.jsvMedia=new Tt.HOOKS.Audio,d(v(i.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){d(v(i.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}}]),i}(),Vt=function(){function a(t){var e;return p(this,a),e=m(this,v(a).call(this,t)),console.log("VideoElement.constructor()",c(e)),e}return g(a,Tt),u(a,[{key:"jsvOnStyleChanged",value:function(t){d(v(a.prototype),"jsvOnStyleChanged",this).call(this,t);var e=!0,i=!1,n=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){switch(r.value){case xt.TYPE.LAYOUT_SIZE:this.jsvFlushVideoView()}}}catch(t){i=!0,n=t}finally{try{e||null==s.return||s.return()}finally{if(i)throw n}}}},{key:"jsvFlushVideoView",value:function(){if(this.jsvVideoView){var t={width:this.style.width,height:this.style.height},e={width:this.jsvMedia.videoWidth,height:this.jsvMedia.videoHeight},i=Element.JsvFitViewLayout(t,e,this.style.objectFit);console.warn("VideoElement.jsvOnLoaded() layout="+JSON.stringify(i)),this.jsvVideoView.ResetLayoutParams(i)}}},{key:"jsvInit",value:function(){this.jsvMedia=new Tt.HOOKS.Video,this.addEventListener("load",this.jsvOnLoaded.bind(this)),d(v(a.prototype),"jsvInit",this).call(this)}},{key:"jsvRelease",value:function(){d(v(a.prototype),"jsvRelease",this).call(this),this.jsvMedia=null}},{key:"jsvOnLoaded",value:function(){if(!this.jsvVideoView){var t=ot.TextureManager.GetOffScreenMediaTexture(this.jsvMedia),e=new y.TextureSetting(t);this.jsvVideoView=new y.LayoutView,this.jsvVideoView.ResetTexture(e),this.jsvMainView.AddView(this.jsvVideoView)}this.jsvFlushVideoView()}}]),a}();for(var Mt in Vt.PROP={SetOnly:[],GetOnly:["videoHeight","videoWidth"],SetAndGet:["height","poster","width"]},Vt.PROP){var Nt=Vt.PROP[Mt],Dt=!0,jt=!1,Bt=void 0;try{for(var Gt,Ut=function(){var e=Gt.value,t={};"SetOnly"!==Mt&&"SetAndGet"!==Mt||(t.set=function(t){this.media[e]=t}),"GetOnly"!==Mt&&"SetAndGet"!==Mt||(t.get=function(){return this.media[e]}),Vt.prototype[e]=t},Wt=Nt[Symbol.iterator]();!(Dt=(Gt=Wt.next()).done);Dt=!0)Ut()}catch(t){jt=!0,Bt=t}finally{try{Dt||null==Wt.return||Wt.return()}finally{if(jt)throw Bt}}}var Ht=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,St),t}(),zt=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,ut.TEXT_NODE))).textContent=t,e}return g(i,ut),i}(),Kt=function(){function e(){var t;return p(this,e),(t=m(this,v(e).call(this,ut.DOCUMENT_NODE))).location=window.location,t.rootElement=new It,t.rootElement.ownerDocument=c(t),t.rootElement.id="root",t.activeElement=t.rootElement,t.cookie="",t.jsvIsReady=!1,t}return g(e,ut),u(e,[{key:"createElement",value:function(t){switch(t){case e.DIV_ELEMENT:case e.FDIV_ELEMENT:return new It;case e.IMG_ELEMENT:case e.FIMG_ELEMENT:return new bt;case e.STYLE_ELEMENT:return new xt;case e.AUDIO_ELEMENT:return new Ft;case e.VIDEO_ELEMENT:return new Vt;default:return console.warn("Document.createElement() unknown name="+t),new Ht(t)}}},{key:"createTextNode",value:function(t){return console.log("Document.createTextNode() text="+t),new zt(t)}},{key:"createEvent",value:function(t){return new ct(t)}},{key:"getElementById",value:function(t){if("root"===t||"app"===t)return this.rootElement;throw Error("Document.getElementById() id="+t+" is UNIMPLEMENTED.")}},{key:"querySelector",value:function(t){if(console.warn("Document.querySelector() selectors="+t),"head"===t||"#app"===t)return this.rootElement;throw Error("Document.querySelector() selectors="+t+" is UNIMPLEMENTED.")}},{key:"jsvUpdateRootElement",value:function(t){console.log("Document.jsvUpdateRootElement() this.jsvIsReady = true"),this.rootElement.jsvMainView=t,this.jsvIsReady=!0}}]),e}();Kt.DIV_ELEMENT="div",Kt.IMG_ELEMENT="img",Kt.STYLE_ELEMENT="style",Kt.VIDEO_ELEMENT="video",Kt.AUDIO_ELEMENT="audio",Kt.FIMG_ELEMENT="fimg",Kt.FDIV_ELEMENT="fdiv";var Yt,Jt=new Kt;window.document.createElement=Jt.createElement.bind(Jt),window.document.createTextNode=Jt.createTextNode.bind(Jt),window.document.getElementById=Jt.getElementById.bind(Jt),window.document.querySelector=Jt.querySelector.bind(Jt),window.document.createEvent=Jt.createEvent.bind(Jt),console.log("Hook Document ..."),window.document.dispatchEvent=Jt.dispatchEvent.bind(Jt),ot.TextureManager=new y.TextureManager,ot.RootView=new y.RootView,Jt.jsvUpdateRootElement(ot.RootView),Yt="undefined"!=typeof ForgeExtension?Forge:{LogM:console.log.bind(console),LogF:console.error.bind(console),LogE:console.error.bind(console),LogW:console.warn.bind(console),LogI:console.log.bind(console),LogD:console.debug.bind(console),ThrowError:function(t){throw new Error(t)},Assert:function(t){if(!t)throw new Error("ASSERT!!!!!")},BaseActivity:function t(){p(this,t)}};var Xt=function(){function n(t,e,i){p(this,n),this.PageName=t,this._FocusChild=null,this._LatestFocusChild=null,this.SubPages=[],this._ParentPage=null,this._ConsumeKeycodeUntilUp=-1,this.TouchDispatcher=null,this._Acc=.001,this._KeyLock=!1,this._CVSet=null,this._AutoShow=!1,this._IsShowing=!1,this._HostActivity=i,e&&this.SetContentView(e)}return u(n,[{key:"OnRenderFrame",value:function(){Yt.LogE("OnRenderFrame() MUST override")}},{key:"OnKeyDown",value:function(){return!1}},{key:"OnKeyUp",value:function(){return!1}},{key:"DispatchKeyDown",value:function(t){if(this._KeyLock)return!0;var e=!1;return(n.LastFocusPage=this)._FocusChild&&(e=this._FocusChild.DispatchKeyDown(t)),e=e||this.OnKeyDown(t)}},{key:"DispatchKeyUp",value:function(t){if(this._KeyLock)return!0;var e=!1;return this._FocusChild&&(e=this._FocusChild.DispatchKeyUp(t)),e=e||this.OnKeyUp(t)}},{key:"PrintLastFocusPage",value:function(){var t="------"+this.PageName+"\n",e=this._ParentPage;return e&&(t+=e.PrintLastFocusPage()),t}},{key:"OnMouseDown",value:function(){return!1}},{key:"EnableTouchDispatcher",value:function(){this.TouchDispatcher=new Forge.TouchDispatcher(this)}},{key:"DisableTouchDispatcher",value:function(){this.TouchDispatcher=null}},{key:"GetTouchView",value:function(){return null}},{key:"GetSwipeParams",value:function(t,e,i){var n=void 0===i||0===i?this._Acc:i,r=t*t/2/n;t<0&&(r=-r);var s=e*e/2/n;return e<0&&(s=-s),{durationX:Math.floor(Math.abs(t/n)),durationY:Math.floor(Math.abs(e/n)),distanceX:r,distanceY:s}}},{key:"OnTouch",value:function(){return!1}},{key:"DispatchTouch",value:function(t){var e=!1;return this.TouchDispatcher&&(e=this.TouchDispatcher.OnTouch(t)),e}},{key:"LostTouchFocus",value:function(){}},{key:"OnJavaKey",value:function(){return!0}},{key:"OnPlatformKey",value:function(){return!0}},{key:"PassPlatformKey",value:function(t,e){if(this._KeyLock)return!1;var i=this.OnPlatformKey(t,e);return i=i&&this.OnJavaKey(t,e)}},{key:"DispatchJavaKey",value:function(t,e){if(t===this._ConsumeKeycodeUntilUp)return 1===e&&(this._ConsumeKeycodeUntilUp=-1),Forge.LogM("Consume Javakey until up keycode="+t+" keyaction="+e),!1;if(this._KeyLock)return!1;-1!==this._ConsumeKeycodeUntilUp&&(Forge.LogE("ERROR: Other key pressed before locked key release"),this._ConsumeKeycodeUntilUp=-1);var i=this._FocusChild,n=!0;return i&&(n=i.DispatchJavaKey(t,e)),n=n&&this.PassPlatformKey(t,e),i!==this._FocusChild&&0===e&&this.CosumeAllKeyUnitlUpForFocusChange(t),n}},{key:"CosumeAllKeyUnitlUpForFocusChange",value:function(t){this._ParentPage?this._ParentPage.CosumeAllKeyUnitlUpForFocusChange(t):this._ConsumeKeycodeUntilUp=t}},{key:"OnHostActivityGetFocus",value:function(){this._ConsumeKeycodeUntilUp=-1}},{key:"IsFocus",value:function(){return!this._ParentPage||this._ParentPage._FocusChild===this}},{key:"_IsLeafInChain",value:function(){return this.IsFocus()&&!this._FocusChild}},{key:"SetParent",value:function(t,e){null!==t?(null!==e&&this.SetContentView(e),t instanceof Yt.BaseActivity&&(t=t.GetRootPageBase()),(this._ParentPage=t).SubPages.push(this),this._HostActivity=t._HostActivity,t._IsShowing&&this._AutoShow&&this._OnShowInternal()):Yt.ThrowError("ERROR: parent is null")}},{key:"SetParentPage",value:function(t){this.SetParent(t)}},{key:"RemoveSubPage",value:function(t){t===this._FocusChild&&(this._FocusChild=null),t===this._LatestFocusChild&&(this._LatestFocusChild=null);for(var e=0;e<this.SubPages.length;e++)if(t===this.SubPages[e]){t._OnHideInternal(),this.SubPages.splice(e,1);break}}},{key:"ClearSubPages",value:function(){this.SubPages=[],this._FocusChild=null,this._LatestFocusChild=null}},{key:"GetParentPage",value:function(){return this._ParentPage}},{key:"Focus",value:function(t){if(this.IsFocus()){if(!t)return void Yt.LogI("Already focused page_name="+this.PageName);if(this._IsLeafInChain())return void Yt.LogI("Already focused page_name="+this.PageName)}if(this._ParentPage){for(var e,i=[],n=this;n._ParentPage&&!n.IsFocus();)i.push(n),n=n._ParentPage;e=t&&0===i.length?this._FocusChild:i[i.length-1]._ParentPage._FocusChild;for(var r=[];e;)r.push(e),e=e._FocusChild;for(var s=r.length-1;0<=s;s--)r[s]._BlurInternal();for(var a=i.length-1;0<=a;a--)i[a]._FocusInternal();if(!t)for(var o=i[0];o._LatestFocusChild&&null===o._FocusChild;)o._LatestFocusChild.Focus(),(o=o._FocusChild)||Yt.ThrowError("ERROR: focus chain is broken")}}},{key:"_FocusInternal",value:function(){this._ParentPage?((this._ParentPage._FocusChild=this)._ParentPage._LatestFocusChild=this).OnFocus():Forge.LogE("No dispatcher")}},{key:"_BlurInternal",value:function(){this._ParentPage||Forge.LogE("No dispacher"),this._ParentPage._FocusChild===this?(this._ParentPage._FocusChild=null,this.OnBlur()):Yt.LogW("Not focus yet, page name="+this.PageName)}},{key:"GetFocusChild",value:function(){return this._FocusChild}},{key:"Hide",value:function(){this._AutoShow=!1,this._OnHideInternal()}},{key:"Show",value:function(t){this._OnShowInternal(),t&&this.Focus()}},{key:"OnFocus",value:function(){Yt.LogW("No overrided Page OnFocus event, page name="+this.PageName)}},{key:"OnBlur",value:function(){Yt.LogW("No overrided Page OnBlur event, page name="+this.PageName)}},{key:"OnShow",value:function(){Yt.LogW("No overrided Page OnShow event, page name="+this.PageName)}},{key:"OnHide",value:function(){Yt.LogW("No overrided Page OnHide event, page name="+this.PageName)}},{key:"_OnShowInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._AutoShow&&t._OnShowInternal();this._IsShowing||(this._IsShowing=!0,this.OnShow())}},{key:"_OnHideInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._IsShowing&&t._OnHideInternal();this._IsShowing&&(this._IsShowing=!1,this.OnHide())}},{key:"GetMainView",value:function(){return null===this._CVSet&&(this._CVSet=new Forge.MainViewSetting(null,null)),this._CVSet}},{key:"GetContentView",value:function(){return null===this._CVSet?null:this._CVSet.View}},{key:"SetContentView",value:function(t){null!==t&&(null!==this._CVSet&&this._CVSet.View.BindedPageBase(null),this._CVSet=new Forge.MainViewSetting(t,null),t.BindedPageBase(this))}},{key:"OnContentViewLostInternal",value:function(){this.OnContentViewLost()}},{key:"OnContentViewLost",value:function(){}},{key:"GetHostActivity",value:function(){return this._HostActivity}},{key:"SetHostActivity",value:function(t){this._HostActivity=t}},{key:"GetTextureManager",value:function(){return null!==this._HostActivity?this._HostActivity.GetTextureManager():null}},{key:"SetAutoShow",value:function(t){this._AutoShow=t}},{key:"KeyLock",value:function(){this._KeyLock=!0}},{key:"UnKeyLock",value:function(){this._KeyLock=!1}}]),n}();Xt.LastFocusPage=null;var qt,Zt,Qt,$t,te,ee=(qt=Object,Zt=qt.getPrototypeOf||function(t){return t.__proto__},Qt=qt.setPrototypeOf||function(t,e){return t.__proto__=e,t},$t="object"===("undefined"==typeof Reflect?"undefined":h(Reflect))?Reflect.construct:function(t,e,i){var n,r=[null];return r.push.apply(r,e),n=t.bind.apply(t,r),Qt(new n,i.prototype)},function(t){var e=Zt(t);return Qt(t,Qt(function(){return $t(e,arguments,Zt(this).constructor)},e))}),ie=function(){function t(){p(this,t),this._ChildMap={}}return u(t,[{key:"add",value:function(t,e){this._ChildMap[t]=e}},{key:"focus",value:function(t){var e=this._ChildMap[t];return!!e&&(e.Focus(),!0)}},{key:"forEach",value:function(t){for(var e in this._ChildMap)t(this._ChildMap[e],e,this._ChildMap)}}]),t}();te=window.JsView?y.PageBase:Xt;var ne=ee(function(){function n(t){var e;return p(this,n),(e=m(this,v(n).call(this,t)))._OnKeyDown=null,e._OnKeyUp=null,e._OnFocus=null,e._OnBlur=null,e._DispatchKeyDown=null,e._DispatchKeyUp=null,e._Mounted=!1,e.BranchName=null,e.Router=null,e._TmpRouter=null,e._SubNodes=e.SubPages,e._AutoShow=!1,e}return g(n,te),u(n,[{key:"UpdateMountState",value:function(){for(var t in this._Mounted=!0,this._SubNodes)this._SubNodes[t].UpdateMountState()}},{key:"SetRouter",value:function(t){this.Router=t}},{key:"RouterAdd",value:function(t,e){this.Router?this.Router.add(t,e):this._ParentPage?this._ParentPage.RouterAdd(t,e):(this._TmpRouter||(this._TmpRouter=new ie),this._TmpRouter.add(t,e))}},{key:"SetBranchName",value:function(t){this.BranchName=t}},{key:"SetOnKeyDown",value:function(t){this._OnKeyDown=t}},{key:"SetOnKeyUp",value:function(t){this._OnKeyUp=t}},{key:"SetOnFocus",value:function(t){this._OnFocus=t}},{key:"SetOnBlur",value:function(t){this._OnBlur=t}},{key:"SetDispatchKeyUp",value:function(t){this._DispatchKeyUp=t}},{key:"SetDispatchKeyDown",value:function(t){this._DispatchKeyDown=t}},{key:"OnKeyDown",value:function(t){return!!this._OnKeyDown&&this._OnKeyDown(t)}},{key:"OnKeyUp",value:function(t){return!!this._OnKeyUp&&this._OnKeyUp(t)}},{key:"DispatchKeyDown",value:function(t){var e=!1;return this._DispatchKeyDown&&(e=this._DispatchKeyDown(t)),!!e||d(v(n.prototype),"DispatchKeyDown",this).call(this,t)}},{key:"DispatchKeyUp",value:function(t){var e=!1;return this._DispatchKeyUp&&(e=this._DispatchKeyUp(t)),!!e||d(v(n.prototype),"DispatchKeyUp",this).call(this,t)}},{key:"AttachToActivity",value:function(t,e){d(v(n.prototype),"SetParent",this).call(this,t,e)}},{key:"SetParent",value:function(t){var i=this;null!=t&&(d(v(n.prototype),"SetParent",this).call(this,t,null),this._ParentPage._Mounted&&(this.UpdateMountState(),n.CurFocus&&n.CurFocus.Focus()),this._TmpRouter&&(this._TmpRouter.forEach(function(t,e){i._ParentPage.RouterAdd(e,t)}),this._TmpRouter=null),this.BranchName&&this._ParentPage.RouterAdd(this.BranchName,this))}},{key:"Focus",value:function(t){if(!this._Mounted)return n.CurFocus=this,void console.log("page base tree not build, cache focus");d(v(n.prototype),"Focus",this).call(this,t)}},{key:"OnFocus",value:function(){this._OnFocus&&this._OnFocus()}},{key:"OnBlur",value:function(){this._OnBlur&&this._OnBlur()}}]),n}());ne.CurFocus=null,ne.LastFocusNode=null,ne.RootPageNode=null;function re(t){var e=""+oe++;return le[e]=t,e}function se(t){delete le[t]}function ae(t){return le[t]}var oe=0,le={};ne.pbMap=le;var he=function(){function c(t){var e;p(this,c);var i=(e=m(this,v(c).call(this,t))).props.onKeyUp,n=e.props.onKeyDown,r=e.props.onFocus,s=e.props.onBlur,a=e.props.dispathchKeyDown,o=e.props.dispathcKeyUp,l=e.props.branchName,h=e.props.router,u=new ne(e.props.id);return l&&u.SetBranchName(l),n&&u.SetOnKeyDown(n),i&&u.SetOnKeyUp(i),r&&u.SetOnFocus(r),s&&u.SetOnBlur(s),a&&u.SetDispatchKeyDown(a),o&&u.SetDispatchKeyUp(o),h&&u.SetRouter(h),e._FocusNodeId=re(u),e}return g(c,n.Component),u(c,[{key:"render",value:function(){var e=this,t=this.props,i=(t.onKeyDown,t.onKeyUp,t.onFocus,t.onBlur,t.dispathchKeyDown,t.dispathcKeyUp,t.focus,t.branchName,t.router,a(t,["onKeyDown","onKeyUp","onFocus","onBlur","dispathchKeyDown","dispathcKeyUp","focus","branchName","router"]));return n.createElement("div",s({ref:function(t){e._Element=t}},i,{__pbid:this._FocusNodeId}))}},{key:"componentDidMount",value:function(){for(var t=ae(this._FocusNodeId),e=this._Element;e.parentElement;){var i=(e=e.parentElement).getAttribute("__pbid");if(i){var n=ae(i);t.SetParent(n);break}}}},{key:"componentWillUnmount",value:function(){console.log(this.props.id+"unmount"),this._Element.setAttribute("__pbid",""),this._Element=null,ae(this._FocusNodeId).ClearSubPages(),se(this._FocusNodeId)}}]),c}(),ue=function(){function r(t){var e;p(this,r),e=m(this,v(r).call(this,t));var i,n=new ne("root");return e._FocusNodeId=re(n),i=n,ne.RootPageBase=i,window.JsView?n.AttachToActivity(ot.RootActivity,ot.RootView):(window.addEventListener("keydown",function(t){ae(e._FocusNodeId).DispatchKeyDown(t),t.preventDefault&&t.preventDefault()}),window.addEventListener("keyup",function(t){ae(e._FocusNodeId).DispatchKeyUp(t),t.preventDefault&&t.preventDefault()})),e}return g(r,n.Component),u(r,[{key:"render",value:function(){return n.createElement("div",s({__pbid:this._FocusNodeId},this.props))}},{key:"componentDidMount",value:function(){console.log("Root didmount"),ae(this._FocusNodeId).UpdateMountState(),ne.CurFocus&&ne.CurFocus.Focus()}},{key:"componentWillUnmount",value:function(){console.log("Root unmount"),ae(this._FocusNodeId).ClearSubPages(),se(this._FocusNodeId)}}]),r}(),ce=function(){function i(t,e){p(this,i),this.Ranges=[],void 0!==t&&void 0!==e&&this.Ranges.push(new de(t,e))}return u(i,[{key:"Merge",value:function(t){for(var e=!1,i=this.Ranges.length,n=0;n<this.Ranges.length;n++){if(t.End+1<this.Ranges[n].Start){i=n;break}if(this.Ranges[n].Merge(t)){for(e=!0;n+1<this.Ranges.length&&this.Ranges[n].Merge(this.Ranges[n+1]);)this.Ranges.splice(n+1,1);break}}e||this.Ranges.splice(i,0,t)}},{key:"Exclude",value:function(t){for(var e=0;e<this.Ranges.length&&!(t.End<this.Ranges[e].Start);e++){var i=this.Ranges[e].Exclude(t);if(this.Ranges[e].IsEmpty()&&(this.Ranges.splice(e,1),e--),null!==i.newSplitedRange){this.Ranges.splice(e+1,0,i.newSplitedRange);break}}}},{key:"ForEach",value:function(t,e){if(t)if(e)for(var i=this.Ranges.length-1;0<=i;i--)for(var n=this.Ranges[i].End;n>=this.Ranges[i].Start;n--)t(n);else for(var r=0;r<this.Ranges.length;r++)for(var s=this.Ranges[r].Start;s<=this.Ranges[r].End;s++)t(s);else console.log("Callback function is invalid")}}]),i}(),de=function(){function i(t,e){p(this,i),this.Start=t,this.End=e}return u(i,[{key:"Merge",value:function(t){return this.IsInterAct(t)?(this.Start>t.Start&&(this.Start=t.Start),this.End<t.End&&(this.End=t.End),!0):this.End+1===t.Start?(this.End=t.End,!0):this.Start===t.End+1&&(this.Start=t.Start,!0)}},{key:"IsInterAct",value:function(t){return t.Start<this.Start?!(t.End<this.Start):t.Start<=this.End}},{key:"Exclude",value:function(t){var e={success:!1,newSplitedRange:null};return this.IsInterAct(t)&&(t.Start<=this.Start?t.End<this.End?this.Start=t.End+1:this.Clear():(t.End<this.End&&(e.newSplitedRange=new i(t.End+1,this.End)),this.End=t.Start-1),e.success=!0),e}},{key:"IsEmpty",value:function(){return this.Start>this.End}},{key:"Clear",value:function(){this.End=this.Start-1}},{key:"Clone",value:function(){return new i(this.Start,this.End)}}]),i}(),fe=function(){function r(t,e,i,n){p(this,r),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return u(r,[{key:"Equals",value:function(t){return null!==t&&(t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height)}}]),r}(),ge=(new(function(){function t(){p(this,t)}return u(t,[{key:"FormatRectArea",value:function(t){var e=null;if(t instanceof fe)e=t;else if("object"===h(t)&&null!==t){if(isNaN(t.width)||isNaN(t.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");e=new fe(0,0,t.width,t.height)}return e}}]),t}()),function(){function n(t,e,i){p(this,n),this.IdsMap=[],this._IdsTotal=-1,this.List=[],this.Orient={type:t,widthMax:e},this.Layout={type:i||"relative"}}return u(n,[{key:"SetIdsMap",value:function(t,e){this.IdsMap[t]=e,this._IdsTotal=-1,this.List[e].id=t}},{key:"AddItem",value:function(t){this.List.push(t)}},{key:"GetIdsTotal",value:function(){if(this._IdsTotal<0){for(var t=0,e=0;e<this.List.length;e++)0<=this.List[e].id&&t++;this._IdsTotal=t}return this._IdsTotal}}]),n}());ge.getTemplateItem=function(t,e){return{id:-1,hasSub:!!t.hasSub,xPos:t.blocks.x?t.blocks.x:0,yPos:t.blocks.y?t.blocks.y:0,centerXPos:0,centerYPos:0,width:t.blocks.w,height:t.blocks.h,focusAble:void 0===t.focusable||t.focusable,needRedraw:void 0===t.needRedraw||t.needRedraw,onBottomLine:!1,view:null,data:e}};function pe(){}function ve(){return null}var ye=function(){function r(t,e,i,n){p(this,r),this._Gaps=[{GapStart:0,GapEnd:i-1}],this._FenceTotalWidth=i,this.AheadOffset=n,0<e&&this._SplitGap(0,t,e)}return u(r,[{key:"HasGapFor",value:function(t){for(var e=0;e<this._Gaps.length;e++)if(this._Gaps[e].GapEnd-this._Gaps[e].GapStart+1>=t)return{startPos:this._Gaps[e].GapStart};return null}},{key:"MarkGapUsed",value:function(t,e){if(e<=0)return this._Gaps.length;for(var i=t+e-1,n=-1,r=0;r<this._Gaps.length;r++)if(this._Gaps[r].GapStart<=t&&this._Gaps[r].GapEnd>=i){n=r;break}return-1===n&&console.log("Error in mark gap used, not found suitable gap of offset="+this.AheadOffset),this._SplitGap(n,t,e),this._Gaps.length}},{key:"_SplitGap",value:function(t,e,i){var n=this._Gaps.splice(t,1)[0],r=e+i-1;(e<n.GapStart||r>n.GapEnd)&&console.log("ERROR in split Fence Gap, range overflow"),r!==n.GapEnd&&this._Gaps.splice(t,0,{GapStart:1+r,GapEnd:n.GapEnd}),e!==n.GapStart&&this._Gaps.splice(t,0,{GapStart:n.GapStart,GapEnd:e-1})}},{key:"Fork",value:function(t){var e=new r(0,0,0,0);return e._Gaps=JSON.parse(JSON.stringify(this._Gaps)),e._FenceTotalWidth=this._FenceTotalWidth,e.AheadOffset=t,e}}]),r}(),me=function(){function s(t,e,i,n,r){p(this,s),this._Template=new ge(t,e,i),this._FenceStack=[new ye(0,0,this._Template.Orient.widthMax,0)],this._Identity=0,this._MoveLimitArea=new fe(0,0,n,r),this._FenceEdge={StartX:0,StartY:0},this._NotOccupiedEdgeList=[],this._SupportHistoryPath=!1,this._VisibleRangeSearchBaseItem=null}return u(s,[{key:"_CheckNeighborItemMatching",value:function(t,e,i){var n=!1,r=e.edgeObj,s=i.edgeObj,a="rightEdge",o="leftEdge";switch(t){case"left":a="rightEdge",o="leftEdge";break;case"right":a="leftEdge",o="rightEdge";break;case"top":a="bottomEdge",o="topEdge";break;case"bottom":o="bottomEdge",a="topEdge";break;default:console.log("_CheckNeighborItemMatching unknown direction:"+t)}var l=s[a].range.Start,h=s[a].range.Clone();s[a].range.Exclude(r[o].range),r[o].range.Exclude(h);var u=s[a].range.Start;return s[a].range.IsEmpty()&&(n=!(s[a]=null)),r[o].range.IsEmpty()&&(n=!(r[o]=null)),l!==u&&(n=!0),n}},{key:"_FindNearestNeighbor",value:function(t){for(var e=t.edgeObj,i=-1,n=-1,r=-1,s=-1,a=-1,o=-1,l=-1,h=-1,u=0;u<this._NotOccupiedEdgeList.length;u++){var c=this._NotOccupiedEdgeList[u],d=c.edgeObj;if(t!==c){if(null!==e.leftEdge&&null!==d.rightEdge&&e.leftEdge.x>=d.rightEdge.x&&e.leftEdge.range.IsInterAct(d.rightEdge.range)){if(-1===a){a=e.leftEdge.x-d.rightEdge.x,i=u;continue}if(a>e.leftEdge.x-d.rightEdge.x){a=e.leftEdge.x-d.rightEdge.x,i=u;continue}}if(null!==e.rightEdge&&null!==d.leftEdge&&e.rightEdge.x<=d.leftEdge.x&&e.rightEdge.range.IsInterAct(d.leftEdge.range)){if(-1===o){o=d.leftEdge.x-e.rightEdge.x,n=u;continue}if(o>d.leftEdge.x-e.rightEdge.x){o=d.leftEdge.x-e.rightEdge.x,n=u;continue}}if(null!==e.topEdge&&null!==d.bottomEdge&&e.topEdge.y>=d.bottomEdge.y&&e.topEdge.range.IsInterAct(d.bottomEdge.range)){if(-1===l){l=e.topEdge.y-d.bottomEdge.y,r=u;continue}if(l>e.topEdge.y-d.bottomEdge.y){l=e.topEdge.y-d.bottomEdge.y,r=u;continue}}if(null!==e.bottomEdge&&null!==d.topEdge&&e.bottomEdge.y<=d.topEdge.y&&e.bottomEdge.range.IsInterAct(d.topEdge.range)){if(-1===h){h=d.topEdge.y-e.bottomEdge.y,s=u;continue}if(h>d.topEdge.y-e.bottomEdge.y){h=d.topEdge.y-e.bottomEdge.y,s=u;continue}}}}return{left:i,right:n,top:r,bottom:s}}},{key:"_CalculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],r=n.edgeObj,s=n.index;if(this._Template.Orient.type===_e){if(null===r.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&r.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===r.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&r.rightEdge.x>this._FenceEdge.StartX)continue}var a=this._FindNearestNeighbor(n);if(-1!==a.left){var o=this._NotOccupiedEdgeList[a.left],l=o.index;if(t)e[l].tmpNeighborIndexList.right.push(s),e[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,o)&&(e[l].neighborIndexList.right.push(s),e[s].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[s].tmpNeighborIndexList.left=[])}if(-1!==a.right){var h=this._NotOccupiedEdgeList[a.right],u=h.index;if(t)e[u].tmpNeighborIndexList.left.push(s),e[s].tmpNeighborIndexList.right.push(u);else this._CheckNeighborItemMatching("right",n,h)&&(e[u].neighborIndexList.left.push(s),e[s].neighborIndexList.right.push(u),e[u].tmpNeighborIndexList.left=[],e[s].tmpNeighborIndexList.right=[])}if(-1!==a.top){var c=this._NotOccupiedEdgeList[a.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(s),e[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(s),e[s].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[s].tmpNeighborIndexList.top=[])}if(-1!==a.bottom){var f=this._NotOccupiedEdgeList[a.bottom],g=f.index;if(t)e[g].tmpNeighborIndexList.top.push(s),e[s].tmpNeighborIndexList.bottom.push(g);else this._CheckNeighborItemMatching("bottom",n,f)&&(e[g].neighborIndexList.top.push(s),e[s].neighborIndexList.bottom.push(g),e[g].tmpNeighborIndexList.top=[],e[s].tmpNeighborIndexList.bottom=[])}}}},{key:"_TryCalculateNeighborItem",value:function(t,e,i,n,r){var s={index:t,edgeObj:{leftEdge:{x:e,range:new de(i,i+r-1)},rightEdge:{x:e+n,range:new de(i,i+r-1)},topEdge:{y:i,range:new de(e,e+n-1)},bottomEdge:{y:i+r,range:new de(e,e+n-1)}}};0===e&&(s.edgeObj.leftEdge=null),0===i&&(s.edgeObj.topEdge=null);var a=!1,o=this._Template.Orient.widthMax,l=this._FenceEdge.StartX,h=this._FenceEdge.StartY;this._Template.Orient.type===_e?(e+n===o&&(s.edgeObj.rightEdge=null),i>this._FenceEdge.StartY&&(a=!0,h=i)):(i+r===o&&(s.edgeObj.bottomEdge=null),e>this._FenceEdge.StartX&&(a=!0,l=e)),this._FenceEdge.StartX=l,this._FenceEdge.StartY=h,this._NotOccupiedEdgeList.push(s),a&&this._CalculateNeighborItem()}},{key:"_UpdateLastFenceEdge",value:function(){for(var t=this._FenceEdge,e={StartX:-1,StartY:-1},i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i].edgeObj;this._Template.Orient.type===_e?null!==n.bottomEdge&&n.bottomEdge.y>t.StartY&&(-1===e.StartY?e.StartY=n.bottomEdge.y:n.bottomEdge.y<e.StartY&&(e.StartY=n.bottomEdge.y)):null!==n.rightEdge&&n.rightEdge.x>t.StartX&&(-1===e.StartX?e.StartX=n.rightEdge.x:n.rightEdge.y<e.StartX&&(e.StartX=n.rightEdge.x))}this._FenceEdge=e}},{key:"ParseTemplateItem",value:function(t,e){var i,n,r,s,a=ge.getTemplateItem(t,e),o=this._FenceStack,l=-1,h=1,u=a.id,c=a.width,d=a.height,f=0,g=0,p=0,v=0,y=0;if("relative"===this._Template.Layout.type){v=this._Template.Orient.type===_e?c:d,y=this._Template.Orient.type===_e?d:c;for(var m=null,_=null;0<o.length;){var w=o[o.length-1];if(null!==(_=w.HasGapFor(v))){m=w;break}o.pop()}null!==_?(f=_.startPos,g=m.AheadOffset):console.log("ERROR: coding error, header full gap fence lost"),p=this._Template.Orient.type===_e?(i=f,r=v,((n=g)+(s=y))/this._MoveLimitArea.height):(n=f,s=v,((i=g)+(r=y))/this._MoveLimitArea.width)}else i=a.xPos,n=a.yPos,r=c,s=d,p=this._Template.Orient.type===_e?(n+s)/this._MoveLimitArea.height:(i+r)/this._MoveLimitArea.width;-1===l&&(l=u);var S=Math.ceil(p);0<=p&&S!==h&&(h=S,l=u),a.curPageHeadId=l,a.neighborIndexList={left:[],top:[],right:[],bottom:[]},a.tmpNeighborIndexList={left:[],top:[],right:[],bottom:[]},a.pathHistory={left:null,top:null,right:null,bottom:null},a.xPos=i,a.yPos=n,a.centerXPos=Math.floor(i+r/2)-1,a.centerYPos=Math.floor(n+s/2)-1,this._Template.Orient.type!==_e&&n+s===this._Template.Orient.widthMax&&(a.onBottomLine=!0),this._Template.AddItem(a),a.focusAble&&this._Template.SetIdsMap(this._Identity++,this._Template.List.length-1),this._TryCalculateNeighborItem(this._Template.List.length-1,a.xPos,a.yPos,a.width,a.height);var I=g+y-1;o[0].AheadOffset<=I&&o.splice(0,0,new ye(0,0,this._Template.Orient.widthMax,1+I));for(var b=!1,x=!1,T=-1,k=o.length-1;0<=k;k--){if(!(o[k].AheadOffset<=I)){o[k].AheadOffset===1+I&&(x=!0),T=k;break}o[k].AheadOffset===I&&(b=!0),0===o[k].MarkGapUsed(f,v)&&o.splice(k,1)}var E=I;if(!b&&T+1<=o.length-1){var L=o[T+1].Fork(E);o.splice(T+1,0,L)}if(!x&&0<T){var R=o[T].Fork(1+E);o.splice(T+1,0,R)}}},{key:"GetItem",value:function(t){return this._Template.List[this._Template.IdsMap[t]]}},{key:"_CheckIdsHasFocusable",value:function(t){for(var e=this._Template.List,i=!1,n=0;n<t.length;n++){if(e[t[n]].focusAble){i=!0;break}}return i}},{key:"_IsInNeighborList",value:function(t,e){for(var i=!1,n=t.length-1;0<=n;n--)if(t[n]===e){i=!0;break}return i}},{key:"_GetValidNeighborIndex",value:function(t,e,i){var n=this._Template.List,r=-1,s=n[e],a=n[t],o=null,l=null;if(0<(o="top"===i?(l=s.neighborIndexList.left,s.neighborIndexList.right):(l=s.neighborIndexList.right,s.neighborIndexList.left)).length)for(var h=0;h<o.length;h++){var u=o[h],c=n[u];if(c.focusAble&&("top"===i&&c.yPos+c.height<=a.yPos||"bottom"===i&&c.yPos>=a.yPos+a.height)){r=u;break}}if(-1===r&&0<l.length)for(var d=0;d<l.length;d++){var f=l[d],g=n[f];if(g.focusAble&&("top"===i&&g.yPos+g.height<=a.yPos||"bottom"===i&&g.yPos>=a.yPos+a.height)){r=f;break}}return r}},{key:"_CaculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],r=n.edgeObj,s=n.index;if(this._Template.Orient.type===_e){if(null===r.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&r.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===r.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&r.rightEdge.x>this._FenceEdge.StartX)continue}var a=this._FindNearestNeighbor(n);if(-1!==a.left){var o=this._NotOccupiedEdgeList[a.left],l=o.index;if(t)e[l].tmpNeighborIndexList.right.push(s),e[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,o)&&(e[l].neighborIndexList.right.push(s),e[s].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[s].tmpNeighborIndexList.left=[])}if(-1!==a.right){var h=this._NotOccupiedEdgeList[a.right],u=h.index;if(t)e[u].tmpNeighborIndexList.left.push(s),e[s].tmpNeighborIndexList.right.push(u);else this._CheckNeighborItemMatching("right",n,h)&&(e[u].neighborIndexList.left.push(s),e[s].neighborIndexList.right.push(u),e[u].tmpNeighborIndexList.left=[],e[s].tmpNeighborIndexList.right=[])}if(-1!==a.top){var c=this._NotOccupiedEdgeList[a.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(s),e[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(s),e[s].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[s].tmpNeighborIndexList.top=[])}if(-1!==a.bottom){var f=this._NotOccupiedEdgeList[a.bottom],g=f.index;if(t)e[g].tmpNeighborIndexList.top.push(s),e[s].tmpNeighborIndexList.bottom.push(g);else this._CheckNeighborItemMatching("bottom",n,f)&&(e[g].neighborIndexList.top.push(s),e[s].neighborIndexList.bottom.push(g),e[g].tmpNeighborIndexList.top=[],e[s].tmpNeighborIndexList.bottom=[])}}}},{key:"CalculateNeighborWhenAddStop",value:function(){this._UpdateLastFenceEdge(),this._CaculateNeighborItem();this._CaculateNeighborItem(!0);for(var t=this._Template.List,e=t.length-1,i=t[e],n=t.length-1;0<=n;n--)if((i=t[n]).focusAble){e=n;break}for(var r=t.length-1;0<=r;r--){var s=t[r];if(s.focusAble){if(0<s.neighborIndexList.bottom.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.bottom)){var a=s.neighborIndexList.bottom[s.neighborIndexList.bottom.length-1],o=this._GetValidNeighborIndex(r,a,"bottom");-1!==o&&(s.neighborIndexList.bottom=[],s.neighborIndexList.bottom.push(o))}if(0<s.neighborIndexList.top.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.top)){var l=this._GetValidNeighborIndex(r,s.neighborIndexList.top[s.neighborIndexList.top.length-1],"top");-1!==l&&(s.neighborIndexList.top=[],s.neighborIndexList.top.push(l))}}}if(this._Template.Orient.type!==_e){for(var h=null,u=-1,c=0,d=e-1;0<=d;d--){var f=t[d];f.focusAble&&f.yPos>=i.yPos+i.height&&(0!==f.neighborIndexList.right.length&&this._CheckIdsHasFocusable(f.neighborIndexList.right)&&!this._IsInNeighborList(f.neighborIndexList.right,e)||(c=Math.pow(i.xPos-f.xPos,2)+Math.pow(i.yPos-f.yPos,2),-1===u?(u=c,h=d):c<u&&(u=c,h=d)))}h&&(i.neighborIndexList.bottom=[],i.neighborIndexList.bottom.push(h))}else for(var g=e-1;0<=g;g--){var p=t[g];p.focusAble&&p.yPos+p.height<i.yPos+i.height&&0===p.neighborIndexList.bottom.length&&p.neighborIndexList.bottom.push(e)}}},{key:"GetNextItem",value:function(t,e,i,n){0===e&&0===i&&console.log("GetNextItem(): offset is 0"),0!==e&&0!==i&&console.log("GetNextItem(): not support change vertical and horizontal and the same time");var r,s=this._Template.IdsMap[t];return r=0!==e?this._GetNextItemVertical(s,e):this._GetNextItemHorizontal(s,i),n&&null===r&&(r=0!==e?this._GetNextLoopItemVertical(s,e):this._GetNextLoopItemHorizontal(s,i)),null===r?-1:r.id}},{key:"_GetNextItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,r="top",s="bottom";0<e&&(s="top",r="bottom");for(var a=i.length-1,o=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){a=l;break}}var h=!1,u=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[r]),null===c){var d=i[t].neighborIndexList[r];if(0<i[t].tmpNeighborIndexList[r].length&&(d=d.concat(i[t].tmpNeighborIndexList[r])),1===d.length)u=d[0],a===t&&"bottom"===r&&o===we||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),h=!0;else{for(var f=0;f<d.length;f++){var g=i[u=d[f]];if(n<=g.xPos+g.width-1&&n>=g.xPos){a===t&&"bottom"===r&&o===we||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),h=!0;break}}if(!h||!i[u].focusAble)for(var p=0;p<d.length;p++){var v=d[p];if(i[v].focusAble){a===t&&"bottom"===r&&o===we||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),u=v,h=!0;break}}}}else u=c,a===t&&"bottom"===r&&o===we||(i[u].pathHistory[s]=t),h=!0;return h?i[u].focusAble?i[u]:this._GetNextItemVertical(u,e):null}},{key:"_GetNextItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,r="left",s="right";0<e&&(s="left",r="right");for(var a=i.length-1,o=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){a=l;break}}var h=!1,u=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[r]),null===c){var d=i[t].neighborIndexList[r];if(0<i[t].tmpNeighborIndexList[r].length&&(d=d.concat(i[t].tmpNeighborIndexList[r])),1===d.length)u=d[0],a===t&&"right"===r&&o===_e||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),h=!0;else{for(var f=0;f<d.length;f++){var g=i[u=d[f]];if(n<=g.yPos+g.height-1&&n>=g.yPos){a===t&&"right"===r&&o===_e||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),h=!0;break}}if(!h||!i[u].focusAble)for(var p=0;p<d.length;p++){var v=d[p];if(i[v].focusAble){a===t&&"right"===r&&o===_e||(i[t].pathHistory[r]=u,i[u].pathHistory[s]=t),u=v,h=!0;break}}}}else u=c,a===t&&"right"===r&&o===_e||(i[u].pathHistory[s]=t),h=!0;return h?i[u].focusAble?i[u]:this._GetNextItemHorizontal(u,e):null}},{key:"_GetNextLoopItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,r="bottom";0<e&&(r="top");var s=!1,a=-1,o=i[t].neighborIndexList[r];for(0<i[t].tmpNeighborIndexList[r].length&&(o=o.concat(i[t].tmpNeighborIndexList[r]));1<=o.length;)for(var l=0;l<o.length;l++){var h=i[a=o[l]];if(n<=h.xPos+h.width-1&&n>=h.xPos){o=i[a].neighborIndexList[r],s=!0;break}}return s?i[a].focusAble?i[a]:this._GetNextLoopItemVertical(a,e):null}},{key:"_GetNextLoopItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,r="right";0<e&&(r="left");var s=!1,a=-1,o=i[t].neighborIndexList[r];for(0<i[t].tmpNeighborIndexList[r].length&&(o=o.concat(i[t].tmpNeighborIndexList[r]));1<=o.length;)for(var l=0;l<o.length;l++){var h=i[a=o[l]];if(n<=h.yPos+h.height-1&&n>=h.yPos){o=i[a].neighborIndexList[r],s=!0;break}}return s?i[a].focusAble?i[a]:this._GetNextLoopItemHorizontal(a,e):null}},{key:"GetTemplate",value:function(){return this._Template}},{key:"GetVisibleItemList",value:function(t,e,i){if(e<t)return null;for(var n=this._Template.IdsMap[i],r={resultStartIdx:-1,resultEndIdx:-1,enableBackwardSearching:!0,enableForwardSearching:!0,checkingStartLinePos:t,checkingEndLinePos:e},s={searchDirect:-1,baseIdx:n,checkingStartLineRanges:new ce,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new ce,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:0,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:r},a={searchDirect:1,baseIdx:n,checkingStartLineRanges:new ce,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new ce,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:this._Template.List.length-1,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:r},o=this._Template.Orient.type===_e,l=0;r.enableBackwardSearching||r.enableForwardSearching;)r.enableBackwardSearching&&this._DoSearching(s,-l,o),r.enableForwardSearching&&this._DoSearching(a,l,o),l++;if(r.resultStartIdx<0&&(0<=s.latestOverStartLineIdx&&0<=s.firstStartLineBlockIdx?r.resultStartIdx=s.latestOverStartLineIdx:0<=a.firstStartLineBlockIdx&&(r.resultStartIdx=a.firstStartLineBlockIdx)),r.resultEndIdx<0&&(0<=a.latestOverEndLineIdx&&0<=a.firstEndLineBlockIdx?r.resultEndIdx=a.latestOverEndLineIdx:0<=s.firstEndLineBlockIdx&&(r.resultEndIdx=s.firstEndLineBlockIdx)),r.resultStartIdx<0&&r.resultEndIdx<0){var h=this._Template.List[0],u=o?h.yPos:h.xPos,c=this._Template.List[this._Template.List.length-1],d=o?c.yPos:c.xPos,f=o?c.height:c.width;t<u&&d+f<e&&(r.resultStartIdx=0,r.resultEndIdx=this._Template.List.length-1)}var g=null;r.resultStartIdx<0&&r.resultEndIdx<0||(g={visibleStart:0<=r.resultStartIdx?r.resultStartIdx:0,visibleEnd:0<=r.resultEndIdx?r.resultEndIdx:this._Template.List.length-1});return g}},{key:"_DoSearching",value:function(t,e,i){var n=this._Template.List[t.baseIdx+e],r=i?n.xPos:n.yPos,s=i?n.width:n.height,a=i?n.yPos:n.xPos,o=i?n.height:n.width;if(t.common.resultStartIdx<0&&!t.startLineRangesFulled){var l=!1;if(a<=t.common.checkingStartLinePos&&a+o-1>=t.common.checkingStartLinePos?(t.latestOverStartLineIdx=t.baseIdx+e,t.firstStartLineBlockIdx<0&&(t.firstStartLineBlockIdx=t.baseIdx+e),t.checkingStartLineRanges.Merge(new de(r,r+s-1)),l=!0):t.searchDirect<0&&a+o-1<=t.common.checkingStartLinePos&&(t.checkingStartLineRanges.Merge(new de(r,r+s-1)),l=!0),l){var h=t.checkingStartLineRanges.Ranges[0];h&&this.DebugPrint&&h.Start<=0&&h.End>=this._Template.Orient.widthMax-1&&((h.End>this._Template.Orient.widthMax-1||h.Start<0)&&(t.startLineRangesFulled=!0),0<t.searchDirect?t.common.resultStartIdx=t.firstStartLineBlockIdx:t.common.resultStartIdx=t.latestOverStartLineIdx,0<=t.common.resultStartIdx&&(t.common.enableBackwardSearching=!1))}}if(t.common.resultEndIdx<0&&!t.endLineRangesFulled){var u=!1;if(a<=t.common.checkingEndLinePos&&a+o-1>=t.common.checkingEndLinePos?(t.latestOverEndLineIdx=t.baseIdx+e,t.firstEndLineBlockIdx<0&&(t.firstEndLineBlockIdx=t.baseIdx+e),t.checkingEndLineRanges.Merge(new de(r,r+s-1)),u=!0):0<t.searchDirect&&a>=t.common.checkingEndLinePos&&(t.checkingEndLineRanges.Merge(new de(r,r+s-1)),u=!0),u){var c=t.checkingEndLineRanges.Ranges[0];c&&this.DebugPrint&&c.Start<=0&&c.End>=this._Template.Orient.widthMax-1&&((c.End>this._Template.Orient.widthMax-1||c.Start<0)&&(t.endLineRangesFulled=!0),t.searchDirect<0?t.common.resultEndIdx=t.firstEndLineBlockIdx:t.common.resultEndIdx=t.latestOverEndLineIdx,0<=t.common.resultEndIdx&&(t.common.enableForwardSearching=!1))}}t.baseIdx+e===t.endSearchingIndex&&(0<t.searchDirect?t.common.enableForwardSearching=!1:t.common.enableBackwardSearching=!1,t.searchToBorder=!0)}}]),s}(),_e=Symbol("vertical"),we=Symbol("horizontal"),Se={seamLess:Symbol("seamless"),wholePage:Symbol("wholePage"),seamlessFixedId:Symbol("seamlessFixedId")},Ie={left:Symbol("left"),right:Symbol("right"),top:Symbol("top"),bottom:Symbol("bottom")},be=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._setVisibility=e._setVisibility.bind(c(e)),e._updateView=e._updateView.bind(c(e)),e._Visibility=!0,e.props.setVisibleFunc&&(e.props.setVisibleFunc(e._setVisibility),e._Visibility=!1),e.props.registerUpdateFunc&&e.props.registerUpdateFunc(e._updateView),e.state={visible:e._Visibility},e}return g(i,n.Component),u(i,[{key:"_updateView",value:function(){this.setState({visible:this._Visibility})}},{key:"_setVisibility",value:function(t){this._Visibility=t,this.setState({visible:this._Visibility})}},{key:"render",value:function(){var t=this.state.visible?"inherit":"hidden";return n.createElement("div",{style:{left:this.props.x,top:this.props.y,visibility:t}},this.props.renderFunc())}}]),i}(),xe=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._updateView=e._updateView.bind(c(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:ve,onRenderDone:pe},e}return g(i,n.Component),u(i,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||pe})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),i}(),Te=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._updateView=e._updateView.bind(c(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:pe},e}return g(i,n.Component),u(i,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||pe})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),i}(),ke=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._updateView=e._updateView.bind(c(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:pe},e}return g(i,n.Component),u(i,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||pe})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),i}(),Ee=function(){function t(){return p(this,t),m(this,v(t).apply(this,arguments))}return g(t,n.Component),u(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return n.createElement("div",null,n.createElement(xe,{registerUpdateFunc:this.props.registerUpdateContentFunc}),n.createElement(ke,{registerUpdateFunc:this.props.registerUpdateBlurFunc}),n.createElement(Te,{registerUpdateFunc:this.props.registerUpdateFocusFunc}))}}]),t}(),Le=function(){function i(t){var e;return p(this,i),(e=m(this,v(i).call(this,t)))._updateView=e._updateView.bind(c(e)),e.props.registerUpdateFunc(e._updateView),e.state={x:0,y:0,transitionCallback:pe},e}return g(i,n.Component),u(i,[{key:"_updateView",value:function(t,e,i){this.setState({x:t,y:e,transitionCallback:i})}},{key:"render",value:function(){return n.createElement("div",{style:{left:this.props.x,top:this.props.y}},n.createElement("div",{style:{transition:this.props.transition,top:this.state.y,left:this.state.x},onTransitionEnd:this.state.transitionCallback},n.createElement(Ee,{registerUpdateContentFunc:this.props.registerUpdateContentFunc,registerUpdateFocusFunc:this.props.registerUpdateFocusFunc,registerUpdateBlurFunc:this.props.registerUpdateBlurFunc})))}}]),i}(),Re=function(){function t(){p(this,t),this._SimpleWidget=null,this._registerSimpleWidget=this._registerSimpleWidget.bind(this),this._unregisterSimpleWidget=this._unregisterSimpleWidget.bind(this),this.dispatch=this.dispatch.bind(this)}return u(t,[{key:"_registerSimpleWidget",value:function(t){this._SimpleWidget=t}},{key:"_unregisterSimpleWidget",value:function(){this._SimpleWidget=null}},{key:"dispatch",value:function(t){t&&this._SimpleWidget&&this._SimpleWidget._dispathcEvent(t)}}]),t}();Re.Type={setFocusId:Symbol("setFocusId"),setFocusRect:Symbol("setFocusRect"),updateItem:Symbol("updateItem"),slideToItem:Symbol("slideTo")};var Oe=function(){function f(t){var i;p(this,f),(i=m(this,v(f).call(this,t)))._OnKeyDown=i._OnKeyDown.bind(c(i)),i._onFocusInner=i._onFocusInner.bind(c(i)),i._onBlurInner=i._onBlurInner.bind(c(i)),i._OnFocusableItemEdge=i._OnFocusableItemEdge.bind(c(i)),i._updateItemVisibility=i._updateItemVisibility.bind(c(i)),i._onTransitionEnd=i._onTransitionEnd.bind(c(i)),i._getContentView=i._getContentView.bind(c(i)),i._getFocusView=i._getFocusView.bind(c(i)),i._getBlurView=i._getBlurView.bind(c(i)),i._onContentUpdate=i._onContentUpdate.bind(c(i)),i._drawItem=i._drawItem.bind(c(i)),i._getSlideAnim=i._getSlideAnim.bind(c(i)),i._setItmeVisible=i._setItmeVisible.bind(c(i)),i._updateFocusItem=i._updateFocusItem.bind(c(i)),i._dispathcEvent=i._dispathcEvent.bind(c(i)),i.props.dispatcher&&i.props.dispatcher._registerSimpleWidget(c(i)),i._AllState={},i._AllState.isFocus=!1;var e=f._getTemplateParser(i.props);f._AddTemplateItem(i.props,e,0),i._AllState.templateParser=e,i._VisibleItemList=[],i._NeedHideItemList=[],i._ItemVisibleFuncMap=[],i._registerItemVisibleFunc=function(e){return function(t){i._ItemVisibleFuncMap[e]={visible:!1,func:t}}},i._itemUpdateFuncMap={},i._registerItemUpdateFunc=function(e){return function(t){i._itemUpdateFuncMap[e]=t}},i._updateRootFunc=pe,i._registerUpdateRootFunc=function(t){i._updateRootFunc=t},i._updateContentFunc=pe,i._registerUpdateContentFunc=function(t){i._updateContentFunc=t},i._updateFocusFunc=pe,i._registerUpdateFocusFunc=function(t){i._updateFocusFunc=t},i._updateBlurFunc=pe,i._registerUpdateBlurFunc=function(t){i._updateBlurFunc=t};var n=0,r=0,s=i.props.direction===_e?i.props.height:i.props.width;if(i._VisibleItemList=i._getVisibleItemList(n,r,r+s-1),void 0!==i.props.baseAnchor){var a=i._BaseAnchorInfo2Pos(i.props.baseAnchor,0,s);r=i.props.direction===_e?a.yPos:a.xPos,i._VisibleItemList=i._getVisibleItemList(i.props.baseAnchor.id,r,r+s-1)}return i.props.initFocusId&&(n=i.props.initFocusId,void 0===i.props.baseAnchor&&(r=i._CalculateSlide(i._AllState.templateParser.GetItem(n),1,0),i._VisibleItemList=i._getVisibleItemList(n,r,r+s-1))),i._AllState.enterFocusId=-1,i._AllState.enterFocusRect=null,i._AllState.focusId=n,i._AllState.preFocusId=-1,i._AllState.preEdgeRect=null,i._AllState.visibleStart=r,i._AllState.visibleRange=s,i._AllState.baseAnchor=i.props.baseAnchor,i}return g(f,n.Component),u(f,[{key:"_getSlideAnim",value:function(){return"left "+this.props.slideTime+"s, top "+this.props.slideTime+"s "+this.props.slideEasing}},{key:"_dispathcEvent",value:function(t){switch(t.type){case Re.Type.setFocusId:this._AllState.enterFocusId=t.data;break;case Re.Type.setFocusRect:this._AllState.enterFocusRect=t.data;break;case Re.Type.updateItem:var e=t.data;if(e){var i=this._AllState.templateParser.GetTemplate(),n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value,h=i.IdsMap[l];this._itemUpdateFuncMap[h]&&this._itemUpdateFuncMap[h]()}}catch(t){r=!0,s=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}}break;case Re.Type.slideToItem:t.data&&this._slideViewToAnchor(t.data)}}},{key:"_getVisibleItemList",value:function(t,e,i){var n=this._AllState.templateParser.GetVisibleItemList(e,i,t);return this._AllState.templateParser.GetTemplate().List.slice(n.visibleStart,n.visibleEnd+1)}},{key:"_calculateNearestItemByRect",value:function(t,e){var i=e.direction,n=e.rect,r="",s={x:0,y:0};switch(i){case Ie.left:r="left",s.x=n.x,s.y=n.y+n.height/4;break;case Ie.right:r="right",s.x=n.x+n.width,s.y=n.y+n.height/4;break;case Ie.top:r="up",s.x=n.x+n.width/4,s.y=n.y;break;case Ie.bottom:r="down",s.x=n.x+n.width/4,s.y=n.y+n.height}var a=new de(s.x,s.x),o=new de(s.y,s.y),l=null,h=-1,u=0,c=0,d=0,f=this.props.direction===_e?"yPos":"xPos",g=this.props.direction===_e?"height":"width",p=!0,v=!1,y=void 0;try{for(var m,_=t[Symbol.iterator]();!(p=(m=_.next()).done);p=!0){var w=m.value;if(w[f]>=this._AllState.visibleStart&&w[f]+w[g]-1<=this._AllState.visibleStart+this._AllState.visibleRange-1){var S=this.props.direction===_e?w.xPos:w.xPos-this._AllState.visibleStart,I=this.props.direction===_e?w.yPos-this._AllState.visibleStart:w.yPos,b=new de(S,S+w.width-1),x=new de(I,I+w.height-1);switch(r){case"left":if(s.x<S+w.width-1)continue;s.y<I?c=Math.pow(s.x-(S+w.width-1),2)+Math.pow(I-s.y,2):o.IsInterAct(x)?c=Math.pow(s.x-(S+w.width-1),2):s.y>I+w.height-1&&(c=Math.pow(s.x-(S+w.width-1),2)+Math.pow(s.y-(I+w.height-1),2)),d=Math.abs(s.x-(S+w.width-1));break;case"right":if(s.x>S)continue;s.y<I?c=Math.pow(S-s.x,2)+Math.pow(I-s.y,2):o.IsInterAct(x)?c=Math.pow(S-s.x,2):s.y>I+w.height-1&&(c=Math.pow(S-s.x,2)+Math.pow(s.y-(I+w.height-1),2)),d=Math.abs(s.x-S);break;case"up":if(s.y<I+w.height-1)continue;s.x<S?c=Math.pow(s.x-S,2)+Math.pow(s.y-(I+w.height-1),2):a.IsInterAct(b)?c=Math.pow(s.y-(I+w.height-1),2):s.x>S+w.width-1&&(c=Math.pow(s.x-(S+w.width-1),2)+Math.pow(s.y-(I+w.height-1),2)),d=Math.abs(s.y-(I+w.height-1));break;case"down":if(s.y>I)continue;s.x<S?c=Math.pow(s.x-S,2)+Math.pow(I-s.y,2):a.IsInterAct(b)?c=Math.pow(I-s.y,2):s.x>S+w.width-1&&(c=Math.pow(s.x-(S+w.width-1),2)+Math.pow(I-s.y,2)),d=Math.abs(s.y-I);break;default:console.log("direction is error:"+r)}h<0?(h=c,u=d,l=w):(d<u||u===d&&c<h)&&(h=c,u=d,l=w)}}}catch(t){v=!0,y=t}finally{try{p||null==_.return||_.return()}finally{if(v)throw y}}return l?l.id:0}},{key:"_updateItemVisibility",value:function(t,e){for(var i=this._AllState.templateParser.GetTemplate(),n=0;n<t.length;++n){var r=this._ItemVisibleFuncMap[i.IdsMap[t[n].id]];r&&r.visible!==e&&(r.visible=e,r.func&&r.func(e))}}},{key:"_OnKeyDown",value:function(t){var e=0,i=0;switch(t.keyCode){case 37:e=-1,this._moveToNext(e,i);break;case 38:i=-1,this._moveToNext(e,i);break;case 39:e=1,this._moveToNext(e,i);break;case 40:i=1,this._moveToNext(e,i);break;case 13:var n=this._AllState.templateParser.GetItem(this._AllState.focusId);!n.hasSub&&this.props.onClick&&this.props.onClick(n.data);break;default:return!1}return!0}},{key:"_moveToNext",value:function(t,e,i){var n=this._AllState.templateParser.GetTemplate(),r=this._AllState.preFocusId,s=n.IdsMap[this._AllState.focusId],a=this._AllState.templateParser.GetNextItem(this._AllState.focusId,e,t,this.props.loopFocus);if(0<=a){this._AllState.preFocusId=this._AllState.focusId;var o=this._AllState.templateParser.GetItem(a);this._AllState.focusId=o.id;var l=this.props.direction===_e?e:t,h=this._AllState.visibleStart,u=this._CalculateSlide(o,l,this._AllState.visibleStart);if(h!=u){var c=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(a,u,u+this._AllState.visibleRange-1);var d=!0,f=!1,g=void 0;try{for(var p,v=c[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var y=p.value;this._VisibleItemList.indexOf(y)<0&&this._NeedHideItemList.indexOf(y)<0&&this._NeedHideItemList.push(y)}}catch(t){f=!0,g=t}finally{try{d||null==v.return||v.return()}finally{if(f)throw g}}var m=!0,_=!1,w=void 0;try{for(var S,I=this._VisibleItemList[Symbol.iterator]();!(m=(S=I.next()).done);m=!0){var b=S.value,x=this._NeedHideItemList.indexOf(b);0<=x&&this._NeedHideItemList.splice(x,1)}}catch(t){_=!0,w=t}finally{try{m||null==I.return||I.return()}finally{if(_)throw w}}this._AllState.visibleStart=u,this._updateItemVisibility(this._VisibleItemList,!0);var T=this.props.direction===_e?0:-this._AllState.visibleStart,k=this.props.direction===_e?-this._AllState.visibleStart:0;this._updateRootFunc(T,k,this._onTransitionEnd)}if(o.hasSub){var E,L=n.List[s].xPos-n.List[a].xPos,R=n.List[s].yPos-n.List[a].yPos;E=i?(i.rect.x+=L,i.rect.y+=R,i):{direction:null,rect:{x:L,y:R,width:n.List[s].width,height:n.List[s].height}},this._AllState.preEdgeRect=E,this._itemUpdateFuncMap[a]&&this._itemUpdateFuncMap[a]()}else r!==this._AllState.preFocusId&&this._setItmeVisible(n.IdsMap[r],!0),this._updateFocusItem(),this._updateBlurItem();if(0<=this._AllState.preFocusId&&this.props.onItemBlur&&this.props.onItemBlur(n.List[n.IdsMap[this._AllState.preFocusId]]),this._AllState.isFocus&&this.props.onItemFocus){var O=V({},o.data,{xPos:o.xPos,yPos:o.yPos});this.props.onItemFocus(O,this._AllState.preEdgeRect)}}else if(this.props.onEdge){var A,P=this.props.direction===_e?0:this._AllState.visibleStart,C=this.props.direction===_e?this._AllState.visibleStart:0;1===t&&(A=Ie.right),-1===t&&(A=Ie.left),1===e&&(A=Ie.bottom),-1===e&&(A=Ie.top);var F={x:n.List[s].xPos-P,y:n.List[s].yPos-C,width:n.List[s].width,height:n.List[s].height};this.props.onEdge({direction:A,rect:F})}}},{key:"_CalculateSlide",value:function(t,e,i){var n=i,r=n,s=this._AllState.templateParser.GetTemplate().List,a=s[s.length-1],o=this.props.direction===_e?"yPos":"xPos",l=this.props.direction===_e?"height":"width",h=this.props.direction===_e?"bottom":"right",u=this.props.direction===_e?this.props.height:this.props.width;switch(this.props.slideStyle){case Se.seamLess:var c=a[o]+a[l]-u+f._getPadding(this.props)[h];0<e?t[o]+t[l]>n+4*u/5&&(r=t[o]+t[l]-4*u/5):e<0&&t[o]<n+u/5&&(r=t[o]-u/5),r=(r=c<r?c:r)<0?0:r;break;case Se.wholePage:0<e?t[o]+t[l]>n+u+1&&(r=t[o]):e<0&&t[o]<n&&(r=(r=t[o]+t[l]-u)<0?0:r)}return r}},{key:"_OnFocusableItemEdge",value:function(t){var e=0,i=0;switch(t.direction){case Ie.left:e=-1;break;case Ie.right:e=1;break;case Ie.top:i=-1;break;case Ie.bottom:i=1}this._moveToNext(e,i,t)}},{key:"_ifValidEnterRect",value:function(t){return t&&t.direction&&t.rect}},{key:"_setItmeVisible",value:function(t,e){var i=this._ItemVisibleFuncMap[t];i&&i.visible!==e&&(i.visible=e,i.func&&i.func(e))}},{key:"_onFocusInner",value:function(){var t=void 0!==this._AllState.enterFocusId&&0<=this._AllState.enterFocusId?this._AllState.enterFocusId:this._AllState.focusId;if(t=this._ifValidEnterRect(this._AllState.enterFocusRect)?this._calculateNearestItemByRect(this._VisibleItemList,this._AllState.enterFocusRect):t,this._AllState.isFocus=!0,this._AllState.focusId=t,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=-1,this._updateFocusItem(),this._updateBlurFunc(this._getBlurView),this.props.onItemFocus){var e=this._AllState.templateParser.GetItem(t),i=V({},e.data,{xPos:e.xPos,yPos:e.yPos});this.props.onItemFocus(i,null)}this.props.onFocus&&this.props.onFocus()}},{key:"_onBlurInner",value:function(){this._AllState.isFocus=!1,this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=this._AllState.focusId,this._updateFocusFunc(this._getFocusView),this._updateBlurItem(),this.props.onBlur&&this.props.onBlur()}},{key:"_onTransitionEnd",value:function(t){t.stopPropagation(),this._updateItemVisibility(this._NeedHideItemList,!1),this._NeedHideItemList=[]}},{key:"_drawItem",value:function(t){var e=this;return function(){return e.props.renderItem(t.data,e._OnFocusableItemEdge)}}},{key:"_getContentView",value:function(){var i=this,t=this._AllState.templateParser.GetTemplate().List;return n.createElement("div",{id:"container"},t.map(function(t,e){return n.createElement(be,{key:t.id,x:t.xPos,y:t.yPos,setVisibleFunc:i._registerItemVisibleFunc(e),registerUpdateFunc:i._registerItemUpdateFunc(e),renderFunc:i._drawItem(t)})}))}},{key:"_onContentUpdate",value:function(){this._updateItemVisibility(this._VisibleItemList,!0),this._updateFocusItem()}},{key:"_drawFocusItem",value:function(t){var e=this;return function(){return e.props.renderFocus(t.data)}}},{key:"_getFocusView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.focusId);return t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus?n.createElement(be,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawFocusItem(t)}):null}},{key:"_updateFocusItem",value:function(){this._updateFocusFunc(this._getFocusView);var t=this._AllState.templateParser.GetItem(this._AllState.focusId);t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.focusId],!1)}},{key:"_drawBlurItem",value:function(t){var e=this;return function(){return e.props.renderBlur(t.data,e._renderBlurEndCallback(t.id))}}},{key:"_getBlurView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);return t&&!t.hasSub&&this.props.renderBlur?n.createElement(be,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawBlurItem(t)}):null}},{key:"_updateBlurItem",value:function(){this._updateBlurFunc(this._getBlurView);var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);t&&!t.hasSub&&this.props.renderBlur||this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0)}},{key:"_onFocusUpdate",value:function(){}},{key:"_BaseAnchorInfo2Pos",value:function(t,e,i){var n=t.id,r={xPos:this.props.direction===_e?0:e,yPos:this.props.direction===_e?e:0};if(null!=n){var s=this._AllState.templateParser.GetTemplate().List,a=s[n],o=s[s.length-1];if(a){var l=void 0!==t.type?t.type:"start",h=this.props.direction===_e?"yPos":"xPos",u=this.props.direction===_e?"height":"width",c=this.props.direction===_e?"bottom":"right";switch(l){case"start":r[h]=a[h];break;case"center":r[h]=a[h]-i/2+a[u]/2;break;case"end":r[h]=a[h]+a[u]-1-i}var d=o[h]+o[u]-i+f._getPadding(this.props)[c];r[h]=r[h]>d?d:r[h],r[h]=r[h]<0?0:r[h]}}return r}},{key:"_slideViewToAnchor",value:function(t){var e=this._BaseAnchorInfo2Pos(t,this._AllState.visibleStart,this._AllState.visibleRange);this._AllState.visibleStart=this.props.direction===_e?e.yPos:e.xPos;var i=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(t.id,this._AllState.visibleStart,this._AllState.visibleStart+this._AllState.visibleRange-1);var n=!0,r=!1,s=void 0;try{for(var a,o=i[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value;this._VisibleItemList.indexOf(l)<0&&this._NeedHideItemList.indexOf(l)<0&&this._NeedHideItemList.push(l)}}catch(t){r=!0,s=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}this._updateItemVisibility(this._VisibleItemList,!0),this._updateRootFunc(-e.xPos,-e.yPos,this._onTransitionEnd)}},{key:"_onBlurUpdate",value:function(){}},{key:"_renderBlurEndCallback",value:function(t){var e=this;return function(){t==e._AllState.preFocusId&&e._updateBlurFunc(ve),e._setItmeVisible(e._AllState.templateParser.GetTemplate().IdsMap[t],!0)}}},{key:"render",value:function(){return n.createElement(he,{onKeyDown:this._OnKeyDown,branchName:this.props.branchName,onFocus:this._onFocusInner,onBlur:this._onBlurInner,style:{left:this.props.left,top:this.props.top,width:this.props.width,height:this.props.height,clipPath:"inset(0px 0px 0px 0px)"}},n.createElement(Le,{x:this.props.padding&&void 0!==this.props.padding.left?this.props.padding.left:0,y:this.props.padding&&void 0!==this.props.padding.top?this.props.padding.top:0,transition:this._getSlideAnim(),registerUpdateFunc:this._registerUpdateRootFunc,registerUpdateContentFunc:this._registerUpdateContentFunc,registerUpdateFocusFunc:this._registerUpdateFocusFunc,registerUpdateBlurFunc:this._registerUpdateBlurFunc}))}},{key:"componentDidUpdate",value:function(){var t=this,e=this._AllState.templateParser.GetTemplate().List,i=this.props.data,n=0;for(n=0;n<i.length;++n){for(var r=!1,s=0;s<e.length;++s)if(i[n]===e[s].data){r=!0;break}if(!r)break}var a=!1;if(n===e.length)n!==i.length?(a=!0,f._AddTemplateItem(this.props,this._AllState.templateParser,n)):!this.props.baseAnchor||this.props.baseAnchor.id===this._AllState.baseAnchor.id&&this.props.baseAnchor.type===this._AllState.baseAnchor.type||(this._AllState.baseAnchor=this.props.baseAnchor,this._slideViewToAnchor(this._AllState.baseAnchor));else{a=!0;var o=f._getTemplateParser(this.props);f._AddTemplateItem(this.props,o,0),this._AllState.templateParser=o}a&&this._updateContentFunc(this._getContentView,null),this._AllState.focusId>=this.props.data.length&&(this._AllState.focusId=0,this._AllState.preFocusId=-1,0!==this._AllState.visibleStart&&(this._AllState.visibleStart=0,this._updateRootFunc(0,0,null)),this._updateFocusItem()),this.props.onWidgetUpdate&&Promise.resolve().then(function(){t.props.onWidgetUpdate()})}},{key:"componentDidMount",value:function(){var t=this;if(this._updateContentFunc(this._getContentView,this._onContentUpdate),0!==this._AllState.visibleStart){var e=this.props.direction===_e?0:-this._AllState.visibleStart,i=this.props.direction===_e?-this._AllState.visibleStart:0;this._updateRootFunc(e,i,null)}this.props.onWidgetMount&&Promise.resolve().then(function(){t.props.onWidgetMount()})}}],[{key:"_getPadding",value:function(t){var e={left:0,right:0,top:0,bottom:0};return void 0!==t.padding&&null!==t.padding&&(e={left:void 0===t.padding.left?0:t.padding.left,right:void 0===t.padding.right?0:t.padding.right,top:void 0===t.padding.top?0:t.padding.top,bottom:void 0===t.padding.bottom?0:t.padding.bottom}),e}},{key:"_getTemplateParser",value:function(t){var e=f._getPadding(t),i=t.direction===_e?t.width-e.left-e.right:t.height-e.top-e.bottom,n=t.layoutType?t.layoutType:"relative";return new me(t.direction,i,n,t.width,t.height)}},{key:"_AddTemplateItem",value:function(t,e,i){for(var n=i;n<t.data.length;n++){var r=t.measures(t.data[n]);e.ParseTemplateItem(r,t.data[n])}e.CalculateNeighborWhenAddStop()}}]),f}();Oe.defaultProps={left:0,top:0,slideEasing:"cubic-bezier(0.14,0.68,0.19,0.87)",slideTime:.2,loopFocus:!1,slideStyle:Se.seamLess},t.EdgeDirection=Ie,t.Fdiv=he,t.FdivRoot=ue,t.HORIZONTAL=we,t.Router=ie,t.SWidgetDispatcher=Re,t.SimpleWidget=Oe,t.SlideStyle=Se,t.VERTICAL=_e,Object.defineProperty(t,"__esModule",{value:!0})});
