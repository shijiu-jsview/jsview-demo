!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","react-dom"],e):e((t=t||self).jsviewreact={},t.React,t.ReactDOM)}(this,function(t,r,l){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],0<=e.indexOf(i)||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],0<=e.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(s){return function(){var t,e,i,n=h(s);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()){var o=h(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return e=this,!(i=t)||"object"!=typeof i&&"function"!=typeof i?_(e):i}}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function P(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(t,e):void 0}}(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,s=!0,r=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}r=r&&r.hasOwnProperty("default")?r.default:r,l=l&&l.hasOwnProperty("default")?l.default:l,void 0===window.Forge&&(window.Forge={});var y,v=window.Forge;y="undefined"!=typeof ForgeExtension?v:{LogM:console.log.bind(console),LogF:console.error.bind(console),LogE:console.error.bind(console),LogW:console.warn.bind(console),LogI:console.log.bind(console),LogD:console.debug.bind(console),ThrowError:function(t){throw new Error(t)},Assert:function(t){if(!t)throw new Error("ASSERT!!!!!")},BaseActivity:function t(){d(this,t)}};var e=function(){function c(t,e,i){d(this,c),this.PageName=t,this._FocusChild=null,this._LatestFocusChild=null,this.SubPages=[],this._ParentPage=null,this._ConsumeKeycodeUntilUp=-1,this.TouchDispatcher=null,this._Acc=.001,this._KeyLock=!1,this._CVSet=null,this._AutoShow=!1,this._IsShowing=!1,this._HostActivity=i,e&&this.SetContentView(e)}return u(c,[{key:"OnRenderFrame",value:function(){y.LogE("OnRenderFrame() MUST override")}},{key:"OnKeyDown",value:function(){return!1}},{key:"OnKeyUp",value:function(){return!1}},{key:"DispatchKeyDown",value:function(t){if(this._KeyLock)return!0;var e=!1;return(c.LastFocusPage=this)._FocusChild&&(e=this._FocusChild.DispatchKeyDown(t)),e=e||this.OnKeyDown(t)}},{key:"DispatchKeyUp",value:function(t){if(this._KeyLock)return!0;var e=!1;return this._FocusChild&&(e=this._FocusChild.DispatchKeyUp(t)),e=e||this.OnKeyUp(t)}},{key:"PrintLastFocusPage",value:function(){var t="------"+this.PageName+"\n",e=this._ParentPage;return e&&(t+=e.PrintLastFocusPage()),t}},{key:"OnMouseDown",value:function(){return!1}},{key:"EnableTouchDispatcher",value:function(){this.TouchDispatcher=new v.TouchDispatcher(this)}},{key:"DisableTouchDispatcher",value:function(){this.TouchDispatcher=null}},{key:"GetTouchView",value:function(){return null}},{key:"GetSwipeParams",value:function(t,e,i){var n=void 0===i||0===i?this._Acc:i,o=t*t/2/n;t<0&&(o=-o);var s=e*e/2/n;return e<0&&(s=-s),{durationX:Math.floor(Math.abs(t/n)),durationY:Math.floor(Math.abs(e/n)),distanceX:o,distanceY:s}}},{key:"OnTouch",value:function(){return!1}},{key:"DispatchTouch",value:function(t){var e=!1;return this.TouchDispatcher&&(e=this.TouchDispatcher.OnTouch(t)),e}},{key:"LostTouchFocus",value:function(){}},{key:"OnJavaKey",value:function(){return!0}},{key:"OnPlatformKey",value:function(){return!0}},{key:"PassPlatformKey",value:function(t,e){if(this._KeyLock)return!1;var i=this.OnPlatformKey(t,e);return i=i&&this.OnJavaKey(t,e)}},{key:"DispatchJavaKey",value:function(t,e){if(t===this._ConsumeKeycodeUntilUp)return 1===e&&(this._ConsumeKeycodeUntilUp=-1),v.LogM("Consume Javakey until up keycode="+t+" keyaction="+e),!1;if(this._KeyLock)return!1;-1!==this._ConsumeKeycodeUntilUp&&(v.LogE("ERROR: Other key pressed before locked key release"),this._ConsumeKeycodeUntilUp=-1);var i=this._FocusChild,n=!0;return i&&(n=i.DispatchJavaKey(t,e)),n=n&&this.PassPlatformKey(t,e),i!==this._FocusChild&&0===e&&this.CosumeAllKeyUnitlUpForFocusChange(t),n}},{key:"CosumeAllKeyUnitlUpForFocusChange",value:function(t){this._ParentPage?this._ParentPage.CosumeAllKeyUnitlUpForFocusChange(t):this._ConsumeKeycodeUntilUp=t}},{key:"OnHostActivityGetFocus",value:function(){this._ConsumeKeycodeUntilUp=-1}},{key:"IsFocus",value:function(){return!this._ParentPage||this._ParentPage._FocusChild===this}},{key:"_IsLeafInChain",value:function(){return this.IsFocus()&&!this._FocusChild}},{key:"SetParent",value:function(t,e){null!==t?(null!==e&&this.SetContentView(e),t instanceof y.BaseActivity&&(t=t.GetRootPageBase()),(this._ParentPage=t).SubPages.push(this),this._HostActivity=t._HostActivity,t._IsShowing&&this._AutoShow&&this._OnShowInternal()):y.ThrowError("ERROR: parent is null")}},{key:"SetParentPage",value:function(t){this.SetParent(t)}},{key:"RemoveSubPage",value:function(t){t===this._FocusChild&&(this._FocusChild=null),t===this._LatestFocusChild&&(this._LatestFocusChild=null);for(var e=0;e<this.SubPages.length;e++)if(t===this.SubPages[e]){t._OnHideInternal(),this.SubPages.splice(e,1);break}}},{key:"ClearSubPages",value:function(){this.SubPages=[],this._FocusChild=null,this._LatestFocusChild=null}},{key:"GetParentPage",value:function(){return this._ParentPage}},{key:"Focus",value:function(t){if(this.IsFocus()){if(!t)return void y.LogI("Already focused page_name="+this.PageName);if(this._IsLeafInChain())return void y.LogI("Already focused page_name="+this.PageName)}if(c.sChangingFocusLock)c.sDelayedFocusChanges.push(this);else{if(c.sChangingFocusLock=!0,this._ParentPage){for(var e,i=[],n=this;n._ParentPage&&!n.IsFocus();)i.push(n),n=n._ParentPage;e=t&&0===i.length?this._FocusChild:i[i.length-1]._ParentPage._FocusChild;for(var o=[];e;)o.push(e),e=e._FocusChild;for(var s=o.length-1;0<=s;s--)o[s]._BlurInternal();for(var r=i.length-1;0<=r;r--)i[r]._FocusInternal();if(!t)for(var a=i[0];a._LatestFocusChild&&null===a._FocusChild;)a._LatestFocusChild._FocusInternal(),(a=a._FocusChild)||y.ThrowError("ERROR: focus chain is broken")}c.sChangingFocusLock=!1;var l=c.sDelayedFocusChanges.length;if(0<l){var u=c.sDelayedFocusChanges;c.sDelayedFocusChanges=[];for(var h=0;h<l;h++)u[h].Focus()}}}},{key:"_FocusInternal",value:function(){this._ParentPage?((this._ParentPage._FocusChild=this)._ParentPage._LatestFocusChild=this).OnFocus():v.LogE("No dispatcher")}},{key:"_BlurInternal",value:function(){this._ParentPage||v.LogE("No dispacher"),this._ParentPage._FocusChild===this?(this._ParentPage._FocusChild=null,this.OnBlur()):y.LogW("Not focus yet, page name="+this.PageName)}},{key:"GetFocusChild",value:function(){return this._FocusChild}},{key:"Hide",value:function(){this._AutoShow=!1,this._OnHideInternal()}},{key:"Show",value:function(t){this._OnShowInternal(),t&&this.Focus()}},{key:"OnFocus",value:function(){y.LogW("No overrided Page OnFocus event, page name="+this.PageName)}},{key:"OnBlur",value:function(){y.LogW("No overrided Page OnBlur event, page name="+this.PageName)}},{key:"OnShow",value:function(){y.LogW("No overrided Page OnShow event, page name="+this.PageName)}},{key:"OnHide",value:function(){y.LogW("No overrided Page OnHide event, page name="+this.PageName)}},{key:"_OnShowInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._AutoShow&&t._OnShowInternal();this._IsShowing||(this._IsShowing=!0,this.OnShow())}},{key:"_OnHideInternal",value:function(){for(var t,e=0;e<this.SubPages.length;e++)(t=this.SubPages[e])._IsShowing&&t._OnHideInternal();this._IsShowing&&(this._IsShowing=!1,this.OnHide())}},{key:"GetMainView",value:function(){return null===this._CVSet&&(this._CVSet=new v.MainViewSetting(null,null)),this._CVSet}},{key:"GetContentView",value:function(){return null===this._CVSet?null:this._CVSet.View}},{key:"SetContentView",value:function(t){null!==t&&(null!==this._CVSet&&this._CVSet.View.BindedPageBase(null),this._CVSet=new v.MainViewSetting(t,null),t.BindedPageBase(this))}},{key:"OnContentViewLostInternal",value:function(){this.OnContentViewLost()}},{key:"OnContentViewLost",value:function(){}},{key:"GetHostActivity",value:function(){return this._HostActivity}},{key:"SetHostActivity",value:function(t){this._HostActivity=t}},{key:"GetTextureManager",value:function(){return null!==this._HostActivity?this._HostActivity.GetTextureManager():null}},{key:"SetAutoShow",value:function(t){this._AutoShow=t}},{key:"KeyLock",value:function(){this._KeyLock=!0}},{key:"UnKeyLock",value:function(){this._KeyLock=!1}}]),c}();e.LastFocusPage=null,e.sChangingFocusLock=!1,e.sDelayedFocusChanges=[];var b,I,S,w,F,k=(b=Object,I=b.getPrototypeOf||function(t){return t.__proto__},S=b.setPrototypeOf||function(t,e){return t.__proto__=e,t},w="object"===("undefined"==typeof Reflect?"undefined":i(Reflect))?Reflect.construct:function(t,e,i){var n,o=[null];return o.push.apply(o,e),n=t.bind.apply(t,o),S(new n,i.prototype)},function(t){var e=I(t);return S(t,S(function(){return w(e,arguments,I(this).constructor)},e))}),x=function(){function e(t){d(this,e),this._IsTemp=!!t,this._ChildMap={},this._FocusNodeName=null}return u(e,[{key:"add",value:function(t,e){this._ChildMap[t]=e,this._FocusNodeName==t&&e.Focus()}},{key:"remove",value:function(t,e){var i=this._ChildMap[t];i&&i==e&&delete this._ChildMap[t]}},{key:"focus",value:function(t,e){var i=this._ChildMap[t];return this._FocusNodeName=t,i?(i.Focus(!e),!0):(console.log("No found branch:"+t),!1)}},{key:"forEach",value:function(t){for(var e in this._ChildMap)t(this._ChildMap[e],e,this._ChildMap)}}]),e}();F=window.JsView?v.PageBase:e;var L=k(function(){g(n,F);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._OnKeyDown=null,e._OnKeyUp=null,e._OnFocus=null,e._OnBlur=null,e._DispatchKeyDown=null,e._DispatchKeyUp=null,e._Mounted=!1,e.BranchName=null,e.RouterDelegate={ref:null},e._TmpRouter=null,e._AutoShow=!1,e}return u(n,[{key:"UpdateMountState",value:function(){this._Mounted=!0;var t=this.SubPages;for(var e in t)t[e].UpdateMountState()}},{key:"SetRouter",value:function(t){this.RouterDelegate.ref=t}},{key:"RouterAdd",value:function(t,e){e.RouterDelegate.ref||(e.RouterDelegate=this.RouterDelegate),this.RouterDelegate.ref||(this.RouterDelegate.ref=new x(!0)),this.RouterDelegate.ref.add(t,e)}},{key:"RouterUnbind",value:function(){this.RouterDelegate.ref&&this.RouterDelegate.ref.remove(this.BranchName,this)}},{key:"SetBranchName",value:function(t){this.BranchName=t}},{key:"SetOnKeyDown",value:function(t){this._OnKeyDown=t}},{key:"SetOnKeyUp",value:function(t){this._OnKeyUp=t}},{key:"SetOnFocus",value:function(t){this._OnFocus=t}},{key:"SetOnBlur",value:function(t){this._OnBlur=t}},{key:"SetDispatchKeyUp",value:function(t){this._DispatchKeyUp=t}},{key:"SetDispatchKeyDown",value:function(t){this._DispatchKeyDown=t}},{key:"ChangeFocus",value:function(t,e){if(this.RouterDelegate.ref)return this.RouterDelegate.ref.focus(t,e);console.error("error: lost router")}},{key:"OnKeyDown",value:function(t){return!!this._OnKeyDown&&this._OnKeyDown(t)}},{key:"OnKeyUp",value:function(t){return!!this._OnKeyUp&&this._OnKeyUp(t)}},{key:"DispatchKeyDown",value:function(t){var e=!1;return(n.sLastFocus=this)._DispatchKeyDown&&(e=this._DispatchKeyDown(t)),!!e||c(h(n.prototype),"DispatchKeyDown",this).call(this,t)}},{key:"DispatchKeyUp",value:function(t){var e=!1;return this._DispatchKeyUp&&(e=this._DispatchKeyUp(t)),!!e||c(h(n.prototype),"DispatchKeyUp",this).call(this,t)}},{key:"AttachToActivity",value:function(t,e){c(h(n.prototype),"SetParent",this).call(this,t,e)}},{key:"SetParent",value:function(i){if(null!=i&&(c(h(n.prototype),"SetParent",this).call(this,i,null),this._ParentPage._Mounted&&(this.UpdateMountState(),D()),i instanceof n)){if(this.RouterDelegate.ref&&this.RouterDelegate.ref._IsTemp){var t=this.RouterDelegate.ref;this.RouterDelegate.ref=null,t.forEach(function(t,e){i.RouterAdd(e,t)})}i.RouterAdd(this.BranchName,this)}}},{key:"Focus",value:function(t){if(!this._Mounted)return n.sFocusMemos.push({obj:this,bcf:t}),void console.log("page base tree not build, cache focus");c(h(n.prototype),"Focus",this).call(this,t)}},{key:"OnFocus",value:function(){this._OnFocus&&this._OnFocus()}},{key:"OnBlur",value:function(){this._OnBlur&&this._OnBlur()}}]),n}());L.sFocusMemos=[],L.sLastFocus=null,L.sRootPageNode=null,window.DebugPrintFocusNode=function(){console.log("FocusNode:"),console.log(L.sLastFocus)};function E(t){var e=""+C++;return N[e]=t,e}function A(t){delete N[t]}function R(t){return N[t]}var C=0,N={};L.pbMap=N;function O(t){L.RootPageBase=t}var D=function(){var t=L.sFocusMemos.length;if(0<t){var e=L.sFocusMemos;L.sFocusMemos=[];for(var i=0;i<t;i++)e[i].obj.Focus(e[i].bcf)}},U=1,V=function(){g(c,r.Component);var h=m(c);function c(t){var e;d(this,c),f(_(e=h.call(this,t)),"_ElementGetter",function(t){e._Element=t}),e.BranchName=e.props.branchName;var i=e.props.onKeyUp,n=e.props.onKeyDown,o=e.props.onFocus,s=e.props.onBlur,r=e.props.onDispatchKeyDown,a=e.props.onDispatchKeyUp,l=e.props.router,u=new L(e.BranchName);return e.BranchName||(e.BranchName="__"+U++),u.SetBranchName(e.BranchName),n&&u.SetOnKeyDown(n),i&&u.SetOnKeyUp(i),o&&u.SetOnFocus(o),s&&u.SetOnBlur(s),r&&u.SetDispatchKeyDown(r),a&&u.SetDispatchKeyUp(a),l&&u.SetRouter(l),e._FocusNodeId=E(u),e.props._updateFN&&e.props._updateFN(u),e}return u(c,[{key:"render",value:function(){var t=this.props,e=(t.onKeyDown,t.onKeyUp,t.onFocus,t.onBlur,t.onDispatchKeyDown,t.onDispatchKeyUp,t.focus,t.branchName,t.router,t._updateFN,s(t,["onKeyDown","onKeyUp","onFocus","onBlur","onDispatchKeyDown","onDispatchKeyUp","focus","branchName","router","_updateFN"]));return r.createElement("div",a({ref:this._ElementGetter},e,{__pbid:this._FocusNodeId}))}},{key:"componentDidMount",value:function(){for(var t=R(this._FocusNodeId),e=this._Element;e.parentElement;){var i=(e=e.parentElement).getAttribute("__pbid");if(i){var n=R(i);t.SetParent(n);break}}}},{key:"componentWillUnmount",value:function(){this._Element.setAttribute("__pbid",""),this._Element=null;var t=R(this._FocusNodeId),e=t.GetParentPage();e&&e.RemoveSubPage(t),t.ClearSubPages(),t.RouterUnbind(),A(this._FocusNodeId)}}]),c}(),T=function(){g(s,r.Component);var o=m(s);function s(t){var i;d(this,s),i=o.call(this,t);var e=new K;if(i._FocusNodeId=E(e),O(e),window.JsView){var n=window.JsView.ForgeExt;e.AttachToActivity(n.RootActivity,n.RootView)}else window.addEventListener("keydown",function(t){var e=document.activeElement.tagName;e&&"input"===e.toLowerCase()||(R(i._FocusNodeId).DispatchKeyDown(t),t.preventDefault&&t.preventDefault())}),window.addEventListener("keyup",function(t){var e=document.activeElement.tagName;e&&"input"===e.toLowerCase()||(R(i._FocusNodeId).DispatchKeyUp(t),t.preventDefault&&t.preventDefault())});return i}return u(s,[{key:"render",value:function(){return r.createElement("div",a({__pbid:this._FocusNodeId},this.props))}},{key:"componentDidMount",value:function(){console.log("Root didmount"),R(this._FocusNodeId).UpdateMountState(),D()}},{key:"componentWillUnmount",value:function(){console.log("Root unmount"),R(this._FocusNodeId).ClearSubPages(),A(this._FocusNodeId)}}]),s}(),K=function(){g(i,L);var e=m(i);function i(){var t;return d(this,i),f(_(t=e.call(this,"root")),"_DispatchKeyDownWrap",function(){t._KeyConsumed=c(h(i.prototype),"DispatchKeyDown",_(t)).call(_(t),t._CurrentEvent)}),f(_(t),"_DispatchKeyUpWrap",function(){t._KeyConsumed=c(h(i.prototype),"DispatchKeyUp",_(t)).call(_(t),t._CurrentEvent)}),t._CurrentEvent=null,t._KeyConsumed=!1,t}return u(i,[{key:"DispatchKeyDown",value:function(t){return this._CurrentEvent=t,l.unstable_batchedUpdates(this._DispatchKeyDownWrap),this._CurrentEvent=null,this._KeyConsumed}},{key:"DispatchKeyUp",value:function(t){return this._CurrentEvent=t,l.unstable_batchedUpdates(this._DispatchKeyUpWrap),this._CurrentEvent=null,this._KeyConsumed}}]),i}(),M=function(){function t(){d(this,t),this._focusNode=null}return u(t,[{key:"updateRef",value:function(t){this._focusNode=t}},{key:"changeFocus",value:function(t,e){return this._focusNode.ChangeFocus(t,e)}}]),t}(),B=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._Router=new x,e._Control=null,e._updateRef=e._updateRef.bind(_(e)),e.props.controlRef&&(e._Control=new M,e.props.controlRef(e._Control)),e}return u(n,[{key:"_updateRef",value:function(t){this._Control&&this._Control.updateRef(t)}},{key:"render",value:function(){var t=this.props,e=(t.controlRef,s(t,["controlRef"]));return r.createElement(V,a({},e,{router:this._Router,_updateFN:this._updateRef}))}}]),n}(),G=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t)).onKeyDown=e.onKeyDown.bind(_(e)),e.onKeyUp=e.onKeyUp.bind(_(e)),e.onDispatchKeyDown=e.onDispatchKeyDown.bind(_(e)),e.onDispatchKeyUp=e.onDispatchKeyUp.bind(_(e)),e.onFocus=e.onFocus.bind(_(e)),e.onBlur=e.onBlur.bind(_(e)),e._updateRef=e._updateRef.bind(_(e)),e._focusNode=null,e}return u(n,[{key:"onKeyDown",value:function(){return!1}},{key:"onKeyUp",value:function(){return!1}},{key:"onDispatchKeyUp",value:function(){return!1}},{key:"onDispatchKeyDown",value:function(){return!1}},{key:"onFocus",value:function(){}},{key:"onBlur",value:function(){}},{key:"changeFocus",value:function(t,e){return this._focusNode.ChangeFocus(t,e)}},{key:"renderContainer",value:function(t){return r.createElement(r.Fragment,null,t)}},{key:"renderContent",value:function(){}},{key:"_updateRef",value:function(t){this._focusNode=t}},{key:"render",value:function(){var t=this.props,e=t.branchName,i=(t.children,this.renderContent()),n=r.createElement(V,{branchName:e,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onDispatchKeyUp:this.onDispatchKeyUp,onDispatchKeyDown:this.onDispatchKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,_updateFN:this._updateRef},i);return this.renderContainer(n)}}]),n}(),H=function(){function t(){d(this,t),this._focusNode=null}return u(t,[{key:"updateRef",value:function(t){this._focusNode=t}},{key:"changeFocus",value:function(t,e){return this._focusNode.ChangeFocus(t,e)}}]),t}();var j=function(){function i(t,e){d(this,i),this.Ranges=[],void 0!==t&&void 0!==e&&this.Ranges.push(new X(t,e))}return u(i,[{key:"Merge",value:function(t){for(var e=!1,i=this.Ranges.length,n=0;n<this.Ranges.length;n++){if(t.End+1<this.Ranges[n].Start){i=n;break}if(this.Ranges[n].Merge(t)){for(e=!0;n+1<this.Ranges.length&&this.Ranges[n].Merge(this.Ranges[n+1]);)this.Ranges.splice(n+1,1);break}}e||this.Ranges.splice(i,0,t)}},{key:"Exclude",value:function(t){for(var e=0;e<this.Ranges.length&&!(t.End<this.Ranges[e].Start);e++){var i=this.Ranges[e].Exclude(t);if(this.Ranges[e].IsEmpty()&&(this.Ranges.splice(e,1),e--),null!==i.newSplitedRange){this.Ranges.splice(e+1,0,i.newSplitedRange);break}}}},{key:"ForEach",value:function(t,e){if(t)if(e)for(var i=this.Ranges.length-1;0<=i;i--)for(var n=this.Ranges[i].End;n>=this.Ranges[i].Start;n--)t(n);else for(var o=0;o<this.Ranges.length;o++)for(var s=this.Ranges[o].Start;s<=this.Ranges[o].End;s++)t(s);else console.log("Callback function is invalid")}}]),i}(),X=function(){function i(t,e){d(this,i),this.Start=t,this.End=e}return u(i,[{key:"Merge",value:function(t){return this.IsInterAct(t)?(this.Start>t.Start&&(this.Start=t.Start),this.End<t.End&&(this.End=t.End),!0):this.End+1===t.Start?(this.End=t.End,!0):this.Start===t.End+1&&(this.Start=t.Start,!0)}},{key:"IsInterAct",value:function(t){return t.Start<this.Start?!(t.End<this.Start):t.Start<=this.End}},{key:"Exclude",value:function(t){var e={success:!1,newSplitedRange:null};return this.IsInterAct(t)&&(t.Start<=this.Start?t.End<this.End?this.Start=t.End+1:this.Clear():(t.End<this.End&&(e.newSplitedRange=new i(t.End+1,this.End)),this.End=t.Start-1),e.success=!0),e}},{key:"IsEmpty",value:function(){return this.Start>this.End}},{key:"Clear",value:function(){this.End=this.Start-1}},{key:"Clone",value:function(){return new i(this.Start,this.End)}}]),i}(),W=function(){function o(t,e,i,n){d(this,o),this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,("number"!=typeof i||i<0)&&(i=0),this.width=i,("number"!=typeof n||n<0)&&(n=0),this.height=n}return u(o,[{key:"Equals",value:function(t){return null!==t&&(t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height)}}]),o}(),Y=(new(function(){function t(){d(this,t)}return u(t,[{key:"FormatRectArea",value:function(t){var e=null;if(t instanceof W)e=t;else if("object"===i(t)&&null!==t){if(isNaN(t.width)||isNaN(t.height))throw Error("ERROR: target_size format should be {width:XXXX, height:XXXX}");e=new W(0,0,t.width,t.height)}return e}}]),t}()),function(){function n(t,e,i){d(this,n),this.IdsMap=[],this._IdsTotal=-1,this.List=[],this.Orient={type:t,widthMax:e},this.Layout={type:i||"relative"}}return u(n,[{key:"SetIdsMap",value:function(t,e){this.IdsMap[t]=e,this._IdsTotal=-1,this.List[e].id=t}},{key:"AddItem",value:function(t){this.List.push(t)}},{key:"GetIdsTotal",value:function(){if(this._IdsTotal<0){for(var t=0,e=0;e<this.List.length;e++)0<=this.List[e].id&&t++;this._IdsTotal=t}return this._IdsTotal}}]),n}());Y.getTemplateItem=function(t,e){return{id:-1,hasSub:!!t.hasSub,xPos:t.x?t.x:0,yPos:t.y?t.y:0,centerXPos:0,centerYPos:0,width:void 0!==t.width?t.width:t.blocks.w,height:void 0!==t.height?t.height:t.blocks.h,focusAble:void 0===t.focusable||t.focusable,needRedraw:void 0===t.needRedraw||t.needRedraw,onBottomLine:!1,view:null,data:e,mounted:!1}};function J(){}var z,q=function(){function o(t,e,i,n){d(this,o),this._Gaps=[{GapStart:0,GapEnd:i-1}],this._FenceTotalWidth=i,this.AheadOffset=n,0<e&&this._SplitGap(0,t,e)}return u(o,[{key:"HasGapFor",value:function(t){for(var e=0;e<this._Gaps.length;e++)if(this._Gaps[e].GapEnd-this._Gaps[e].GapStart+1>=t)return{startPos:this._Gaps[e].GapStart};return null}},{key:"MarkGapUsed",value:function(t,e){if(e<=0)return this._Gaps.length;for(var i=t+e-1,n=-1,o=0;o<this._Gaps.length;o++)if(this._Gaps[o].GapStart<=t&&this._Gaps[o].GapEnd>=i){n=o;break}return-1===n&&console.log("Error in mark gap used, not found suitable gap of offset="+this.AheadOffset),this._SplitGap(n,t,e),this._Gaps.length}},{key:"_SplitGap",value:function(t,e,i){var n=this._Gaps.splice(t,1)[0],o=e+i-1;(e<n.GapStart||o>n.GapEnd)&&console.log("ERROR in split Fence Gap, range overflow"),o!==n.GapEnd&&this._Gaps.splice(t,0,{GapStart:1+o,GapEnd:n.GapEnd}),e!==n.GapStart&&this._Gaps.splice(t,0,{GapStart:n.GapStart,GapEnd:e-1})}},{key:"Fork",value:function(t){var e=new o(0,0,0,0);return e._Gaps=JSON.parse(JSON.stringify(this._Gaps)),e._FenceTotalWidth=this._FenceTotalWidth,e.AheadOffset=t,e}}]),o}(),Q=function(){function s(t,e,i,n,o){d(this,s),this._Template=new Y(t,e,i),this._FenceStack=[new q(0,0,this._Template.Orient.widthMax,0)],this._Identity=0,this._MoveLimitArea=new W(0,0,n,o),this._FenceEdge={StartX:0,StartY:0},this._NotOccupiedEdgeList=[],this._SupportHistoryPath=!1,this._VisibleRangeSearchBaseItem=null}return u(s,[{key:"_CheckNeighborItemMatching",value:function(t,e,i){var n=!1,o=e.edgeObj,s=i.edgeObj,r="rightEdge",a="leftEdge";switch(t){case"left":r="rightEdge",a="leftEdge";break;case"right":r="leftEdge",a="rightEdge";break;case"top":r="bottomEdge",a="topEdge";break;case"bottom":a="bottomEdge",r="topEdge";break;default:console.log("_CheckNeighborItemMatching unknown direction:"+t)}var l=s[r].range.Start,u=s[r].range.Clone();s[r].range.Exclude(o[a].range),o[a].range.Exclude(u);var h=s[r].range.Start;return s[r].range.IsEmpty()&&(n=!(s[r]=null)),o[a].range.IsEmpty()&&(n=!(o[a]=null)),l!==h&&(n=!0),n}},{key:"_FindNearestNeighbor",value:function(t){for(var e=t.edgeObj,i=-1,n=-1,o=-1,s=-1,r=-1,a=-1,l=-1,u=-1,h=0;h<this._NotOccupiedEdgeList.length;h++){var c=this._NotOccupiedEdgeList[h],d=c.edgeObj;if(t!==c){if(null!==e.leftEdge&&null!==d.rightEdge&&e.leftEdge.x>=d.rightEdge.x&&e.leftEdge.range.IsInterAct(d.rightEdge.range)){if(-1===r){r=e.leftEdge.x-d.rightEdge.x,i=h;continue}if(r>e.leftEdge.x-d.rightEdge.x){r=e.leftEdge.x-d.rightEdge.x,i=h;continue}}if(null!==e.rightEdge&&null!==d.leftEdge&&e.rightEdge.x<=d.leftEdge.x&&e.rightEdge.range.IsInterAct(d.leftEdge.range)){if(-1===a){a=d.leftEdge.x-e.rightEdge.x,n=h;continue}if(a>d.leftEdge.x-e.rightEdge.x){a=d.leftEdge.x-e.rightEdge.x,n=h;continue}}if(null!==e.topEdge&&null!==d.bottomEdge&&e.topEdge.y>=d.bottomEdge.y&&e.topEdge.range.IsInterAct(d.bottomEdge.range)){if(-1===l){l=e.topEdge.y-d.bottomEdge.y,o=h;continue}if(l>e.topEdge.y-d.bottomEdge.y){l=e.topEdge.y-d.bottomEdge.y,o=h;continue}}if(null!==e.bottomEdge&&null!==d.topEdge&&e.bottomEdge.y<=d.topEdge.y&&e.bottomEdge.range.IsInterAct(d.topEdge.range)){if(-1===u){u=d.topEdge.y-e.bottomEdge.y,s=h;continue}if(u>d.topEdge.y-e.bottomEdge.y){u=d.topEdge.y-e.bottomEdge.y,s=h;continue}}}}return{left:i,right:n,top:o,bottom:s}}},{key:"_CalculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],o=n.edgeObj,s=n.index;if(this._Template.Orient.type===Z){if(null===o.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&o.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===o.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&o.rightEdge.x>this._FenceEdge.StartX)continue}var r=this._FindNearestNeighbor(n);if(-1!==r.left){var a=this._NotOccupiedEdgeList[r.left],l=a.index;if(t)e[l].tmpNeighborIndexList.right.push(s),e[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,a)&&(e[l].neighborIndexList.right.push(s),e[s].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[s].tmpNeighborIndexList.left=[])}if(-1!==r.right){var u=this._NotOccupiedEdgeList[r.right],h=u.index;if(t)e[h].tmpNeighborIndexList.left.push(s),e[s].tmpNeighborIndexList.right.push(h);else this._CheckNeighborItemMatching("right",n,u)&&(e[h].neighborIndexList.left.push(s),e[s].neighborIndexList.right.push(h),e[h].tmpNeighborIndexList.left=[],e[s].tmpNeighborIndexList.right=[])}if(-1!==r.top){var c=this._NotOccupiedEdgeList[r.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(s),e[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(s),e[s].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[s].tmpNeighborIndexList.top=[])}if(-1!==r.bottom){var p=this._NotOccupiedEdgeList[r.bottom],f=p.index;if(t)e[f].tmpNeighborIndexList.top.push(s),e[s].tmpNeighborIndexList.bottom.push(f);else this._CheckNeighborItemMatching("bottom",n,p)&&(e[f].neighborIndexList.top.push(s),e[s].neighborIndexList.bottom.push(f),e[f].tmpNeighborIndexList.top=[],e[s].tmpNeighborIndexList.bottom=[])}}}},{key:"_TryCalculateNeighborItem",value:function(t,e,i,n,o){var s={index:t,edgeObj:{leftEdge:{x:e,range:new X(i,i+o-1)},rightEdge:{x:e+n,range:new X(i,i+o-1)},topEdge:{y:i,range:new X(e,e+n-1)},bottomEdge:{y:i+o,range:new X(e,e+n-1)}}};0===e&&(s.edgeObj.leftEdge=null),0===i&&(s.edgeObj.topEdge=null);var r=!1,a=this._Template.Orient.widthMax,l=this._FenceEdge.StartX,u=this._FenceEdge.StartY;this._Template.Orient.type===Z?(e+n===a&&(s.edgeObj.rightEdge=null),i>this._FenceEdge.StartY&&(r=!0,u=i)):(i+o===a&&(s.edgeObj.bottomEdge=null),e>this._FenceEdge.StartX&&(r=!0,l=e)),this._FenceEdge.StartX=l,this._FenceEdge.StartY=u,this._NotOccupiedEdgeList.push(s),r&&this._CalculateNeighborItem()}},{key:"_UpdateLastFenceEdge",value:function(){for(var t=this._FenceEdge,e={StartX:-1,StartY:-1},i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i].edgeObj;this._Template.Orient.type===Z?null!==n.bottomEdge&&n.bottomEdge.y>t.StartY&&(-1===e.StartY||n.bottomEdge.y<e.StartY)&&(e.StartY=n.bottomEdge.y):null!==n.rightEdge&&n.rightEdge.x>t.StartX&&(-1===e.StartX||n.rightEdge.y<e.StartX)&&(e.StartX=n.rightEdge.x)}this._FenceEdge=e}},{key:"ParseTemplateItem",value:function(t,e){var i,n,o,s,r=Y.getTemplateItem(t,e),a=this._FenceStack,l=-1,u=1,h=r.id,c=r.width,d=r.height,p=0,f=0,g=0,_=0,m=0;if("relative"===this._Template.Layout.type){_=this._Template.Orient.type===Z?c:d,m=this._Template.Orient.type===Z?d:c;for(var y=null,v=null;0<a.length;){var b=a[a.length-1];if(null!==(v=b.HasGapFor(_))){y=b;break}a.pop()}null!==v?(p=v.startPos,f=y.AheadOffset):console.log("ERROR: coding error, header full gap fence lost"),g=this._Template.Orient.type===Z?(i=p,o=_,((n=f)+(s=m))/this._MoveLimitArea.height):(n=p,s=_,((i=f)+(o=m))/this._MoveLimitArea.width)}else i=r.xPos,n=r.yPos,o=c,s=d,g=this._Template.Orient.type===Z?(n+s)/this._MoveLimitArea.height:(i+o)/this._MoveLimitArea.width;-1===l&&(l=h);var I=Math.ceil(g);0<=g&&I!==u&&(u=I,l=h),r.curPageHeadId=l,r.neighborIndexList={left:[],top:[],right:[],bottom:[]},r.tmpNeighborIndexList={left:[],top:[],right:[],bottom:[]},r.pathHistory={left:null,top:null,right:null,bottom:null},r.xPos=i,r.yPos=n,r.centerXPos=Math.floor(i+o/2)-1,r.centerYPos=Math.floor(n+s/2)-1,this._Template.Orient.type!==Z&&n+s===this._Template.Orient.widthMax&&(r.onBottomLine=!0),this._Template.AddItem(r),r.focusAble&&this._Template.SetIdsMap(this._Identity++,this._Template.List.length-1),this._TryCalculateNeighborItem(this._Template.List.length-1,r.xPos,r.yPos,r.width,r.height);var S=f+m-1;a[0].AheadOffset<=S&&a.splice(0,0,new q(0,0,this._Template.Orient.widthMax,1+S));for(var w=!1,F=!1,k=-1,x=a.length-1;0<=x;x--){if(!(a[x].AheadOffset<=S)){a[x].AheadOffset===1+S&&(F=!0),k=x;break}a[x].AheadOffset===S&&(w=!0),0===a[x].MarkGapUsed(p,_)&&a.splice(x,1)}var L=S;if(!w&&k+1<=a.length-1){var E=a[k+1].Fork(L);a.splice(k+1,0,E)}if(!F&&0<k){var P=a[k].Fork(1+L);a.splice(k+1,0,P)}}},{key:"GetItem",value:function(t){return this._Template.List[this._Template.IdsMap[t]]}},{key:"_CheckIdsHasFocusable",value:function(t){for(var e=this._Template.List,i=!1,n=0;n<t.length;n++){if(e[t[n]].focusAble){i=!0;break}}return i}},{key:"_IsInNeighborList",value:function(t,e){for(var i=!1,n=t.length-1;0<=n;n--)if(t[n]===e){i=!0;break}return i}},{key:"_GetValidNeighborIndex",value:function(t,e,i){var n=this._Template.List,o=-1,s=n[e],r=n[t],a=null,l=null;if(0<(a="top"===i?(l=s.neighborIndexList.left,s.neighborIndexList.right):(l=s.neighborIndexList.right,s.neighborIndexList.left)).length)for(var u=0;u<a.length;u++){var h=a[u],c=n[h];if(c.focusAble&&("top"===i&&c.yPos+c.height<=r.yPos||"bottom"===i&&c.yPos>=r.yPos+r.height)){o=h;break}}if(-1===o&&0<l.length)for(var d=0;d<l.length;d++){var p=l[d],f=n[p];if(f.focusAble&&("top"===i&&f.yPos+f.height<=r.yPos||"bottom"===i&&f.yPos>=r.yPos+r.height)){o=p;break}}return o}},{key:"_CaculateNeighborItem",value:function(t){for(var e=this._Template.List,i=0;i<this._NotOccupiedEdgeList.length;i++){var n=this._NotOccupiedEdgeList[i],o=n.edgeObj,s=n.index;if(this._Template.Orient.type===Z){if(null===o.bottomEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&o.bottomEdge.y>this._FenceEdge.StartY)continue}else{if(null===o.rightEdge){this._NotOccupiedEdgeList.splice(i,1),i--;continue}if(!t&&o.rightEdge.x>this._FenceEdge.StartX)continue}var r=this._FindNearestNeighbor(n);if(-1!==r.left){var a=this._NotOccupiedEdgeList[r.left],l=a.index;if(t)e[l].tmpNeighborIndexList.right.push(s),e[s].tmpNeighborIndexList.left.push(l);else this._CheckNeighborItemMatching("left",n,a)&&(e[l].neighborIndexList.right.push(s),e[s].neighborIndexList.left.push(l),e[l].tmpNeighborIndexList.right=[],e[s].tmpNeighborIndexList.left=[])}if(-1!==r.right){var u=this._NotOccupiedEdgeList[r.right],h=u.index;if(t)e[h].tmpNeighborIndexList.left.push(s),e[s].tmpNeighborIndexList.right.push(h);else this._CheckNeighborItemMatching("right",n,u)&&(e[h].neighborIndexList.left.push(s),e[s].neighborIndexList.right.push(h),e[h].tmpNeighborIndexList.left=[],e[s].tmpNeighborIndexList.right=[])}if(-1!==r.top){var c=this._NotOccupiedEdgeList[r.top],d=c.index;if(t)e[d].tmpNeighborIndexList.bottom.push(s),e[s].tmpNeighborIndexList.top.push(d);else this._CheckNeighborItemMatching("top",n,c)&&(e[d].neighborIndexList.bottom.push(s),e[s].neighborIndexList.top.push(d),e[d].tmpNeighborIndexList.bottom=[],e[s].tmpNeighborIndexList.top=[])}if(-1!==r.bottom){var p=this._NotOccupiedEdgeList[r.bottom],f=p.index;if(t)e[f].tmpNeighborIndexList.top.push(s),e[s].tmpNeighborIndexList.bottom.push(f);else this._CheckNeighborItemMatching("bottom",n,p)&&(e[f].neighborIndexList.top.push(s),e[s].neighborIndexList.bottom.push(f),e[f].tmpNeighborIndexList.top=[],e[s].tmpNeighborIndexList.bottom=[])}}}},{key:"CalculateNeighborWhenAddStop",value:function(){this._UpdateLastFenceEdge(),this._CaculateNeighborItem();this._CaculateNeighborItem(!0);for(var t=this._Template.List,e=t.length-1,i=t[e],n=t.length-1;0<=n;n--)if((i=t[n]).focusAble){e=n;break}for(var o=t.length-1;0<=o;o--){var s=t[o];if(s.focusAble){if(0<s.neighborIndexList.bottom.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.bottom)){var r=s.neighborIndexList.bottom[s.neighborIndexList.bottom.length-1],a=this._GetValidNeighborIndex(o,r,"bottom");-1!==a&&(s.neighborIndexList.bottom=[],s.neighborIndexList.bottom.push(a))}if(0<s.neighborIndexList.top.length&&!this._CheckIdsHasFocusable(s.neighborIndexList.top)){var l=this._GetValidNeighborIndex(o,s.neighborIndexList.top[s.neighborIndexList.top.length-1],"top");-1!==l&&(s.neighborIndexList.top=[],s.neighborIndexList.top.push(l))}}}if(this._Template.Orient.type!==Z){for(var u=null,h=-1,c=0,d=e-1;0<=d;d--){var p=t[d];p.focusAble&&p.yPos>=i.yPos+i.height&&(0!==p.neighborIndexList.right.length&&this._CheckIdsHasFocusable(p.neighborIndexList.right)&&!this._IsInNeighborList(p.neighborIndexList.right,e)||(c=Math.pow(i.xPos-p.xPos,2)+Math.pow(i.yPos-p.yPos,2),(-1===h||c<h)&&(h=c,u=d)))}u&&(i.neighborIndexList.bottom=[],i.neighborIndexList.bottom.push(u))}else for(var f=e-1;0<=f;f--){var g=t[f];g.focusAble&&g.yPos+g.height<i.yPos+i.height&&0===g.neighborIndexList.bottom.length&&g.neighborIndexList.bottom.push(e)}}},{key:"GetNextItem",value:function(t,e,i,n){0===e&&0===i&&console.log("GetNextItem(): offset is 0"),0!==e&&0!==i&&console.log("GetNextItem(): not support change vertical and horizontal and the same time");var o,s=this._Template.IdsMap[t];return o=0!==e?this._GetNextItemVertical(s,e):this._GetNextItemHorizontal(s,i),n&&null===o&&(o=0!==e?this._GetNextLoopItemVertical(s,e):this._GetNextLoopItemHorizontal(s,i)),null===o?-1:o.id}},{key:"_GetNextItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,o="top",s="bottom";0<e&&(s="top",o="bottom");for(var r=i.length-1,a=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){r=l;break}}var u=!1,h=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[o]),null===c){var d=i[t].neighborIndexList[o];if(0<i[t].tmpNeighborIndexList[o].length&&(d=d.concat(i[t].tmpNeighborIndexList[o])),1===d.length)h=d[0],r===t&&"bottom"===o&&a===$||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),u=!0;else{for(var p=0;p<d.length;p++){var f=i[h=d[p]];if(n<=f.xPos+f.width-1&&n>=f.xPos){r===t&&"bottom"===o&&a===$||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),u=!0;break}}if(!u||!i[h].focusAble)for(var g=0;g<d.length;g++){var _=d[g];if(i[_].focusAble){r===t&&"bottom"===o&&a===$||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),h=_,u=!0;break}}}}else h=c,r===t&&"bottom"===o&&a===$||(i[h].pathHistory[s]=t),u=!0;return u?i[h].focusAble?i[h]:this._GetNextItemVertical(h,e):null}},{key:"_GetNextItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,o="left",s="right";0<e&&(s="left",o="right");for(var r=i.length-1,a=this._Template.Orient.type,l=i.length-1;0<=l;l--){if(i[l].focusAble){r=l;break}}var u=!1,h=-1,c=null;if(this._SupportHistoryPath&&(c=i[t].pathHistory[o]),null===c){var d=i[t].neighborIndexList[o];if(0<i[t].tmpNeighborIndexList[o].length&&(d=d.concat(i[t].tmpNeighborIndexList[o])),1===d.length)h=d[0],r===t&&"right"===o&&a===Z||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),u=!0;else{for(var p=0;p<d.length;p++){var f=i[h=d[p]];if(n<=f.yPos+f.height-1&&n>=f.yPos){r===t&&"right"===o&&a===Z||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),u=!0;break}}if(!u||!i[h].focusAble)for(var g=0;g<d.length;g++){var _=d[g];if(i[_].focusAble){r===t&&"right"===o&&a===Z||(i[t].pathHistory[o]=h,i[h].pathHistory[s]=t),h=_,u=!0;break}}}}else h=c,r===t&&"right"===o&&a===Z||(i[h].pathHistory[s]=t),u=!0;return u?i[h].focusAble?i[h]:this._GetNextItemHorizontal(h,e):null}},{key:"_GetNextLoopItemVertical",value:function(t,e){var i=this._Template.List,n=i[t].centerXPos,o="bottom";0<e&&(o="top");var s=!1,r=-1,a=i[t].neighborIndexList[o];for(0<i[t].tmpNeighborIndexList[o].length&&(a=a.concat(i[t].tmpNeighborIndexList[o]));1<=a.length;)for(var l=0;l<a.length;l++){var u=i[r=a[l]];if(n<=u.xPos+u.width-1&&n>=u.xPos){a=i[r].neighborIndexList[o],s=!0;break}}return s?i[r].focusAble?i[r]:this._GetNextLoopItemVertical(r,e):null}},{key:"_GetNextLoopItemHorizontal",value:function(t,e){var i=this._Template.List,n=i[t].centerYPos,o="right";0<e&&(o="left");var s=!1,r=-1,a=i[t].neighborIndexList[o];for(0<i[t].tmpNeighborIndexList[o].length&&(a=a.concat(i[t].tmpNeighborIndexList[o]));1<=a.length;)for(var l=0;l<a.length;l++){var u=i[r=a[l]];if(n<=u.yPos+u.height-1&&n>=u.yPos){a=i[r].neighborIndexList[o],s=!0;break}}return s?i[r].focusAble?i[r]:this._GetNextLoopItemHorizontal(r,e):null}},{key:"GetTemplate",value:function(){return this._Template}},{key:"GetVisibleItemList",value:function(t,e,i){if(e<t)return null;for(var n=this._Template.IdsMap[i],o={resultStartIdx:-1,resultEndIdx:-1,enableBackwardSearching:!0,enableForwardSearching:!0,checkingStartLinePos:t,checkingEndLinePos:e},s={searchDirect:-1,baseIdx:n,checkingStartLineRanges:new j,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new j,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:0,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:o},r={searchDirect:1,baseIdx:n,checkingStartLineRanges:new j,startLineRangesFulled:!1,latestOverStartLineIdx:-1,checkingEndLineRanges:new j,endLineRangesFulled:!1,latestOverEndLineIdx:-1,endSearchingIndex:this._Template.List.length-1,firstStartLineBlockIdx:-1,firstEndLineBlockIdx:-1,searchToBorder:!1,common:o},a=this._Template.Orient.type===Z,l=0;o.enableBackwardSearching||o.enableForwardSearching;)o.enableBackwardSearching&&this._DoSearching(s,-l,a),o.enableForwardSearching&&this._DoSearching(r,l,a),l++;if(o.resultStartIdx<0&&(0<=s.latestOverStartLineIdx&&0<=s.firstStartLineBlockIdx?o.resultStartIdx=s.latestOverStartLineIdx:0<=r.firstStartLineBlockIdx&&(o.resultStartIdx=r.firstStartLineBlockIdx)),o.resultEndIdx<0&&(0<=r.latestOverEndLineIdx&&0<=r.firstEndLineBlockIdx?o.resultEndIdx=r.latestOverEndLineIdx:0<=s.firstEndLineBlockIdx&&(o.resultEndIdx=s.firstEndLineBlockIdx)),o.resultStartIdx<0&&o.resultEndIdx<0){var u=this._Template.List[0],h=a?u.yPos:u.xPos,c=this._Template.List[this._Template.List.length-1],d=a?c.yPos:c.xPos,p=a?c.height:c.width;t<h&&d+p<e&&(o.resultStartIdx=0,o.resultEndIdx=this._Template.List.length-1)}var f=null;o.resultStartIdx<0&&o.resultEndIdx<0||(f={visibleStart:0<=o.resultStartIdx?o.resultStartIdx:0,visibleEnd:0<=o.resultEndIdx?o.resultEndIdx:this._Template.List.length-1});return f}},{key:"_DoSearching",value:function(t,e,i){var n=this._Template.List[t.baseIdx+e],o=i?n.xPos:n.yPos,s=i?n.width:n.height,r=i?n.yPos:n.xPos,a=i?n.height:n.width;if(t.common.resultStartIdx<0&&!t.startLineRangesFulled){var l=!1;if(r<=t.common.checkingStartLinePos&&r+a-1>=t.common.checkingStartLinePos?(t.latestOverStartLineIdx=t.baseIdx+e,t.firstStartLineBlockIdx<0&&(t.firstStartLineBlockIdx=t.baseIdx+e),t.checkingStartLineRanges.Merge(new X(o,o+s-1)),l=!0):t.searchDirect<0&&r+a-1<=t.common.checkingStartLinePos&&(t.checkingStartLineRanges.Merge(new X(o,o+s-1)),l=!0),l){var u=t.checkingStartLineRanges.Ranges[0];u&&this.DebugPrint&&u.Start<=0&&u.End>=this._Template.Orient.widthMax-1&&((u.End>this._Template.Orient.widthMax-1||u.Start<0)&&(t.startLineRangesFulled=!0),0<t.searchDirect?t.common.resultStartIdx=t.firstStartLineBlockIdx:t.common.resultStartIdx=t.latestOverStartLineIdx,0<=t.common.resultStartIdx&&(t.common.enableBackwardSearching=!1))}}if(t.common.resultEndIdx<0&&!t.endLineRangesFulled){var h=!1;if(r<=t.common.checkingEndLinePos&&r+a-1>=t.common.checkingEndLinePos?(t.latestOverEndLineIdx=t.baseIdx+e,t.firstEndLineBlockIdx<0&&(t.firstEndLineBlockIdx=t.baseIdx+e),t.checkingEndLineRanges.Merge(new X(o,o+s-1)),h=!0):0<t.searchDirect&&r>=t.common.checkingEndLinePos&&(t.checkingEndLineRanges.Merge(new X(o,o+s-1)),h=!0),h){var c=t.checkingEndLineRanges.Ranges[0];c&&this.DebugPrint&&c.Start<=0&&c.End>=this._Template.Orient.widthMax-1&&((c.End>this._Template.Orient.widthMax-1||c.Start<0)&&(t.endLineRangesFulled=!0),t.searchDirect<0?t.common.resultEndIdx=t.firstEndLineBlockIdx:t.common.resultEndIdx=t.latestOverEndLineIdx,0<=t.common.resultEndIdx&&(t.common.enableForwardSearching=!1))}}t.baseIdx+e===t.endSearchingIndex&&(0<t.searchDirect?t.common.enableForwardSearching=!1:t.common.enableBackwardSearching=!1,t.searchToBorder=!0)}}]),s}(),Z=Symbol("vertical"),$=Symbol("horizontal");function tt(){}function et(){return null}var it=function(){function t(){d(this,t)}return u(t,null,[{key:"removeKeyframe",value:function(t){window.JsView||function(t){z=z||document.styleSheets,console.assert(0<z.length,"styleSheets is empty!");for(var e=z[0].cssRules,i=e.length-1;0<=i;i--)for(var n in t)if(e[i].name==t[n]){t.splice(n,1),z[0].deleteRule(i);break}}(t)}},{key:"translate",value:function(t,e){var i,n,o,s,r=e.name,a=e.fromX,l=e.toX,u=e.fromY,h=e.toY,c=e.duration,d=(e.easing,e.onEnd);if(window.JsView){var p=t.jsvMaskView,f=new v.TranslateAnimation(a,l,u,h,c),g=new v.AnimationListener(J,d||J);f.SetAnimationListener(g),p.StartAnimation(f)}else{console.log("animation wrapper",r,a,l,u,h),function(t){z=z||document.styleSheets,console.assert(0<z.length,"styleSheets is empty!"),window.jsvInAndroidWebView&&(t=(t=t.replace(/@keyframes/,"@-webkit-keyframes")).replace(/transform/g,"-webkit-transform"));var e=z[0].cssRules.length;z[0].insertRule(t,e)}((i=a,n=l,o=u,s=h,"@keyframes ".concat(r,"{from{transform:translate3d(").concat(i,"px,").concat(o,"px,0);}to{transform:translate3d(").concat(n,"px,").concat(s,"px,0);}}")));var _=t.jsvMaskView.Element;_.addEventListener("animationend",d||J),_.style.animation=r+" "+c/1e3+"s"}}}]),t}(),nt={seamLess:Symbol("seamless"),wholePage:Symbol("wholePage"),seamlessFixedId:Symbol("seamlessFixedId")},ot={left:Symbol("left"),right:Symbol("right"),top:Symbol("top"),bottom:Symbol("bottom")},st=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._setVisibility=e._setVisibility.bind(_(e)),e._setZIndex=e._setZIndex.bind(_(e)),e._updateView=e._updateView.bind(_(e)),e._Visibility=!0,e.props.setControlFunc&&(e.props.setControlFunc(e._setVisibility,e._setZIndex),e._Visibility=!1),e.props.registerUpdateFunc&&e.props.registerUpdateFunc(e._updateView),e.state={visible:e._Visibility,zIndex:0},e}return u(n,[{key:"_updateView",value:function(){this.setState({visible:this._Visibility})}},{key:"_setVisibility",value:function(t){this._Visibility=t,this.setState({visible:this._Visibility})}},{key:"_setZIndex",value:function(t){this.setState({zIndex:t})}},{key:"render",value:function(){return this.state.visible?r.createElement("div",{style:{left:this.props.x,top:this.props.y,visibility:"inherit",zIndex:this.state.zIndex}},this.props.renderFunc()):null}},{key:"componentDidMount",value:function(){this.props.mountStateUpdater&&this.props.mountStateUpdater(!0)}},{key:"componentWillUnmount",value:function(){this.props.mountStateUpdater&&this.props.mountStateUpdater(!1)}}]),n}(),rt=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(_(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:et,onRenderDone:tt},e}return u(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||tt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),at=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(_(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:tt},e}return u(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||tt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),lt=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(_(e)),e.props.registerUpdateFunc(e._updateView),e.state={renderFunc:function(){return null},onRenderDone:tt},e}return u(n,[{key:"_updateView",value:function(t,e){this.setState({renderFunc:t,onRenderDone:e||tt})}},{key:"render",value:function(){return this.state.renderFunc()}},{key:"componentDidMount",value:function(){this.state.onRenderDone()}},{key:"componentDidUpdate",value:function(){this.state.onRenderDone()}}]),n}(),ut=function(){g(e,r.Component);var t=m(e);function e(){return d(this,e),t.apply(this,arguments)}return u(e,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return r.createElement("div",null,r.createElement(rt,{registerUpdateFunc:this.props.registerUpdateContentFunc}),r.createElement(lt,{registerUpdateFunc:this.props.registerUpdateBlurFunc}),r.createElement(at,{registerUpdateFunc:this.props.registerUpdateFocusFunc}))}}]),e}(),ht=function(){g(n,r.Component);var i=m(n);function n(t){var e;return d(this,n),(e=i.call(this,t))._updateView=e._updateView.bind(_(e)),e.props.registerUpdateFunc(e._updateView),e.state={animX:0,animY:0,staticX:0,staticY:0,transitionCallback:tt},e}return u(n,[{key:"_updateView",value:function(t,e){var i=t-(this.state.animX+this.state.staticX),n=e-(this.state.animY+this.state.staticY);this.setState({animX:this.state.animX+i,animY:this.state.animY+n})}},{key:"render",value:function(){return r.createElement("div",{style:{left:this.props.x,top:this.props.y}},r.createElement("div",{ref:this.props.rootViewRef,style:{top:this.state.animY,left:this.state.animX}},r.createElement("div",{style:{left:this.state.staticX,top:this.state.staticY}},r.createElement(ut,{registerUpdateContentFunc:this.props.registerUpdateContentFunc,registerUpdateFocusFunc:this.props.registerUpdateFocusFunc,registerUpdateBlurFunc:this.props.registerUpdateBlurFunc}))))}}]),n}(),ct=function(){function t(){d(this,t),this._Component=null,this.registerComponent=this.registerComponent.bind(this),this.unregisterComponent=this.unregisterComponent.bind(this),this.dispatch=this.dispatch.bind(this)}return u(t,[{key:"registerComponent",value:function(t){this._Component=t}},{key:"unregisterComponent",value:function(){this._Component=null}},{key:"dispatch",value:function(t){t&&this._Component&&this._Component._dispathcEvent(t)}}]),t}(),dt=0,pt=function(){g(e,ct);var t=m(e);function e(){return d(this,e),t.apply(this,arguments)}return e}();pt.Type={setFocusId:Symbol("setFocusId"),setFocusRect:Symbol("setFocusRect"),updateItem:Symbol("updateItem"),slideToItem:Symbol("slideTo")};var ft=function(){g(p,G);var a=m(p);function p(t){var n;d(this,p),f(_(n=a.call(this,t)),"_mountStateUpdate",function(e){return function(t){return e.mounted=t}}),n.onKeyDown=n.onKeyDown.bind(_(n)),n.onFocus=n.onFocus.bind(_(n)),n.onBlur=n.onBlur.bind(_(n)),n._OnFocusableItemEdge=n._OnFocusableItemEdge.bind(_(n)),n._updateItemVisibility=n._updateItemVisibility.bind(_(n)),n._onTransitionEnd=n._onTransitionEnd.bind(_(n)),n._getContentView=n._getContentView.bind(_(n)),n._getFocusView=n._getFocusView.bind(_(n)),n._getBlurView=n._getBlurView.bind(_(n)),n._onContentUpdate=n._onContentUpdate.bind(_(n)),n._drawItem=n._drawItem.bind(_(n)),n._getSlideAnim=n._getSlideAnim.bind(_(n)),n._setItmeVisible=n._setItmeVisible.bind(_(n)),n._updateFocusItem=n._updateFocusItem.bind(_(n)),n._dispathcEvent=n._dispathcEvent.bind(_(n)),n._getQueryObj=n._getQueryObj.bind(_(n)),n._getRootViewRef=n._getRootViewRef.bind(_(n)),n._SlideAnimCount=0,n._SimpleWidgetCount=dt++,n.props.dispatcher&&n.props.dispatcher.registerComponent(_(n)),n._AllState={},n._AllState.isFocus=!1;var e=p._getTemplateParser(n.props.width,n.props.height,n.props.direction,n.props.padding,n.props.layoutType);p._AddTemplateItem(n.props.data,n.props.measures,e,0),n._AllState.templateParser=e,n._VisibleItemList=[],n._NeedHideItemList=[],n._ItemControlFuncMap=[],n._registerItemControlFunc=function(i){return function(t,e){n._ItemControlFuncMap[i]={visible:!1,visibleFunc:t,zIndexFunc:e}}},n._itemUpdateFuncMap={},n._registerItemUpdateFunc=function(e){return function(t){n._itemUpdateFuncMap[e]=t}},n._updateRootFunc=tt,n._registerUpdateRootFunc=function(t){n._updateRootFunc=t},n._updateContentFunc=tt,n._registerUpdateContentFunc=function(t){n._updateContentFunc=t},n._updateFocusFunc=tt,n._registerUpdateFocusFunc=function(t){n._updateFocusFunc=t},n._updateBlurFunc=tt,n._registerUpdateBlurFunc=function(t){n._updateBlurFunc=t},n._queryPosition=n._queryPosition.bind(_(n));var i=0,o=0,s=n.props.direction===Z?n.props.height:n.props.width;if(n._VisibleItemList=n._getVisibleItemList(i,o,o+s-1),void 0!==n.props.baseAnchor){var r=n._BaseAnchorInfo2Pos(n.props.baseAnchor,0,s);o=n.props.direction===Z?r.yPos:r.xPos,n._VisibleItemList=n._getVisibleItemList(n.props.baseAnchor.id,o,o+s-1)}return n.props.initFocusId&&(i=n.props.initFocusId,void 0===n.props.baseAnchor&&(o=n._CalculateSlide(n._AllState.templateParser.GetItem(i),1,0),n._VisibleItemList=n._getVisibleItemList(i,o,o+s-1))),n._AllState.enterFocusId=-1,n._AllState.enterFocusRect=null,n._AllState.focusId=i,n._AllState.preFocusId=-1,n._AllState.preEdgeRect=null,n._AllState.visibleStart=o,n._AllState.visibleRange=s,n._AllState.baseAnchor=n.props.baseAnchor,n}return u(p,[{key:"_getQueryObj",value:function(t){return{id:t,queryPosition:this._queryPosition,queryTempPosition:this._queryTemplatePosition}}},{key:"_queryPosition",value:function(t){var e=this._AllState.templateParser.GetItem(t),i=this.props.direction===Z?0:-this._AllState.visibleStart,n=this.props.direction===Z?-this._AllState.visibleStart:0;return{xPos:e.xPos+i,yPos:e.yPos+n,width:e.width,height:e.height}}},{key:"_queryTemplatePosition",value:function(t){var e=this._AllState.templateParser.GetItem(t);return{xPos:e.xPos,yPos:e.yPos,width:e.width,height:e.height}}},{key:"_getSlideAnim",value:function(){return window.jsvInAndroidWebView?null:"left "+this.props.slideTime+"s, top "+this.props.slideTime+"s "+this.props.slideEasing}},{key:"_dispathcEvent",value:function(t){switch(t.type){case pt.Type.setFocusId:this._AllState.enterFocusId=t.data;break;case pt.Type.setFocusRect:this._AllState.enterFocusRect=t.data;break;case pt.Type.updateItem:var e=t.data;if(e){var i,n=this._AllState.templateParser.GetTemplate(),o=P(e);try{for(o.s();!(i=o.n()).done;){var s=i.value,r=n.IdsMap[s];this._itemUpdateFuncMap[r]&&this._itemUpdateFuncMap[r](),this._AllState.focusId===s&&this._updateFocusItem()}}catch(t){o.e(t)}finally{o.f()}}break;case pt.Type.slideToItem:t.data&&this._slideViewToAnchor(t.data)}}},{key:"_getVisibleItemList",value:function(t,e,i){var n=this._AllState.templateParser.GetVisibleItemList(e,i,t);return this._AllState.templateParser.GetTemplate().List.slice(n.visibleStart,n.visibleEnd+1)}},{key:"_calculateNearestItemByRect",value:function(t,e){var i=e.direction,n=e.rect,o="",s={x:0,y:0};switch(i){case ot.left:o="left",s.x=n.x,s.y=n.y+n.height/4;break;case ot.right:o="right",s.x=n.x+n.width,s.y=n.y+n.height/4;break;case ot.top:o="up",s.x=n.x+n.width/4,s.y=n.y;break;case ot.bottom:o="down",s.x=n.x+n.width/4,s.y=n.y+n.height}var r,a=new X(s.x,s.x),l=new X(s.y,s.y),u=null,h=-1,c=0,d=0,p=0,f=this.props.direction===Z?"yPos":"xPos",g=this.props.direction===Z?"height":"width",_=P(t);try{for(_.s();!(r=_.n()).done;){var m=r.value;if(m[f]>=this._AllState.visibleStart&&m[f]+m[g]-1<=this._AllState.visibleStart+this._AllState.visibleRange-1){var y=this.props.direction===Z?m.xPos:m.xPos-this._AllState.visibleStart,v=this.props.direction===Z?m.yPos-this._AllState.visibleStart:m.yPos,b=new X(y,y+m.width-1),I=new X(v,v+m.height-1);switch(o){case"left":if(s.x<y+m.width-1)continue;s.y<v?d=Math.pow(s.x-(y+m.width-1),2)+Math.pow(v-s.y,2):l.IsInterAct(I)?d=Math.pow(s.x-(y+m.width-1),2):s.y>v+m.height-1&&(d=Math.pow(s.x-(y+m.width-1),2)+Math.pow(s.y-(v+m.height-1),2)),p=Math.abs(s.x-(y+m.width-1));break;case"right":if(s.x>y)continue;s.y<v?d=Math.pow(y-s.x,2)+Math.pow(v-s.y,2):l.IsInterAct(I)?d=Math.pow(y-s.x,2):s.y>v+m.height-1&&(d=Math.pow(y-s.x,2)+Math.pow(s.y-(v+m.height-1),2)),p=Math.abs(s.x-y);break;case"up":if(s.y<v+m.height-1)continue;s.x<y?d=Math.pow(s.x-y,2)+Math.pow(s.y-(v+m.height-1),2):a.IsInterAct(b)?d=Math.pow(s.y-(v+m.height-1),2):s.x>y+m.width-1&&(d=Math.pow(s.x-(y+m.width-1),2)+Math.pow(s.y-(v+m.height-1),2)),p=Math.abs(s.y-(v+m.height-1));break;case"down":if(s.y>v)continue;s.x<y?d=Math.pow(s.x-y,2)+Math.pow(v-s.y,2):a.IsInterAct(b)?d=Math.pow(v-s.y,2):s.x>y+m.width-1&&(d=Math.pow(s.x-(y+m.width-1),2)+Math.pow(v-s.y,2)),p=Math.abs(s.y-v);break;default:console.log("direction is error:"+o)}(h<0||p<c||c===p&&d<h)&&(h=d,c=p,u=m)}}}catch(t){_.e(t)}finally{_.f()}return u?u.id:0}},{key:"_updateItemVisibility",value:function(t,e){for(var i=this._AllState.templateParser.GetTemplate(),n=0;n<t.length;++n){var o=this._ItemControlFuncMap[i.IdsMap[t[n].id]];o&&o.visible!==e&&(o.visible=e,o.visibleFunc&&o.visibleFunc(e))}}},{key:"onKeyDown",value:function(t){var e=0,i=0;switch(t.keyCode){case 37:e=-1,this._moveToNext(e,i);break;case 38:i=-1,this._moveToNext(e,i);break;case 39:e=1,this._moveToNext(e,i);break;case 40:i=1,this._moveToNext(e,i);break;case 13:var n=this._AllState.templateParser.GetItem(this._AllState.focusId);!n.hasSub&&this.props.onClick&&this.props.onClick(n.data);break;default:return!1}return!0}},{key:"_moveToNext",value:function(t,e,i){var n=this._AllState.templateParser.GetTemplate(),o=this._AllState.preFocusId,s=n.IdsMap[this._AllState.focusId],r=this._AllState.templateParser.GetNextItem(this._AllState.focusId,e,t,this.props.loopFocus);if(0<=r){this._AllState.preFocusId=this._AllState.focusId;var a=this._AllState.templateParser.GetItem(r);this._AllState.focusId=a.id;var l=this.props.direction===Z?e:t,u=this._AllState.visibleStart,h=this._CalculateSlide(a,l,this._AllState.visibleStart);if(u!==h){var c=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(r,h,h+this._AllState.visibleRange-1);var d,p=P(c);try{for(p.s();!(d=p.n()).done;){var f=d.value;this._VisibleItemList.indexOf(f)<0&&this._NeedHideItemList.indexOf(f)<0&&this._NeedHideItemList.push(f)}}catch(t){p.e(t)}finally{p.f()}var g,_=P(this._VisibleItemList);try{for(_.s();!(g=_.n()).done;){var m=g.value,y=this._NeedHideItemList.indexOf(m);0<=y&&this._NeedHideItemList.splice(y,1)}}catch(t){_.e(t)}finally{_.f()}var v=this._AllState.visibleStart;this._AllState.visibleStart=h,this._updateItemVisibility(this._VisibleItemList,!0),!window.JsView&&0<this._SlideAnimCount&&it.removeKeyframe(["--inner-simple-slide--"+this._SimpleWidgetCount+"--"+(this._SlideAnimCount-1)]);var b={name:window.JsView?null:"--inner-simple-slide--"+this._SimpleWidgetCount+"--"+this._SlideAnimCount++,fromX:0,toX:0,fromY:0,toY:0,duration:200,easing:"",onEnd:this._onTransitionEnd};this.props.direction===$?(b.fromX=this._AllState.visibleStart-v,this._updateRootFunc(-this._AllState.visibleStart,0)):(b.fromY=this._AllState.visibleStart-v,this._updateRootFunc(0,-this._AllState.visibleStart)),this._RootViewRef&&it.translate(this._RootViewRef,b)}if(a.hasSub){var I,S=n.List[s].xPos-n.List[r].xPos,w=n.List[s].yPos-n.List[r].yPos;I=i?(i.rect.x+=S,i.rect.y+=w,i):{direction:null,rect:{x:S,y:w,width:n.List[s].width,height:n.List[s].height}},this._AllState.preEdgeRect=I,this._itemUpdateFuncMap[r]&&this._itemUpdateFuncMap[r]()}else o!==this._AllState.preFocusId&&this._setItmeVisible(n.IdsMap[o],!0),this._updateBlurItem(),this._updateFocusItem();if(0<=this._AllState.preFocusId&&this.props.onItemBlur){var F=this._AllState.templateParser.GetItem(this._AllState.preFocusId).data;this.props.onItemBlur(F,this._getQueryObj(this._AllState.preFocusId))}this._AllState.isFocus&&this.props.onItemFocus&&this.props.onItemFocus(a.data,this._AllState.preEdgeRect,this._getQueryObj(a.id))}else if(this.props.onEdge){var k,x=this.props.direction===Z?0:this._AllState.visibleStart,L=this.props.direction===Z?this._AllState.visibleStart:0;1===t&&(k=ot.right),-1===t&&(k=ot.left),1===e&&(k=ot.bottom),-1===e&&(k=ot.top);var E={x:n.List[s].xPos-x,y:n.List[s].yPos-L,width:n.List[s].width,height:n.List[s].height};this.props.onEdge({direction:k,rect:E})}}},{key:"_CalculateSlide",value:function(t,e,i){var n=i,o=n,s=this._AllState.templateParser.GetTemplate().List,r=s[s.length-1],a=this.props.direction===Z?"yPos":"xPos",l=this.props.direction===Z?"height":"width",u=this.props.direction===Z?"bottom":"right",h=this.props.direction===Z?this.props.height:this.props.width;switch(this.props.slideStyle){case nt.seamLess:var c=r[a]+r[l]-h+p._getPadding(this.props.padding)[u];0<e?t[a]+t[l]>n+4*h/5&&(o=t[a]+t[l]-4*h/5):e<0?t[a]<n+h/5&&(o=t[a]-h/5):t[a]<n?o=t[a]-h/5:t[a]+t[l]>n+h&&(o=t[a]+t[l]-4*h/5),o=(o=c<o?c:o)<0?0:o;break;case nt.wholePage:0<e?t[a]+t[l]>n+h+1&&(o=t[a]):e<0&&t[a]<n&&(o=(o=t[a]+t[l]-h)<0?0:o)}return o}},{key:"_OnFocusableItemEdge",value:function(t){var e=0,i=0;switch(t.direction){case ot.left:e=-1;break;case ot.right:e=1;break;case ot.top:i=-1;break;case ot.bottom:i=1}this._moveToNext(e,i,t)}},{key:"_ifValidEnterRect",value:function(t){return t&&t.direction&&t.rect}},{key:"_setItmeVisible",value:function(t,e){var i=this._ItemControlFuncMap[t];i&&i.visible!==e&&(i.visible=e,i.visibleFunc&&i.visibleFunc(e))}},{key:"_setZIndex",value:function(t,e){var i=this._ItemControlFuncMap[t];i&&i.zIndexFunc&&i.zIndexFunc(e)}},{key:"onFocus",value:function(){var t=this,e=void 0!==this._AllState.enterFocusId&&0<=this._AllState.enterFocusId&&this._AllState.enterFocusId<this._AllState.templateParser.GetTemplate().List.length?this._AllState.enterFocusId:this._AllState.focusId;e=this._ifValidEnterRect(this._AllState.enterFocusRect)?this._calculateNearestItemByRect(this._VisibleItemList,this._AllState.enterFocusRect):e,this._AllState.isFocus=!0,this._AllState.focusId=e;var i=this._AllState.templateParser.GetItem(this._AllState.preFocusId);if(i&&!i.hasSub&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.preFocusId=-1,this._updateFocusItem(),this._updateBlurFunc(this._getBlurView),this.props.onItemFocus){var n=this._AllState.templateParser.GetItem(e);n.mounted?this.props.onItemFocus(n.data,null,this._getQueryObj(n.id)):Promise.resolve().then(function(){l.unstable_batchedUpdates(function(){t.props.onItemFocus(n.data,null,t._getQueryObj(n.id))})})}this.props.onFocus&&this.props.onFocus()}},{key:"onBlur",value:function(){this._AllState.isFocus=!1;var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);if(t&&!t.hasSub&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this._AllState.enterFocusId=-1,this._AllState.enterFocusRect=null,this._AllState.preFocusId=this._AllState.focusId,this._AllState.preEdgeRect=null,this._updateFocusFunc(this._getFocusView),this._updateBlurItem(),this.props.onItemBlur){var e=this._AllState.templateParser.GetItem(this._AllState.preFocusId).data;this.props.onItemBlur(e,this._getQueryObj(this._AllState.preFocusId))}this.props.onBlur&&this.props.onBlur()}},{key:"_onTransitionEnd",value:function(t){(window.JsView?t:(t&&t.stopPropagation&&t.stopPropagation(),!0))&&(this._updateItemVisibility(this._NeedHideItemList,!1),this._NeedHideItemList=[])}},{key:"_drawItem",value:function(t){var e=this;return function(){return e.props.renderItem(t.data,e._OnFocusableItemEdge,e._getQueryObj(t.id))}}},{key:"_getContentView",value:function(){var i=this,t=this._AllState.templateParser.GetTemplate().List;return r.createElement("div",{id:"container"},t.map(function(t,e){return r.createElement(st,{key:t.id,x:t.xPos,y:t.yPos,setControlFunc:i._registerItemControlFunc(e),registerUpdateFunc:i._registerItemUpdateFunc(e),renderFunc:i._drawItem(t),mountStateUpdater:i._mountStateUpdate(t)})}))}},{key:"_onContentUpdate",value:function(){this._updateItemVisibility(this._VisibleItemList,!0),this._updateFocusItem()}},{key:"_drawFocusItem",value:function(t){var e=this;return function(){return e.props.renderFocus(t.data,e._getQueryObj(t.id))}}},{key:"_getFocusView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.focusId);return t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus?r.createElement(st,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawFocusItem(t)}):null}},{key:"_updateFocusItem",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.focusId);this.props.renderFocus?(this._updateFocusFunc(this._getFocusView),t&&!t.hasSub&&this._AllState.isFocus&&this.props.renderFocus&&this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.focusId],!1)):t&&this._setZIndex(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.focusId],this.props.data.length)}},{key:"_drawBlurItem",value:function(t){var e=this;return function(){return e.props.renderBlur(t.data,e._renderBlurEndCallback(t.id),e._getQueryObj(t.id))}}},{key:"_getBlurView",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);return t&&!t.hasSub&&this.props.renderBlur?r.createElement(st,{key:t.id,x:t.xPos,y:t.yPos,renderFunc:this._drawBlurItem(t)}):null}},{key:"_updateBlurItem",value:function(){var t=this._AllState.templateParser.GetItem(this._AllState.preFocusId);this.props.renderBlur&&this._updateBlurFunc(this._getBlurView),t&&!t.hasSub&&this.props.renderBlur||this._setItmeVisible(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],!0),this.props.renderFocus||this._setZIndex(this._AllState.templateParser.GetTemplate().IdsMap[this._AllState.preFocusId],0)}},{key:"_onFocusUpdate",value:function(){}},{key:"_BaseAnchorInfo2Pos",value:function(t,e,i){var n=t.id,o={xPos:this.props.direction===Z?0:e,yPos:this.props.direction===Z?e:0};if(null!=n){var s=this._AllState.templateParser.GetTemplate().List,r=s[n],a=s[s.length-1];if(r){var l=void 0!==t.type?t.type:"start",u=this.props.direction===Z?"yPos":"xPos",h=this.props.direction===Z?"height":"width",c=this.props.direction===Z?"bottom":"right";switch(l){case"start":o[u]=r[u];break;case"center":o[u]=r[u]-i/2+r[h]/2;break;case"end":o[u]=r[u]+r[h]-1-i+p._getPadding(this.props.padding)[c]}var d=a[u]+a[h]-i+p._getPadding(this.props.padding)[c];o[u]=o[u]>d?d:o[u],o[u]=o[u]<0?0:o[u]}}return o}},{key:"_slideViewToAnchor",value:function(t){if(!(t.id<0||t.id>=this._AllState.templateParser.GetTemplate().List.length)){var e=this._AllState.visibleStart,i=this._BaseAnchorInfo2Pos(t,this._AllState.visibleStart,this._AllState.visibleRange);this._AllState.visibleStart=this.props.direction===Z?i.yPos:i.xPos;var n=this._VisibleItemList;this._VisibleItemList=this._getVisibleItemList(t.id,this._AllState.visibleStart,this._AllState.visibleStart+this._AllState.visibleRange-1);var o,s=P(n);try{for(s.s();!(o=s.n()).done;){var r=o.value;this._VisibleItemList.indexOf(r)<0&&this._NeedHideItemList.indexOf(r)<0&&this._NeedHideItemList.push(r)}}catch(t){s.e(t)}finally{s.f()}var a,l=P(this._VisibleItemList);try{for(l.s();!(a=l.n()).done;){var u=a.value,h=this._NeedHideItemList.indexOf(u);0<=h&&this._NeedHideItemList.splice(h,1)}}catch(t){l.e(t)}finally{l.f()}this._updateItemVisibility(this._VisibleItemList,!0);var c=void 0===t.doAnim||null===t.doAnim||t.doAnim;if(this._updateRootFunc(-i.xPos,-i.yPos),c){if(this._RootViewRef){!window.JsView&&0<this._SlideAnimCount&&it.removeKeyframe(["--inner-simple-slide--"+this._SimpleWidgetCount+"--"+(this._SlideAnimCount-1)]);var d={name:window.JsView?null:"--inner-simple-slide--"+this._SimpleWidgetCount+"--"+this._SlideAnimCount++,fromX:0,toX:0,fromY:0,toY:0,duration:200,easing:"",onEnd:this._onTransitionEnd};this.props.direction===$?d.fromX=this._AllState.visibleStart-e:d.fromY=this._AllState.visibleStart-e,it.translate(this._RootViewRef,d)}}else this._updateItemVisibility(this._NeedHideItemList,!1),this._NeedHideItemList=[]}}},{key:"_onBlurUpdate",value:function(){}},{key:"_renderBlurEndCallback",value:function(t){var e=this;return function(){t===e._AllState.preFocusId&&e._updateBlurFunc(et),e._setItmeVisible(e._AllState.templateParser.GetTemplate().IdsMap[t],!0)}}},{key:"_getRootViewRef",value:function(t){this._RootViewRef=t}},{key:"renderContent",value:function(){return r.createElement("div",{style:{left:this.props.left,top:this.props.top,width:this.props.width,height:this.props.height,overflow:"hidden"}},r.createElement(ht,{x:this.props.padding&&void 0!==this.props.padding.left?this.props.padding.left:0,y:this.props.padding&&void 0!==this.props.padding.top?this.props.padding.top:0,registerUpdateFunc:this._registerUpdateRootFunc,registerUpdateContentFunc:this._registerUpdateContentFunc,registerUpdateFocusFunc:this._registerUpdateFocusFunc,registerUpdateBlurFunc:this._registerUpdateBlurFunc,rootViewRef:this._getRootViewRef}))}},{key:"shouldComponentUpdate",value:function(t){var e=!1;for(var i in t)"padding"===i&&t[i]?e|=t[i].left!==this.props[i].left||t[i].right!==this.props[i].right||t[i].top!==this.props[i].top||t[i].bottom!==this.props[i].bottom:e|=this.props[i]!==t[i];return e}},{key:"componentDidUpdate",value:function(){var t=this,e=this._AllState.templateParser.GetTemplate().List,i=this.props.data,n=0;for(n=0;n<i.length;++n){for(var o=!1,s=0;s<e.length;++s)if(i[n]===e[s].data){o=!0;break}if(!o)break}var r=!1;if(n===e.length)n!==i.length?(r=!0,p._AddTemplateItem(this.props.data,this.props.measures,this._AllState.templateParser,n)):!this.props.baseAnchor||this.props.baseAnchor.id===this._AllState.baseAnchor.id&&this.props.baseAnchor.type===this._AllState.baseAnchor.type||(this._AllState.baseAnchor=this.props.baseAnchor,this._slideViewToAnchor(this._AllState.baseAnchor));else{r=!0;var a=p._getTemplateParser(this.props.width,this.props.height,this.props.direction,this.props.padding,this.props.layoutType);p._AddTemplateItem(this.props.data,this.props.measures,a,0),this._AllState.templateParser=a}r&&this._updateContentFunc(this._getContentView,null),this._AllState.focusId>=this.props.data.length&&(this._AllState.focusId=0,this._AllState.preFocusId=-1,0!==this._AllState.visibleStart&&(this._AllState.visibleStart=0,this._updateRootFunc(0,0))),this._updateFocusItem(),this.props.onWidgetUpdate&&Promise.resolve().then(function(){l.unstable_batchedUpdates(function(){t.props.onWidgetUpdate()})})}},{key:"componentDidMount",value:function(){var t=this;if(this._updateContentFunc(this._getContentView,this._onContentUpdate),0!==this._AllState.visibleStart){var e=this.props.direction===Z?0:-this._AllState.visibleStart,i=this.props.direction===Z?-this._AllState.visibleStart:0;this._updateRootFunc(e,i)}this.props.onWidgetMount&&Promise.resolve().then(function(){l.unstable_batchedUpdates(function(){t.props.onWidgetMount()})})}},{key:"componentWillUnmount",value:function(){this.props.dispatcher&&this.props.dispatcher.unregisterComponent()}}],[{key:"_getPadding",value:function(t){var e={left:0,right:0,top:0,bottom:0};return null!=t&&(e={left:void 0===t.left?0:t.left,right:void 0===t.right?0:t.right,top:void 0===t.top?0:t.top,bottom:void 0===t.bottom?0:t.bottom}),e}},{key:"_getTemplateParser",value:function(t,e,i,n,o){var s=p._getPadding(n),r=i===Z?t-s.left-s.right:e-s.top-s.bottom;return new Q(i,r,o||"relative",t,e)}},{key:"_AddTemplateItem",value:function(t,e,i,n){for(var o=n;o<t.length;o++){var s=e(t[o]);i.ParseTemplateItem(s,t[o])}i.CalculateNeighborWhenAddStop()}}]),p}();ft.defaultProps={left:0,top:0,slideEasing:"cubic-bezier(0.14,0.68,0.19,0.87)",slideTime:.2,loopFocus:!1,slideStyle:nt.seamLess},ft.getMeasureObj=function(t,e,i,n){return{width:t,height:e,focusable:i,hasSub:n}};var gt={};window.JsView&&(window.JsView.React&&window.JsView.React.Extension||(window.JsView.React.Extension=gt),gt=window.JsView.React.Extension);var _t=gt;t.BaseDispatcher=ct,t.EdgeDirection=ot,t.Fdiv=V,t.FdivRoot=T,t.FdivRouter=B,t.FdivWrapper=G,t.FocusNode=L,t.Forge=v,t.ForgeExtension=_t,t.HORIZONTAL=$,t.PBMapAdd=E,t.PBMapGet=R,t.PBMapRemove=A,t.Router=x,t.SWidgetDispatcher=pt,t.SetRootPB=O,t.SimpleWidget=ft,t.SlideStyle=nt,t.TriggerFocus=D,t.VERTICAL=Z,t.enableFocusable=function(t){return function(){g(n,t);var i=m(n);function n(t){var e;if(d(this,n),(e=i.call(this,t)).onKeyDown=e.onKeyDown.bind(_(e)),e.onKeyUp=e.onKeyUp.bind(_(e)),e.onDispatchKeyDown=e.onDispatchKeyDown.bind(_(e)),e.onDispatchKeyUp=e.onDispatchKeyUp.bind(_(e)),e.onFocus=e.onFocus.bind(_(e)),e.onBlur=e.onBlur.bind(_(e)),e._updateRef=e._updateRef.bind(_(e)),!c(h(n.prototype),"setControl",_(e)))throw console.error("Need interface 'setControl'"),Error("Err");return e.__control=new H,c(h(n.prototype),"setControl",_(e)).call(_(e),e.__control),e}return u(n,[{key:"onKeyDown",value:function(t){return!!c(h(n.prototype),"onKeyDown",this)&&c(h(n.prototype),"onKeyDown",this).call(this,t)}},{key:"onKeyUp",value:function(t){return!!c(h(n.prototype),"onKeyUp",this)&&c(h(n.prototype),"onKeyUp",this).call(this,t)}},{key:"onDispatchKeyUp",value:function(t){return!!c(h(n.prototype),"onDispatchKeyUp",this)&&c(h(n.prototype),"onDispatchKeyUp",this).call(this,t)}},{key:"onDispatchKeyDown",value:function(t){return!!c(h(n.prototype),"onDispatchKeyDown",this)&&c(h(n.prototype),"onDispatchKeyDown",this).call(this,t)}},{key:"onFocus",value:function(){c(h(n.prototype),"onFocus",this)&&c(h(n.prototype),"onFocus",this).call(this)}},{key:"onBlur",value:function(){c(h(n.prototype),"onBlur",this)&&c(h(n.prototype),"onBlur",this).call(this)}},{key:"changeFocus",value:function(t,e){return this.__control.changeFocus(t,e)}},{key:"_updateRef",value:function(t){this.__control.updateRef(t)}},{key:"render",value:function(){var t=c(h(n.prototype),"render",this).call(this),e=this.props,i=e.branchName;e.children;return r.createElement(V,{branchName:i,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onDispatchKeyUp:this.onDispatchKeyUp,onDispatchKeyDown:this.onDispatchKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,_updateFN:this._updateRef},t)}}]),n}()},Object.defineProperty(t,"__esModule",{value:!0})});
